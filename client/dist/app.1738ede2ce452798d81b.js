!function(e){function t(t){for(var a,s,o=t[0],l=t[1],c=t[2],d=0,m=[];d<o.length;d++)s=o[d],Object.prototype.hasOwnProperty.call(n,s)&&n[s]&&m.push(n[s][0]),n[s]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(u&&u(t);m.length;)m.shift()();return i.push.apply(i,c||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],a=!0,o=1;o<r.length;o++){var l=r[o];0!==n[l]&&(a=!1)}a&&(i.splice(t--,1),e=s(s.s=r[0]))}return e}var a={},n={0:0},i=[];function s(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=a,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(r,a,function(t){return e[t]}.bind(null,a));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/static/";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;i.push([1100,2]),r()}({1100:function(e,t,r){r(2741),r(2737),e.exports=r(2738)},1112:function(e,t,r){var a={"./en-au":651,"./en-au.js":651,"./en-ca":652,"./en-ca.js":652,"./en-gb":653,"./en-gb.js":653,"./en-ie":654,"./en-ie.js":654,"./en-il":655,"./en-il.js":655,"./en-in":656,"./en-in.js":656,"./en-nz":657,"./en-nz.js":657,"./en-sg":658,"./en-sg.js":658};function n(e){var t=i(e);return r(t)}function i(e){if(!r.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=i,e.exports=n,n.id=1112},146:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/redash_icon_small.png"},1569:function(e,t){},2634:function(e,t,r){var a={"./avatar.svg":659,"./db-logos/Cassandra.png":2635,"./db-logos/arangodb.png":2636,"./db-logos/athena.png":2637,"./db-logos/aws_es.png":2638,"./db-logos/axibasetsd.png":2639,"./db-logos/azure_kusto.png":2640,"./db-logos/bigquery.png":2641,"./db-logos/bigquery_gce.png":2642,"./db-logos/clickhouse.png":2643,"./db-logos/cloudwatch.png":2644,"./db-logos/cloudwatch_insights.png":2645,"./db-logos/cockroach.png":2646,"./db-logos/corporate_memory.png":2647,"./db-logos/couchbase.png":2648,"./db-logos/csv.png":2649,"./db-logos/databend.png":2650,"./db-logos/databricks.png":2651,"./db-logos/db2.png":2652,"./db-logos/dgraph.png":2653,"./db-logos/drill.png":2654,"./db-logos/druid.png":2655,"./db-logos/e6data.png":2656,"./db-logos/elasticsearch.png":2657,"./db-logos/elasticsearch2.png":2658,"./db-logos/elasticsearch2_OpenDistroSQLElasticSearch.png":2659,"./db-logos/elasticsearch2_XPackSQLElasticSearch.png":2660,"./db-logos/exasol.png":2661,"./db-logos/excel.png":2662,"./db-logos/firebolt.png":2663,"./db-logos/google_analytics.png":2664,"./db-logos/google_analytics4.png":2665,"./db-logos/google_search_console.png":2666,"./db-logos/google_spreadsheets.png":2667,"./db-logos/graphite.png":2668,"./db-logos/hive.png":2669,"./db-logos/hive_http.png":2670,"./db-logos/ignite.png":2671,"./db-logos/impala.png":2672,"./db-logos/influxdb.png":2673,"./db-logos/influxdbv2.png":2674,"./db-logos/jirajql.png":2675,"./db-logos/json.png":2676,"./db-logos/kibana.png":2677,"./db-logos/kylin.png":2678,"./db-logos/mapd.png":2679,"./db-logos/memsql.png":2680,"./db-logos/mongodb.png":2681,"./db-logos/mssql.png":2682,"./db-logos/mssql_odbc.png":2683,"./db-logos/mysql.png":2684,"./db-logos/nz.png":2685,"./db-logos/oracle.png":2686,"./db-logos/pg.png":2687,"./db-logos/phoenix.png":2688,"./db-logos/pinot.png":2689,"./db-logos/presto.png":2690,"./db-logos/prometheus.png":2691,"./db-logos/python.png":2692,"./db-logos/rds_mysql.png":2693,"./db-logos/redshift.png":2694,"./db-logos/redshift_iam.png":2695,"./db-logos/results.png":2696,"./db-logos/risingwave.png":2697,"./db-logos/rockset.png":2698,"./db-logos/salesforce.png":2699,"./db-logos/scylla.png":2700,"./db-logos/snowflake.png":2701,"./db-logos/sparql_endpoint.png":2702,"./db-logos/sqlite.png":2703,"./db-logos/tinybird.png":2704,"./db-logos/treasuredata.png":2705,"./db-logos/trino.png":2706,"./db-logos/uptycs.png":2707,"./db-logos/url.png":2708,"./db-logos/vertica.png":2709,"./db-logos/yandex_appmetrika.png":2710,"./db-logos/yandex_disk.png":2711,"./db-logos/yandex_metrika.png":2712,"./destinations/asana.png":2713,"./destinations/chatwork.png":2714,"./destinations/datadog.png":2715,"./destinations/discord.png":2716,"./destinations/email.png":2717,"./destinations/hangouts_chat.png":2718,"./destinations/mattermost.png":2719,"./destinations/microsoft_teams_webhook.png":2720,"./destinations/pagerduty.png":2721,"./destinations/slack.png":2722,"./destinations/webex.png":2723,"./destinations/webhook.png":2724,"./favicon-16x16.png":2725,"./favicon-32x32.png":2726,"./favicon-96x96.png":2727,"./fixtures/map-tile.png":2728,"./google_logo.svg":2729,"./illustrations/alert.svg":2730,"./illustrations/dashboard.svg":2731,"./illustrations/no-query-results.svg":2732,"./illustrations/query.svg":2733,"./logo.png":2734,"./logo_white.png":2735,"./redash_icon_small.png":146};function n(e){var t=i(e);return r(t)}function i(e){if(!r.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=i,e.exports=n,n.id=2634},2635:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/Cassandra.png"},2636:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/arangodb.png"},2637:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/athena.png"},2638:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/aws_es.png"},2639:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/axibasetsd.png"},2640:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/azure_kusto.png"},2641:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/bigquery.png"},2642:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/bigquery_gce.png"},2643:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/clickhouse.png"},2644:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/cloudwatch.png"},2645:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/cloudwatch_insights.png"},2646:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/cockroach.png"},2647:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/corporate_memory.png"},2648:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/couchbase.png"},2649:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/csv.png"},2650:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/databend.png"},2651:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/databricks.png"},2652:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/db2.png"},2653:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/dgraph.png"},2654:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/drill.png"},2655:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/druid.png"},2656:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/e6data.png"},2657:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/elasticsearch.png"},2658:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/elasticsearch2.png"},2659:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/elasticsearch2_OpenDistroSQLElasticSearch.png"},2660:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/elasticsearch2_XPackSQLElasticSearch.png"},2661:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/exasol.png"},2662:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/excel.png"},2663:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/firebolt.png"},2664:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/google_analytics.png"},2665:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/google_analytics4.png"},2666:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/google_search_console.png"},2667:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/google_spreadsheets.png"},2668:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/graphite.png"},2669:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/hive.png"},2670:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/hive_http.png"},2671:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/ignite.png"},2672:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/impala.png"},2673:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/influxdb.png"},2674:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/influxdbv2.png"},2675:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/jirajql.png"},2676:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/json.png"},2677:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/kibana.png"},2678:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/kylin.png"},2679:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/mapd.png"},2680:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/memsql.png"},2681:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/mongodb.png"},2682:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/mssql.png"},2683:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/mssql_odbc.png"},2684:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/mysql.png"},2685:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/nz.png"},2686:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/oracle.png"},2687:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/pg.png"},2688:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/phoenix.png"},2689:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/pinot.png"},2690:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/presto.png"},2691:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/prometheus.png"},2692:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/python.png"},2693:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/rds_mysql.png"},2694:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/redshift.png"},2695:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/redshift_iam.png"},2696:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/results.png"},2697:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/risingwave.png"},2698:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/rockset.png"},2699:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/salesforce.png"},2700:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/scylla.png"},2701:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/snowflake.png"},2702:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/sparql_endpoint.png"},2703:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/sqlite.png"},2704:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/tinybird.png"},2705:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/treasuredata.png"},2706:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/trino.png"},2707:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/uptycs.png"},2708:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/url.png"},2709:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/vertica.png"},2710:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/yandex_appmetrika.png"},2711:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/yandex_disk.png"},2712:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/db-logos/yandex_metrika.png"},2713:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/asana.png"},2714:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/chatwork.png"},2715:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/datadog.png"},2716:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/discord.png"},2717:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/email.png"},2718:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/hangouts_chat.png"},2719:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/mattermost.png"},2720:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/microsoft_teams_webhook.png"},2721:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/pagerduty.png"},2722:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/slack.png"},2723:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/webex.png"},2724:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/destinations/webhook.png"},2725:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/favicon-16x16.png"},2726:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/favicon-32x32.png"},2727:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/favicon-96x96.png"},2728:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/fixtures/map-tile.png"},2729:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/google_logo.svg"},2730:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/illustrations/alert.svg"},2731:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/illustrations/dashboard.svg"},2732:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/illustrations/no-query-results.svg"},2733:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/illustrations/query.svg"},2734:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/logo.png"},2735:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/logo_white.png"},2736:function(e,t){function r(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}r.keys=function(){return[]},r.resolve=r,e.exports=r,r.id=2736},2737:function(e,t,r){"use strict";r.r(t)},2738:function(e,t,r){"use strict";r.r(t)},2741:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),i=r(38),s=r.n(i),o=(r(11),r(13),r(15),r(12)),l=r.n(o),c=r(2),u=r.n(c),d=(r(659),r(69)),m=r(68),p=r.n(m),f=(r(8),r(9)),h=r.n(f),b=["children"],g=["children"],y=["icon","alt","children"],v=["icon","alt"];function O(){return(O=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function E(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function j(e){var t=e.children,r=E(e,g);return n.a.createElement(j.Component,r,t)}function w(e){return n.a.createElement(w.Component,e)}j.Component=function(e){var t=e.children,r=E(e,b);return n.a.createElement("a",r,t)},j.WithIcon=function(e){var t=e.icon,r=e.alt,a=e.children,i=E(e,y);return n.a.createElement(j.Component,i,a," ",t," ",n.a.createElement("span",{className:"sr-only"},r))},j.External=function(e){var t=e.icon,r=void 0===t?n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}):t,a=e.alt,i=void 0===a?"(opens in a new tab)":a,s=E(e,v);return n.a.createElement(j.WithIcon,O({target:"_blank",rel:"noopener noreferrer",icon:r,alt:i},s))},w.Component=function(e){return n.a.createElement(h.a,e)},j.Button=w;var S=j,P=r(188),C=r.n(P),N=r(214),k=r.n(N),_=(r(108),r(264),r(129)),A=r.n(_),x=r(1097),q=Object(x.a)();function T(e){var t=e.pathname,r=e.search,a=e.hash,n={};return n.path=t,n.search=Object(c.mapValues)(A.a.parse(r),e=>!!Object(c.isNil)(e)||e),n.hash=Object(c.trimStart)(a,"#"),n.url="".concat(t).concat(r).concat(a),n}var I={listen:e=>Object(c.isFunction)(e)?q.listen((t,r)=>e(I,r)):()=>{},confirmChange:e=>Object(c.isFunction)(e)?q.block(t=>e(T(t),I)):()=>{},update(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(c.isObject)(e)&&(e=Object(c.omitBy)({pathname:e.path,search:e.search,hash:e.hash},c.isUndefined),e=Object(c.extend)({pathname:I.path,search:I.search,hash:I.hash},e),Object(c.isObject)(e.search)&&(e.search=Object(c.omitBy)(Object(c.extend)({},I.search,e.search),c.isNil),e.search=Object(c.mapValues)(e.search,e=>!0===e?null:e),e.search=A.a.stringify(e.search))),t?q.replace(e):q.push(e)},url:void 0,path:void 0,setPath(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I.update({path:e},t)},search:void 0,setSearch(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I.update({search:e},t)},hash:void 0,setHash(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];I.update({hash:e},t)}};function D(){Object(c.extend)(I,T(q.location))}q.listen(D),D();var R=I,M=r(634),z=r.n(M),F=r(638),L=r.n(F),U=r(27),V=r.n(U);function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){W(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function W(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function H(e,t){var r=null;V.a.warning({content:"Your session has expired. Please login to continue.",okText:n.a.createElement(n.a.Fragment,null,"Login ",n.a.createElement("i",{className:"fa fa-external-link m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")),centered:!0,mask:!0,maskClosable:!1,keyboard:!1,onOk:a=>{if(!r||r.closed){var n,i,s,o,l,u,d=Q(Q({},(n=640,i=640,s=window.screenX,o=window.screenY,l=window.innerWidth,u=window.innerHeight,{left:Math.floor((l-n)/2+s),top:Math.floor((u-i)/2+o),width:Math.floor(n),height:Math.floor(i)})),{},{menubar:"no",toolbar:"no",location:"yes",resizable:"yes",scrollbars:"yes",status:"yes"});r=window.open(e,"Restore Session",Object(c.map)(d,(e,t)=>"".concat(t,"=").concat(e)).join(","));var m=e=>{"redash_session_restored"===e.data.type&&(r&&r.close(),r=null,window.removeEventListener("message",m),a(),t())};window.addEventListener("message",m,!1)}else r.focus()}})}var G=null;var K=z.a.create({paramsSerializer:e=>A.a.stringify(e),xsrfCookieName:"csrf_token",xsrfHeaderName:"X-CSRF-TOKEN"});K.interceptors.response.use(e=>e.data);L()(K,e=>{var t=Object(c.get)(e,"response.data.message");return e.isAxiosError&&Object(c.includes)(t,"CSRF")?K.get("/ping"):Promise.reject(e)},{statusCodes:[400]}),L()(K,e=>{var t=parseInt(Object(c.get)(e,"response.status")),r=Object(c.get)(e,"response.data.message"),a=Object(c.get)(e,"config.url");return e.isAxiosError&&(401===t||Object(c.includes)(r,"Please login"))&&"api/session"!==a?(G||(G=new Promise(e=>{H(re.getLoginUrl(),()=>{G=null,e()})})),G):Promise.reject(e)},{statusCodes:[401,404],pauseInstanceWhileRefreshing:!1});K.interceptors.request.use(e=>{var t=re.getApiKey();return t&&(e.headers.Authorization="Key ".concat(t)),e});var Y={_isAdmin:void 0,canEdit(e){var t=e.user_id||e.user&&e.user.id;return this.isAdmin||t&&t===this.id},canCreate(){return this.hasPermission("create_query")||this.hasPermission("create_dashboard")||this.hasPermission("list_alerts")},hasPermission(e){return"admin"===e&&void 0!==this._isAdmin?this._isAdmin:Object(c.includes)(this.permissions,e)},get isAdmin(){return this.hasPermission("admin")},set isAdmin(e){this._isAdmin=e}},$={},J=[],X=k()("redash:auth"),Z={loaded:!1},ee={Login:"login"};function te(e){X("Updating session to be:",e),Object(c.extend)(Z,e,{loaded:!0}),Object(c.extend)(Y,Z.user),Object(c.extend)($,Z.client_config),Object(c.extend)(J,Z.messages)}var re={isAuthenticated:()=>Z.loaded&&Z.user.id,getLoginUrl:()=>ee.Login,setLoginUrl(e){ee.Login=e},login(){var e=encodeURI(R.url);X("Calling login with next = %s",e),window.location.href="".concat(ee.Login,"?next=").concat(e)},logout(){X("Logout."),window.location.href="logout"},loadSession:()=>(X("Loading session"),Z.loaded&&Z.user.id?(X("Resolving with local value."),Promise.resolve(Z)):(re.setApiKey(null),K.get("api/session").then(e=>(te(e),Z)))),loadConfig:()=>(X("Loading config"),K.get("/api/config").then(e=>(te({client_config:e.client_config,user:{permissions:[]},messages:[]}),e))),setApiKey(e){X("Set API key to: %s",e),re.apiKey=e},getApiKey:()=>re.apiKey,requireSession:()=>(X("Requested authentication"),re.isAuthenticated()?Promise.resolve(Z):re.loadSession().then(()=>{if(re.isAuthenticated())return X("Loaded session"),window.opener&&window.opener.postMessage({type:"redash_session_restored"},window.location.origin),Z;X("Need to login, redirecting"),re.login()}).catch(()=>{X("Need to login, redirecting"),re.login()}))};var ae=new class{refresh(){return Promise.resolve(this)}canCreateDataSource(){return Y.isAdmin}isCreateDataSourceEnabled(){return Y.isAdmin}canCreateDestination(){return Y.isAdmin}isCreateDestinationEnabled(){return Y.isAdmin}canCreateDashboard(){return Y.hasPermission("create_dashboard")}isCreateDashboardEnabled(){return Y.hasPermission("create_dashboard")}canCreateAlert(){return!0}canCreateUser(){return Y.isAdmin}isCreateUserEnabled(){return Y.isAdmin}isCreateQuerySnippetEnabled(){return!0}getDashboardRefreshIntervals(){var e=$.dashboardRefreshIntervals;return Object(c.isArray)(e)?e:null}getQueryRefreshIntervals(){var e=$.queryRefreshIntervals;return Object(c.isArray)(e)?e:null}canEdit(e){return Object(c.get)(e,"can_edit",!1)}canRun(){return!0}};var ne=new class{constructor(){this.objectCounters={}}refresh(){return K.get("api/organization/status").then(e=>(this.objectCounters=e.object_counters,this))}},ie=(r(604),r(606),r(1)),se=r.n(ie),oe=["name","children","fallback"];function le(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function ce(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ue=new Map,de=new Set;function me(e,t){Object(c.isString)(e)&&""!==e&&(ue.set(e,Object(c.isFunction)(t)?t:null),de.forEach(t=>{t.props.name===e&&t.forceUpdate()}))}class pe extends n.a.Component{componentDidMount(){de.add(this)}componentWillUnmount(){de.delete(this)}render(){var e=this.props,t=e.name,r=e.children,a=e.fallback,i=le(e,oe),s=ue.get(t);return s?n.a.createElement(s,i,r):Object(c.isUndefined)(a)?r:a}}ce(pe,"propTypes",{name:se.a.string.isRequired,fallback:se.a.node,children:se.a.node}),ce(pe,"defaultProps",{children:null});var fe=r(16),he=r.n(fe),be=r(4),ge=r.n(be),ye=["className","type"];function ve(){return(ve=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Oe(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Ee=function(e){var t=e.className,r=e.type,a=Oe(e,ye);return n.a.createElement("button",ve({className:ge()("plain-button","clickable",{"plain-button-link":"link"===r},t),type:"button"},a))},je=r(114),we=r.n(je),Se=["title"];function Pe(){return(Pe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Ce(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Ne(e){var t=e.title,r=Ce(e,Se),a=Object(c.isNil)(t)?null:n.a.createElement("span",{role:"status","aria-live":"assertive","aria-relevant":"additions"},t);return n.a.createElement(we.a,Pe({trigger:["hover","focus"],title:a},r))}var ke=r(1068),_e=r.n(ke),Ae=r(75),xe=r.n(Ae);function qe(e){var t,r;return(t=()=>Object(c.uniqueId)(e),null===(r=Object(a.useRef)(null)).current&&(r.current=t()),r).current}function Te(e){var t=e.message,r=e.icon,a=e.children,i=e.className,s=qe("bm-message");return n.a.createElement("div",{className:"big-message p-15 text-center "+i,role:"status","aria-live":"assertive","aria-relevant":"additions removals"},n.a.createElement("h3",{className:"m-t-0 m-b-0","aria-labelledby":s},n.a.createElement("i",{className:ge()("fa",r),"aria-hidden":"true"})),n.a.createElement("br",null),n.a.createElement("span",{id:s},t),a)}Te.propTypes={message:se.a.string,icon:se.a.string.isRequired,children:se.a.node,className:se.a.string},Te.defaultProps={message:"",children:null,className:"tiled bg-white"};var Ie=Te;function De(){return(De=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(r),!0).forEach((function(t){ze(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ze(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Le(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Le(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var Ue=Object(c.mapValues)({HOME:["","Help"],VALUE_SOURCE_OPTIONS:["/user-guide/querying/query-parameters#Value-Source-Options","Guide: Value Source Options"],SHARE_DASHBOARD:["/user-guide/dashboards/sharing-dashboards","Guide: Sharing and Embedding Dashboards"],AUTHENTICATION_OPTIONS:["/user-guide/users/authentication-options","Guide: Authentication Options"],DS_ATHENA:["/data-sources/amazon-athena-setup","Guide: Help Setting up Amazon Athena"],DS_BIGQUERY:["/data-sources/bigquery-setup","Guide: Help Setting up BigQuery"],DS_URL:["/data-sources/querying-urls","Guide: Help Setting up URL"],DS_MONGODB:["/data-sources/mongodb-setup","Guide: Help Setting up MongoDB"],DS_GOOGLE_SPREADSHEETS:["/data-sources/querying-a-google-spreadsheet","Guide: Help Setting up Google Spreadsheets"],DS_GOOGLE_ANALYTICS:["/data-sources/google-analytics-setup","Guide: Help Setting up Google Analytics"],DS_AXIBASETSD:["/data-sources/axibase-time-series-database","Guide: Help Setting up Axibase Time Series"],DS_RESULTS:["/user-guide/querying/query-results-data-source","Guide: Help Setting up Query Results"],ALERT_SETUP:["/user-guide/alerts/setting-up-an-alert","Guide: Setting Up a New Alert"],MAIL_CONFIG:["/open-source/setup/#Mail-Configuration","Guide: Mail Configuration"],ALERT_NOTIF_TEMPLATE_GUIDE:["/user-guide/alerts/custom-alert-notifications","Guide: Custom Alerts Notifications"],FAVORITES:["/user-guide/querying/favorites-tagging/#Favorites","Guide: Favorites"],MANAGE_PERMISSIONS:["/user-guide/querying/writing-queries#Managing-Query-Permissions","Guide: Managing Query Permissions"],NUMBER_FORMAT_SPECS:["/user-guide/visualizations/formatting-numbers","Formatting Numbers"],GETTING_STARTED:["/user-guide/getting-started","Guide: Getting Started"],DASHBOARDS:["/user-guide/dashboards","Guide: Dashboards"],QUERIES:["/user-guide/querying","Guide: Queries"],ALERTS:["/user-guide/alerts","Guide: Alerts"]},e=>{var t=Fe(e,2);return["https://redash.io/help"+t[0],t[1]]}),Ve={type:se.a.string,href:se.a.string,title:se.a.node,className:se.a.string,showTooltip:se.a.bool,renderAsLink:se.a.bool,children:se.a.node},Be={type:null,href:null,title:null,className:null,showTooltip:!0,renderAsLink:!1,children:n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"})};function Qe(e){return n.a.createElement(pe,De({},e,{name:"HelpTrigger"}))}me("HelpTrigger",function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return t=class extends n.a.Component{constructor(){super(...arguments),ze(this,"iframeRef",n.a.createRef()),ze(this,"iframeLoadingTimeout",null),ze(this,"state",{visible:!1,loading:!1,error:!1,currentUrl:null}),ze(this,"loadIframe",e=>{clearTimeout(this.iframeLoadingTimeout),this.setState({loading:!0,error:!1}),this.iframeRef.current.src=e,this.iframeLoadingTimeout=setTimeout(()=>{this.setState({error:e,loading:!1})},2e4)}),ze(this,"onIframeLoaded",()=>{this.setState({loading:!1}),clearTimeout(this.iframeLoadingTimeout)}),ze(this,"onPostMessageReceived",e=>{if(Object(c.some)(r,t=>Object(c.startsWith)(e.origin,t))){var t=e.data||{},a=t.type,n=t.message;"iframe_url"===a&&this.setState({currentUrl:n})}}),ze(this,"getUrl",()=>{var t=Object(c.get)(e,this.props.type);return t?t[0]:this.props.href}),ze(this,"openDrawer",e=>{e.shiftKey||e.ctrlKey||e.metaKey||(e.preventDefault(),this.setState({visible:!0}),setTimeout(()=>this.loadIframe(this.getUrl()),300))}),ze(this,"closeDrawer",e=>{e&&e.preventDefault(),this.setState({visible:!1}),this.setState({visible:!1,currentUrl:null})})}componentDidMount(){window.addEventListener("message",this.onPostMessageReceived,!1)}componentWillUnmount(){window.removeEventListener("message",this.onPostMessageReceived),clearTimeout(this.iframeLoadingTimeout)}render(){var t=this.getUrl();if(!t)return null;var i=Object(c.get)(e,"".concat(this.props.type,"[1]"),this.props.title),s=ge()("help-trigger",this.props.className),o=this.state.currentUrl,l=Object(c.some)(r,e=>Object(c.startsWith)(o||t,e)),u=this.props.renderAsLink||!l;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Ne,{title:this.props.showTooltip?n.a.createElement(n.a.Fragment,null,i,u&&n.a.createElement(n.a.Fragment,null," ",n.a.createElement("i",{className:"fa fa-external-link",style:{marginLeft:5},"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))):null},n.a.createElement(S,{href:o||this.getUrl(),className:s,rel:"noopener noreferrer",target:"_blank",onClick:u?()=>{}:this.openDrawer},this.props.children)),n.a.createElement(_e.a,{placement:"right",closable:!1,onClose:this.closeDrawer,visible:this.state.visible,className:ge()("help-drawer",a),destroyOnClose:!0,width:400},n.a.createElement("div",{className:"drawer-wrapper"},n.a.createElement("div",{className:"drawer-menu"},o&&n.a.createElement(Ne,{title:"Open page in a new window",placement:"left"},n.a.createElement(S,{href:o,target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))),n.a.createElement(Ne,{title:"Close",placement:"bottom"},n.a.createElement(Ee,{onClick:this.closeDrawer},n.a.createElement(xe.a,null)))),!this.state.error&&n.a.createElement("iframe",{ref:this.iframeRef,title:"Usage Help",src:"about:blank",className:ge()({ready:!this.state.loading}),onLoad:this.onIframeLoaded}),this.state.loading&&n.a.createElement(Ie,{icon:"fa-spinner fa-2x fa-pulse",message:"Loading...",className:"help-message"}),this.state.error&&n.a.createElement(Ie,{icon:"fa-exclamation-circle",className:"help-message"},"Something went wrong.",n.a.createElement("br",null),n.a.createElement(S,{href:this.state.error,target:"_blank",rel:"noopener"},"Click here")," ","to open the page in a new window.")),n.a.createElement(pe,{name:"HelpDrawerExtraContent",onLeave:this.closeDrawer,openPageUrl:this.loadIframe})))}},ze(t,"propTypes",Me(Me({},Ve),{},{type:se.a.oneOf(Object.keys(e))})),ze(t,"defaultProps",Be),t}(Ue,["https://redash.io"])),Qe.propTypes=Ve,Qe.defaultProps=Be;var We=r(26),He=r.n(We);r(80);function Ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(r),!0).forEach((function(t){Ye(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ye(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $e(){return($e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var Je=se.a.shape({props:se.a.shape({visible:se.a.bool,onOk:se.a.func,onCancel:se.a.func,afterClose:se.a.func}).isRequired,close:se.a.func.isRequired,dismiss:se.a.func.isRequired});function Xe(e){return{Component:e,showModal:t=>function(e,t){var r={props:{visible:!0,okButtonProps:{},cancelButtonProps:{},onOk:()=>{},onCancel:()=>{},afterClose:()=>{}},close:()=>{},dismiss:()=>{}},a=null,i={onClose:()=>{},onDismiss:()=>{}},o=document.createElement("div");function l(){s.a.render(n.a.createElement(e,$e({},t,{dialog:r})),o)}function u(e,t){return r.props.okButtonProps={disabled:!0},r.props.cancelButtonProps={disabled:!0},t(),l(),Promise.resolve(e).then(()=>{r.props.visible=!1}).finally(()=>{r.props.okButtonProps={},r.props.cancelButtonProps={},l()})}function d(e){return a||(a=u(i.onClose(e),()=>{r.props.okButtonProps.loading=!0}).finally(()=>{a=null})),a}function m(e){return a||(a=u(i.onDismiss(e),()=>{r.props.cancelButtonProps.loading=!0}).finally(()=>{a=null})),a}document.body.appendChild(o),r.props.onOk=d,r.props.onCancel=m,r.props.afterClose=function(){setTimeout(()=>{s.a.unmountComponentAtNode(o),document.body.removeChild(o)},10)},r.close=d,r.dismiss=m;var p={close:d,dismiss:m,update:e=>{t=Ke(Ke({},t),e),l()},onClose:e=>(Object(c.isFunction)(e)&&(i.onClose=e),p),onDismiss:e=>(Object(c.isFunction)(e)&&(i.onDismiss=e),p)};return l(),p}(e,t)}}var Ze=document.createElement("a");Ze.style.display="none",document.body.appendChild(Ze);var et=["origin","protocol","host","hostname","port","pathname","search","hash","href"];var tt={parse:function(e){return Ze.setAttribute("href",e),Object(c.pick)(Ze,et)},stringify:function(e){return Object(c.extend)(Ze,Object(c.pick)(e,et)),Ze.href},normalize:function(e){return Ze.setAttribute("href",e),Ze.href}},rt=(r(122),r(1069));function at(e){return n.a.createElement("h4",null,e.message)}function nt(){return(nt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function it(e,t){switch(e){case 404:return"It seems like the page you're looking for cannot be found.";case 401:case 403:return"It seems like you don’t have permission to see this page.";default:return t}}function st(e){var t="It seems like we encountered an error. Try refreshing this page or contact your administrator.";if(Object(c.isObject)(e)){if(e.isAxiosError&&Object(c.isObject)(e.response))return it(e.response.status,Object(c.get)(e,"response.data.message",t));if(e.status)return it(e.status,t)}return t}function ot(e){var t=e.error,r=e.message;if(!t)return null;console.error(t);var a={error:t,message:r||st(t)};return n.a.createElement("div",{className:"error-message-container","data-test":"ErrorMessage",role:"alert"},n.a.createElement("div",{className:"error-state bg-white tiled"},n.a.createElement("div",{className:"error-state__icon"},n.a.createElement("i",{className:"zmdi zmdi-alert-circle-o","aria-hidden":"true"})),n.a.createElement("div",{className:"error-state__details"},n.a.createElement(pe,nt({name:"ErrorMessageDetails",fallback:n.a.createElement(at,a)},a)))))}function lt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function ct(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?lt(Object(r),!0).forEach((function(t){ut(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ut(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return mt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}at.propTypes={error:se.a.instanceOf(Error).isRequired,message:se.a.string.isRequired},ot.propTypes={error:se.a.object.isRequired,message:se.a.string};var pt=n.a.createContext(null);function ft(e){var t=Object(c.trimEnd)(tt.normalize(""),"/")+"/";return e=tt.normalize(e),!!Object(c.startsWith)(e,t)&&"/"+Object(c.trimStart)(e.substr(t.length),"/")}function ht(e){var t=e.routes,r=e.onRouteChange,i=dt(Object(a.useState)(null),2),s=i[0],o=i[1],l=Object(a.useRef)(null),u=Object(a.useRef)();return Object(a.useEffect)(()=>{var e=!1,r=new rt.a(t,{resolveRoute(e,t){var r=e.route;if(Object(c.isFunction)(r.render))return ct(ct({},r),{},{routeParams:t})}});function a(t){if(!e){u.current&&u.current.reset();var a=ft(R.path)||"/";if(a===l.current)return;if(l.current=a,"REPLACE"===t)return;r.resolve({pathname:a}).then(t=>{e||l.current!==a||o(ct(ct({},t),{},{key:Math.random().toString(32).substr(2)}))}).catch(t=>{e||l.current!==a||o({render:e=>n.a.createElement(ot,e.routeParams),routeParams:{error:t}})})}}a("PUSH");var i=R.listen((e,t)=>a(t));return()=>{e=!0,l.current=null,i()}},[t]),Object(a.useEffect)(()=>{r(s)},[s,r]),s?n.a.createElement(pt.Provider,{value:s},n.a.createElement(C.a,{ref:u,renderError:e=>n.a.createElement(ot,{error:e})},s.render(s))):null}function bt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];setTimeout(()=>{!1===ft(e)?window.location=e:(e=tt.parse(e),R.update({path:e.pathname,search:e.search,hash:e.hash},t))},10)}ht.propTypes={routes:se.a.arrayOf(se.a.shape({path:se.a.string.isRequired,render:se.a.func,resolve:se.a.objectOf(se.a.any)})),onRouteChange:se.a.func},ht.defaultProps={routes:[],onRouteChange:()=>{}};var gt=[],yt=Object(c.debounce)(()=>{var e=gt;gt=[],K.post("api/events",e)},1e3);function vt(e,t,r,a){var n={action:e,object_type:t,object_id:r,timestamp:Date.now()/1e3,screen_resolution:"".concat(window.screen.width,"x").concat(window.screen.height)};Object(c.extend)(n,a),gt.push(n),yt()}r(2401);var Ot=6,Et=50,jt=15,wt=800,St=3,Pt=3,Ct=1,Nt=6,kt=1,_t=1e3;var At=class{constructor(e,t){this.title=e.title,this.name=e.name,this.type=e.type,this.global=e.global,this.parentQueryId=t,this.locals=[],this.urlPrefix="p_"}static getExecutionValue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(c.isObject)(e)&&Object(c.isFunction)(e.getExecutionValue)?e.getExecutionValue(t):null}static setValue(e,t){return Object(c.isObject)(e)&&Object(c.isFunction)(e.setValue)?e.setValue(t):null}get isEmpty(){return Object(c.isNull)(this.normalizedValue)}get hasPendingValue(){return void 0!==this.pendingValue&&!Object(c.isEqual)(this.pendingValue,this.normalizedValue)}get normalizedValue(){return this.$$value}isEmptyValue(e){return Object(c.isNull)(this.normalizeValue(e))}normalizeValue(e){return Object(c.isUndefined)(e)?null:e}updateLocals(){Object(c.isArray)(this.locals)&&Object(c.each)(this.locals,e=>{e.setValue(this.value)})}setValue(e){var t=this.normalizeValue(e);return this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){return this.value}setPendingValue(e){this.pendingValue=this.normalizeValue(e)}applyPendingValue(){this.hasPendingValue&&this.setValue(this.pendingValue)}clearPendingValue(){this.pendingValue=void 0}toUrlParams(){var e=this.urlPrefix;return{["".concat(e).concat(this.name)]:this.isEmpty?null:this.value}}fromUrlParams(e){var t=this.urlPrefix,r="".concat(t).concat(this.name);Object(c.has)(e,r)&&this.setValue(e[r])}toQueryTextFragment(){return"{{ ".concat(this.name," }}")}toSaveableObject(){return Object(c.omit)(this,["$$value","urlPrefix","pendingValue","parentQueryId"])}};var xt=class extends At{constructor(e,t){super(e,t),this.setValue(e.value)}normalizeValue(e){var t=Object(c.toString)(e);return Object(c.isEmpty)(t)?null:t}};var qt=class extends At{constructor(e,t){super(e,t),this.setValue(e.value)}normalizeValue(e){if(Object(c.isNull)(e))return null;var t=Object(c.toNumber)(e);return isNaN(t)?null:t}};r(186);var Tt=class extends At{constructor(e,t){super(e,t),this.enumOptions=e.enumOptions,this.multiValuesOptions=e.multiValuesOptions,this.setValue(e.value)}normalizeValue(e){if(Object(c.isEmpty)(this.enumOptions))return null;var t=this.enumOptions.split("\n")||[];return this.multiValuesOptions?(Object(c.isArray)(e)||(e=[e]),e=Object(c.intersection)(e,t)):e&&!Object(c.isArray)(e)&&Object(c.includes)(t,e)||(e=t[0]),Object(c.isArray)(e)&&Object(c.isEmpty)(e)?null:e}getExecutionValue(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).joinListValues&&Object(c.isArray)(this.value)){var e=Object(c.get)(this.multiValuesOptions,"separator",","),t=Object(c.get)(this.multiValuesOptions,"prefix",""),r=Object(c.get)(this.multiValuesOptions,"suffix",""),a=Object(c.map)(this.value,e=>"".concat(t).concat(e).concat(r));return Object(c.join)(a,e)}return this.value}toUrlParams(){var e=this.urlPrefix,t=this.value;return this.multiValuesOptions&&Object(c.isArray)(this.value)&&(t=JSON.stringify(this.value)),{["".concat(e).concat(this.name)]:this.isEmpty?null:t}}fromUrlParams(e){var t=this.urlPrefix,r="".concat(t).concat(this.name);if(Object(c.has)(e,r))if(this.multiValuesOptions)try{var a=JSON.parse(e[r]);this.setValue(Object(c.isArray)(a)?a:e[r])}catch(t){this.setValue(e[r])}else this.setValue(e[r])}},It=(r(1018),r(343)),Dt=r.n(It),Rt=k()("redash:services:QueryResult"),Mt=["filter","multi-filter","multiFilter"];function zt(e){return function(e){var t;if(-1!==e.indexOf("::"))t="::";else{if(-1===e.indexOf("__"))return e;t="__"}var r=e.split(t);return""===r[0]&&2===r.length?r[1]:Object(c.includes)(Mt,r[1])?r[0]:e}(e).replace(/(?:^|\s)\S/g,e=>e.toUpperCase())}var Ft=e=>{var t=e.id;return K.get("api/query_results/".concat(t))},Lt=e=>K.post((e=>e.id?"api/query_results/".concat(e.id):"api/query_results")(e),e),Ut="waiting",Vt="processing",Bt="done",Qt="failed",Wt="loading-result",Ht={1:Ut,2:Vt,3:Bt,4:Qt};function Gt(e,t){switch(Object(c.get)(t,"response.status")){case 403:return void e.update(t.response.data);case 400:if("job"in t.response.data)return void e.update(t.response.data);break;case 404:return void e.update({job:{error:"cached query result unavailable, please execute again.",status:4}})}Rt("Unknown error",t),e.update({job:{error:Object(c.get)(t,"response.data.message","Unknown error occurred. Please try again later."),status:4}})}function Kt(e){return new Promise(t=>setTimeout(t,e))}function Yt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;return K.get("api/jobs/".concat(e)).then(e=>{var r=Ht[e.job.status];return r===Ut||r===Vt?Kt(t).then(()=>Yt(e.job.id)):r===Bt?e.job.result:r===Qt?Promise.reject(e.job.error):void 0})}class $t{constructor(e){var t;this.deferred=((t={onStatusChange:e=>{}}).promise=new Promise((e,r)=>{t.resolve=e,t.reject=r}),t),this.job={},this.query_result={},this.status="waiting",this.updatedAt=l()(),this.isLoadingResult=!1,e&&this.update(e)}update(e){if(Object(c.extend)(this,e),"query_result"in e){this.status=Bt,this.deferred.onStatusChange(Bt);var t={};Object(c.each)(this.query_result.data.rows,e=>{Object(c.forOwn)(e,(r,a)=>{var n=null;Object(c.isNumber)(r)?n="float":!function(e){return Object(c.isString)(e)&&l()(e).isValid()&&/^\d{4}-\d{2}-\d{2}T/.test(e)}(r)?Object(c.isString)(r)&&r.match(/^\d{4}-\d{2}-\d{2}$/)?(e[a]=l.a.utc(r),n="date"):"object"==typeof r&&null!==r?e[a]=JSON.stringify(r):n="string":(e[a]=l.a.utc(r),n="datetime"),null!==n&&(void 0!==t[a]&&t[a]!==n?t[a]="string":t[a]=n)})}),Object(c.each)(this.query_result.data.columns,e=>{e.name=""+e.name,t[e.name]&&(null!=e.type&&"string"!==e.type||(e.type=t[e.name]))}),this.deferred.resolve(this)}else 3===this.job.status||2===this.job.status?(this.deferred.onStatusChange(Vt),this.status="processing"):4===this.job.status?(this.status=Ht[this.job.status],this.deferred.reject(new or(this.job.error))):(this.deferred.onStatusChange(void 0),this.status=void 0)}getId(){var e=null;return"query_result"in this&&(e=this.query_result.id),e}cancelExecution(){K.delete("api/jobs/".concat(this.job.id))}getStatus(){return this.isLoadingResult?Wt:this.status||Ht[this.job.status]}getError(){if("None"!==this.job.error)return this.job.error}getLog(){return this.query_result.data&&this.query_result.data.log&&0!==this.query_result.data.log.length?this.query_result.data.log:null}getUpdatedAt(){return this.query_result.retrieved_at||1e3*this.job.updated_at||this.updatedAt}getRuntime(){return this.query_result.runtime}getRawData(){return this.query_result.data?this.query_result.data.rows:null}getData(){return this.query_result.data?this.query_result.data.rows:null}isEmpty(){return null===this.getData()||0===this.getData().length}getColumns(){return void 0===this.columns&&this.query_result.data&&(this.columns=this.query_result.data.columns),this.columns}getColumnNames(){return void 0===this.columnNames&&this.query_result.data&&(this.columnNames=this.query_result.data.columns.map(e=>e.name)),this.columnNames}getColumnFriendlyNames(){return this.getColumnNames().map(e=>zt(e))}getTruncated(){return this.query_result.data?this.query_result.data.truncated:null}getFilters(){if(!this.getColumns())return[];var e=[];return this.getColumns().forEach(t=>{var r=t.name,a=r.split("::")[1]||r.split("__")[1];if(Object(c.includes)(Mt,a)){var n={name:r,friendlyName:zt(r),column:t,values:[],multiple:"multiFilter"===a||"multi-filter"===a};e.push(n)}},this),this.getRawData().forEach(t=>{e.forEach(e=>{e.values.push(t[e.name]),1===e.values.length&&(e.multiple?e.current=[t[e.name]]:e.current=t[e.name])})}),e.forEach(e=>{e.values=Object(c.uniqBy)(e.values,e=>l.a.isMoment(e)?e.unix():e),e.values.length>1&&e.multiple&&(e.current=e.values.slice())}),e}toPromise(e){return e&&(this.deferred.onStatusChange=e),this.deferred.promise}static getById(e,t){var r=new $t;return r.isLoadingResult=!0,r.deferred.onStatusChange(Wt),K.get("api/queries/".concat(e,"/results/").concat(t,".json")).then(e=>{r.isLoadingResult=!1,r.update(e)}).catch(e=>{r.isLoadingResult=!1,Gt(r,e)}),r}loadLatestCachedResult(e,t){K.post("api/queries/".concat(e,"/results"),{queryId:e,parameters:t}).then(e=>{this.update(e)}).catch(e=>{Gt(this,e)})}loadResult(e){this.isLoadingResult=!0,this.deferred.onStatusChange(Wt),Ft({id:this.job.query_result_id}).then(e=>{this.update(e),this.isLoadingResult=!1}).catch(t=>{void 0===e&&(e=0),e>3?(Rt("Connection error while trying to load result",t),this.update({job:{error:"failed communicating with server. Please check your Internet connection and try again.",status:4}}),this.isLoadingResult=!1):setTimeout(()=>{this.loadResult(e+1)},1e3*Math.pow(2,e))})}refreshStatus(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=()=>re.isAuthenticated()?this.loadResult():this.loadLatestCachedResult(e,t);(re.isAuthenticated()?K.get("api/jobs/".concat(this.job.id)):K.get("api/queries/".concat(e,"/jobs/").concat(this.job.id))).then(n=>{if(this.update(n),"processing"===this.getStatus()&&this.job.query_result_id&&"None"!==this.job.query_result_id)a();else if("failed"!==this.getStatus()){setTimeout(()=>{this.refreshStatus(e,t,r+1)},r>10?3e3:500)}}).catch(e=>{Rt("Connection error",e),this.update({job:{error:"failed communicating with server. Please check your Internet connection and try again.",status:4}})})}getLink(e,t,r){var a="api/queries/".concat(e,"/results/").concat(this.getId(),".").concat(t);return r&&(a="".concat(a,"?api_key=").concat(r)),a}getName(e,t){return"".concat(e.replace(/ /g,"_")+l()(this.getUpdatedAt()).format("_YYYY_MM_DD"),".").concat(t)}static getByQueryId(e,t,r,a){var n=new $t;return K.post("api/queries/".concat(e,"/results"),{id:e,parameters:t,apply_auto_limit:r,max_age:a}).then(r=>{n.update(r),"job"in r&&n.refreshStatus(e,t)}).catch(e=>{Gt(n,e)}),n}static get(e,t,r,a,n,i){var s=new $t,o={data_source_id:e,parameters:r,query:t,apply_auto_limit:a,max_age:n};return void 0!==i&&(o.query_id=i),Lt(o).then(e=>{s.update(e),"job"in e&&s.refreshStatus(t,r)}).catch(e=>{Gt(s,e)}),s}}var Jt=$t,Xt="localOptions:";var Zt={get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=Xt+e;return r in window.localStorage?JSON.parse(window.localStorage.getItem(r)):t},set:function(e,t){var r=Xt+e;window.localStorage.setItem(r,JSON.stringify(t))}};function er(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function tr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?er(Object(r),!0).forEach((function(t){rr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):er(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function rr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ar(){return(ar=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}Dt.a.escape=c.identity;var nr=k()("redash:services:query");class ir{constructor(e){Object(c.extend)(this,e),Object(c.has)(this,"options")||(this.options={}),this.options.apply_auto_limit=!!this.options.apply_auto_limit,Object(c.isArray)(this.options.parameters)||(this.options.parameters=[])}isNew(){return void 0===this.id}hasDailySchedule(){return this.schedule&&null!==this.schedule.match(/\d\d:\d\d/)}scheduleInLocalTime(){var e=this.schedule.split(":");return l.a.utc().hour(e[0]).minute(e[1]).local().format("HH:mm")}hasResult(){return!(!this.latest_query_data&&!this.latest_query_data_id)}paramsRequired(){return this.getParameters().isRequired()}hasParameters(){return this.getParametersDefs().length>0}prepareQueryResultExecution(e,t){var r=this.getParameters(),a=r.getMissing();if(a.length>0){var n="parameter",i="value";return a.length>1&&(n="parameters",i="values"),new Jt({job:{error:"missing ".concat(i," for ").concat(a.join(", ")," ").concat(n,"."),status:4}})}return r.isRequired()&&(this.latest_query_data=null,this.latest_query_data_id=null),this.latest_query_data&&0!==t?this.queryResult||(this.queryResult=new Jt({query_result:this.latest_query_data})):this.latest_query_data_id&&0!==t?this.queryResult||(this.queryResult=Jt.getById(this.id,this.latest_query_data_id)):this.queryResult=e(),this.queryResult}getQueryResult(e){return this.prepareQueryResultExecution(()=>Jt.getByQueryId(this.id,this.getParameters().getExecutionValues(),this.getAutoLimit(),e),e)}getQueryResultByText(e,t){var r=t||this.query;if(!r)return new or("Can't execute empty query.");var a=this.getParameters().getExecutionValues({joinListValues:!0});return this.prepareQueryResultExecution(()=>Jt.get(this.data_source_id,r,a,this.getAutoLimit(),e,this.id),e)}getUrl(e,t){var r="queries/".concat(this.id);e&&(r+="/source");var a={};return this.getParameters().isRequired()&&this.getParametersDefs().forEach(e=>{Object(c.extend)(a,e.toUrlParams())}),Object.keys(a).forEach(e=>null==a[e]&&delete a[e]),""!==(a=Object(c.map)(a,(e,t)=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e))).join("&"))&&(r+="?".concat(a)),t&&(r+="#".concat(t)),r}getQueryResultPromise(){return this.getQueryResult().toPromise()}getParameters(){return this.$parameters||(this.$parameters=new sr(this,R.search)),this.$parameters}getAutoLimit(){return this.options.apply_auto_limit}getParametersDefs(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.getParameters().get(e)}favorite(){return ir.favorite(this)}unfavorite(){return ir.unfavorite(this)}clone(){var e=Object(c.clone)(this);return e.$parameters=null,e.getParameters(),e}}class sr{constructor(e,t){this.query=e,this.updateParameters(),this.initFromQueryString(t)}parseQuery(){var e=()=>Object(c.map)(this.query.options.parameters,e=>e.name),t=[];if(void 0!==this.query.query)try{var r=Dt.a.parse(this.query.query);t=Object(c.uniq)(function e(t){var r=[];return t.forEach(t=>{"name"===t[0]||"&"===t[0]?r.push(t[1].split(".")[0]):"#"===t[0]&&(r=Object(c.union)(r,e(t[4])))}),r}(r))}catch(r){nr("Failed parsing parameters: ",r),t=e()}else t=e();return t}updateParameters(e){if(this.query.query!==this.cachedQueryText){this.cachedQueryText=this.query.query;var t=e?this.parseQuery():Object(c.map)(this.query.options.parameters,e=>e.name);this.query.options.parameters=this.query.options.parameters||[];var r={};this.query.options.parameters.forEach(e=>{r[e.name]=e}),t.forEach(e=>{Object(c.has)(r,e)||this.query.options.parameters.push(qr({title:e,name:e,type:"text",value:null,global:!1}))});var a=this.query.options.parameters;this.query.options.parameters=a.filter(e=>Object(c.includes)(t,e.name)).map(e=>e instanceof At?e:qr(e,this.query.id))}else{var n=this.query.options.parameters;Object(c.find)(n,e=>!(e instanceof At))&&(this.query.options.parameters=Object(c.map)(n,e=>e instanceof At?e:qr(e,this.query.id)))}}initFromQueryString(e){this.get().forEach(t=>{t.fromUrlParams(e)})}get(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.updateParameters(e),this.query.options.parameters}add(e){this.query.options.parameters=this.query.options.parameters.filter(t=>t.name!==e.name);var t=qr(e);return this.query.options.parameters.push(t),t}getMissing(){return Object(c.map)(Object(c.filter)(this.get(),e=>e.isEmpty),e=>e.title)}isRequired(){return!Object(c.isEmpty)(this.get())}getExecutionValues(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.get();return Object(c.zipObject)(Object(c.map)(t,e=>e.name),Object(c.map)(t,t=>t.getExecutionValue(e)))}hasPendingValues(){return Object(c.some)(this.get(),e=>e.hasPendingValue)}applyPendingValues(){Object(c.each)(this.get(),e=>e.applyPendingValue())}toUrlParams(){if(0===this.get().length)return"";var e=ar(...this.get().map(e=>e.toUrlParams()));return Object.keys(e).forEach(t=>null==e[t]&&delete e[t]),Object.keys(e).map(t=>"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(e[t]))).join("&")}}class or{constructor(e){this.errorMessage=e,this.updatedAt=l.a.utc()}getUpdatedAt(){return this.updatedAt}getError(){return this.errorMessage}toPromise(){return Promise.reject(this)}getStatus(){return"failed"}getData(){return null}getLog(){return null}}var lr=e=>new ir(e),cr=e=>tr(tr({},e),{},{results:Object(c.map)(e.results,lr)}),ur={query:e=>K.get("api/queries",{params:e}).then(cr),get:e=>K.get("api/queries/".concat(e.id),e).then(lr),save:e=>K.post((e=>e.id?"api/queries/".concat(e.id):"api/queries")(e),e).then(lr),delete:e=>K.delete("api/queries/".concat(e.id)),recent:e=>K.get("api/queries/recent",{params:e}).then(e=>Object(c.map)(e,lr)),archive:e=>K.get("api/queries/archive",{params:e}).then(cr),myQueries:e=>K.get("api/queries/my",{params:e}).then(cr),fork:e=>{var t=e.id;return K.post("api/queries/".concat(t,"/fork"),{id:t}).then(lr)},resultById:e=>K.get("api/queries/".concat(e.id,"/results.json")),asDropdown:e=>K.get("api/queries/".concat(e.id,"/dropdown")),associatedDropdown:e=>{var t=e.queryId,r=e.dropdownQueryId;return K.get("api/queries/".concat(t,"/dropdowns/").concat(r))},favorites:e=>K.get("api/queries/favorites",{params:e}).then(cr),favorite:e=>K.post("api/queries/".concat(e.id,"/favorite")),unfavorite:e=>K.delete("api/queries/".concat(e.id,"/favorite")),newQuery:function(){return new ir({query:"",name:"New Query",schedule:null,user:Y,options:{apply_auto_limit:Zt.get("applyAutoLimit",!0)},tags:[],can_edit:!0})}};Object(c.extend)(ir,ur);var dr=class extends At{constructor(e,t){super(e,t),this.queryId=e.queryId,this.multiValuesOptions=e.multiValuesOptions,this.setValue(e.value)}normalizeValue(e){return Object(c.isUndefined)(e)||Object(c.isNull)(e)||Object(c.isArray)(e)&&Object(c.isEmpty)(e)?null:e=this.multiValuesOptions?Object(c.isArray)(e)?e:[e]:Object(c.isArray)(e)?e[0]:e}getExecutionValue(){if((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).joinListValues&&Object(c.isArray)(this.value)){var e=Object(c.get)(this.multiValuesOptions,"separator",","),t=Object(c.get)(this.multiValuesOptions,"prefix",""),r=Object(c.get)(this.multiValuesOptions,"suffix",""),a=Object(c.map)(this.value,e=>"".concat(t).concat(e).concat(r));return Object(c.join)(a,e)}return this.value}toUrlParams(){var e=this.urlPrefix,t=this.value;return this.multiValuesOptions&&Object(c.isArray)(this.value)&&(t=JSON.stringify(this.value)),{["".concat(e).concat(this.name)]:this.isEmpty?null:t}}fromUrlParams(e){var t=this.urlPrefix,r="".concat(t).concat(this.name);if(Object(c.has)(e,r))if(this.multiValuesOptions)try{var a=JSON.parse(e[r]);this.setValue(Object(c.isArray)(a)?a:e[r])}catch(t){this.setValue(e[r])}else this.setValue(e[r])}loadDropdownValues(){return this.parentQueryId?ir.associatedDropdown({queryId:this.parentQueryId,dropdownQueryId:this.queryId}).catch(()=>Promise.resolve([])):ir.asDropdown({id:this.queryId}).catch(Promise.resolve([]))}},mr={date:"YYYY-MM-DD","datetime-local":"YYYY-MM-DD HH:mm","datetime-with-seconds":"YYYY-MM-DD HH:mm:ss"},pr={now:{name:"Today/Now",value:()=>l()()},yesterday:{name:"Yesterday",value:()=>l()().subtract(1,"day")}},fr=se.a.oneOf(Object(c.values)(pr));function hr(e){return Object(c.startsWith)(e,"d_")&&Object(c.has)(pr,e.substring("d_".length))}function br(e){return Object(c.includes)(pr,e)}function gr(e){return hr(e)?pr[e.substring("d_".length)]:null}var yr=class extends At{constructor(e,t){super(e,t),this.useCurrentDateTime=e.useCurrentDateTime,this.setValue(e.value)}get hasDynamicValue(){return br(this.normalizedValue)}normalizeValue(e){if(hr(e))return gr(e);if(br(e))return e;var t=l()(e);return t.isValid()?t:null}setValue(e){var t=this.normalizeValue(e);return br(t)?this.value="d_"+Object(c.findKey)(pr,t):l.a.isMoment(t)?this.value=t.format(mr[this.type]):this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){return this.hasDynamicValue?this.normalizedValue.value().format(mr[this.type]):Object(c.isNull)(this.value)&&this.useCurrentDateTime?l()().format(mr[this.type]):this.value}};function vr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Or(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Or(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Or(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var Er={"date-range":"YYYY-MM-DD","datetime-range":"YYYY-MM-DD HH:mm","datetime-range-with-seconds":"YYYY-MM-DD HH:mm:ss"},jr=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>l()();return function(){var r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return[e(),r?t():void 0]}},wr={today:{name:"Today",value:()=>[l()().startOf("day"),l()().endOf("day")]},yesterday:{name:"Yesterday",value:()=>[l()().subtract(1,"day").startOf("day"),l()().subtract(1,"day").endOf("day")]},this_week:{name:"This week",value:()=>[l()().startOf("week"),l()().endOf("week")]},this_month:{name:"This month",value:()=>[l()().startOf("month"),l()().endOf("month")]},this_year:{name:"This year",value:()=>[l()().startOf("year"),l()().endOf("year")]},last_week:{name:"Last week",value:()=>[l()().subtract(1,"week").startOf("week"),l()().subtract(1,"week").endOf("week")]},last_month:{name:"Last month",value:()=>[l()().subtract(1,"month").startOf("month"),l()().subtract(1,"month").endOf("month")]},last_year:{name:"Last year",value:()=>[l()().subtract(1,"year").startOf("year"),l()().subtract(1,"year").endOf("year")]},last_hour:{name:"Last hour",value:jr(()=>l()().subtract(1,"hour"))},last_8_hours:{name:"Last 8 hours",value:jr(()=>l()().subtract(8,"hour"))},last_24_hours:{name:"Last 24 hours",value:jr(()=>l()().subtract(24,"hour"))},last_7_days:{name:"Last 7 days",value:jr(()=>l()().subtract(7,"days").startOf("day"),()=>l()().endOf("day"))},last_14_days:{name:"Last 14 days",value:jr(()=>l()().subtract(14,"days").startOf("day"),()=>l()().endOf("day"))},last_30_days:{name:"Last 30 days",value:jr(()=>l()().subtract(30,"days").startOf("day"),()=>l()().endOf("day"))},last_60_days:{name:"Last 60 days",value:jr(()=>l()().subtract(60,"days").startOf("day"),()=>l()().endOf("day"))},last_90_days:{name:"Last 90 days",value:jr(()=>l()().subtract(90,"days").startOf("day"),()=>l()().endOf("day"))},last_12_months:{name:"Last 12 months",value:jr(()=>l()().subtract(12,"months").startOf("day"),()=>l()().endOf("day"))}},Sr=se.a.oneOf(Object(c.values)(wr));function Pr(e){return!!Object(c.startsWith)(e,"d_")&&!!wr[e.substring("d_".length)]}function Cr(e){return Object(c.includes)(wr,e)}function Nr(e){return Pr(e)?wr[e.substring("d_".length)]:null}var kr=class extends At{constructor(e,t){super(e,t),this.setValue(e.value)}get hasDynamicValue(){return Cr(this.normalizedValue)}normalizeValue(e){return Pr(e)?Nr(e):Cr(e)?e:(Object(c.isObject)(e)&&!Object(c.isArray)(e)&&(e=[e.start,e.end]),Object(c.isArray)(e)&&2===e.length&&(e=[l()(e[0]),l()(e[1])])[0].isValid()&&e[1].isValid()?e:null)}setValue(e){var t=this.normalizeValue(e);return Cr(t)?this.value="d_"+Object(c.findKey)(wr,t):Object(c.isArray)(t)?this.value={start:t[0].format(Er[this.type]),end:t[1].format(Er[this.type])}:this.value=t,this.$$value=t,this.updateLocals(),this.clearPendingValue(),this}getExecutionValue(){if(this.hasDynamicValue){var e=vr(this.normalizedValue.value().map(e=>e.format(Er[this.type])),2);return{start:e[0],end:e[1]}}return this.value}toUrlParams(){var e=this.urlPrefix;return Object(c.isObject)(this.value)&&this.value.start&&this.value.end?{["".concat(e).concat(this.name)]:"".concat(this.value.start,"--").concat(this.value.end)}:super.toUrlParams()}fromUrlParams(e){var t=this.urlPrefix,r="".concat(t).concat(this.name),a="".concat(t).concat(this.name,".start"),n="".concat(t).concat(this.name,".end");if(Object(c.has)(e,r)){var i=e[r].split("--");2===i.length?this.setValue(i):this.setValue(e[r])}else Object(c.has)(e,a)&&Object(c.has)(e,n)&&this.setValue([e[a],e[n]])}toQueryTextFragment(){return"{{ ".concat(this.name,".start }} {{ ").concat(this.name,".end }}")}};function _r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Ar(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_r(Object(r),!0).forEach((function(t){xr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_r(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function xr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qr(e,t){switch(e.type){case"number":return new qt(e,t);case"enum":return new Tt(e,t);case"query":return new dr(e,t);case"date":case"datetime-local":case"datetime-with-seconds":return new yr(e,t);case"date-range":case"datetime-range":case"datetime-range-with-seconds":return new kr(e,t);default:return new xt(Ar(Ar({},e),{},{type:"text"}),t)}}function Tr(e){return qr(e,e.parentQueryId)}var Ir="textbox",Dr="visualization",Rr="restricted";var Mr,zr,Fr,Lr={DashboardLevel:"dashboard-level",WidgetLevel:"widget-level",StaticValue:"static-value"};class Ur{constructor(e){Object(c.extend)(this,e);var t=function(e){e.width=1;var t={autoHeight:!1,sizeX:Math.round(Ot/2),sizeY:Pt,minSizeX:Ct,maxSizeX:Nt,minSizeY:kt,maxSizeY:_t},r=e.visualization?d.registeredVisualizations[e.visualization.type]:null;if(Object(c.isObject)(r)){Object.prototype.hasOwnProperty.call(r,"autoHeight")&&(t.autoHeight=r.autoHeight);var a=parseInt(r.minColumns,10);isFinite(a)&&a>=0&&(t.minSizeX=a);var n=parseInt(r.maxColumns,10);isFinite(n)&&n>=0&&(t.maxSizeX=Math.min(n,Ot));var i=parseInt(r.height,10);isFinite(i)&&(t.minSizeY=Math.ceil(i/Et));var s=parseInt(r.minRows,10);isFinite(s)&&(t.minSizeY=s);var o=parseInt(r.maxRows,10);isFinite(o)&&o>=0&&(t.maxSizeY=o);var l=parseInt(r.defaultColumns,10);isFinite(l)&&l>0&&(t.sizeX=l);var u=parseInt(r.defaultRows,10);isFinite(u)&&u>0&&(t.sizeY=u)}return t}(this);this.options=this.options||{},this.options.position=Object(c.extend)({},t,Object(c.pick)(this.options.position,["col","row","sizeX","sizeY","autoHeight"])),this.options.position.sizeY<0&&(this.options.position.autoHeight=!0)}get type(){return this.visualization?Dr:this.restricted?Rr:Ir}getQuery(){return!this.query&&this.visualization&&(this.query=new ir(this.visualization.query)),this.query}getQueryResult(){return this.data}getName(){return this.visualization?"".concat(this.visualization.query.name," (").concat(this.visualization.name,")"):Object(c.truncate)(this.text,20)}load(e,t){if(!this.visualization)return Promise.resolve();if(e||void 0===this.queryResult){this.loading=!0,this.refreshStartedAt=l()(),(void 0===t||e)&&(t=e?0:void 0);var r=this.getQuery().getQueryResult(t);this.queryResult=r,r.toPromise().then(e=>(this.queryResult===r&&(this.loading=!1,this.data=e),e)).catch(e=>(this.queryResult===r&&(this.loading=!1,this.data=e),e))}return this.queryResult.toPromise()}save(e,t){var r=Object(c.pick)(this,"options","text","id","width","dashboard_id","visualization_id");e&&t&&(r[e]=Object(c.merge)({},r[e],t));var a="api/widgets";return this.id&&(a="".concat(a,"/").concat(this.id)),K.post(a,r).then(e=>(Object(c.each)(e,(e,t)=>{this[t]=e}),this))}delete(){var e="api/widgets/".concat(this.id);return K.delete(e)}isStaticParam(e){return this.getParameterMappings()[e.name].type===Ur.MappingType.StaticValue}getParametersDefs(){var e=this.getParameterMappings(),t=this.getQuery()?this.getQuery().getParametersDefs():[],r=R.search,a=[Ur.MappingType.WidgetLevel,Ur.MappingType.StaticValue],n=Object(c.map)(Object(c.filter)(t,t=>a.indexOf(e[t.name].type)>=0),t=>{var a=e[t.name],n=Tr(t);return n.title=a.title||t.title,n.locals=[t],n.urlPrefix="p_w".concat(this.id,"_"),a.type===Ur.MappingType.StaticValue?n.setValue(a.value):n.fromUrlParams(r),n});return Object(c.sortBy)(n,e=>Object(c.includes)(this.options.paramOrder,e.name)?Object(c.indexOf)(this.options.paramOrder,e.name):Object(c.size)(this.options.paramOrder))}getParameterMappings(){Object(c.isObject)(this.options.parameterMappings)||(this.options.parameterMappings={});var e={},t=this.getQuery()?this.getQuery().getParametersDefs(!1):[];Object(c.each)(t,t=>{e[t.name]=!0,Object(c.isObject)(this.options.parameterMappings[t.name])||(this.options.parameterMappings[t.name]={name:t.name,type:t.global?Ur.MappingType.DashboardLevel:Ur.MappingType.WidgetLevel,mapTo:t.name,value:null,title:""})});var r=Object(c.difference)(Object(c.keys)(this.options.parameterMappings),Object(c.keys)(e));return Object(c.each)(r,e=>{delete this.options.parameterMappings[e]}),this.options.parameterMappings}getLocalParameters(){return Object(c.filter)(this.getParametersDefs(),e=>!this.isStaticParam(e))}}Mr=Ur,Fr=Lr,(zr=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(zr="MappingType"))in Mr?Object.defineProperty(Mr,zr,{value:Fr,enumerable:!0,configurable:!0,writable:!0}):Mr[zr]=Fr;var Vr=Ur;function Br(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Qr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Br(Object(r),!0).forEach((function(t){Wr(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Br(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Wr(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Hr=e=>{var t=e.id,r=e.slug;return"dashboards/".concat(t,"-").concat(r)};function Gr(e,t,r){var a={};return u.a.each(t,t=>{var n=t&&t.getFilters?t.getFilters():[];u.a.each(n,t=>{var n=u.a.has(r,t.name);if(n||e.dashboard_filters_enabled){n&&(t.current=r[t.name]);var i=Qr({},t);u.a.has(a,t.name)?a[i.name].values=u.a.union(a[i.name].values,i.values):a[i.name]=i}})}),u.a.values(a)}function Kr(e){var t=Math.max(u.a.chain(e).map(e=>e.options.position.sizeY).max().value(),20)+5;return u.a.chain(e).sortBy(e=>e.options.position.row).groupBy(e=>e.options.position.row).reduce((e,r)=>{var a=1;return u.a.each(r,r=>{a=Math.max(a,r.options.position.autoHeight?t:r.options.position.sizeY),r.options.position.row=e,r.options.position.sizeY<1&&(r.options.position.sizeY=t)}),e+a},0).value(),e=u.a.sortBy(e,e=>e.options.position.col),e=u.a.sortBy(e,e=>e.options.position.row)}function Yr(e,t){var r=u.a.extend({sizeX:St},u.a.extend({},t.options).position).sizeX,a=u.a.chain(e).map(e=>{var t=u.a.extend({},e.options),r=u.a.extend({row:0,sizeY:0},t.position);return{left:r.col,top:r.row,right:r.col+r.sizeX,bottom:r.row+r.sizeY,width:r.sizeX,height:r.sizeY}}).reduce((e,t)=>{for(var r=Math.max(t.left,0),a=Math.min(t.right,e.length+1),n=r;n<a;n+=1)e[n]=Math.max(e[n],t.bottom);return e},u.a.map(new Array(Ot),u.a.constant(0))).value();return u.a.chain(u.a.range(0,Ot-r+1)).map(e=>({col:e,row:u.a.chain(a).slice(e,e+r).max().value()})).sortBy("row").first().value()}function $r(e){u.a.extend(this,e),Object.defineProperty(this,"url",{get:function(){return Hr(this)}})}function Jr(e){return Kr(u.a.map(e,e=>new Vr(e)))}function Xr(e){return(e=new $r(e)).widgets&&(e.widgets=Jr(e.widgets)),e.publicAccessEnabled=void 0!==e.public_url,e}function Zr(e){return e=e.results?Qr(Qr({},e),{},{results:u.a.map(e.results,Xr)}):Xr(e)}var ea={get:e=>{var t=e.id,r=e.slug,a={};return t||(a.legacy=null),K.get("api/dashboards/".concat(t||r),{params:a}).then(Zr)},getByToken:e=>{var t=e.token;return K.get("api/dashboards/public/".concat(t)).then(Zr)},save:e=>K.post((e=>e.id?"api/dashboards/".concat(e.id):"api/dashboards")(e),e).then(Zr),delete:e=>{var t=e.id;return K.delete("api/dashboards/".concat(t)).then(Zr)},query:e=>K.get("api/dashboards",{params:e}).then(Zr),recent:e=>K.get("api/dashboards/recent",{params:e}).then(Zr),myDashboards:e=>K.get("api/dashboards/my",{params:e}).then(Zr),favorites:e=>K.get("api/dashboards/favorites",{params:e}).then(Zr),favorite:e=>{var t=e.id;return K.post("api/dashboards/".concat(t,"/favorite"))},unfavorite:e=>{var t=e.id;return K.delete("api/dashboards/".concat(t,"/favorite"))},fork:e=>{var t=e.id;return K.post("api/dashboards/".concat(t,"/fork"),{id:t}).then(Zr)}};function ta(){return(ta=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function ra(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return aa(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return aa(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function aa(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function na(e){var t=e.dialog,r=ra(Object(a.useState)(""),2),i=r[0],s=r[1],o=ra(Object(a.useState)(!1),2),l=o[0],u=o[1],d=ra(Object(a.useState)(!1),2),m=d[0],p=d[1],f=ae.isCreateDashboardEnabled();function h(){""!==i&&(p(!0),$r.save({name:i}).then(e=>{t.close(),bt("".concat(e.url,"?edit"))}),vt("create","dashboard"))}return n.a.createElement(V.a,ta({},t.props,f?{}:{footer:null},{title:"New Dashboard",okText:"Save",cancelText:"Close",okButtonProps:{disabled:!l||m,loading:m,"data-test":"DashboardSaveButton"},cancelButtonProps:{disabled:m},onOk:h,closable:!m,maskClosable:!m,wrapProps:{"data-test":"CreateDashboardDialog"}}),n.a.createElement(pe,{name:"CreateDashboardDialogExtra",disabled:!f},n.a.createElement(He.a,{defaultValue:i,onChange:function(e){var t=Object(c.trim)(e.target.value);s(t),u(""!==t)},onPressEnter:h,placeholder:"Dashboard Name","aria-label":"Dashboard name",disabled:m,autoFocus:!0})))}u.a.extend($r,ea),$r.prepareDashboardWidgets=Jr,$r.prepareWidgetsForDashboard=Kr,$r.prototype.canEdit=function(){return ae.canEdit(this)},$r.prototype.getParametersDefs=function(){var e={},t=R.search;u.a.each(this.widgets,t=>{if(t.getQuery()){var r=t.getParameterMappings();t.getQuery().getParametersDefs(!1).forEach(t=>{var a=r[t.name];a.type===Vr.MappingType.DashboardLevel&&(e[a.mapTo]||(e[a.mapTo]=Tr(t),e[a.mapTo].name=a.mapTo,e[a.mapTo].title=a.title||t.title,e[a.mapTo].locals=[]),e[a.mapTo].locals.push(t))})}});var r=u.a.values(u.a.each(e,e=>{e.setValue(e.value),e.fromUrlParams(t)}));return u.a.sortBy(r,e=>u.a.includes(this.options.globalParamOrder,e.name)?u.a.indexOf(this.options.globalParamOrder,e.name):u.a.size(this.options.globalParamOrder))},$r.prototype.addWidget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={dashboard_id:this.id,options:Qr(Qr({},t),{},{isHidden:!1,position:{}}),text:"",visualization_id:null,visualization:null};u.a.isString(e)?r.text=e:u.a.isObject(e)&&(r.visualization_id=e.id,r.visualization=e);var a=new Vr(r),n=Yr(this.widgets,a);return a.options.position.col=n.col,a.options.position.row=n.row,a.save().then(()=>(this.widgets=[...this.widgets,a],a))},$r.prototype.favorite=function(){return $r.favorite(this)},$r.prototype.unfavorite=function(){return $r.unfavorite(this)},$r.prototype.getUrl=function(){return Hr(this)},na.propTypes={dialog:Je.isRequired};var ia=Xe(na);function sa(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function oa(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?sa(Object(r),!0).forEach((function(t){la(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sa(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function la(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ca{constructor(e){Object(c.extend)(this,{pathPrefix:"/".concat(e.path)},Object(c.omit)(e,["isActive","isAvailable"])),Object(c.isFunction)(e.isActive)&&(this.isActive=e.isActive),Object(c.isFunction)(e.isAvailable)&&(this.isAvailable=e.isAvailable)}isActive(e){return e.startsWith(this.pathPrefix)}isAvailable(){return void 0===this.permission||Y.hasPermission(this.permission)}}var ua=new class{constructor(){la(this,"items",[])}add(e,t){e=Object(c.isString)(e)?e:null,this.remove(e),Object(c.isObject)(t)&&(this.items.push(new ca(oa(oa({},t),{},{id:e}))),this.items=Object(c.sortBy)(this.items,"order"))}remove(e){Object(c.isString)(e)&&(this.items=Object(c.filter)(this.items,t=>t.id!==e))}getAvailableItems(){return Object(c.filter)(this.items,e=>e.isAvailable())}getActiveItem(e){var t=ft(e);return Object(c.find)(this.items,e=>e.isActive(t))}},da=r(146),ma=r(1070),pa=r.n(ma),fa=r(1071),ha=r.n(fa),ba=r(1072),ga=r.n(ba),ya=r(632),va=r.n(ya),Oa=r(1073),Ea=r.n(Oa),ja=r(1074),wa=r.n(ja),Sa=r(639);function Pa(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",null,"Version: ",$.version,Sa!==$.version&&" (".concat(Sa.substring(0,8),")")))}var Ca=["children"];function Na(){return(Na=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function ka(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function _a(e){var t=e.children,r=ka(e,Ca);return n.a.createElement(he.a,Na({selectable:!1,mode:"vertical",theme:"dark"},r),t)}function Aa(){var e=Object(a.useContext)(pt);return Object(a.useMemo)(()=>({dashboards:Object(c.includes)(["Dashboards.List","Dashboards.Favorites","Dashboards.My","Dashboards.ViewOrEdit","Dashboards.LegacyViewOrEdit"],e.id),queries:Object(c.includes)(["Queries.List","Queries.Favorites","Queries.Archived","Queries.My","Queries.View","Queries.New","Queries.Edit"],e.id),dataSources:Object(c.includes)(["DataSources.List"],e.id),alerts:Object(c.includes)(["Alerts.List","Alerts.New","Alerts.View","Alerts.Edit"],e.id)}),[e.id])}function xa(){var e=Object(c.first)(ua.getAvailableItems()),t=Aa(),r=Y.hasPermission("create_query"),a=Y.hasPermission("create_dashboard"),i=Y.hasPermission("list_alerts");return n.a.createElement("nav",{className:"desktop-navbar"},n.a.createElement(_a,{className:"desktop-navbar-logo"},n.a.createElement("div",{role:"menuitem"},n.a.createElement(S,{href:"./"},n.a.createElement("img",{src:da.default,alt:"Redash"})))),n.a.createElement(_a,null,Y.hasPermission("list_dashboards")&&n.a.createElement(he.a.Item,{key:"dashboards",className:t.dashboards?"navbar-active-item":null},n.a.createElement(S,{href:"dashboards"},n.a.createElement(pa.a,{"aria-label":"Dashboard navigation button"}),n.a.createElement("span",{className:"desktop-navbar-label"},"Dashboards"))),Y.hasPermission("view_query")&&n.a.createElement(he.a.Item,{key:"queries",className:t.queries?"navbar-active-item":null},n.a.createElement(S,{href:"queries"},n.a.createElement(ha.a,{"aria-label":"Queries navigation button"}),n.a.createElement("span",{className:"desktop-navbar-label"},"Queries"))),Y.hasPermission("list_alerts")&&n.a.createElement(he.a.Item,{key:"alerts",className:t.alerts?"navbar-active-item":null},n.a.createElement(S,{href:"alerts"},n.a.createElement(ga.a,{"aria-label":"Alerts navigation button"}),n.a.createElement("span",{className:"desktop-navbar-label"},"Alerts")))),n.a.createElement(_a,{className:"desktop-navbar-spacer"},(r||a||i)&&n.a.createElement(he.a.SubMenu,{key:"create",popupClassName:"desktop-navbar-submenu","data-test":"CreateButton",tabIndex:0,title:n.a.createElement(n.a.Fragment,null,n.a.createElement(va.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},"Create"))},r&&n.a.createElement(he.a.Item,{key:"new-query"},n.a.createElement(S,{href:"queries/new","data-test":"CreateQueryMenuItem"},"New Query")),a&&n.a.createElement(he.a.Item,{key:"new-dashboard"},n.a.createElement(Ee,{"data-test":"CreateDashboardMenuItem",onClick:()=>ia.showModal()},"New Dashboard")),i&&n.a.createElement(he.a.Item,{key:"new-alert"},n.a.createElement(S,{"data-test":"CreateAlertMenuItem",href:"alerts/new"},"New Alert")))),n.a.createElement(_a,null,n.a.createElement(he.a.Item,{key:"help"},n.a.createElement(Qe,{showTooltip:!1,type:"HOME",tabIndex:0},n.a.createElement(Ea.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},"Help"))),e&&n.a.createElement(he.a.Item,{key:"settings",className:t.dataSources?"navbar-active-item":null},n.a.createElement(S,{href:e.path,"data-test":"SettingsLink"},n.a.createElement(wa.a,null),n.a.createElement("span",{className:"desktop-navbar-label"},"Settings")))),n.a.createElement(_a,{className:"desktop-navbar-profile-menu"},n.a.createElement(he.a.SubMenu,{key:"profile",popupClassName:"desktop-navbar-submenu",tabIndex:0,title:n.a.createElement("span",{"data-test":"ProfileDropdown",className:"desktop-navbar-profile-menu-title"},n.a.createElement("img",{className:"profile__image_thumb",src:Y.profile_image_url,alt:Y.name}))},n.a.createElement(he.a.Item,{key:"profile"},n.a.createElement(S,{href:"users/me"},"Profile")),Y.hasPermission("super_admin")&&n.a.createElement(he.a.Item,{key:"status"},n.a.createElement(S,{href:"admin/status"},"System Status")),n.a.createElement(he.a.Divider,null),n.a.createElement(he.a.Item,{key:"logout"},n.a.createElement(Ee,{"data-test":"LogOutButton",onClick:()=>re.logout()},"Log out")),n.a.createElement(he.a.Divider,null),n.a.createElement(he.a.Item,{key:"version",role:"presentation",disabled:!0,className:"version-info"},n.a.createElement(Pa,null)))))}var qa=r(1075),Ta=r.n(qa),Ia=r(81),Da=r.n(Ia);function Ra(e){var t=e.getPopupContainer,r=Object(c.first)(ua.getAvailableItems());return n.a.createElement("div",{className:"mobile-navbar"},n.a.createElement("div",{className:"mobile-navbar-logo"},n.a.createElement(S,{href:"./"},n.a.createElement("img",{src:da.default,alt:"Redash"}))),n.a.createElement("div",null,n.a.createElement(Da.a,{overlayStyle:{minWidth:200},trigger:["click"],getPopupContainer:t,overlay:n.a.createElement(he.a,{mode:"vertical",theme:"dark",selectable:!1,className:"mobile-navbar-menu"},Y.hasPermission("list_dashboards")&&n.a.createElement(he.a.Item,{key:"dashboards"},n.a.createElement(S,{href:"dashboards"},"Dashboards")),Y.hasPermission("view_query")&&n.a.createElement(he.a.Item,{key:"queries"},n.a.createElement(S,{href:"queries"},"Queries")),Y.hasPermission("list_alerts")&&n.a.createElement(he.a.Item,{key:"alerts"},n.a.createElement(S,{href:"alerts"},"Alerts")),n.a.createElement(he.a.Item,{key:"profile"},n.a.createElement(S,{href:"users/me"},"Edit Profile")),n.a.createElement(he.a.Divider,null),r&&n.a.createElement(he.a.Item,{key:"settings"},n.a.createElement(S,{href:r.path},"Settings")),Y.hasPermission("super_admin")&&n.a.createElement(he.a.Item,{key:"status"},n.a.createElement(S,{href:"admin/status"},"System Status")),Y.hasPermission("super_admin")&&n.a.createElement(he.a.Divider,null),n.a.createElement(he.a.Item,{key:"help"},n.a.createElement(S,{href:"https://redash.io/help",target:"_blank",rel:"noopener"},"Help")),n.a.createElement(he.a.Item,{key:"logout",onClick:()=>re.logout()},"Log out"))},n.a.createElement(h.a,{className:"mobile-navbar-toggle-button",ghost:!0},n.a.createElement(Ta.a,null)))))}function Ma(e){var t=e.children,r=Object(a.useRef)(),i=Object(a.useCallback)(()=>r.current,[]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(pe,{name:"ApplicationWrapper"},n.a.createElement("div",{className:"application-layout-side-menu"},n.a.createElement(pe,{name:"ApplicationDesktopNavbar"},n.a.createElement(xa,null))),n.a.createElement("div",{className:"application-layout-content"},n.a.createElement("nav",{className:"application-layout-top-menu",ref:r},n.a.createElement(pe,{name:"ApplicationMobileNavbar",getPopupContainer:i},n.a.createElement(Ra,{getPopupContainer:i}))),t)))}Ra.propTypes={getPopupContainer:se.a.func},Ra.defaultProps={getPopupContainer:null},Ma.propTypes={children:se.a.node},Ma.defaultProps={children:null};var za=["render","bodyClass"];function Fa(){return(Fa=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function La(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Ua(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Va(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ua(Object(r),!0).forEach((function(t){Ba(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ua(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ba(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qa(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wa(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wa(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wa(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Ha(e){var t=e.bodyClass,r=e.currentRoute,i=e.render,s=Qa(Object(a.useState)(!!re.isAuthenticated()),2),o=s[0],l=s[1];return Object(a.useEffect)(()=>{var e=!1;return Promise.all([re.requireSession(),ne.refresh(),ae.refresh()]).then(()=>{e||l(!!re.isAuthenticated())}).catch(()=>{e||l(!1)}),()=>{e=!0}},[]),Object(a.useEffect)(()=>{if(t)return document.body.classList.toggle(t,!0),()=>{document.body.classList.toggle(t,!1)}},[t]),o?n.a.createElement(Ma,null,n.a.createElement(n.a.Fragment,{key:r.key},n.a.createElement(C.a,{renderError:e=>n.a.createElement(ot,{error:e})},n.a.createElement(P.ErrorBoundaryContext.Consumer,null,e=>{var t=e.handleError;return i(Va(Va({},r.routeParams),{},{pageTitle:r.title,onError:t}))})))):null}function Ga(e){var t=e.render,r=e.bodyClass;return Va(Va({},La(e,za)),{},{render:e=>{var a={render:t,bodyClass:r,currentRoute:e};return n.a.createElement(pe,Fa({},a,{name:"UserSessionWrapper",fallback:n.a.createElement(Ha,a)}))}})}function Ka(){return(Ka=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Ya(e){var t=e.show,r=e.completed,a=e.text,i=e.url,s=e.urlText,o=e.onClick;if(!t)return null;var l={children:s,onClick:o};return n.a.createElement("li",{className:ge()({done:r})},i?n.a.createElement(S,Ka({href:i},l)):n.a.createElement(Ee,Ka({type:"link"},l))," ",a)}function $a(e){var t=e.helpTriggerType;return n.a.createElement("p",null,"Need more support?"," ",n.a.createElement(Qe,{className:"f-14",type:t,showTooltip:!1},"See our Help"))}function Ja(e){var t=e.icon,r=e.header,i=e.description,s=e.illustration,o=e.helpMessage,l=e.closable,u=e.onClose,d=e.onboardingMode,m=e.showAlertStep,p=e.showDashboardStep,f=e.showDataSourceStep,h=e.showInviteStep,b=e.getStepsItems,g=e.illustrationPath,y={dataSource:f,query:!0,alert:m,dashboard:p,inviteUsers:h},v={dataSource:ne.objectCounters.data_sources>0,query:ne.objectCounters.queries>0,alert:ne.objectCounters.alerts>0,dashboard:ne.objectCounters.dashboards>0,inviteUsers:ne.objectCounters.users>1},O=Object(a.useCallback)(()=>{ia.showModal()},[]);if(!(!d||Object(c.some)(Object(c.keys)(y),e=>y[e]&&!v[e])))return null;var E=[{key:"dataSources",node:Y.isAdmin?n.a.createElement(Ya,{key:"dataSources",show:y.dataSource,completed:v.dataSource,url:"data_sources/new",urlText:"Connect a Data Source"}):n.a.createElement(Ya,{key:"dataSources",show:y.dataSource,completed:v.dataSource,text:"Ask an account admin to connect a data source"})},{key:"queries",node:n.a.createElement(Ya,{key:"queries",show:y.query,completed:v.query,url:"queries/new",urlText:"Create your first Query"})},{key:"alerts",node:n.a.createElement(Ya,{key:"alerts",show:y.alert,completed:v.alert,url:"alerts/new",urlText:"Create your first Alert"})},{key:"dashboards",node:n.a.createElement(Ya,{key:"dashboards",show:y.dashboard,completed:v.dashboard,onClick:O,urlText:"Create your first Dashboard"})},{key:"users",node:n.a.createElement(Ya,{key:"users",show:y.inviteUsers,completed:v.inviteUsers,url:"users/new",urlText:"Invite your team members"})}],j=b?b(E):E,w=g||"static/images/illustrations/"+s+".svg";return n.a.createElement("div",{className:"empty-state-wrapper"},n.a.createElement("div",{className:"empty-state bg-white tiled"},n.a.createElement("div",{className:"empty-state__summary"},r&&n.a.createElement("h4",null,r),n.a.createElement("h2",null,n.a.createElement("i",{className:t,"aria-hidden":"true"})),n.a.createElement("p",null,i),n.a.createElement("img",{src:w,alt:s+" Illustration",width:"75%"})),n.a.createElement("div",{className:"empty-state__steps"},n.a.createElement("h4",null,"Let's get started"),n.a.createElement("ol",null,j.map(e=>e.node)),o)),l&&n.a.createElement(Ee,{className:"close-button","aria-label":"Close",onClick:u},n.a.createElement(xe.a,null)))}Ya.propTypes={show:se.a.bool.isRequired,completed:se.a.bool.isRequired,text:se.a.node,url:se.a.string,urlTarget:se.a.string,urlText:se.a.node,onClick:se.a.func},Ya.defaultProps={url:null,urlTarget:null,urlText:null,text:null,onClick:null},$a.propTypes={helpTriggerType:se.a.string.isRequired},Ja.propTypes={icon:se.a.string,header:se.a.string,description:se.a.string.isRequired,illustration:se.a.string.isRequired,illustrationPath:se.a.string,helpMessage:se.a.node,closable:se.a.bool,onClose:se.a.func,onboardingMode:se.a.bool,showAlertStep:se.a.bool,showDashboardStep:se.a.bool,showDataSourceStep:se.a.bool,showInviteStep:se.a.bool,getStepItems:se.a.func},Ja.defaultProps={icon:null,header:null,helpMessage:null,closable:!1,onClose:()=>{},onboardingMode:!1,showAlertStep:!1,showDashboardStep:!1,showDataSourceStep:!0,showInviteStep:!1};var Xa=Ja,Za=r(341),en=r.n(Za);function tn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function rn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tn(Object(r),!0).forEach((function(t){an(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function an(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}en.a.config({placement:"bottomRight",duration:3});var nn={};["success","error","info","warning","warn"].forEach(e=>{nn[e]=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return en.a[e](rn(rn({},a),{},{message:t,description:r}))}});var sn=rn(rn({},en.a),nn),on=r(342),ln=r.n(on);function cn(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function un(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?cn(Object(r),!0).forEach((function(t){dn(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cn(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function dn(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var mn=new class{constructor(){dn(this,"_items",[]),dn(this,"_sorted",!1)}get items(){return this._sorted||(this._items=Object(c.sortBy)(this._items,[e=>{return t=e.path,r=ln.a.parse(t),Object(c.filter)(r,c.isObject).length;var t,r},e=>-e.path.length,e=>e.path]),this._sorted=!0),this._items}register(e,t){var r=Object(c.isString)(e)?e:null;this.unregister(r),Object(c.isObject)(t)&&(this._items=[...this.items,un(un({},t),{},{id:r})],this._sorted=!1)}unregister(e){Object(c.isString)(e)&&(this._items=Object(c.filter)(this.items,t=>t.id!==e))}},pn=r(127),fn=r.n(pn);function hn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function gn(e){var t=e.title,r=e.resource,i=e.itemUrl,s=e.emptyState,o=hn(Object(a.useState)([]),2),l=o[0],u=o[1],d=hn(Object(a.useState)(!0),2),m=d[0],p=d[1];return Object(a.useEffect)(()=>{p(!0),r.favorites().then(e=>{var t=e.results;return u(t)}).finally(()=>p(!1))},[r]),n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"d-flex align-items-center m-b-20"},n.a.createElement("p",{className:"flex-fill f-500 c-black m-0"},t),m&&n.a.createElement(fn.a,null)),!Object(c.isEmpty)(l)&&n.a.createElement("div",{role:"list",className:"list-group"},l.map(e=>n.a.createElement(S,{key:i(e),role:"listitem",className:"list-group-item",href:i(e)},n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),e.name,e.is_draft&&n.a.createElement("span",{className:"label label-default m-l-5"},"Unpublished")))),Object(c.isEmpty)(l)&&!m&&s)}function yn(){return n.a.createElement("div",{className:"tile"},n.a.createElement("div",{className:"t-body tb-padding"},n.a.createElement("div",{className:"row home-favorites-list"},n.a.createElement("div",{className:"col-sm-6 m-t-20"},n.a.createElement(gn,{title:"Favorite Dashboards",resource:$r,itemUrl:e=>e.url,emptyState:n.a.createElement("p",null,n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),"Favorite ",n.a.createElement(S,{href:"dashboards"},"Dashboards")," will appear here")})),n.a.createElement("div",{className:"col-sm-6 m-t-20"},n.a.createElement(gn,{title:"Favorite Queries",resource:ir,itemUrl:e=>"queries/".concat(e.id),emptyState:n.a.createElement("p",null,n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:"fa fa-star","aria-hidden":"true"})),"Favorite ",n.a.createElement(S,{href:"queries"},"Queries")," will appear here")})))))}function vn(){return n.a.createElement(p.a,{className:"m-b-15",type:"warning",message:n.a.createElement(n.a.Fragment,null,"You have enabled ",n.a.createElement("code",null,"ALLOW_PARAMETERS_IN_EMBEDS"),". This setting is now deprecated and should be turned off. Parameters in embeds are supported by default."," ",n.a.createElement(S,{href:"https://discuss.redash.io/t/support-for-parameters-in-embedded-visualizations/3337",target:"_blank",rel:"noopener noreferrer"},"Read more"),".")})}function On(){return n.a.createElement(p.a,{className:"m-b-15",type:"warning",message:n.a.createElement(n.a.Fragment,null,"We have sent an email with a confirmation link to your email address. Please follow the link to verify your email address."," ",n.a.createElement(Ee,{type:"link",onClick:()=>{K.post("verification_email/").then(e=>{sn.success(e.message)})}},"Resend email"),".")})}function En(){return Object(a.useEffect)(()=>{vt("view","page","personal_homepage")},[]),n.a.createElement("div",{className:"home-page"},n.a.createElement("div",{className:"container"},Object(c.includes)(J,"using-deprecated-embed-feature")&&n.a.createElement(vn,null),Object(c.includes)(J,"email-not-verified")&&n.a.createElement(On,null),n.a.createElement(pe,{name:"Home.EmptyState"},n.a.createElement(Xa,{header:"Welcome to Redash 👋",description:"Connect to any data source, easily visualize and share your data",illustration:"dashboard",helpMessage:n.a.createElement($a,{helpTriggerType:"GETTING_STARTED"}),showDashboardStep:!0,showInviteStep:!0,onboardingMode:!0})),n.a.createElement(pe,{name:"HomeExtra"}),n.a.createElement(yn,null)))}gn.propTypes={title:se.a.string.isRequired,resource:se.a.func.isRequired,itemUrl:se.a.func.isRequired,emptyState:se.a.node},gn.defaultProps={emptyState:null},mn.register("Home",Ga({path:"/",title:"Redash",render:e=>n.a.createElement(En,e)}));var jn=r(149),wn=r.n(jn),Sn=r(90);function Pn(e){var t=e.title,r=e.actions;return n.a.createElement("div",{className:"page-header-wrapper"},n.a.createElement("h3",null,t),r&&n.a.createElement("div",{className:"page-header-actions"},r))}function Cn(e){var t=e.activeTab,r=e.children;return n.a.createElement("div",{className:"admin-page-layout"},n.a.createElement("div",{className:"container"},n.a.createElement(Pn,{title:"Admin"}),n.a.createElement("div",{className:"bg-white tiled"},n.a.createElement(he.a,{selectedKeys:[t],selectable:!1,mode:"horizontal"},n.a.createElement(he.a.Item,{key:"system_status"},n.a.createElement(S,{href:"admin/status"},"System Status")),n.a.createElement(he.a.Item,{key:"jobs"},n.a.createElement(S,{href:"admin/queries/jobs"},"RQ Status")),n.a.createElement(he.a.Item,{key:"outdated_queries"},n.a.createElement(S,{href:"admin/queries/outdated"},"Outdated Queries"))),r)))}Pn.propTypes={title:se.a.string,actions:se.a.node},Pn.defaultProps={title:"",actions:null},Cn.propTypes={activeTab:se.a.string,children:se.a.node},Cn.defaultProps={activeTab:"system_status",children:null};var Nn=r(280),kn=r.n(Nn),_n=r(168),An=r.n(_n),xn=r(272),qn=r.n(xn),Tn=r(91),In=r.n(Tn),Dn=r(116),Rn=r.n(Dn);function Mn(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class zn extends n.a.Component{toggleItem(e,t,r){var a=t.is_favorite?t.unfavorite.bind(t):t.favorite.bind(t),n=t.is_favorite;a().then(()=>{t.is_favorite=!n,this.forceUpdate(),r()})}render(){var e=this.props,t=e.item,r=e.onChange,a=t.is_favorite?"fa fa-star":"fa fa-star-o",i=t.is_favorite?"Remove from favorites":"Add to favorites";return n.a.createElement(Ee,{title:i,"aria-label":i,className:"favorites-control btn-favorite",onClick:e=>this.toggleItem(e,t,r)},n.a.createElement("i",{className:a,"aria-hidden":"true"}))}}Mn(zn,"propTypes",{item:se.a.shape({is_favorite:se.a.bool.isRequired}).isRequired,onChange:se.a.func}),Mn(zn,"defaultProps",{onChange:()=>{}});se.a.shape({syntax:se.a.string,options:se.a.shape({doc:se.a.string,doc_url:se.a.string}),type_name:se.a.string});var Fn=se.a.shape({columns:se.a.arrayOf(se.a.string).isRequired}),Ln=(se.a.arrayOf(Fn),se.a.shape({interval:se.a.number,time:se.a.string,day_of_week:se.a.string,until:se.a.string})),Un={interval:null,time:null,day_of_week:null,until:null},Vn=se.a.shape({id:se.a.number.isRequired,name:se.a.string.isRequired,email:se.a.string.isRequired,profileImageUrl:se.a.string,apiKey:se.a.string,isDisabled:se.a.bool}),Bn=se.a.shape({id:se.a.number.isRequired,name:se.a.string.isRequired,icon:se.a.string.isRequired,type:se.a.string.isRequired}),Qn=se.a.shape({id:se.a.any.isRequired,name:se.a.string.isRequired,description:se.a.string,data_source_id:se.a.any.isRequired,created_at:se.a.string.isRequired,updated_at:se.a.string,user:Vn,query:se.a.string,queryHash:se.a.string,is_safe:se.a.bool.isRequired,is_draft:se.a.bool.isRequired,is_archived:se.a.bool.isRequired,api_key:se.a.string.isRequired}),Wn=se.a.shape({column:se.a.string,op:se.a.oneOf([">",">=","<","<=","==","!="]),value:se.a.oneOfType([se.a.string,se.a.number]),custom_subject:se.a.string,custom_body:se.a.string}),Hn=se.a.shape({id:se.a.any,name:se.a.string,created_at:se.a.string,last_triggered_at:se.a.string,updated_at:se.a.string,rearm:se.a.number,state:se.a.oneOf(["ok","triggered","unknown"]),user:Vn,query:Qn,options:se.a.shape({column:se.a.string,op:se.a.string,value:se.a.oneOfType([se.a.string,se.a.number])}).isRequired});function Gn(e,t,r,a){var n=t[r],i=e&&null!=n&&l.a.isMoment(n),s=!e&&(null==n||l.a.isMoment(n));if(!i&&!s)return new Error("Prop `"+r+"` supplied to `"+a+"` should be a Moment.js instance.")}var Kn=Object(c.wrap)(!1,Gn);function Yn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Jn(e){var t=e.date,r=e.placeholder,i=e.autoUpdate,s=e.variation,o=function(e){return(e=Object(c.isNil)(e)?null:l()(e))&&e.isValid()?e:null}(t),u=Yn(Object(a.useState)(null),2),d=u[0],m=u[1],p=Object(a.useMemo)(()=>o?o.format($.dateTimeFormat):null,[o]);return Object(a.useEffect)(()=>{function e(){m(o?o.fromNow():r)}if(e(),i){var t=setInterval(e,3e4);return()=>clearInterval(t)}},[i,o,r]),"timeAgoInTooltip"===s?n.a.createElement(Ne,{title:d},n.a.createElement("span",{"data-test":"TimeAgo"},p)):n.a.createElement(Ne,{title:p},n.a.createElement("span",{"data-test":"TimeAgo"},d))}function Xn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Zn(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}Kn.isRequired=Object(c.wrap)(!0,Gn),Jn.propTypes={date:se.a.oneOfType([se.a.string,se.a.number,se.a.instanceOf(Date),Kn]),placeholder:se.a.string,autoUpdate:se.a.bool,variation:se.a.oneOf(["timeAgoInTooltip"])},Jn.defaultProps={date:null,placeholder:"",autoUpdate:!0};var ei={NEVER:"Never",SECONDS:"second",MINUTES:"minute",HOURS:"hour",DAYS:"day",WEEKS:"week",MILLISECONDS:"millisecond"};function ti(e,t){if(!e)return"";var r=l()(e);return r.isValid()?r.format(t):"-"}function ri(e){return ti(e,$.dateTimeFormat)}function ai(e){return ti(e,$.dateFormat)}function ni(e){var t=Xn(e.split(":"),2),r=t[0],a=t[1];return l.a.utc().hour(r).minute(a).local().format("HH:mm")}function ii(e){if(!e)return{interval:ei.NEVER};var t=ei.SECONDS;return e>=60&&(e/=60,t=ei.MINUTES),e>=60&&(e/=60,t=ei.HOURS),e>=24&&t===ei.HOURS&&(e/=24,t=ei.DAYS),e>=7&&!(e%7)&&t===ei.DAYS&&(e/=7,t=ei.WEEKS),{count:e,interval:t}}function si(e,t){return e+(1!==t?"s":"")}function oi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"-";var r="",a=ii(e),n=a.interval,i=a.count,s=Math.round(i);return 1===s&&t.omitSingleValueNumber||(r="".concat(s," ")),r+=si(n,s)}function li(e){return e.replace(/_/g," ").replace(/(?:^|\s)\S/g,e=>e.toUpperCase())}function ci(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return Math.round(e)!==e?e.toFixed(t):e.toString()}function ui(e,t){return function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0;if(isNaN(parseFloat(e))||!isFinite(e))return{value:"",unit:"",divisor:1};for(var n=0,i=1;e>=t&&n<r.length-1;)e/=t,i*=t,n+=1;return{value:ci(e,a),unit:r[n],divisor:i}}(e,1024,["bytes","KB","MB","GB","TB","PB"],t)}function di(e){var t=ui(e),r=t.value,a=t.unit;return r?r+" "+a:"?"}function mi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return l.a.isMoment(e)?"date"===t?ai(e):ri(e):"boolean"==typeof e?e.toString():e}function pi(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function fi(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pi(Object(r),!0).forEach((function(t){hi(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pi(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function hi(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bi(){return(bi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function gi(){return Object(c.extend)(this(...arguments),{sorter:!0})}var yi={favorites:e=>Object(c.extend)({width:"1%",render:(e,t)=>n.a.createElement(zn,{item:t})},e),avatar:(e,t)=>(t=Object(c.isFunction)(t)?t:c.identity,Object(c.extend)({width:"1%",render:(e,r)=>n.a.createElement("img",{src:r.user.profile_image_url,className:"profile__image_thumb",alt:t(e.name,r),title:t(e.name,r)})},e)),date:e=>Object(c.extend)({render:e=>ai(e)},e),dateTime:e=>Object(c.extend)({render:e=>ri(e)},e),duration:e=>Object(c.extend)({width:"1%",className:"text-nowrap",render:e=>oi(e)},e),timeAgo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return Object(c.extend)({render:e=>n.a.createElement(Jn,bi({date:e},t))},e)},custom:(e,t)=>Object(c.extend)({render:e},t)};yi.date.sortable=gi,yi.dateTime.sortable=gi,yi.duration.sortable=gi,yi.timeAgo.sortable=gi,yi.custom.sortable=gi;class vi extends n.a.Component{constructor(){super(...arguments),hi(this,"getRowKey",e=>{var t=this.props.rowKey;return t?Object(c.isFunction)(t)?t(e.item):e.item[t]:e.key})}prepareColumns(){var e=this.props,t=e.orderByField,r=e.orderByReverse,a=e.toggleSorting,n=r?"descend":"ascend";return Object(c.map)(Object(c.map)(Object(c.filter)(this.props.columns,e=>!Object(c.isFunction)(e.isAvailable)||e.isAvailable()),e=>Object(c.extend)(e,{orderByField:e.orderByField||e.field})),(e,r)=>{var i=e.sorter?()=>({onClick:()=>a(e.orderByField)}):null,s=Object(c.isFunction)(e.render)?(t,r)=>e.render(t,r.item):c.identity;return Object(c.extend)(Object(c.omit)(e,["field","orderByField","render"]),{key:"column"+r,dataIndex:["item",e.field],defaultSortOrder:e.orderByField===t?n:null,onHeaderCell:i,render:s})})}render(){var e={columns:this.prepareColumns(),dataSource:Object(c.map)(this.props.items,(e,t)=>({key:"row"+t,item:e}))},t=Object(c.isFunction)(this.props.onRowClick)?e=>({onClick:t=>{this.props.onRowClick(t,e.item)}}):null,r=this.props.showHeader;return this.props.loading&&(Object(c.isEmpty)(e.dataSource)?(e.columns=e.columns.map(e=>fi(fi({},e),{},{sorter:!1,render:()=>n.a.createElement(Rn.a,{active:!0,paragraph:!1})})),e.dataSource=Object(c.range)(10).map(e=>({key:"".concat(e)}))):e.loading={indicator:null}),n.a.createElement(In.a,bi({className:ge()("table-data",{"ant-table-headerless":!r}),showHeader:r,rowKey:this.getRowKey,pagination:!1,onRow:t,"data-test":this.props["data-test"]},e))}}function Oi(e){var t=e.title,r=e.value,a=e.loading;return n.a.createElement(qn.a,{spinning:a},n.a.createElement(An.a,null,t,n.a.createElement("div",{className:"f-20"},r)))}hi(vi,"propTypes",{loading:se.a.bool,items:se.a.arrayOf(se.a.object),columns:se.a.arrayOf(se.a.shape({field:se.a.string,orderByField:se.a.string,render:se.a.func,isAvailable:se.a.func})),showHeader:se.a.bool,onRowClick:se.a.func,orderByField:se.a.string,orderByReverse:se.a.bool,toggleSorting:se.a.func,"data-test":se.a.string,rowKey:se.a.oneOfType([se.a.string,se.a.func])}),hi(vi,"defaultProps",{loading:!1,items:[],columns:[],showHeader:!0,onRowClick:null,orderByField:null,orderByReverse:!1,toggleSorting:()=>{}}),Oi.propTypes={title:se.a.string.isRequired,value:se.a.oneOfType([se.a.number,se.a.string]),loading:se.a.bool.isRequired},Oi.defaultProps={value:""};var Ei=[{title:"Queue",dataIndex:"origin"},{title:"Query ID",dataIndex:["meta","query_id"]},{title:"Org ID",dataIndex:["meta","org_id"]},{title:"Data Source ID",dataIndex:["meta","data_source_id"]},{title:"User ID",dataIndex:["meta","user_id"]},yi.custom(e=>e.toString(),{title:"Scheduled",dataIndex:["meta","scheduled"]}),yi.timeAgo({title:"Start Time",dataIndex:"started_at"}),yi.timeAgo({title:"Enqueue Time",dataIndex:"enqueued_at"})],ji=[{title:"Queue",dataIndex:"origin"},{title:"Job Name",dataIndex:"name"},yi.timeAgo({title:"Start Time",dataIndex:"started_at"}),yi.timeAgo({title:"Enqueue Time",dataIndex:"enqueued_at"})],wi=[yi.custom(e=>n.a.createElement("span",null,n.a.createElement(kn.a,{status:{busy:"processing",idle:"default",started:"success",suspended:"warning"}[e]})," ",e),{title:"State",dataIndex:"state"})].concat(Object(c.map)(["Hostname","PID","Name","Queues","Current Job","Successful Jobs","Failed Jobs"],e=>({title:e,dataIndex:e.toLowerCase().replace(/\s/g,"_")}))).concat([yi.dateTime({title:"Birth Date",dataIndex:"birth_date"}),yi.duration({title:"Total Working Time",dataIndex:"total_working_time"})]),Si=Object(c.map)(["Name","Started","Queued"],e=>({title:e,dataIndex:e.toLowerCase()})),Pi={loading:se.a.bool.isRequired,items:se.a.arrayOf(se.a.object).isRequired};function Ci(e){var t=e.loading,r=e.items;return n.a.createElement(In.a,{loading:t,columns:wi,rowKey:"name",dataSource:r,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function Ni(e){var t=e.loading,r=e.items;return n.a.createElement(In.a,{loading:t,columns:Si,rowKey:"name",dataSource:r,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function ki(e){var t=e.loading,r=e.items;return n.a.createElement(In.a,{loading:t,columns:Ei,rowKey:"id",dataSource:r,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}function _i(e){var t=e.loading,r=e.items;return n.a.createElement(In.a,{loading:t,columns:ji,rowKey:"id",dataSource:r,pagination:{defaultPageSize:25,pageSizeOptions:["10","25","50"],showSizeChanger:!0}})}Ci.propTypes=Pi,Ni.propTypes=Pi,ki.propTypes=Pi,_i.propTypes=Pi;var Ai=["started"];function xi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return qi(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qi(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Ti(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Ii(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ti(Object(r),!0).forEach((function(t){Ri(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ti(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Di(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Ri(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Mi extends n.a.Component{constructor(){super(...arguments),Ri(this,"state",{activeTab:R.hash,isLoading:!0,error:null,queueCounters:[],overallCounters:{started:0,queued:0},startedJobs:[],workers:[]}),Ri(this,"_refreshTimer",null),Ri(this,"refresh",()=>{K.get("/api/admin/queries/rq_status").then(e=>this.processQueues(e)).catch(e=>this.handleError(e)),this._refreshTimer=setTimeout(this.refresh,6e4)}),Ri(this,"processQueues",e=>{var t=e.queues,r=e.workers,a=Object(c.values)(t).map(e=>{var t=e.started,r=Di(e,Ai);return Ii({started:t.length},r)}),n=a.reduce((e,t)=>({started:e.started+t.started,queued:e.queued+t.queued}),{started:0,queued:0}),i=Object(c.flatMap)(Object(c.values)(t),e=>e.started.map(e=>Ii(Ii({},e),{},{enqueued_at:l.a.utc(e.enqueued_at),started_at:l.a.utc(e.started_at)})));this.setState({isLoading:!1,queueCounters:a,startedJobs:i,overallCounters:n,workers:r})}),Ri(this,"handleError",e=>{this.setState({isLoading:!1,error:e})})}componentDidMount(){vt("view","page","admin/rq_status"),this.refresh()}componentWillUnmount(){clearTimeout(this._refreshTimer),this.processQueues=()=>{},this.handleError=()=>{}}render(){var e=this.state,t=e.isLoading,r=e.error,a=e.queueCounters,i=e.startedJobs,s=e.overallCounters,o=e.workers,l=e.activeTab,u=xi(Object(c.partition)(i,["name","redash.tasks.queries.execution.execute_query"]),2),d=u[0],m=u[1];return n.a.createElement(Cn,{activeTab:"jobs"},n.a.createElement("div",{className:"p-15"},r&&n.a.createElement(p.a,{type:"error",message:"Failed loading status. Please refresh."}),!r&&n.a.createElement(n.a.Fragment,null,n.a.createElement(Sn.Row,{gutter:15,className:"m-b-15"},n.a.createElement(Sn.Col,{span:8},n.a.createElement(Oi,{title:"Started Jobs",value:s.started,loading:t})),n.a.createElement(Sn.Col,{span:8},n.a.createElement(Oi,{title:"Queued Jobs",value:s.queued,loading:t}))),n.a.createElement(wn.a,{activeKey:l||"queues",onTabClick:e=>{R.setHash(e),this.setState({activeTab:e})},animated:!1},n.a.createElement(wn.a.TabPane,{key:"queues",tab:"Queues"},n.a.createElement(Ni,{loading:t,items:a})),n.a.createElement(wn.a.TabPane,{key:"workers",tab:"Workers"},n.a.createElement(Ci,{loading:t,items:o})),n.a.createElement(wn.a.TabPane,{key:"queries",tab:"Queries"},n.a.createElement(ki,{loading:t,items:d})),n.a.createElement(wn.a.TabPane,{key:"other",tab:"Other Jobs"},n.a.createElement(_i,{loading:t,items:m}))))))}}mn.register("Admin.Jobs",Ga({path:"/admin/queries/jobs",title:"RQ Status",render:e=>n.a.createElement(Mi,e)}));var zi=r(189),Fi=r.n(zi),Li=r(337),Ui=r.n(Li);function Vi(e){var t=e.page,r=e.showPageSizeSelect,a=e.pageSize,i=e.onPageSizeChange,s=e.totalCount,o=e.onChange;return s<=(r?5:a)?null:n.a.createElement("div",{className:"paginator-container"},n.a.createElement(Ui.a,{showSizeChanger:r,pageSizeOptions:["5","10","20","50","100"],onShowSizeChange:(e,t)=>i(t),defaultCurrent:t,pageSize:a,total:s,onChange:o}))}Vi.propTypes={page:se.a.number.isRequired,showPageSizeSelect:se.a.bool,pageSize:se.a.number.isRequired,totalCount:se.a.number.isRequired,onPageSizeChange:se.a.func,onChange:se.a.func},Vi.defaultProps={showPageSizeSelect:!1,onChange:()=>{},onPageSizeChange:()=>{}};var Bi=r(23),Qi=r.n(Bi);function Wi(){return(Wi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Hi(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Gi(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gi(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Ki(e){var t=e.dialog,r=e.tags,i=e.getAvailableTags,s=Hi(Object(a.useState)([]),2),o=s[0],l=s[1],u=Hi(Object(a.useState)(!0),2),d=u[0],m=u[1],p=Hi(Object(a.useState)(()=>Object(c.uniq)(Object(c.map)(r,c.trim))),2),f=p[0],h=p[1],b=Hi(Object(a.useState)(null),2),g=b[0],y=b[1];return Object(a.useEffect)(()=>{g&&!d&&g.focus()},[g,d]),Object(a.useEffect)(()=>{var e=!1;return i().then(t=>{e||(l(Object(c.uniq)(Object(c.compact)(Object(c.map)(t,c.trim)))),m(!1))}),()=>{e=!0}},[i]),n.a.createElement(V.a,Wi({},t.props,{onOk:()=>t.close(f),title:"Add/Edit Tags",className:"shortModal",wrapProps:{"data-test":"EditTagsDialog"}}),n.a.createElement(Qi.a,{ref:y,mode:"tags",className:"w-100",placeholder:"Add some tags...",defaultValue:f,onChange:e=>h(Object(c.compact)(Object(c.map)(e,c.trim))),disabled:d,loading:d},Object(c.map)(o,e=>n.a.createElement(Qi.a.Option,{key:e},e))))}Ki.propTypes={dialog:Je.isRequired,tags:se.a.arrayOf(se.a.string),getAvailableTags:se.a.func.isRequired},Ki.defaultProps={tags:[]};var Yi=Xe(Ki),$i=["isDraft","isArchived"];function Ji(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Xi(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Zi extends n.a.Component{constructor(){super(...arguments),Xi(this,"editTags",(e,t)=>{Yi.showModal({tags:e,getAvailableTags:t}).onClose(this.props.onEdit)})}renderEditButton(){var e=Object(c.map)(this.props.tags,c.trim);return n.a.createElement(Ee,{className:"label label-tag hidden-xs",onClick:()=>this.editTags(e,this.props.getAvailableTags),"data-test":"EditTagsButton"},0===e.length&&n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"zmdi zmdi-plus m-r-5","aria-hidden":"true"}),"Add tag"),e.length>0&&n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"zmdi zmdi-edit","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Edit")))}render(){var e=this.props,t=e.tags,r=e.tagSeparator;return n.a.createElement("div",{className:"tags-control "+this.props.className,"data-test":"TagsControl"},this.props.children,Object(c.map)(t,(e,t)=>n.a.createElement(n.a.Fragment,{key:e},r&&t>0&&n.a.createElement("span",{className:"tag-separator"},r),n.a.createElement("span",{className:"label label-tag",key:e,title:e,"data-test":"TagLabel"},e))),this.props.canEdit&&this.renderEditButton(),this.props.tagsExtra)}}function es(e){var t=e.archivedTooltip;function r(e){var r=e.isDraft,a=e.isArchived,i=Ji(e,$i);return n.a.createElement(Zi,i,!a&&r&&n.a.createElement("span",{className:"label label-tag-unpublished"},"Unpublished"),a&&n.a.createElement(Ne,{placement:"right",title:t},n.a.createElement("span",{className:"label label-tag-archived"},"Archived")))}return r.propTypes={isDraft:se.a.bool,isArchived:se.a.bool},r.defaultProps={isDraft:!1,isArchived:!1},r}Xi(Zi,"propTypes",{tags:se.a.arrayOf(se.a.string),canEdit:se.a.bool,getAvailableTags:se.a.func,onEdit:se.a.func,className:se.a.string,tagsExtra:se.a.node,tagSeparator:se.a.node,children:se.a.node}),Xi(Zi,"defaultProps",{tags:[],canEdit:!1,getAvailableTags:()=>Promise.resolve([]),onEdit:()=>{},className:"",tagsExtra:null,tagSeparator:null,children:null});var ts=es({archivedTooltip:"This query is archived and can't be used in dashboards, or appear in search results."}),rs=es({archivedTooltip:"This dashboard is archived and won't be listed in dashboards nor search results."});function as(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ns(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ns(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ns(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function is(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ss extends n.a.Component{get content(){var e=(this.props.schedule||ss.defaultProps.schedule).interval;if(!e)return["Never"];var t=oi(e,{omitSingleValueNumber:!0}),r="Every ".concat(t),a="Refreshes every ".concat(t),n=this.props.schedule,i=n.time,s=n.day_of_week;return i&&(a+=" at ".concat(ni(i))),s&&(a+=" on ".concat(s)),[r,a]}render(){if(this.props.isNew)return"Never";var e=as(this.content,2),t=e[0],r=e[1],a=r?n.a.createElement(Ne,{title:r},t):t;return this.props.isLink?n.a.createElement(Ee,{type:"link",className:"schedule-phrase",onClick:this.props.onClick,"data-test":"EditSchedule"},a):a}}is(ss,"propTypes",{schedule:Ln,isNew:se.a.bool.isRequired,isLink:se.a.bool,onClick:se.a.func}),is(ss,"defaultProps",{schedule:Un,isLink:!1,onClick:()=>{}});var os=r(1076),ls=r.n(os),cs=["isLoaded","totalCount","pageItems","params"],us=["children","onError"];function ds(){return(ds=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function ms(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function ps(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function fs(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ps(Object(r),!0).forEach((function(t){hs(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ps(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function hs(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var bs=se.a.shape({params:se.a.object.isRequired,isLoaded:se.a.bool.isRequired,isEmpty:se.a.bool.isRequired,searchTerm:se.a.string,updateSearch:se.a.func.isRequired,selectedTags:se.a.array.isRequired,updateSelectedTags:se.a.func.isRequired,orderByField:se.a.string,orderByReverse:se.a.bool.isRequired,toggleSorting:se.a.func.isRequired,page:se.a.number.isRequired,itemsPerPage:se.a.number.isRequired,totalItemsCount:se.a.number.isRequired,pageSizeOptions:se.a.arrayOf(se.a.number).isRequired,pageItems:se.a.array.isRequired,updatePagination:se.a.func.isRequired,handleError:se.a.func.isRequired});function gs(e,t,r){class a extends n.a.Component{constructor(e){super(e),hs(this,"_itemsSource",void 0);var a=r(),n=t();this._itemsSource=n,n.setState(fs(fs({},a.getState()),{},{validate:!1})),n.getCallbackContext=()=>this.state,n.onBeforeUpdate=()=>{var e=n.getState();a.setState(e),this.setState(this.getState(fs(fs({},e),{},{isLoaded:!1})))},n.onAfterUpdate=()=>{var e=n.getState();this.setState(this.getState(fs(fs({},e),{},{isLoaded:!0})))},n.onError=e=>this.props.onError(e);var i=this.getState(fs(fs({},n.getState()),{},{isLoaded:!1})),s=n.updatePagination,o=n.toggleSorting,l=n.updateSearch,u=n.updateSelectedTags,d=n.update,m=n.handleError;this.state=fs(fs({},i),{},{toggleSorting:o,updateSearch:Object(c.debounce)(l,200),updateSelectedTags:u,updatePagination:s,update:d,handleError:m})}componentDidMount(){this.state.update()}componentWillUnmount(){this._itemsSource.onBeforeUpdate=()=>{},this._itemsSource.onAfterUpdate=()=>{},this._itemsSource.onError=()=>{}}getState(e){var t=e.isLoaded,r=e.totalCount,a=e.pageItems,n=e.params;return fs(fs({},ms(e,cs)),{},{params:fs(fs({},n),Object(c.omit)(this.props,["onError","children"])),isLoaded:t,isEmpty:!t||0===r,totalItemsCount:r||0,pageSizeOptions:$.pageSizeOptions,pageItems:a||[]})}render(){var t=this.props,r=t.children,a=(t.onError,ms(t,us));return n.a.createElement(e,ds({},a,{controller:this.state}),r)}}return hs(a,"propTypes",{onError:se.a.func,children:se.a.node}),hs(a,"defaultProps",{onError:e=>{setTimeout(()=>{throw e})},children:null}),ls()(a,e),a}function ys(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class vs{get totalPages(){return Math.ceil(this.totalCount/this.itemsPerPage)}setPage(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(c.isUndefined)(e)||(e=parseInt(e,10)||1,this.page=t?e>=1&&e<=this.totalPages?e:1:e>=1?e:1)}setItemsPerPage(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(c.isUndefined)(e)||(e=parseInt(e,10)||20,this.itemsPerPage=e>=1?e:1,t&&this.setPage(this.page,t))}setTotalCount(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(c.isUndefined)(e)||(e=parseInt(e,10)||0,this.totalCount=e,t&&this.setPage(this.page,t))}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.page,r=e.itemsPerPage,a=e.totalCount,n=e.validate,i=void 0===n||n;ys(this,"page",1),ys(this,"itemsPerPage",20),ys(this,"totalCount",0),this.setItemsPerPage(r,i),this.setTotalCount(a,i),this.setPage(t,i)}getItemsForPage(e){var t=this.itemsPerPage*(this.page-1),r=t+this.itemsPerPage;return e.slice(t,r)}}function Os(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Es(e,t){return e?t?"-"+e:e:null}function js(e){var t=(e=Object(c.isString)(e)?e:"").startsWith("-");return t&&(e=e.substring(1)),{field:""!==e?e:null,reverse:t}}class ws{get compiled(){return Es(this.field,this.reverse)}set compiled(e){var t=js(e),r=t.field,a=t.reverse;this.field=r,this.reverse=a}setField(e){this.field=Object(c.isString)(e)&&""!==e?e:null}setReverse(e){this.reverse=!!e}constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.orderByField,r=e.orderByReverse,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;Os(this,"field",null),Os(this,"reverse",!1),Os(this,"sortByIteratees",null),this.setField(t),this.setReverse(r),this.sortByIteratees=a}toggleField(e){Object(c.isString)(e)&&""!==e&&(e===this.field?this.reverse=!this.reverse:(this.field=e,this.reverse=!1))}sort(e){if(this.field){var t=this.sortByIteratees&&this.sortByIteratees[this.field];return e=Object(c.sortBy)(e,t?[t]:this.field),this.reverse&&e.reverse(),e}}}r(2423);function Ss(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ps{_getRequest(e,t){return this._originalGetRequest({},t)}_processResults(e,t,r){var a=e.results,n=e.count;return{results:this._originalProcessResults(a,r),count:n}}constructor(e){var t=e.getRequest,r=e.doRequest,a=e.processResults;this._originalGetRequest=Object(c.isFunction)(t)?t:c.identity,this._originalDoRequest=r,this._originalProcessResults=Object(c.isFunction)(a)?a:c.identity}fetch(e,t,r){var a=this._getRequest(t,r);return this._originalDoRequest(a,r).then(e=>this._processResults(e,t,r))}}class Cs extends Ps{constructor(){super(...arguments),Ss(this,"_allItems",[])}_getRequest(e,t){var r=e.searchTerm,a=e.selectedTags;return this._originalGetRequest({q:Object(c.isString)(r)&&""!==r?r:void 0,tags:a},t)}_processResults(e,t,r){var a=t.paginator,n=t.sorter;return this._allItems=this._originalProcessResults(e,r),this._allItems=n.sort(this._allItems),{results:a.getItemsForPage(this._allItems),count:this._allItems.length,allResults:this._allItems}}fetch(e,t,r){if(Object(c.isNil)(e)||e.tags||e.sorting)return super.fetch(e,t,r);var a=t.paginator,n=t.sorter;return e.sorting&&(this._allItems=n.sort(this._allItems)),Promise.resolve({results:a.getItemsForPage(this._allItems),count:this._allItems.length,allResults:this._allItems})}}class Ns extends Ps{_getRequest(e,t){var r=e.paginator,a=e.sorter,n=e.searchTerm,i=e.selectedTags;return this._originalGetRequest({page:r.page,page_size:r.itemsPerPage,order:a.compiled,q:Object(c.isString)(n)&&""!==n?n:void 0,tags:i},t)}}var ks=["getRequest","doRequest","processResults","isPlainList","sortByIteratees"],_s=["getResource","getItemProcessor"];function As(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function xs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function qs(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xs(Object(r),!0).forEach((function(t){Ts(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xs(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ts(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Is{_beforeUpdate(){return Object(c.isFunction)(this.onBeforeUpdate)?Promise.resolve(this.onBeforeUpdate(this.getState(),this.getCallbackContext())):Promise.resolve()}_afterUpdate(){return Object(c.isFunction)(this.onAfterUpdate)?Promise.resolve(this.onAfterUpdate(this.getState(),this.getCallbackContext())):Promise.resolve()}_changed(e){var t={paginator:this._paginator,sorter:this._sorter,searchTerm:this._searchTerm,selectedTags:this._selectedTags},r={},a=qs(qs({},this.getCallbackContext()),{},{setCustomParams:e=>{Object(c.extend)(r,e)}});return this._beforeUpdate().then(()=>{var n=Math.random().toString(36).substr(2);return this._currentFetchToken=n,this._fetcher.fetch(e,t,a).then(e=>{var t=e.results,a=e.count,i=e.allResults;if(this._currentFetchToken===n)return this._pageItems=t,this._allItems=i||null,this._paginator.setTotalCount(a),this._params=qs(qs({},this._params),r),this._afterUpdate()}).catch(e=>this.handleError(e))})}constructor(e){var t=e.getRequest,r=e.doRequest,a=e.processResults,n=e.isPlainList,i=void 0!==n&&n,s=e.sortByIteratees,o=void 0===s?void 0:s,l=As(e,ks);Ts(this,"onBeforeUpdate",null),Ts(this,"onAfterUpdate",null),Ts(this,"onError",null),Ts(this,"sortByIteratees",void 0),Ts(this,"getCallbackContext",()=>null),Ts(this,"updatePagination",e=>{var t=e.page,r=e.itemsPerPage,a=this._paginator,n=a.page,i=a.itemsPerPage;this._paginator.setItemsPerPage(r),this._paginator.setPage(t),this._changed({pagination:{page:n!==this._paginator.page,itemsPerPage:i!==this._paginator.itemsPerPage}})}),Ts(this,"toggleSorting",e=>{this._sorter.toggleField(e),this._savedOrderByField=this._sorter.field,this._changed({sorting:!0})}),Ts(this,"updateSearch",e=>{this._searchTerm=e,""===e?this._sorter.setField(this._savedOrderByField):this._sorter.setField(null),this._paginator.setPage(1),this._changed({search:!0,pagination:{page:!0}})}),Ts(this,"updateSelectedTags",e=>{this._selectedTags=e,this._paginator.setPage(1),this._changed({tags:!0,pagination:{page:!0}})}),Ts(this,"update",()=>this._changed()),Ts(this,"handleError",e=>{Object(c.isFunction)(this.onError)&&this.onError(e)}),Object(c.isFunction)(t)||(t=c.identity),this._fetcher=i?new Cs({getRequest:t,doRequest:r,processResults:a}):new Ns({getRequest:t,doRequest:r,processResults:a}),this.sortByIteratees=o,this.setState(l),this._pageItems=[],this._params={}}getState(){return{page:this._paginator.page,itemsPerPage:this._paginator.itemsPerPage,orderByField:this._sorter.field,orderByReverse:this._sorter.reverse,searchTerm:this._searchTerm,selectedTags:this._selectedTags,totalCount:this._paginator.totalCount,pageItems:this._pageItems,allItems:this._allItems,params:this._params}}setState(e){this._paginator=new vs(e),this._sorter=new ws(e,this.sortByIteratees),this._searchTerm=e.searchTerm||"",this._selectedTags=e.selectedTags||[],this._savedOrderByField=this._sorter.field}}class Ds extends Is{constructor(e){var t=e.getResource,r=e.getItemProcessor,a=As(e,_s);r=Object(c.isFunction)(r)?r:()=>null,super(qs(qs({},a),{},{doRequest:(e,r)=>t(r)(e),processResults:(e,t)=>{var a=r(t);return a=Object(c.isFunction)(a)?a:c.identity,Object(c.map)(e,e=>a(e,t))}}))}}function Rs(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Ms(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class zs{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._state=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rs(Object(r),!0).forEach((function(t){Ms(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rs(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e)}getState(){return Object(c.defaults)(this._state,{page:1,itemsPerPage:$.pageSize,orderByField:"created_at",orderByReverse:!1,searchTerm:"",tags:[]})}setState(){}}class Fs extends zs{getState(){var e=super.getState(),t=R.search,r=t.q||"",a=""!==r?"":Es(e.orderByField,e.orderByReverse),n=js(t.order||a),i=n.field,s=n.reverse;return{page:parseInt(t.page,10)||e.page,itemsPerPage:parseInt(t.page_size,10)||e.itemsPerPage,orderByField:i,orderByReverse:s,searchTerm:r}}setState(e){var t=e.page,r=e.itemsPerPage,a=e.orderByField,n=e.orderByReverse,i=e.searchTerm;R.setSearch({page:t,page_size:r,order:Es(a,n),q:""!==i?i:null},!0)}}function Ls(){return(Ls=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Us(e){return n.a.createElement("div",{className:"text-center"},n.a.createElement(Ie,Ls({icon:"fa-spinner fa-2x fa-pulse",message:"Loading..."},e)))}function Vs(){return(Vs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Bs(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Qs extends n.a.Component{constructor(){var e;super(...arguments),e=this,Bs(this,"listColumns",[{title:"ID",field:"id",width:"1%",align:"right",sorter:!0},yi.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(S,{className:"table-main-title",href:"queries/"+t.id},t.name),n.a.createElement(ts,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:"Name",field:"name",width:null}),yi.avatar({field:"user",className:"p-l-0 p-r-0"},e=>"Created by ".concat(e)),yi.dateTime.sortable({title:"Created At",field:"created_at"}),yi.duration.sortable({title:"Runtime",field:"runtime"}),yi.dateTime.sortable({title:"Last Executed At",field:"retrieved_at",orderByField:"executed_at"}),yi.custom.sortable((e,t)=>n.a.createElement(ss,{schedule:t.schedule,isNew:t.isNew()}),{title:"Update Schedule",field:"schedule"})]),Bs(this,"state",{autoUpdate:!0}),Bs(this,"_updateTimer",null),Bs(this,"autoUpdateSwitchId",Object(c.uniqueId)("auto-update-switch")),Bs(this,"update",(function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!t&&e.state.autoUpdate&&e.props.controller.update(),e._updateTimer=setTimeout(e.update,6e4)}))}componentDidMount(){vt("view","page","admin/queries/outdated"),this.update(!0)}componentWillUnmount(){clearTimeout(this._updateTimer)}render(){var e=this.props.controller;return n.a.createElement(Cn,{activeTab:e.params.currentPage},n.a.createElement("div",{className:"m-15"},n.a.createElement("div",null,n.a.createElement("label",{htmlFor:this.autoUpdateSwitchId,className:"m-0"},"Auto update"),n.a.createElement(Fi.a,{id:this.autoUpdateSwitchId,className:"m-l-10",checked:this.state.autoUpdate,onChange:e=>this.setState({autoUpdate:e})})),e.params.lastUpdatedAt&&n.a.createElement("div",{className:"m-t-5"},"Last updated: ",n.a.createElement(Jn,{date:1e3*e.params.lastUpdatedAt}))),!e.isLoaded&&n.a.createElement(Us,null),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center p-15"},"There are no outdated queries."),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(vi,{items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vi,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}Bs(Qs,"propTypes",{controller:bs.isRequired});var Ws=gs(Qs,()=>new Is({doRequest:(e,t)=>K.get("/api/admin/queries/outdated").then(e=>{var r=e.queries,a=e.updated_at;return t.setCustomParams({lastUpdatedAt:parseFloat(a)}),r}),processResults:e=>Object(c.map)(e,e=>new ir(e)),isPlainList:!0}),()=>new zs({orderByField:"created_at",orderByReverse:!0}));mn.register("Admin.OutdatedQueries",Ga({path:"/admin/queries/outdated",title:"Outdated Queries",render:e=>n.a.createElement(Ws,Vs({},e,{currentPage:"outdated_queries"}))}));var Hs=r(72),Gs=r.n(Hs);function Ks(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ys(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ys(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ys(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function $s(e){var t=e.info;return t=Object(c.toPairs)(t),n.a.createElement(An.a,{title:"General",size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t.length>0&&n.a.createElement(Gs.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Ks(e,2),r=t[0],a=t[1];return n.a.createElement(Gs.a.Item,{extra:n.a.createElement("span",{className:"badge"},a)},li(r))}}))}function Js(e){var t=e.info;return n.a.createElement(An.a,{title:"Redash Database",size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t.length>0&&n.a.createElement(Gs.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Ks(e,2),r=t[0],a=t[1];return n.a.createElement(Gs.a.Item,{extra:n.a.createElement("span",{className:"badge"},di(a))},r)}}))}function Xs(e){var t=e.info;return t=Object(c.toPairs)(t),n.a.createElement(An.a,{title:"Queues",size:"small"},0===t.length&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t.length>0&&n.a.createElement(Gs.a,{size:"small",itemLayout:"vertical",dataSource:t,renderItem:e=>{var t=Ks(e,2),r=t[0],a=t[1];return n.a.createElement(Gs.a.Item,{extra:n.a.createElement("span",{className:"badge"},a.size)},r)}}))}function Zs(e){var t=e.info,r=t?[n.a.createElement(Gs.a.Item,{extra:n.a.createElement("span",{className:"badge"},n.a.createElement(Jn,{date:t.lastRefreshAt,placeholder:"n/a"}))},"Last Refresh"),n.a.createElement(Gs.a.Item,{extra:n.a.createElement("span",{className:"badge"},n.a.createElement(Jn,{date:t.startedAt,placeholder:"n/a"}))},"Started"),n.a.createElement(Gs.a.Item,{extra:n.a.createElement("span",{className:"badge"},t.outdatedQueriesCount)},"Outdated Queries Count")]:[];return n.a.createElement(An.a,{title:"Manager",size:"small"},!t&&n.a.createElement("div",{className:"text-muted text-center"},"No data"),t&&n.a.createElement(Gs.a,{size:"small",itemLayout:"vertical",dataSource:r,renderItem:e=>e}))}function eo(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class to extends n.a.Component{constructor(){super(...arguments),eo(this,"state",{queues:[],manager:null,databaseMetrics:{},status:{}}),eo(this,"_refreshTimer",null),eo(this,"refresh",()=>{K.get("/status.json").then(e=>{this.setState({queues:e.manager.queues,manager:{startedAt:1e3*e.manager.started_at,lastRefreshAt:1e3*e.manager.last_refresh_at,outdatedQueriesCount:e.manager.outdated_queries_count},databaseMetrics:e.database_metrics.metrics||[],status:Object(c.omit)(e,["workers","manager","database_metrics"])})}).catch(e=>this.props.onError(e)),this._refreshTimer=setTimeout(this.refresh,6e4)})}componentDidMount(){vt("view","page","admin/status"),this.refresh()}componentWillUnmount(){clearTimeout(this._refreshTimer)}render(){return n.a.createElement(Cn,{activeTab:"system_status"},n.a.createElement("div",{className:"system-status-page"},n.a.createElement("div",{className:"system-status-page-blocks"},n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement($s,{info:this.state.status})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Zs,{info:this.state.manager})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Xs,{info:this.state.queues})),n.a.createElement("div",{className:"system-status-page-block"},n.a.createElement(Js,{info:this.state.databaseMetrics})))))}}function ro(){return(ro=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}eo(to,"propTypes",{onError:se.a.func}),eo(to,"defaultProps",{onError:()=>{}}),mn.register("Admin.SystemStatus",Ga({path:"/admin/status",title:"System Status",render:e=>n.a.createElement(to,e)}));var ao={"greater than":">","less than":"<",equals:"="},no=e=>Object(c.merge)({},e,{options:{op:ao[e.options.op]||e.options.op}}),io={query:()=>K.get("api/alerts"),get:e=>{var t=e.id;return K.get("api/alerts/".concat(t)).then(no)},save:e=>K.post((e=>e.id?"api/alerts/".concat(e.id):"api/alerts")(e),(e=>{var t=ro({},e);return void 0===t.query_id&&(t.query_id=t.query.id,t.destination_id=t.destinations,delete t.query,delete t.destinations),t})(e)),delete:e=>K.delete("api/alerts/".concat(e.id)),mute:e=>K.post("api/alerts/".concat(e.id,"/mute")),unmute:e=>K.delete("api/alerts/".concat(e.id,"/mute"))};function so(){return(so=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function oo(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var lo={unknown:"label-warning",ok:"label-success",triggered:"label-danger"};class co extends n.a.Component{constructor(){super(...arguments),oo(this,"listColumns",[yi.custom.sortable((e,t)=>n.a.createElement("span",{title:t.options.muted?"Muted":"Active"},n.a.createElement("i",{className:"fa fa-bell-".concat(t.options.muted?"slash":"o"," p-r-0"),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},t.options.muted?"Muted":"Active")),{title:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-bell p-r-0","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Sort by notification status.")),field:"muted",width:"1%"}),yi.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement(S,{className:"table-main-title",href:"alerts/"+t.id},t.name)),{title:"Name",field:"name"}),yi.custom((e,t)=>t.user.name,{title:"Created By",width:"1%"}),yi.custom.sortable((e,t)=>n.a.createElement("div",null,n.a.createElement("span",{className:"label ".concat(lo[t.state])},Object(c.toUpper)(t.state))),{title:"State",field:"state",width:"1%",className:"text-nowrap"}),yi.timeAgo.sortable({title:"Last Updated At",field:"updated_at",width:"1%"}),yi.dateTime.sortable({title:"Created At",field:"created_at",width:"1%"})])}render(){var e=this.props.controller;return n.a.createElement("div",{className:"page-alerts-list"},n.a.createElement("div",{className:"container"},n.a.createElement(Pn,{title:e.params.pageTitle,actions:Y.hasPermission("list_alerts")?n.a.createElement(S.Button,{block:!0,type:"primary",href:"alerts/new"},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Alert"):null}),n.a.createElement("div",null,e.isLoaded&&e.isEmpty?n.a.createElement(pe,{name:"AlertsList.EmptyState"},n.a.createElement(Xa,{icon:"fa fa-bell-o",illustration:"alert",description:"Get notified on certain events",helpMessage:n.a.createElement($a,{helpTriggerType:"ALERTS"}),showAlertStep:!0})):n.a.createElement("div",{className:"table-responsive bg-white tiled"},n.a.createElement(vi,{loading:!e.isLoaded,items:e.pageItems,columns:this.listColumns,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vi,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}oo(co,"propTypes",{controller:bs.isRequired});var uo=gs(co,()=>new Ds({isPlainList:!0,getRequest:()=>({}),getResource:()=>io.query.bind(io)}),()=>new zs({orderByField:"created_at",orderByReverse:!0,itemsPerPage:20}));mn.register("Alerts.List",Ga({path:"/alerts",title:"Alerts",render:e=>n.a.createElement(uo,so({},e,{currentPage:"alerts"}))}));var mo=r(164),po=r.n(mo);function fo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ho(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ho(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ho(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function bo(e){var t=e.doDelete,r=e.canEdit,i=e.mute,s=e.unmute,o=e.muted,l=fo(Object(a.useState)(!1),2),c=l[0],u=l[1],d=Object(a.useCallback)(e=>{u(!0),e().finally(()=>{u(!1)})},[]),m=Object(a.useCallback)(()=>{V.a.confirm({title:"Delete Alert",content:"Are you sure you want to delete this alert?",okText:"Delete",okType:"danger",onOk:()=>{u(!0),t().catch(()=>{u(!1)})},maskClosable:!0,autoFocusButton:null})},[t]);return n.a.createElement(Da.a,{className:ge()("m-l-5",{disabled:!r}),trigger:[r?"click":void 0],placement:"bottomRight",overlay:n.a.createElement(he.a,null,n.a.createElement(he.a.Item,null,o?n.a.createElement(Ee,{onClick:()=>d(s)},"Unmute Notifications"):n.a.createElement(Ee,{onClick:()=>d(i)},"Mute Notifications")),n.a.createElement(he.a.Item,null,n.a.createElement(Ee,{onClick:m},"Delete")))},n.a.createElement(h.a,{"aria-label":"More actions"},c?n.a.createElement(fn.a,null):n.a.createElement(po.a,{rotate:90,"aria-hidden":"true"})))}bo.propTypes={doDelete:se.a.func.isRequired,canEdit:se.a.bool.isRequired,mute:se.a.func.isRequired,unmute:se.a.func.isRequired,muted:se.a.bool},bo.defaultProps={muted:!1};var go=r(30),yo=r.n(go);function vo(e){var t=e.alert,r=e.editMode,a=e.name,i=e.onChange,s=e.children,o=Rl(t);return n.a.createElement("div",{className:"alert-header"},n.a.createElement("div",{className:"alert-title"},n.a.createElement("h3",null,r&&t.query?n.a.createElement(He.a,{className:"f-inherit",placeholder:o,value:a,"aria-label":"Alert title",onChange:e=>i(e.target.value)}):a||o)),n.a.createElement("div",{className:"alert-actions"},s))}vo.propTypes={alert:Hn.isRequired,name:se.a.string,children:se.a.node,onChange:se.a.func,editMode:se.a.bool},vo.defaultProps={name:null,children:null,onChange:null,editMode:!1};var Oo=r(281),Eo=r.n(Oo),jo=r(169),wo=r.n(jo),So={">":">",">=":"≥","<":"<","<=":"≤","==":"=","!=":"≠"},Po=["==","!="];function Co(e){var t=e.children,r=e.minWidth;return n.a.createElement("div",{className:"criteria-disabled-input",style:{minWidth:r}},t)}function No(e){var t=e.columnNames,r=e.resultValues,a=e.alertOptions,i=e.onChange,s=e.editMode,o=Object(c.isEmpty)(r)?null:Object(c.head)(r)[a.column],l=Object(c.includes)(Po,a.op)?null:isNaN(a.value)?"Value column type doesn't match threshold type.":isNaN(o)?"Value column isn't supported by condition type.":null,u=n.a.createElement("small",{className:"alert-criteria-hint"},"Top row value is ",n.a.createElement("code",{className:"p-0"},Object(c.toString)(o)||"unknown"));return n.a.createElement("div",{"data-test":"Criteria"},n.a.createElement("div",{className:"input-title"},n.a.createElement("span",{className:"input-label"},"Value column"),s?n.a.createElement(Qi.a,{value:a.column,onChange:e=>i({column:e}),dropdownMatchSelectWidth:!1,style:{minWidth:100}},t.map(e=>n.a.createElement(Qi.a.Option,{key:e},e))):n.a.createElement(Co,{minWidth:70},a.column)),n.a.createElement("div",{className:"input-title"},n.a.createElement("span",{className:"input-label"},"Condition"),s?n.a.createElement(Qi.a,{value:a.op,onChange:e=>i({op:e}),optionLabelProp:"label",dropdownMatchSelectWidth:!1,style:{width:55}},n.a.createElement(Qi.a.Option,{value:">",label:So[">"]},So[">"]," greater than"),n.a.createElement(Qi.a.Option,{value:">=",label:So[">="]},So[">="]," greater than or equals"),n.a.createElement(Qi.a.Option,{disabled:!0,key:"dv1"},n.a.createElement(wo.a,{className:"select-option-divider m-t-10 m-b-5"})),n.a.createElement(Qi.a.Option,{value:"<",label:So["<"]},So["<"]," less than"),n.a.createElement(Qi.a.Option,{value:"<=",label:So["<="]},So["<="]," less than or equals"),n.a.createElement(Qi.a.Option,{disabled:!0,key:"dv2"},n.a.createElement(wo.a,{className:"select-option-divider m-t-10 m-b-5"})),n.a.createElement(Qi.a.Option,{value:"==",label:So["=="]},So["=="]," equals"),n.a.createElement(Qi.a.Option,{value:"!=",label:So["!="]},So["!="]," not equal to")):n.a.createElement(Co,{minWidth:50},So[a.op])),n.a.createElement("div",{className:"input-title"},n.a.createElement("label",{className:"input-label",htmlFor:"threshold-criterion"},"Threshold"),s?n.a.createElement(He.a,{id:"threshold-criterion",style:{width:90},value:a.value,onChange:e=>i({value:e.target.value})}):n.a.createElement(Co,{minWidth:50},a.value)),n.a.createElement("div",{className:"ant-form-item-explain"},u,n.a.createElement("br",null),l&&n.a.createElement("small",null,n.a.createElement(Eo.a,{className:"warning-icon-danger"})," ",l)))}Co.propTypes={children:se.a.node.isRequired,minWidth:se.a.number.isRequired},No.propTypes={columnNames:se.a.arrayOf(se.a.string).isRequired,resultValues:se.a.arrayOf(se.a.object).isRequired,alertOptions:Wn.isRequired,onChange:se.a.func,editMode:se.a.bool},No.defaultProps={onChange:()=>{},editMode:!1};var ko=r(166),_o=r.n(ko),Ao=["editMode"];function xo(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function qo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return To(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return To(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function To(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var Io=[["Second",1],["Minute",60],["Hour",3600],["Day",86400],["Week",604800]];function Do(e){var t=e.value,r=e.onChange,i=e.editMode,s=qo(Object(a.useState)(),2),o=s[0],l=s[1],u=qo(Object(a.useState)(),2),d=u[0],m=u[1];if(Object(a.useEffect)(()=>{for(var e=Io.length-1;e>=0;e-=1){var r=qo(Io[e],2)[1];if(t%r==0){l(e),m(t/r);break}}},[t]),!Object(c.isNumber)(d)||!Object(c.isNumber)(o))return null;var p=1!==d?"s":"";if(i)return n.a.createElement(n.a.Fragment,null,n.a.createElement(_o.a,{value:d,onChange:e=>{m(e),r(e*Io[o][1])},min:1,precision:0}),n.a.createElement(Qi.a,{value:o,onChange:e=>{l(e),r(d*Io[e][1])}},Io.map((e,t)=>{var r=qo(e,1)[0];return n.a.createElement(Qi.a.Option,{value:t,key:r},r,p)})));var f=qo(Io[o],1)[0];return d+" "+Object(c.toLower)(f)+p}function Ro(e){var t=e.value,r=e.onChange,i=qo(Object(a.useState)(t<2?t:2),2),s=i[0],o=i[1];return n.a.createElement("div",{className:"alert-rearm"},n.a.createElement(Qi.a,{optionLabelProp:"label",defaultValue:s||0,dropdownMatchSelectWidth:!1,onChange:e=>{o(e),r(e<2?e:3600)}},n.a.createElement(Qi.a.Option,{value:0,label:"Just once"},"Just once ",n.a.createElement("em",null,"until back to normal")),n.a.createElement(Qi.a.Option,{value:1,label:"Each time alert is evaluated"},"Each time alert is evaluated ",n.a.createElement("em",null,"until back to normal")),n.a.createElement(Qi.a.Option,{value:2,label:"At most every"},"At most every ... ",n.a.createElement("em",null,"when alert is evaluated"))),2===s&&t&&n.a.createElement(Do,{value:t,onChange:r,editMode:!0}))}function Mo(e){var t=e.value,r="";switch(t){case 0:r="just once, until back to normal";break;case 1:r="each time alert is evaluated, until back to normal";break;default:r=n.a.createElement(n.a.Fragment,null,"at most every ",n.a.createElement(Do,{value:t,editMode:!1}),", when alert is evaluated")}return n.a.createElement("span",null,"Notifications are sent ",r,".")}function zo(e){var t=e.editMode,r=xo(e,Ao);return t?n.a.createElement(Ro,r):n.a.createElement(Mo,r)}Do.propTypes={onChange:se.a.func,value:se.a.number.isRequired,editMode:se.a.bool.isRequired},Do.defaultProps={onChange:()=>{}},Ro.propTypes={onChange:se.a.func.isRequired,value:se.a.number.isRequired},Mo.propTypes={value:se.a.number.isRequired},zo.propTypes={onChange:se.a.func,value:se.a.number.isRequired,editMode:se.a.bool},zo.defaultProps={onChange:null,editMode:!1};var Fo=r(2762);function Lo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Uo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Uo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Uo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Vo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.initialResults,n=void 0===r?null:r,i=t.debounceTimeout,s=void 0===i?200:i,o=Object(a.useState)(n),l=Lo(o,2),c=l[0],u=l[1],d=Object(a.useState)(!1),m=Lo(d,2),p=m[0],f=m[1],h=Object(a.useRef)(null),b=Object(a.useRef)(!1),g=Object(Fo.a)(t=>{f(!0),h.current=t,e(t).catch(()=>n).then(e=>{t!==h.current||b.current||(u(e),f(!1))})},s),y=Lo(g,1),v=y[0];return Object(a.useEffect)(()=>()=>{b.current=!0},[]),[v,c,p]}function Bo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var Wo=Qi.a.Option;function Ho(e){return null===e?Promise.resolve(null):e?ir.query({q:e}).then(e=>e.results):ir.recent().then(e=>e.filter(e=>!e.is_draft))}function Go(e){var t=Bo(Object(a.useState)(""),2),r=t[0],i=t[1],s=Bo(Object(a.useState)(),2),o=s[0],l=s[1],u=Bo(Vo(Ho,{initialResults:[]}),3),d=u[0],m=u[1],p=u[2],f="Search a query by name",h=n.a.createElement("i",{className:"fa fa-times hide-in-percy",role:"button",tabIndex:0,"aria-label":"Clear",onClick:()=>g(null)}),b=n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:ge()("fa fa-spinner fa-pulse hide-in-percy",{hidden:!p}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Searching..."));function g(t){var r=null;t&&((r=Object(c.find)(m,{id:t}))||sn.error("Something went wrong...","Couldn't select query")),i(r?null:""),l(r),e.onChange(r)}if(Object(a.useEffect)(()=>{d(r)},[d,r]),Object(a.useEffect)(()=>{e.selectedQuery&&l(e.selectedQuery)},[e.selectedQuery]),e.disabled)return n.a.createElement(He.a,{value:o&&o.name,"aria-label":"Tied query",placeholder:f,disabled:!0});if("select"===e.type){var y=o?h:null,v=o?o.name:r;return n.a.createElement(Qi.a,{showSearch:!0,dropdownMatchSelectWidth:!1,placeholder:f,value:v||void 0,onSearch:i,onChange:g,suffixIcon:p?b:y,notFoundContent:null,filterOption:!1,defaultActiveFirstOption:!1,className:e.className,"data-test":"QuerySelector"},m&&m.map(e=>{var t=e.is_draft;return n.a.createElement(Wo,{value:e.id,key:e.id,disabled:t,className:"query-selector-result","data-test":"QueryId".concat(e.id)},e.name," ",n.a.createElement(ts,{isDraft:e.is_draft,tags:e.tags,className:ge()("inline-tags-control",{disabled:t})}))}))}return n.a.createElement("span",{"data-test":"QuerySelector"},o?n.a.createElement(He.a,{value:o.name,"aria-label":"Tied query",suffix:h,readOnly:!0}):n.a.createElement(He.a,{placeholder:f,value:r,"aria-label":"Tied query",onChange:e=>i(e.target.value),suffix:b}),n.a.createElement("div",{className:"scrollbox",style:{maxHeight:"50vh",marginTop:15}},m&&(m.length?n.a.createElement("ul",{className:"list-group"},m.map(e=>n.a.createElement(Ee,{className:ge()("query-selector-result","list-group-item",{inactive:e.is_draft}),key:e.id,role:"listitem",onClick:()=>g(e.id),"data-test":"QueryId".concat(e.id)},e.name," ",n.a.createElement(ts,{isDraft:e.is_draft,tags:e.tags,className:"inline-tags-control"})))):n.a.createElement("div",{className:"text-muted"},"No results matching search term."))))}Go.propTypes={onChange:se.a.func.isRequired,selectedQuery:se.a.object,type:se.a.oneOf(["select","default"]),className:se.a.string,disabled:se.a.bool},Go.defaultProps={selectedQuery:null,type:"default",className:null,disabled:!1};var Ko=r(1077),Yo=r.n(Ko);function $o(e){var t=e.query,r=e.queryResult,a=e.onChange,i=e.editMode,s=t&&t.schedule?n.a.createElement("small",null,"Scheduled to refresh"," ",n.a.createElement("i",{className:"alert-query-schedule"},n.a.createElement(ss,{schedule:t.schedule,isNew:!1}))):n.a.createElement("small",null,n.a.createElement(Eo.a,{className:"warning-icon-danger"})," This query has no ",n.a.createElement("i",null,"refresh schedule"),"."," ",n.a.createElement(Ne,{title:"A query schedule is not necessary but is highly recommended for alerts. An Alert without a query schedule will only send notifications if a user in your organization manually executes this query."},n.a.createElement("a",{role:"presentation"},"Why it's recommended ",n.a.createElement(Yo.a,null))));return n.a.createElement(n.a.Fragment,null,i?n.a.createElement(Go,{onChange:a,selectedQuery:t,className:"alert-query-selector",type:"select"}):n.a.createElement(Ne,{title:"Open query in a new tab."},n.a.createElement(S,{href:"queries/".concat(t.id),target:"_blank",rel:"noopener noreferrer",className:"alert-query-link"},t.name," ",n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))),n.a.createElement("div",{className:"ant-form-item-explain"},t&&s),t&&!r&&n.a.createElement("div",{className:"m-t-30"},n.a.createElement(fn.a,{className:"m-r-5"})," Loading query data"))}function Jo(){return(Jo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Xo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Zo(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Zo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zo(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function el(e){var t=e.items,r=e.renderItem,i=e.onItemClick,s=Object(a.useCallback)(e=>{var t=r(e),a=t.content,s=t.className,o=t.isDisabled;return n.a.createElement(Gs.a.Item,{className:ge()("select-items-list","w-100","p-l-10","p-r-10",{disabled:o},s),onClick:o?null:()=>i(e)},a)},[r,i]);return n.a.createElement(Gs.a,{size:"small",dataSource:t,renderItem:s})}function tl(e){var t=e.dialog,r=e.dialogTitle,i=e.inputPlaceholder,s=e.itemKey,o=e.renderItem,l=e.renderStagedItem,u=e.searchItems,d=e.selectedItemsTitle,m=e.width,p=e.showCount,f=e.extraFooterContent,b=Xo(Object(a.useState)([]),2),g=b[0],y=b[1],v=Xo(Vo(u,{initialResults:[]}),3),O=v[0],E=v[1],j=v[2],w=E.length>0;Object(a.useEffect)(()=>{O()},[O]);var S=Object(a.useCallback)(e=>{var t=s(e);return!!Object(c.find)(g,e=>s(e)===t)},[g,s]),P=Object(a.useCallback)(e=>{if(S(e)){var t=s(e);y(Object(c.filter)(g,e=>s(e)!==t))}else y([...g,e])},[g,s,S]),C=Object(a.useCallback)(()=>{t.close(g).catch(e=>{e&&sn.error("Failed to save some of selected items.")})},[t,g]);return n.a.createElement(V.a,Jo({},t.props,{className:"select-items-dialog",width:m,title:r,footer:n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("span",{className:"flex-fill m-r-5",style:{textAlign:"left",color:"rgba(0, 0, 0, 0.5)"}},f),n.a.createElement(h.a,Jo({},t.props.cancelButtonProps,{onClick:t.dismiss}),"Cancel"),n.a.createElement(h.a,Jo({},t.props.okButtonProps,{onClick:C,disabled:0===g.length||t.props.okButtonProps.disabled,type:"primary"}),"Save",p&&!Object(c.isEmpty)(g)?" (".concat(Object(c.size)(g),")"):null))}),n.a.createElement("div",{className:"d-flex align-items-center m-b-10"},n.a.createElement("div",{className:"flex-fill"},n.a.createElement(He.a.Search,{onChange:e=>O(e.target.value),placeholder:i,"aria-label":i,autoFocus:!0})),l&&n.a.createElement("div",{className:"w-50 m-l-20"},n.a.createElement("h5",{className:"m-0"},d))),n.a.createElement("div",{className:"d-flex align-items-stretch",style:{minHeight:"30vh",maxHeight:"50vh"}},n.a.createElement("div",{className:"flex-fill scrollbox"},j&&n.a.createElement(Us,{className:""}),!j&&!w&&n.a.createElement(Ie,{icon:"fa-search",message:"No items match your search.",className:""}),!j&&w&&n.a.createElement(el,{items:E,renderItem:e=>o(e,{isSelected:S(e)}),onItemClick:P})),l&&n.a.createElement("div",{className:"w-50 m-l-20 scrollbox"},g.length>0&&n.a.createElement(el,{items:g,renderItem:e=>l(e,{isSelected:!0}),onItemClick:P}))))}$o.propTypes={query:Qn,queryResult:se.a.object,onChange:se.a.func,editMode:se.a.bool},$o.defaultProps={query:null,queryResult:null,onChange:()=>{},editMode:!1},el.propTypes={items:se.a.array,renderItem:se.a.func,onItemClick:se.a.func},el.defaultProps={items:[],renderItem:()=>{},onItemClick:()=>{}},tl.propTypes={dialog:Je.isRequired,dialogTitle:se.a.string,inputPlaceholder:se.a.string,selectedItemsTitle:se.a.string,searchItems:se.a.func.isRequired,itemKey:se.a.func,renderItem:se.a.func,renderStagedItem:se.a.func,width:se.a.oneOfType([se.a.string,se.a.number]),extraFooterContent:se.a.node,showCount:se.a.bool},tl.defaultProps={dialogTitle:"Add Items",inputPlaceholder:"Search...",selectedItemsTitle:"Selected items",itemKey:e=>e.id,renderItem:()=>"",renderStagedItem:null,width:"80%",extraFooterContent:null,showCount:!1};var rl=Xe(tl),al="static/images/destinations",nl={query:()=>K.get("api/destinations"),get:e=>{var t=e.id;return K.get("api/destinations/".concat(t))},types:()=>K.get("api/destinations/types"),create:e=>K.post("api/destinations",e),save:e=>K.post("api/destinations/".concat(e.id),e),delete:e=>{var t=e.id;return K.delete("api/destinations/".concat(t))}},il={query:e=>{var t=e.alertId;return K.get("api/alerts/".concat(t,"/subscriptions"))},create:e=>K.post("api/alerts/".concat(e.alert_id,"/subscriptions"),e),delete:e=>K.delete("api/alerts/".concat(e.alert_id,"/subscriptions/").concat(e.id))};function sl(e){var t=e.isSelected,r=e.isStaged,a=e.alreadyInGroup,i=e.deselectedIcon;return r?n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-remove","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Remove")):a?n.a.createElement(Ne,{title:"Already selected"},n.a.createElement("span",{tabIndex:0},n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Already selected"))):t?n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Selected")):n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa ".concat(i),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Select"))}function ol(e){var t=e.featureName,r=e.className,a=e.mode,i=e.adminOnly,s=qe("sr-mail-description");if(!$.mailSettingsMissing)return null;if(i&&!Y.isAdmin)return null;var o=n.a.createElement("span",{id:s},"Your mail server isn't configured correctly, and is needed for ",t," to work."," ",n.a.createElement(Qe,{type:"MAIL_CONFIG",className:"f-inherit"}));return"icon"===a?n.a.createElement(Ne,{title:o,placement:"topRight",arrowPointAtCenter:!0},n.a.createElement("span",{className:r,"aria-label":"Mail alert","aria-describedby":s,tabIndex:0},n.a.createElement("i",{className:"fa fa-exclamation-triangle","aria-hidden":"true"}))):n.a.createElement(p.a,{message:o,type:"error",className:r})}function ll(){return(ll=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function cl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ul(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ul(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ul(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function dl(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}sl.propTypes={isSelected:se.a.bool,isStaged:se.a.bool,alreadyInGroup:se.a.bool,deselectedIcon:se.a.string},sl.defaultProps={isSelected:!1,isStaged:!1,alreadyInGroup:!1,deselectedIcon:"fa-angle-double-right"},ol.propTypes={featureName:se.a.string.isRequired,className:se.a.string,mode:se.a.oneOf(["alert","icon"]),adminOnly:se.a.bool},ol.defaultProps={className:null,mode:"alert",adminOnly:!1};function ml(e){return e.destination||(e.destination={id:-1,name:e.user.email,icon:"DEPRECATED",type:"email"}),e}function pl(e){var t=e.destination,r=t.name,a=t.type,i=e.user,s=e.unsubscribe,o=Y.isAdmin||Y.id===i.id;return n.a.createElement("li",{className:"destination-wrapper"},n.a.createElement("img",{src:"".concat(al,"/").concat(a,".png"),className:"destination-icon",alt:r}),n.a.createElement("span",{className:"flex-fill"},r),"email"===a&&n.a.createElement(ol,{className:"destination-warning",featureName:"alert emails",mode:"icon"}),o&&n.a.createElement(Ne,{title:"Remove",mouseEnterDelay:.5},n.a.createElement(Ee,{className:"remove-button",onClick:s},n.a.createElement(xe.a,null))))}pl.propTypes={destination:Bn.isRequired,user:Vn.isRequired,unsubscribe:se.a.func.isRequired};class fl extends n.a.Component{constructor(){super(...arguments),dl(this,"state",{dests:[],subs:null}),dl(this,"showAddAlertSubDialog",()=>{var e=this.state,t=e.dests,r=e.subs;rl.showModal({width:570,showCount:!0,extraFooterContent:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-info-circle","aria-hidden":"true"})," Create new destinations in"," ",n.a.createElement(Ne,{title:"Opens page in a new tab."},n.a.createElement(S,{href:"destinations/new",target:"_blank"},"Alert Destinations"))),dialogTitle:"Add Existing Alert Destinations",inputPlaceholder:"Search destinations...",searchItems:e=>(e=Object(c.toLower)(e),Promise.resolve(t.filter(t=>Object(c.includes)(Object(c.toLower)(t.name),e)))),renderItem:(e,t)=>{var a=t.isSelected,i=!!Object(c.find)(r,t=>t.destination.id===e.id);return{content:n.a.createElement("div",{className:"destination-wrapper"},n.a.createElement("img",{src:"".concat(al,"/").concat(e.type,".png"),className:"destination-icon",alt:e.name}),n.a.createElement("span",{className:"flex-fill"},e.name),n.a.createElement(sl,{isSelected:a,alreadyInGroup:i,deselectedIcon:"fa-plus"})),isDisabled:i,className:a||i?"selected":""}}}).onClose(e=>{var t=Object(c.map)(e,e=>this.subscribe(e));return Promise.all(t).then(()=>{sn.success("Subscribed.")}).catch(()=>(sn.error("Failed saving subscription."),Promise.reject(null)))})}),dl(this,"onUserEmailToggle",e=>{e?this.unsubscribe(e):this.subscribe()}),dl(this,"subscribe",e=>{var t={alert_id:this.props.alertId};return e&&(t.destination_id=e.id),il.create(t).then(e=>{var t=this.state.subs;this.setState({subs:[...t,ml(e)]})})}),dl(this,"unsubscribe",e=>{il.delete(e).then(()=>{var t=this.state.subs;this.setState({subs:Object(c.without)(t,e)})}).catch(()=>{sn.error("Failed unsubscribing.")})})}componentDidMount(){var e=this.props.alertId;Promise.all([nl.query(),il.query({alertId:e})]).then(e=>{var t=cl(e,2),r=t[0],a=t[1];a=a.map(ml),this.setState({dests:r,subs:a})})}render(){if(!this.props.alertId)return null;var e=this.state.subs,t=Object(c.find)(e,{destination:{id:-1},user:{id:Y.id}}),r=Object(c.without)(e,t),a=$.mailSettingsMissing;return n.a.createElement("div",{className:"alert-destinations","data-test":"AlertDestinations"},n.a.createElement(Ne,{title:'Click to add an existing "Alert Destination"',mouseEnterDelay:.5},n.a.createElement(h.a,{"data-test":"ShowAddAlertSubDialog",type:"primary",size:"small",className:"add-button",onClick:this.showAddAlertSubDialog},n.a.createElement("i",{className:"fa fa-plus f-12 m-r-5","aria-hidden":"true"})," Add")),n.a.createElement("ul",null,n.a.createElement("li",{className:"destination-wrapper"},n.a.createElement("i",{className:"destination-icon fa fa-envelope","aria-hidden":"true"}),n.a.createElement("span",{className:"flex-fill"},Y.email),n.a.createElement(ol,{className:"destination-warning",featureName:"alert emails",mode:"icon"}),!a&&n.a.createElement(Fi.a,{size:"small",className:"toggle-button",checked:!!t,loading:!e,onChange:()=>this.onUserEmailToggle(t),"data-test":"UserEmailToggle"})),r.map(e=>n.a.createElement(pl,ll({key:e.id,unsubscribe:()=>this.unsubscribe(e)},e)))))}}dl(fl,"propTypes",{alertId:se.a.any.isRequired});var hl=["children","label","className"];function bl(){return(bl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function gl(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function yl(e){var t=e.children,r=e.label,a=e.className,i=gl(e,hl),s={span:16};return r||(s.offset=4),a=ge()("alert-form-item",a),n.a.createElement(yo.a.Item,bl({labelCol:{span:4},wrapperCol:s,label:r,className:a},i),t)}function vl(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ol(e){var t=e.state,r=e.lastTriggered;return n.a.createElement("div",{className:"alert-state"},n.a.createElement("span",{className:"alert-state-indicator label ".concat(lo[t])},"Status: ",t),"unknown"===t&&n.a.createElement("div",{className:"ant-form-item-explain"},"Alert condition has not been evaluated."),r&&n.a.createElement("div",{className:"ant-form-item-explain"},"Last triggered"," ",n.a.createElement("span",{className:"alert-last-triggered"},n.a.createElement(Jn,{date:r}))))}yl.propTypes={children:se.a.node,label:se.a.string,className:se.a.string},yl.defaultProps={children:null,label:null,className:null},Ol.propTypes={state:se.a.string.isRequired,lastTriggered:se.a.string},Ol.defaultProps={lastTriggered:null};class El extends n.a.Component{constructor(){super(...arguments),vl(this,"state",{unmuting:!1}),vl(this,"unmute",()=>{this.setState({unmuting:!0}),this.props.unmute().finally(()=>{this.setState({unmuting:!1})})})}render(){var e=this.props,t=e.alert,r=e.queryResult,a=e.canEdit,i=e.onEdit,s=e.menuButton,o=t.query,l=t.name,c=t.options,u=t.rearm;return n.a.createElement(n.a.Fragment,null,n.a.createElement(vo,{name:l,alert:t},n.a.createElement(pe,{name:"AlertView.HeaderExtra",alert:t}),n.a.createElement(Ne,{title:a?"":"You do not have sufficient permissions to edit this alert"},n.a.createElement(h.a,{type:"default",onClick:a?i:null,className:ge()({disabled:!a})},n.a.createElement("i",{className:"fa fa-edit m-r-5","aria-hidden":"true"}),"Edit"),s)),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement(Sn.Row,{type:"flex",gutter:16},n.a.createElement(Sn.Col,{xs:24,md:16,className:"d-flex"},n.a.createElement(yo.a,{className:"flex-fill"},n.a.createElement(yl,null,n.a.createElement(Ol,{state:t.state,lastTriggered:t.last_triggered_at})),n.a.createElement(yl,{label:"Query"},n.a.createElement($o,{query:o,queryResult:r})),r&&c&&n.a.createElement(n.a.Fragment,null,n.a.createElement(yl,{label:"Trigger when",className:"alert-criteria"},n.a.createElement(No,{columnNames:r.getColumnNames(),resultValues:r.getData(),alertOptions:c})),n.a.createElement(yl,{label:"Notifications",className:"form-item-line-height-normal"},n.a.createElement(zo,{value:u||0}),n.a.createElement("br",null),"Set to ",c.custom_subject||c.custom_body?"custom":"default"," notification template.")))),n.a.createElement(Sn.Col,{xs:24,md:8},c.muted&&n.a.createElement(p.a,{className:"m-b-20",message:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-bell-slash-o","aria-hidden":"true"})," Notifications are muted"),description:n.a.createElement(n.a.Fragment,null,"Notifications for this alert will not be sent.",n.a.createElement("br",null),a&&n.a.createElement(n.a.Fragment,null,"To restore notifications click",n.a.createElement(h.a,{size:"small",type:"primary",onClick:this.unmute,loading:this.state.unmuting,className:"m-t-5 m-l-5"},"Unmute"))),type:"warning"}),n.a.createElement("h4",null,"Destinations"," ",n.a.createElement(Ne,{title:"Open Alert Destinations page in a new tab."},n.a.createElement(S,{href:"destinations",target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link f-13","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")))),n.a.createElement(fl,{alertId:t.id})))))}}function jl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return wl(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wl(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Sl(e){var t=e.alert,r=e.query,i=e.columnNames,s=e.resultValues,o=e.subject,l=e.setSubject,u=e.body,d=e.setBody,m=!(!o&&!u),p=jl(Object(a.useState)(m?1:0),2),f=p[0],h=p[1],b=jl(Object(a.useState)(!1),2),g=b[0],y=b[1],v=function(e,t,r,a){var n=Object(c.isEmpty)(a)?null:Object(c.head)(a)[e.options.column];return{ALERT_STATUS:"TRIGGERED",ALERT_CONDITION:e.options.op,ALERT_THRESHOLD:e.options.value,ALERT_NAME:e.name,ALERT_URL:"".concat(window.location.origin,"/alerts/").concat(e.id),QUERY_NAME:t.name,QUERY_URL:"".concat(window.location.origin,"/queries/").concat(t.id),QUERY_RESULT_VALUE:Object(c.isNull)(n)||Object(c.isUndefined)(n)?"UNKNOWN":n,QUERY_RESULT_ROWS:a,QUERY_RESULT_COLS:r}}(t,r,i,s),O=e=>Dt.a.render(e||"",v);return n.a.createElement("div",{className:"alert-template"},n.a.createElement(Qi.a,{value:f,onChange:e=>{e||!m?(h(e),y(!1)):V.a.confirm({title:"Are you sure?",content:"Switching to default template will discard your custom template.",onOk:()=>{l(null),d(null),h(e),y(!1)},maskClosable:!0,autoFocusButton:null})},optionLabelProp:"label",dropdownMatchSelectWidth:!1,style:{width:"fit-content"}},n.a.createElement(Qi.a.Option,{value:0,label:"Use default template"},"Default template"),n.a.createElement(Qi.a.Option,{value:1,label:"Use custom template"},"Custom template")),!!f&&n.a.createElement("div",{className:"alert-custom-template","data-test":"AlertCustomTemplate"},n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("h5",{className:"flex-fill"},"Subject / Body"),"Preview"," ",n.a.createElement(Fi.a,{size:"small",className:"alert-template-preview",value:g,onChange:y})),n.a.createElement(He.a,{value:g?O(o):o,"aria-label":"Subject",onChange:e=>l(e.target.value),disabled:g,"data-test":"CustomSubject"}),n.a.createElement(He.a.TextArea,{value:g?O(u):u,"aria-label":"Body",autoSize:{minRows:9},onChange:e=>d(e.target.value),disabled:g,"data-test":"CustomBody"}),n.a.createElement(Qe,{type:"ALERT_NOTIF_TEMPLATE_GUIDE",className:"f-13"},n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"})," Formatting guide"," ",n.a.createElement("span",{className:"sr-only"},"(help)"))))}El.propTypes={alert:Hn.isRequired,queryResult:se.a.object,canEdit:se.a.bool.isRequired,onEdit:se.a.func.isRequired,menuButton:se.a.node.isRequired,unmute:se.a.func},El.defaultProps={queryResult:null,unmute:null},Sl.propTypes={alert:Hn.isRequired,query:Qn.isRequired,columnNames:se.a.arrayOf(se.a.string).isRequired,resultValues:se.a.arrayOf(se.a.any).isRequired,subject:se.a.string,setSubject:se.a.func.isRequired,body:se.a.string,setBody:se.a.func.isRequired},Sl.defaultProps={subject:"",body:""};var Pl=Sl;function Cl(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Nl extends n.a.Component{constructor(){super(...arguments),Cl(this,"_isMounted",!1),Cl(this,"state",{saving:!1}),Cl(this,"save",()=>{this.setState({saving:!0}),this.props.save().catch(()=>{this._isMounted&&this.setState({saving:!1})})}),Cl(this,"cancel",()=>{this.props.cancel()})}componentDidMount(){this._isMounted=!0}componentWillUnmount(){this._isMounted=!1}render(){var e=this.props,t=e.alert,r=e.queryResult,a=e.pendingRearm,i=e.onNotificationTemplateChange,s=e.menuButton,o=this.props,l=o.onQuerySelected,c=o.onNameChange,u=o.onRearmChange,d=o.onCriteriaChange,m=t.query,p=t.name,f=t.options,b=this.state.saving;return n.a.createElement(n.a.Fragment,null,n.a.createElement(vo,{name:p,alert:t,onChange:c,editMode:!0},n.a.createElement(pe,{name:"AlertEdit.HeaderExtra",alert:t}),n.a.createElement(h.a,{className:"m-r-5",onClick:()=>this.cancel()},n.a.createElement("i",{className:"fa fa-times m-r-5","aria-hidden":"true"}),"Cancel"),n.a.createElement(h.a,{type:"primary",onClick:()=>this.save()},b?n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Saving...")):n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-check m-r-5","aria-hidden":"true"})),"Save Changes"),s),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex"},n.a.createElement(yo.a,{className:"flex-fill"},n.a.createElement(yl,{label:"Query"},n.a.createElement($o,{query:m,queryResult:r,onChange:l,editMode:!0})),r&&f&&n.a.createElement(n.a.Fragment,null,n.a.createElement(yl,{label:"Trigger when",className:"alert-criteria"},n.a.createElement(No,{columnNames:r.getColumnNames(),resultValues:r.getData(),alertOptions:f,onChange:d,editMode:!0})),n.a.createElement(yl,{label:"When triggered, send notification"},n.a.createElement(zo,{value:a||0,onChange:u,editMode:!0})),n.a.createElement(yl,{label:"Template"},n.a.createElement(Pl,{alert:t,query:m,columnNames:r.getColumnNames(),resultValues:r.getData(),subject:f.custom_subject,setSubject:e=>i({custom_subject:e}),body:f.custom_body,setBody:e=>i({custom_body:e})})))),n.a.createElement("div",null,n.a.createElement(Qe,{className:"f-13",type:"ALERT_SETUP"},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(help)"))))))}}function kl(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Nl.propTypes={alert:Hn.isRequired,queryResult:se.a.object,pendingRearm:se.a.number,menuButton:se.a.node.isRequired,save:se.a.func.isRequired,cancel:se.a.func.isRequired,onQuerySelected:se.a.func.isRequired,onNameChange:se.a.func.isRequired,onCriteriaChange:se.a.func.isRequired,onRearmChange:se.a.func.isRequired,onNotificationTemplateChange:se.a.func.isRequired},Nl.defaultProps={queryResult:null,pendingRearm:null};class _l extends n.a.Component{constructor(){super(...arguments),kl(this,"state",{saving:!1}),kl(this,"save",()=>{this.setState({saving:!0}),this.props.save().catch(()=>{this.setState({saving:!1})})})}render(){var e=this.props,t=e.alert,r=e.queryResult,a=e.pendingRearm,i=e.onNotificationTemplateChange,s=this.props,o=s.onQuerySelected,l=s.onNameChange,c=s.onRearmChange,u=s.onCriteriaChange,d=t.query,m=t.name,p=t.options,f=this.state.saving;return n.a.createElement(n.a.Fragment,null,n.a.createElement(vo,{alert:t,name:m,onChange:l,editMode:!0}),n.a.createElement("div",{className:"bg-white tiled p-20"},n.a.createElement("div",{className:"d-flex"},n.a.createElement(yo.a,{className:"flex-fill"},n.a.createElement("div",{className:"m-b-30"},"Start by selecting the query that you would like to monitor using the search bar.",n.a.createElement("br",null),"Keep in mind that Alerts do not work with queries that use parameters."),n.a.createElement(yl,{label:"Query"},n.a.createElement($o,{query:d,queryResult:r,onChange:o,editMode:!0})),r&&p&&n.a.createElement(n.a.Fragment,null,n.a.createElement(yl,{label:"Trigger when",className:"alert-criteria"},n.a.createElement(No,{columnNames:r.getColumnNames(),resultValues:r.getData(),alertOptions:p,onChange:u,editMode:!0})),n.a.createElement(yl,{label:"When triggered, send notification"},n.a.createElement(zo,{value:a||0,onChange:c,editMode:!0})),n.a.createElement(yl,{label:"Template"},n.a.createElement(Pl,{alert:t,query:d,columnNames:r.getColumnNames(),resultValues:r.getData(),subject:p.custom_subject,setSubject:e=>i({custom_subject:e}),body:p.custom_body,setBody:e=>i({custom_body:e})}))),n.a.createElement(yl,null,n.a.createElement(h.a,{type:"primary",onClick:this.save,disabled:!d,className:"btn-create-alert"},f&&n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse m-r-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Saving...")),"Create Alert"))),n.a.createElement(Qe,{className:"f-13",type:"ALERT_SETUP"},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(help)")))))}}function Al(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function xl(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Al(Object(r),!0).forEach((function(t){Tl(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Al(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ql(){return(ql=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Tl(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}_l.propTypes={alert:Hn.isRequired,queryResult:se.a.object,pendingRearm:se.a.number,onQuerySelected:se.a.func.isRequired,save:se.a.func.isRequired,onNameChange:se.a.func.isRequired,onRearmChange:se.a.func.isRequired,onCriteriaChange:se.a.func.isRequired,onNotificationTemplateChange:se.a.func.isRequired},_l.defaultProps={queryResult:null,pendingRearm:null};var Il={NEW:0,VIEW:1,EDIT:2},Dl=Object(c.template)("<%= query.name %>: <%= options.column %> <%= options.op %> <%= options.value %>");function Rl(e){return e.query?Dl(e):"New Alert"}class Ml extends n.a.Component{constructor(){super(...arguments),Tl(this,"_isMounted",!1),Tl(this,"state",{alert:null,queryResult:null,pendingRearm:null,canEdit:!1,mode:null}),Tl(this,"save",()=>{var e=this.state,t=e.alert,r=e.pendingRearm;return t.name=Object(c.trim)(t.name)||Rl(t),t.rearm=r||null,io.save(t).then(e=>{sn.success("Saved."),bt("alerts/".concat(e.id),!0),this.setState({alert:e,mode:Il.VIEW})}).catch(()=>{sn.error("Failed saving alert.")})}),Tl(this,"onQuerySelected",e=>{this.setState(t=>({alert:ql(t.alert,{query:e}),queryResult:null})),e&&new ir(e).getQueryResultPromise().then(e=>{if(this._isMounted){this.setState({queryResult:e});var t=this.state.alert.options.column,r=e.getColumnNames();t&&Object(c.includes)(r,t)||(t=Object(c.head)(e.getColumnNames())),this.setAlertOptions({column:t})}})}),Tl(this,"onNameChange",e=>{var t=this.state.alert;this.setState({alert:ql(t,{name:e})})}),Tl(this,"onRearmChange",e=>{this.setState({pendingRearm:e})}),Tl(this,"setAlertOptions",e=>{var t=this.state.alert,r=xl(xl({},t.options),e);this.setState({alert:ql(t,{options:r})})}),Tl(this,"delete",()=>{var e=this.state.alert;return io.delete(e).then(()=>{sn.success("Alert deleted successfully."),bt("alerts")}).catch(()=>{sn.error("Failed deleting alert.")})}),Tl(this,"mute",()=>{var e=this.state.alert;return io.mute(e).then(()=>{this.setAlertOptions({muted:!0}),sn.warn("Notifications have been muted.")}).catch(()=>{sn.error("Failed muting notifications.")})}),Tl(this,"unmute",()=>{var e=this.state.alert;return io.unmute(e).then(()=>{this.setAlertOptions({muted:!1}),sn.success("Notifications have been restored.")}).catch(()=>{sn.error("Failed restoring notifications.")})}),Tl(this,"edit",()=>{var e=this.state.alert.id;bt("alerts/".concat(e,"/edit"),!0),this.setState({mode:Il.EDIT})}),Tl(this,"cancel",()=>{var e=this.state.alert.id;bt("alerts/".concat(e),!0),this.setState({mode:Il.VIEW})})}componentDidMount(){this._isMounted=!0;var e=this.props.mode;if(this.setState({mode:e}),e===Il.NEW)this.setState({alert:{options:{op:">",value:1,muted:!1}},pendingRearm:0,canEdit:!0});else{var t=this.props.alertId;io.get({id:t}).then(e=>{if(this._isMounted){var t=Y.canEdit(e);t||(this.setState({mode:Il.VIEW}),sn.warn("You cannot edit this alert","You do not have sufficient permissions to edit this alert, and have been redirected to the view-only page.",{duration:0})),this.setState({alert:e,canEdit:t,pendingRearm:e.rearm}),this.onQuerySelected(e.query)}}).catch(e=>{this._isMounted&&this.props.onError(e)})}}componentWillUnmount(){this._isMounted=!1}render(){var e=this.state.alert;if(!e)return n.a.createElement(Us,{className:"m-t-30"});var t=!!e.options.muted,r=this.state,a=r.queryResult,i=r.mode,s=r.canEdit,o=r.pendingRearm,l=n.a.createElement(bo,{doDelete:this.delete,muted:t,mute:this.mute,unmute:this.unmute,canEdit:s}),c={alert:e,queryResult:a,pendingRearm:o,save:this.save,menuButton:l,onQuerySelected:this.onQuerySelected,onRearmChange:this.onRearmChange,onNameChange:this.onNameChange,onCriteriaChange:this.setAlertOptions,onNotificationTemplateChange:this.setAlertOptions};return n.a.createElement("div",{className:"alert-page"},n.a.createElement("div",{className:"container"},i===Il.NEW&&n.a.createElement(_l,c),i===Il.VIEW&&n.a.createElement(El,ql({canEdit:s,onEdit:this.edit,muted:t,unmute:this.unmute},c)),i===Il.EDIT&&n.a.createElement(Nl,ql({cancel:this.cancel},c))))}}function zl(e){return e.tags||[]}function Fl(e){return K.get(e).then(zl)}function Ll(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ul(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ul(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ul(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}Tl(Ml,"propTypes",{mode:se.a.oneOf(Object(c.values)(Il)),alertId:se.a.string,onError:se.a.func}),Tl(Ml,"defaultProps",{mode:null,alertId:null,onError:()=>{}}),mn.register("Alerts.New",Ga({path:"/alerts/new",title:"New Alert",render:e=>n.a.createElement(Ml,ql({},e,{mode:Il.NEW}))})),mn.register("Alerts.View",Ga({path:"/alerts/:alertId",title:"Alert",render:e=>n.a.createElement(Ml,ql({},e,{mode:Il.VIEW}))})),mn.register("Alerts.Edit",Ga({path:"/alerts/:alertId/edit",title:"Alert",render:e=>n.a.createElement(Ml,ql({},e,{mode:Il.EDIT}))}));var Vl=function(e){var t=e.tagsUrl,r=e.showUnselectAll,i=void 0!==r&&r,s=e.onUpdate,o=Ll(Object(a.useState)([]),2),l=o[0],u=o[1],d=Ll(Object(a.useState)([]),2),m=d[0],p=d[1];Object(a.useEffect)(()=>{var e=!1;return Fl(t).then(t=>{e||u(t)}),()=>{e=!0}},[t]);var f=Object(a.useCallback)((e,t)=>{var r;r=e.shiftKey?Object(c.includes)(m,t)?Object(c.difference)(m,[t]):[...m,t]:Object(c.includes)(m,t)&&1===m.length?[]:[t],p(r),s&&s([...r])},[m,s]),h=Object(a.useCallback)(()=>{p([]),s&&s([])},[s]);return 0===l.length?null:n.a.createElement("div",{className:"tags-list"},n.a.createElement("div",{className:"tags-list-title"},n.a.createElement("span",{className:"tags-list-label"},"Tags"),i&&m.length>0&&n.a.createElement(Ee,{type:"link",onClick:h},n.a.createElement(xe.a,null),"clear selection")),n.a.createElement("div",{className:"tiled"},n.a.createElement(he.a,{className:"invert-stripe-position",mode:"inline",selectedKeys:m},Object(c.map)(l,e=>n.a.createElement(he.a.Item,{key:e.name,className:"m-0"},n.a.createElement(Ee,{className:"d-flex align-items-center justify-content-between",onClick:t=>f(t,e.name)},n.a.createElement("span",{className:"max-character col-xs-11"},e.name),n.a.createElement(kn.a,{count:e.count})))))))};function Bl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ql(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ql(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ql(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Wl(e){var t=e.placeholder,r=e.value,i=e.showIcon,s=e.onChange,o=e.label,l=Bl(Object(a.useState)(r),2),c=l[0],u=l[1];Object(a.useEffect)(()=>{u(r)},[r]);var d=Object(a.useCallback)(e=>{var t=e.target.value;u(t),s(t)},[s]),m=i?He.a.Search:He.a;return n.a.createElement("div",{className:"m-b-10"},n.a.createElement(m,{className:"form-control",placeholder:t,value:c,"aria-label":o,onChange:d}))}function Hl(e){var t=e.items,r=e.selected;return 0===(t=Object(c.filter)(t,e=>!Object(c.isFunction)(e.isAvailable)||e.isAvailable())).length?null:n.a.createElement("div",{className:"m-b-10 tags-list tiled"},n.a.createElement(he.a,{className:"invert-stripe-position",mode:"inline",selectable:!1,selectedKeys:[r]},Object(c.map)(t,e=>n.a.createElement(he.a.Item,{key:e.key,className:"m-0"},n.a.createElement(S,{href:e.href},Object(c.isString)(e.icon)&&""!==e.icon&&n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:e.icon,"aria-hidden":"true"})),Object(c.isFunction)(e.icon)&&(e.icon(e)||null),e.title)))))}function Gl(e){var t=e.icon;return n.a.createElement("span",{className:"btn-favorite m-r-5"},n.a.createElement("i",{className:t,"aria-hidden":"true"}))}function Kl(e){var t=e.user;return Object(c.isString)(t.profile_image_url)&&""!==t.profile_image_url?n.a.createElement("img",{src:t.profile_image_url,className:"profile__image--sidebar m-r-5",width:"13",alt:t.name}):null}function Yl(e){var t=e.url,r=e.onChange,a=e.showUnselectAll;return""===t?null:n.a.createElement("div",{className:"m-b-10"},n.a.createElement(Vl,{tagsUrl:t,onUpdate:r,showUnselectAll:a}))}Wl.propTypes={value:se.a.string.isRequired,placeholder:se.a.string,showIcon:se.a.bool,onChange:se.a.func.isRequired,label:se.a.string},Wl.defaultProps={placeholder:"Search...",showIcon:!1,label:"Search"},Hl.propTypes={items:se.a.arrayOf(se.a.shape({key:se.a.string.isRequired,href:se.a.string.isRequired,title:se.a.string.isRequired,icon:se.a.func,isAvailable:se.a.func})),selected:se.a.string},Hl.defaultProps={items:[],selected:null},Gl.propTypes={icon:se.a.string.isRequired},Kl.propTypes={user:se.a.shape({profile_image_url:se.a.string,name:se.a.string}).isRequired},Yl.propTypes={url:se.a.string.isRequired,onChange:se.a.func.isRequired,showUnselectAll:se.a.bool,unselectAllButtonTitle:se.a.string};var $l=r(71),Jl=r.n($l);function Xl(){return(Xl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Zl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ec(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ec(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ec(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function tc(e,t,r){var i=Zl(Object(a.useState)({isAvailable:!1}),2),s=i[0],o=i[1],l=Zl(Object(a.useState)([]),2),u=l[0],d=l[1];Object(a.useEffect)(()=>{d([])},[e.pageItems,s.isAvailable]);var m=Object(a.useMemo)(()=>{var t=e.pageItems;return 0!==t.length&&0!==u.length&&Object(c.intersection)(u,t).length===t.length},[u,e.pageItems]),p=Object(a.useCallback)(()=>{d(m?[]:e.pageItems)},[m,e.pageItems]),f=Object(a.useCallback)(e=>{Object(c.includes)(u,e)?d(Object(c.filter)(u,t=>t!==e)):d([...u,e])},[u]),h=Object(a.useMemo)(()=>yi.custom((e,t)=>n.a.createElement(Jl.a,{checked:Object(c.includes)(u,t),onChange:()=>f(t)}),{title:()=>n.a.createElement(Jl.a,{checked:m,onChange:p}),field:"id",width:"1%"}),[u,m,p,f]),b=Object(a.useCallback)((function(e){return r?n.a.createElement(r,Xl({onStateChange:o},e)):null}),[r]);return Object(a.useMemo)(()=>({areExtraActionsAvailable:s.isAvailable,listColumns:s.isAvailable?[h,...t]:t,Component:b,selectedItems:u,setSelectedItems:d}),[s,t,h,u,b])}var rc=["className","children"],ac=["className","children"],nc=["children","className"];function ic(){return(ic=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function sc(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var oc={className:se.a.string,children:se.a.node},lc={className:null,children:null};function cc(e){var t=e.className,r=e.children,a=sc(e,rc);return n.a.createElement("div",ic({className:ge()("layout-sidebar",t)},a),n.a.createElement("div",null,r))}function uc(e){var t=e.className,r=e.children,a=sc(e,ac);return n.a.createElement("div",ic({className:ge()("layout-content",t)},a),n.a.createElement("div",null,r))}function dc(e){var t=e.children,r=e.className,a=void 0===r?void 0:r,i=sc(e,nc);return n.a.createElement("div",ic({className:ge()("layout-with-sidebar",a)},i),t)}function mc(e){var t=e.objectType,r=e.tags;return n.a.createElement(Ie,{icon:"fa-tags"},"No ",t," found tagged with ",n.a.createElement(Zi,{className:"inline-tags-control",tags:Array.from(r),tagSeparator:"+"}),".")}function pc(e){var t=e.page,r=e.searchTerm,n=e.selectedTags;if(""!==r)return a.createElement(Ie,{message:"Sorry, we couldn't find anything.",icon:"fa-search"});if(n.length>0)return a.createElement(mc,{objectType:"dashboards",tags:n});switch(t){case"favorites":return a.createElement(Ie,{message:"Mark dashboards as Favorite to list them here.",icon:"fa-star"});case"my":var i=Y.hasPermission("create_dashboard")?a.createElement("span",null,a.createElement(h.a,{type:"primary",size:"small",onClick:()=>ia.showModal()},"Create your first dashboard!")," ",a.createElement(Qe,{className:"f-14",type:"DASHBOARDS",showTooltip:!1},"Need help?")):a.createElement("span",null,"Sorry, we couldn't find anything.");return a.createElement(Ie,{icon:"fa-search"},i);default:return a.createElement(pe,{name:"DashboardList.EmptyState"},a.createElement(Xa,{icon:"zmdi zmdi-view-quilt",description:"See the big picture",illustration:"dashboard",helpMessage:a.createElement($a,{helpTriggerType:"DASHBOARDS"}),showDashboardStep:!0}))}}function fc(){return(fc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}cc.propTypes=oc,cc.defaultProps=lc,uc.propTypes=oc,uc.defaultProps=lc,dc.propTypes=oc,dc.defaultProps=lc,dc.Sidebar=cc,dc.Content=uc,mc.propTypes={objectType:se.a.string.isRequired,tags:se.a.oneOfType([se.a.array,se.a.objectOf(Set)]).isRequired},pc.propTypes={page:ie.string.isRequired,searchTerm:ie.string.isRequired,selectedTags:ie.array.isRequired};var hc=[{key:"all",href:"dashboards",title:"All Dashboards",icon:()=>n.a.createElement(Gl,{icon:"zmdi zmdi-view-quilt"})},{key:"my",href:"dashboards/my",title:"My Dashboards",icon:()=>n.a.createElement(Kl,{user:Y})},{key:"favorites",href:"dashboards/favorites",title:"Favorites",icon:()=>n.a.createElement(Gl,{icon:"fa fa-star"})}],bc=[yi.favorites({className:"p-r-0"}),yi.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(S,{className:"table-main-title",href:t.url,"data-test":"DashboardId".concat(t.id)},t.name),n.a.createElement(rs,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:"Name",field:"name",width:null}),yi.custom((e,t)=>t.user.name,{title:"Created By",width:"1%"}),yi.dateTime.sortable({title:"Created At",field:"created_at",width:"1%"})];function gc(e){return n.a.createElement(pe,fc({name:"DashboardList.Actions"},e))}function yc(e){var t=e.controller,r=tc(t,bc,gc),a=r.areExtraActionsAvailable,i=r.listColumns,s=r.Component,o=r.selectedItems;return n.a.createElement("div",{className:"page-dashboard-list"},n.a.createElement("div",{className:"container"},n.a.createElement(Pn,{title:t.params.pageTitle,actions:Y.hasPermission("create_dashboard")?n.a.createElement(h.a,{block:!0,type:"primary",onClick:()=>ia.showModal()},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Dashboard"):null}),n.a.createElement(dc,null,n.a.createElement(dc.Sidebar,{className:"m-b-0"},n.a.createElement(Wl,{placeholder:"Search Dashboards...",label:"Search dashboards",value:t.searchTerm,onChange:t.updateSearch}),n.a.createElement(Hl,{items:hc,selected:t.params.currentPage}),n.a.createElement(Yl,{url:"api/dashboards/tags",onChange:t.updateSelectedTags,showUnselectAll:!0})),n.a.createElement(dc.Content,null,n.a.createElement("div",{"data-test":"DashboardLayoutContent"},t.isLoaded&&t.isEmpty?n.a.createElement(pc,{page:t.params.currentPage,searchTerm:t.searchTerm,selectedTags:t.selectedTags}):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:ge()({"m-b-10":a})},n.a.createElement(s,{selectedItems:o})),n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(vi,{items:t.pageItems,loading:!t.isLoaded,columns:i,orderByField:t.orderByField,orderByReverse:t.orderByReverse,toggleSorting:t.toggleSorting}),n.a.createElement(Vi,{showPageSizeSelect:!0,totalCount:t.totalItemsCount,pageSize:t.itemsPerPage,onPageSizeChange:e=>t.updatePagination({itemsPerPage:e}),page:t.page,onChange:e=>t.updatePagination({page:e})}))))))))}yc.propTypes={controller:bs.isRequired};var vc=gs(yc,()=>new Ds({getResource(e){var t=e.params.currentPage;return{all:$r.query.bind($r),my:$r.myDashboards.bind($r),favorites:$r.favorites.bind($r)}[t]},getItemProcessor:()=>e=>new $r(e)}),()=>new Fs({orderByField:"created_at",orderByReverse:!0}));mn.register("Dashboards.List",Ga({path:"/dashboards",title:"Dashboards",render:e=>n.a.createElement(vc,fc({},e,{currentPage:"all"}))})),mn.register("Dashboards.Favorites",Ga({path:"/dashboards/favorites",title:"Favorite Dashboards",render:e=>n.a.createElement(vc,fc({},e,{currentPage:"favorites"}))})),mn.register("Dashboards.My",Ga({path:"/dashboards/my",title:"My Dashboards",render:e=>n.a.createElement(vc,fc({},e,{currentPage:"my"}))}));var Oc=r(640),Ec=r(191),jc=r(190),wc=r.n(jc),Sc=r(279),Pc=r(641),Cc=r.n(Pc),Nc=(r(2449),/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"Cmd":"Ctrl"),kc=/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"Option":"Alt";var _c={};function Ac(e,t){e.preventDefault(),e.retunValue=!1,Object(c.each)(_c[t],e=>e())}var xc={modKey:Nc,altKey:kc,bind:e=>{Object(c.each)(e,(e,t)=>{var r=t.toLowerCase().split(",").map(c.trim);Object(c.each)(r,t=>{_c[t]=[...Object(c.without)(_c[t],e),e],Cc.a.bindGlobal(t,Ac)})})},unbind:e=>{Object(c.each)(e,(e,t)=>{var r=t.toLowerCase().split(",").map(c.trim);Object(c.each)(r,t=>{_c[t]=Object(c.without)(_c[t],e),0===_c[t].length&&(_c[t]=void 0,Cc.a.unbind(t))})})}};function qc(e){var t=e.paramCount,r=e.onClick,a=t?n.a.createElement("i",{className:"fa fa-check","aria-hidden":"true"}):n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading..."));return n.a.createElement("div",{className:"parameter-apply-button","data-show":!!t,"data-test":"ParameterApplyButton"},n.a.createElement(kn.a,{count:t},n.a.createElement(Ne,{title:t?"".concat(xc.modKey," + Enter"):null},n.a.createElement("span",null,n.a.createElement(h.a,{onClick:r},a," Apply Changes")))))}qc.propTypes={onClick:se.a.func.isRequired,paramCount:se.a.number.isRequired};var Tc=qc,Ic=document.createElement("canvas");Ic.style.display="none",document.body.appendChild(Ic);var Dc=["options"];function Rc(){return(Rc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Mc(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var zc=function(e){var t=e.options,r=Mc(e,Dc),i=Object(a.useMemo)(()=>{if(t&&t.length>400){var e=Object(c.maxBy)(t,"label.length");if(e){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,r=Ic.getContext("2d");if(r){var a=window.getComputedStyle(t);r.font="".concat(a.fontSize," ").concat(a.fontFamily);var n=r.measureText(e),i=n.width;return"actualBoundingBoxLeft"in n&&(i=Math.abs(n.actualBoundingBoxLeft)+Math.abs(n.actualBoundingBoxRight)),i}return null}(e.label);if(r)return r+40}return!0}return!1},[t]);return n.a.createElement(Qi.a,Rc({dropdownMatchSelectWidth:i,options:t,allowClear:!0,optionFilterProp:"label"},r))},Fc=r(147),Lc=r.n(Fc),Uc=["defaultValue","value","onSelect","className"];function Vc(){return(Vc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Bc(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Qc=n.a.forwardRef((e,t)=>{var r=e.defaultValue,a=e.value,i=e.onSelect,s=e.className,o=Bc(e,Uc),l=$.dateFormat||"YYYY-MM-DD",c={};return r&&r.isValid()&&(c.defaultValue=r),(null===a||a&&a.isValid())&&(c.value=a),n.a.createElement(Lc.a,Vc({ref:t,className:s},c,{format:l,placeholder:"Select Date",onChange:i},o))});Qc.propTypes={defaultValue:Kn,value:Kn,onSelect:se.a.func,className:se.a.string},Qc.defaultProps={defaultValue:null,value:void 0,onSelect:()=>{},className:""};var Wc=Qc,Hc=["defaultValue","value","withSeconds","onSelect","className"];function Gc(){return(Gc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Kc(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Yc=n.a.forwardRef((e,t)=>{var r=e.defaultValue,a=e.value,i=e.withSeconds,s=e.onSelect,o=e.className,l=Kc(e,Hc),c=($.dateFormat||"YYYY-MM-DD")+(i?" HH:mm:ss":" HH:mm"),u={};return r&&r.isValid()&&(u.defaultValue=r),(null===a||a&&a.isValid())&&(u.value=a),n.a.createElement(Lc.a,Gc({ref:t,className:o,showTime:!0},u,{format:c,placeholder:"Select Date and Time",onChange:s},l))});Yc.propTypes={defaultValue:Kn,value:Kn,withSeconds:se.a.bool,onSelect:se.a.func,className:se.a.string},Yc.defaultProps={defaultValue:null,value:void 0,withSeconds:!1,onSelect:()=>{},className:""};var $c=Yc,Jc=r(128),Xc=r.n(Jc),Zc=r(1078),eu=r.n(Zc),tu=r(1079),ru=r.n(tu),au=r(1080),nu=r.n(au),iu=Xc.a.Text;function su(e){var t=e.options,r=e.selectedDynamicValue,i=e.onSelect,s=e.enabled,o=e.staticValueLabel,l=n.a.createElement(he.a,{className:"dynamic-menu",onClick:e=>{var r=e.key;return i(Object(c.get)(t,r,"static"))},selectedKeys:["".concat(Object(c.findIndex)(t,{value:r}))],"data-test":"DynamicButtonMenu"},t.map((e,t)=>n.a.createElement(he.a.Item,{key:t},e.name," ",e.label&&n.a.createElement("em",null,Object(c.isFunction)(e.label)?e.label():e.label))),s&&n.a.createElement(he.a.Divider,null),s&&n.a.createElement(he.a.Item,null,n.a.createElement(eu.a,null),n.a.createElement(iu,{type:"secondary"},o))),u=Object(a.useRef)(null);return n.a.createElement("div",{ref:u},n.a.createElement("div",{role:"presentation",onClick:e=>e.stopPropagation()},n.a.createElement(Da.a.Button,{overlay:l,className:"dynamic-button",placement:"bottomRight",trigger:["click"],icon:s?n.a.createElement(ru.a,{className:"dynamic-icon"}):n.a.createElement(nu.a,{className:"dynamic-icon"}),getPopupContainer:()=>u.current,"data-test":"DynamicButton"})))}su.propTypes={options:se.a.arrayOf(se.a.object),selectedDynamicValue:se.a.oneOfType([fr,Sr]),onSelect:se.a.func,enabled:se.a.bool,staticValueLabel:se.a.string},su.defaultProps={options:[],selectedDynamicValue:null,onSelect:()=>{},enabled:!1,staticValueLabel:"Back to Static Value"};var ou=su;function lu(){return(lu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function cu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class uu extends n.a.Component{constructor(e){super(e),cu(this,"onDynamicValueSelect",e=>{var t=this.props,r=t.onSelect,a=t.parameter;if("static"===e){var n=a.getExecutionValue();r(n?l()(n):null)}else r(e.value);this.dateComponentRef.current.focus()}),this.dateComponentRef=n.a.createRef()}render(){var e=this.props,t=e.type,r=e.value,a=e.className,i=e.dateOptions,s=e.dynamicButtonOptions,o=e.onSelect,u=br(r),d=Object(c.includes)(t,"datetime"),m={},p=Wc;if(d&&(p=$c,Object(c.includes)(t,"with-seconds")&&(m.withSeconds=!0)),(l.a.isMoment(r)||null===r)&&(m.value=r),u){var f=r;m.placeholder=f&&f.name,m.value=null}return n.a.createElement("div",{className:ge()("date-parameter",a)},n.a.createElement(p,lu({},i,{ref:this.dateComponentRef,className:ge()("redash-datepicker",t,{"dynamic-value":u}),onSelect:o,suffixIcon:null},m)),n.a.createElement(ou,{options:s.options,staticValueLabel:s.staticValueLabel,selectedDynamicValue:u?r:null,enabled:u,onSelect:this.onDynamicValueSelect}))}}cu(uu,"propTypes",{type:se.a.string,className:se.a.string,value:se.a.any,parameter:se.a.any,onSelect:se.a.func,dynamicButtonOptions:se.a.shape({staticValueLabel:se.a.string,options:se.a.arrayOf(se.a.shape({name:se.a.string,value:se.a.object,label:se.a.oneOfType([se.a.string,se.a.func])}))}),dateOptions:se.a.any}),cu(uu,"defaultProps",{type:"",className:"",value:null,parameter:null,dynamicButtonOptions:{options:[]},onSelect:()=>{}});var du=uu;function mu(){return(mu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var pu=[{name:"Today/Now",value:gr("d_now"),label:()=>gr("d_now").value().format("MMM D")},{name:"Yesterday",value:gr("d_yesterday"),label:()=>gr("d_yesterday").value().format("MMM D")}];function fu(e){return n.a.createElement(du,mu({dynamicButtonOptions:{options:pu}},e,{dateOptions:{"aria-label":"Parameter date value"}}))}fu.propTypes={type:se.a.string,className:se.a.string,value:se.a.any,parameter:se.a.any,onSelect:se.a.func},fu.defaultProps={type:"",className:"",value:null,parameter:null,onSelect:()=>{}};var hu=fu,bu=["defaultValue","value","onSelect","className"];function gu(){return(gu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function yu(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var vu=Lc.a.RangePicker,Ou=n.a.forwardRef((e,t)=>{var r=e.defaultValue,a=e.value,i=e.onSelect,s=e.className,o=yu(e,bu),l=$.dateFormat||"YYYY-MM-DD",u={};return Object(c.isArray)(r)&&r[0].isValid()&&r[1].isValid()&&(u.defaultValue=r),(null===a||Object(c.isArray)(a)&&a[0].isValid()&&a[1].isValid())&&(u.value=a),n.a.createElement(vu,gu({ref:t,className:s},u,{format:l,onChange:i},o))});Ou.propTypes={defaultValue:se.a.arrayOf(Kn),value:se.a.arrayOf(Kn),onSelect:se.a.func,className:se.a.string},Ou.defaultProps={defaultValue:null,value:void 0,onSelect:()=>{},className:""};var Eu=Ou,ju=["defaultValue","value","withSeconds","onSelect","className"];function wu(){return(wu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Su(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Pu=Lc.a.RangePicker,Cu=n.a.forwardRef((e,t)=>{var r=e.defaultValue,a=e.value,i=e.withSeconds,s=e.onSelect,o=e.className,l=Su(e,ju),u=($.dateFormat||"YYYY-MM-DD")+(i?" HH:mm:ss":" HH:mm"),d={};return Object(c.isArray)(r)&&r[0].isValid()&&r[1].isValid()&&(d.defaultValue=r),(null===a||Object(c.isArray)(a)&&a[0].isValid()&&a[1].isValid())&&(d.value=a),n.a.createElement(Pu,wu({ref:t,className:o,showTime:!0},d,{format:u,onChange:s},l))});Cu.propTypes={defaultValue:se.a.arrayOf(Kn),value:se.a.arrayOf(Kn),withSeconds:se.a.bool,onSelect:se.a.func,className:se.a.string},Cu.defaultProps={defaultValue:null,value:void 0,withSeconds:!1,onSelect:()=>{},className:""};var Nu=Cu,ku=["type","value","onSelect","className","dynamicButtonOptions","dateRangeOptions","parameter"];function _u(){return(_u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Au(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function xu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class qu extends n.a.Component{constructor(e){super(e),xu(this,"onDynamicValueSelect",e=>{var t=this.props,r=t.onSelect,a=t.parameter;if("static"===e){var n=a.getExecutionValue();Object(c.isObject)(n)&&n.start&&n.end?r([l()(n.start),l()(n.end)]):r(null)}else r(e.value);this.dateRangeComponentRef.current.focus()}),this.dateRangeComponentRef=n.a.createRef()}render(){var e=this.props,t=e.type,r=e.value,a=e.onSelect,i=e.className,s=e.dynamicButtonOptions,o=e.dateRangeOptions,u=(e.parameter,Au(e,ku)),d=Object(c.includes)(t,"datetime-range"),m=Cr(r),p={},f=Eu;return d&&(f=Nu,Object(c.includes)(t,"with-seconds")&&(p.withSeconds=!0)),(function(e){return Object(c.isArray)(e)&&2===e.length&&l.a.isMoment(e[0])&&l.a.isMoment(e[1])}(r)||null===r)&&(p.value=r),m&&(p.placeholder=[r&&r.name],p.value=null),n.a.createElement("div",_u({},u,{className:ge()("date-range-parameter",i)}),n.a.createElement(f,_u({},o,{ref:this.dateRangeComponentRef,className:ge()("redash-datepicker date-range-input",t,{"dynamic-value":m}),onSelect:a,suffixIcon:null},p)),n.a.createElement(ou,{options:s.options,staticValueLabel:s.staticValueLabel,selectedDynamicValue:m?r:null,enabled:m,onSelect:this.onDynamicValueSelect}))}}xu(qu,"propTypes",{type:se.a.oneOf(["date-range","datetime-range","datetime-range-with-seconds"]).isRequired,className:se.a.string,value:se.a.any,parameter:se.a.any,onSelect:se.a.func,dynamicButtonOptions:se.a.shape({staticValueLabel:se.a.string,options:se.a.arrayOf(se.a.shape({name:se.a.string,value:se.a.object,label:se.a.oneOfType([se.a.string,se.a.func])}))}),dateRangeOptions:se.a.any}),xu(qu,"defaultProps",{type:"date-range",className:"",value:null,parameter:null,dynamicButtonOptions:{options:[]},onSelect:()=>{}});var Tu=qu;function Iu(){return(Iu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var Du=[{name:"This week",value:Nr("d_this_week"),label:()=>Nr("d_this_week").value()[0].format("MMM D")+" - "+Nr("d_this_week").value()[1].format("MMM D")},{name:"This month",value:Nr("d_this_month"),label:()=>Nr("d_this_month").value()[0].format("MMMM")},{name:"This year",value:Nr("d_this_year"),label:()=>Nr("d_this_year").value()[0].format("YYYY")},{name:"Last week",value:Nr("d_last_week"),label:()=>Nr("d_last_week").value()[0].format("MMM D")+" - "+Nr("d_last_week").value()[1].format("MMM D")},{name:"Last month",value:Nr("d_last_month"),label:()=>Nr("d_last_month").value()[0].format("MMMM")},{name:"Last year",value:Nr("d_last_year"),label:()=>Nr("d_last_year").value()[0].format("YYYY")},{name:"Last 7 days",value:Nr("d_last_7_days"),label:()=>Nr("d_last_7_days").value()[0].format("MMM D")+" - Today"},{name:"Last 14 days",value:Nr("d_last_14_days"),label:()=>Nr("d_last_14_days").value()[0].format("MMM D")+" - Today"},{name:"Last 30 days",value:Nr("d_last_30_days"),label:()=>Nr("d_last_30_days").value()[0].format("MMM D")+" - Today"},{name:"Last 60 days",value:Nr("d_last_60_days"),label:()=>Nr("d_last_60_days").value()[0].format("MMM D")+" - Today"},{name:"Last 90 days",value:Nr("d_last_90_days"),label:()=>Nr("d_last_90_days").value()[0].format("MMM D")+" - Today"},{name:"Last 12 months",value:Nr("d_last_12_months"),label:null}],Ru=[{name:"Today",value:Nr("d_today"),label:()=>Nr("d_today").value()[0].format("MMM D")},{name:"Yesterday",value:Nr("d_yesterday"),label:()=>Nr("d_yesterday").value()[0].format("MMM D")},...Du];function Mu(e){var t=Object(c.includes)(e.type,"datetime-range")?Ru:Du;return n.a.createElement(Tu,Iu({},e,{dynamicButtonOptions:{options:t}}))}Mu.propTypes={type:se.a.string,className:se.a.string,value:se.a.any,parameter:se.a.any,onSelect:se.a.func},Mu.defaultProps={type:"",className:"",value:null,parameter:null,onSelect:()=>{}};var zu=Mu,Fu=(r(2469),["className","mode","onSelect","queryId","value"]);function Lu(){return(Lu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Uu(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Vu(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Vu=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof m?t:m,s=Object.create(i.prototype),o=new P(n||[]);return a(s,"_invoke",{value:E(e,r,o)}),s}function u(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function m(){}function p(){}function f(){}var h={};l(h,i,(function(){return this}));var b=Object.getPrototypeOf,g=b&&b(b(C([])));g&&g!==t&&r.call(g,i)&&(h=g);var y=f.prototype=m.prototype=Object.create(h);function v(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){var n;a(this,"_invoke",{value:function(a,i){function s(){return new t((function(n,s){!function a(n,i,s,o){var l=u(e[n],e,i);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,s,o)}),(function(e){a("throw",e,s,o)})):t.resolve(d).then((function(e){c.value=e,s(c)}),(function(e){return a("throw",e,s,o)}))}o(l.arg)}(a,i,n,s)}))}return n=n?n.then(s,s):s()}})}function E(e,t,r){var a="suspendedStart";return function(n,i){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===n)throw i;return N()}for(r.method=n,r.arg=i;;){var s=r.delegate;if(s){var o=j(s,r);if(o){if(o===d)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===a)throw a="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a="executing";var l=u(e,t,r);if("normal"===l.type){if(a=r.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(a="completed",r.method="throw",r.arg=l.arg)}}}function j(e,t){var r=t.method,a=e.iterator[r];if(void 0===a)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,j(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),d;var n=u(a,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,d;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,n=function t(){for(;++a<e.length;)if(r.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:N}}function N(){return{value:void 0,done:!0}}return p.prototype=f,a(y,"constructor",{value:f,configurable:!0}),a(f,"constructor",{value:p,configurable:!0}),p.displayName=l(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,o,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},v(O.prototype),l(O.prototype,s,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,a,n,i){void 0===i&&(i=Promise);var s=new O(c(t,r,a,n),i);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},v(y),l(y,o,"Generator"),l(y,i,(function(){return this})),l(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var a in t)r.push(a);return r.reverse(),function e(){for(;r.length;){var a=r.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=C,P.prototype={constructor:P,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(r,a){return s.type="throw",s.arg=e,t.next=r,a&&(t.method="next",t.arg=void 0),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var o=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(o&&l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var n=a.arg;S(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),d}},e}function Bu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Qu extends n.a.Component{constructor(e){super(e),this.state={options:[],value:null,loading:!1}}componentDidMount(){this._loadOptions(this.props.queryId)}componentDidUpdate(e){this.props.queryId!==e.queryId&&this._loadOptions(this.props.queryId),this.props.value!==e.value&&this.setValue(this.props.value)}setValue(e){var t=this.state.options;if("multiple"===this.props.mode){e=Object(c.isArray)(e)?e:[e];var r=Object(c.map)(t,e=>e.value),a=Object(c.intersection)(e,r);return this.setState({value:a}),a}return e=void 0!==Object(c.find)(t,e=>e.value===this.props.value)?e:Object(c.get)(Object(c.first)(t),"value"),this.setState({value:e}),e}_loadOptions(e){var t,r=this;return Vu().async((function(a){for(;;)switch(a.prev=a.next){case 0:if(!e||e===r.state.queryId){a.next=6;break}return r.setState({loading:!0}),a.next=4,Vu().awrap(r.props.parameter.loadDropdownValues());case 4:t=a.sent,r.props.queryId===e&&r.setState({options:t,loading:!1},()=>{var e=r.setValue(r.props.value);Object(c.isEqual)(e,r.props.value)||r.props.onSelect(e)});case 6:case"end":return a.stop()}}),null,null,null,Promise)}render(){var e=this.props,t=e.className,r=e.mode,a=e.onSelect,i=(e.queryId,e.value,Uu(e,Fu)),s=this.state,o=s.loading,l=s.options;return n.a.createElement("span",null,n.a.createElement(zc,Lu({className:t,disabled:o,loading:o,mode:r,value:this.state.value,onChange:a,options:Object(c.map)(l,e=>{var t=e.value,r=e.name;return{label:String(r),value:t}}),showSearch:!0,showArrow:!0,notFoundContent:Object(c.isEmpty)(l)?"No options available":null},i)))}}function Wu(){return(Wu=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Hu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Bu(Qu,"propTypes",{parameter:se.a.any,value:se.a.any,mode:se.a.oneOf(["default","multiple"]),queryId:se.a.number,onSelect:se.a.func,className:se.a.string}),Bu(Qu,"defaultProps",{value:null,mode:"default",parameter:null,queryId:null,onSelect:()=>{},className:""});var Gu={maxTagCount:3,maxTagTextLength:10,maxTagPlaceholder:e=>"+".concat(e.length," more")};class Ku extends n.a.Component{constructor(e){super(e),Hu(this,"componentDidUpdate",e=>{var t=this.props,r=t.value,a=t.parameter;e.value===r&&e.parameter===a||this.setState({value:a.hasPendingValue?a.pendingValue:r,isDirty:a.hasPendingValue})}),Hu(this,"onSelect",e=>{var t=!Object(c.isEqual)(e,this.props.value);this.setState({value:e,isDirty:t}),this.props.onSelect(e,t)}),this.state={value:e.parameter.hasPendingValue?e.parameter.pendingValue:e.value,isDirty:e.parameter.hasPendingValue}}renderDateParameter(){var e=this.props,t=e.type,r=e.parameter,a=this.state.value;return n.a.createElement(hu,{type:t,className:this.props.className,value:a,parameter:r,onSelect:this.onSelect})}renderDateRangeParameter(){var e=this.props,t=e.type,r=e.parameter,a=this.state.value;return n.a.createElement(zu,{type:t,className:this.props.className,value:a,parameter:r,onSelect:this.onSelect})}renderEnumInput(){var e,t=this.props,r=t.enumOptions,a=t.parameter,i=this.state.value,s=r.split("\n").filter(e=>""!==e);return n.a.createElement(zc,Wu({className:this.props.className,mode:a.multiValuesOptions?"multiple":"default",value:(e=i,a.multiValuesOptions&&null===e?[]:e),onChange:this.onSelect,options:Object(c.map)(s,e=>({label:String(e),value:e})),showSearch:!0,showArrow:!0,notFoundContent:Object(c.isEmpty)(s)?"No options available":null},Gu))}renderQueryBasedInput(){var e=this.props,t=e.queryId,r=e.parameter,a=this.state.value;return n.a.createElement(Qu,Wu({className:this.props.className,mode:r.multiValuesOptions?"multiple":"default",parameter:r,value:a,queryId:t,onSelect:this.onSelect,style:{minWidth:60}},Gu))}renderNumberInput(){var e=this.props.className,t=this.state.value,r=e=>isNaN(e)?void 0:e;return n.a.createElement(_o.a,{className:e,value:r(t),"aria-label":"Parameter number value",onChange:e=>this.onSelect(r(e))})}renderTextInput(){var e=this.props.className,t=this.state.value;return n.a.createElement(He.a,{className:e,value:t,"aria-label":"Parameter text value","data-test":"TextParamInput",onChange:e=>this.onSelect(e.target.value)})}renderInput(){switch(this.props.type){case"datetime-with-seconds":case"datetime-local":case"date":return this.renderDateParameter();case"datetime-range-with-seconds":case"datetime-range":case"date-range":return this.renderDateRangeParameter();case"enum":return this.renderEnumInput();case"query":return this.renderQueryBasedInput();case"number":return this.renderNumberInput();default:return this.renderTextInput()}}render(){var e=this.state.isDirty;return n.a.createElement("div",{className:"parameter-input","data-dirty":e||null,"data-test":"ParameterValueInput"},this.renderInput())}}Hu(Ku,"propTypes",{type:se.a.string,value:se.a.any,enumOptions:se.a.string,queryId:se.a.number,parameter:se.a.any,onSelect:se.a.func,className:se.a.string}),Hu(Ku,"defaultProps",{type:"text",value:null,enumOptions:"",queryId:null,parameter:null,onSelect:()=>{},className:""});var Yu=Ku;function $u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Ju(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$u(Object(r),!0).forEach((function(t){Xu(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Xu(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ed(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ed(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ed(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function td(){return(td=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var rd=Qi.a.Option,ad={labelCol:{span:6},wrapperCol:{span:16}};function nd(e){return Object(c.capitalize)(Object(c.words)(e).join(" "))}function id(e){var t=e.name,r=e.type,a=e.onChange,i=e.existingNames,s=e.setValidation,o="",l="";return t?Object(c.includes)(i,t)?(o="Parameter with this name already exists",s(!1),l="error"):(function(e){return/-range/.test(e)}(r)&&(o=n.a.createElement(n.a.Fragment,null,"Appears in query as"," ",n.a.createElement("code",{style:{display:"inline-block",color:"inherit"}},"{{".concat(t,".start}} {{").concat(t,".end}}")))),s(!0)):(o="Choose a keyword for this parameter",s(!1)),n.a.createElement(yo.a.Item,td({required:!0,label:"Keyword",help:o,validateStatus:l},ad),n.a.createElement(He.a,{onChange:e=>a(e.target.value),autoFocus:!0}))}function sd(e){var t=Zu(Object(a.useState)(Object(c.clone)(e.parameter)),2),r=t[0],i=t[1],s=Zu(Object(a.useState)(!0),2),o=s[0],l=s[1],u=Zu(Object(a.useState)(),2),d=u[0],m=u[1],p=!e.parameter.name;Object(a.useEffect)(()=>{var t=e.parameter.queryId;t&&ir.get({id:t}).then(m)},[e.parameter.queryId]);var f,b,g,y=qe("paramForm");return n.a.createElement(V.a,td({},e.dialog.props,{title:p?"Add Parameter":r.name,width:600,footer:[n.a.createElement(h.a,{key:"cancel",onClick:e.dialog.dismiss},"Cancel"),n.a.createElement(h.a,{key:"submit",htmlType:"submit",disabled:!!(!o||""===r.title||"query"===r.type&&!r.queryId),type:"primary",form:y,"data-test":"SaveParameterSettings"},p?"Add Parameter":"OK")]}),n.a.createElement(yo.a,{layout:"horizontal",onFinish:function(){r.title||(r.title=nd(r.name),i(r)),e.dialog.close(r)},id:y},p&&n.a.createElement(id,{name:r.name,onChange:e=>i(Ju(Ju({},r),{},{name:e})),setValidation:l,existingNames:e.existingParams,type:r.type}),n.a.createElement(yo.a.Item,td({required:!0,label:"Title"},ad),n.a.createElement(He.a,{value:Object(c.isNull)(r.title)?nd(r.name):r.title,onChange:e=>i(Ju(Ju({},r),{},{title:e.target.value})),"data-test":"ParameterTitleInput"})),n.a.createElement(yo.a.Item,td({label:"Type"},ad),n.a.createElement(Qi.a,{value:r.type,onChange:e=>i(Ju(Ju({},r),{},{type:e})),"data-test":"ParameterTypeSelect"},n.a.createElement(rd,{value:"text","data-test":"TextParameterTypeOption"},"Text"),n.a.createElement(rd,{value:"number","data-test":"NumberParameterTypeOption"},"Number"),n.a.createElement(rd,{value:"enum"},"Dropdown List"),n.a.createElement(rd,{value:"query"},"Query Based Dropdown List"),n.a.createElement(rd,{disabled:!0,key:"dv1"},n.a.createElement(wo.a,{className:"select-option-divider"})),n.a.createElement(rd,{value:"date","data-test":"DateParameterTypeOption"},"Date"),n.a.createElement(rd,{value:"datetime-local","data-test":"DateTimeParameterTypeOption"},"Date and Time"),n.a.createElement(rd,{value:"datetime-with-seconds"},"Date and Time (with seconds)"),n.a.createElement(rd,{disabled:!0,key:"dv2"},n.a.createElement(wo.a,{className:"select-option-divider"})),n.a.createElement(rd,{value:"date-range","data-test":"DateRangeParameterTypeOption"},"Date Range"),n.a.createElement(rd,{value:"datetime-range"},"Date and Time Range"),n.a.createElement(rd,{value:"datetime-range-with-seconds"},"Date and Time Range (with seconds)"))),"enum"===r.type&&n.a.createElement(yo.a.Item,td({label:"Values",help:"Dropdown list values (newline delimited)"},ad),n.a.createElement(He.a.TextArea,{rows:3,value:r.enumOptions,onChange:e=>i(Ju(Ju({},r),{},{enumOptions:e.target.value}))})),"query"===r.type&&n.a.createElement(yo.a.Item,td({label:"Query",help:"Select query to load dropdown values from"},ad),n.a.createElement(Go,{selectedQuery:d,onChange:e=>i(Ju(Ju({},r),{},{queryId:e&&e.id})),type:"select"})),("enum"===r.type||"query"===r.type)&&n.a.createElement(yo.a.Item,td({className:"m-b-0",label:" ",colon:!1},ad),n.a.createElement(Jl.a,{defaultChecked:!!r.multiValuesOptions,onChange:e=>i(Ju(Ju({},r),{},{multiValuesOptions:e.target.checked?{prefix:"",suffix:"",separator:","}:null})),"data-test":"AllowMultipleValuesCheckbox"},"Allow multiple values")),("enum"===r.type||"query"===r.type)&&r.multiValuesOptions&&n.a.createElement(yo.a.Item,td({label:"Quotation",help:n.a.createElement(n.a.Fragment,null,"Placed in query as: ",n.a.createElement("code",null,(f=r.multiValuesOptions,b=f.prefix,g=f.suffix,["value1","value2","value3"].map(e=>"".concat(b).concat(e).concat(g)).join(","))))},ad),n.a.createElement(Qi.a,{value:r.multiValuesOptions.prefix,onChange:e=>i(Ju(Ju({},r),{},{multiValuesOptions:Ju(Ju({},r.multiValuesOptions),{},{prefix:e,suffix:e})})),"data-test":"QuotationSelect"},n.a.createElement(rd,{value:""},"None (default)"),n.a.createElement(rd,{value:"'"},"Single Quotation Mark"),n.a.createElement(rd,{value:'"',"data-test":"DoubleQuotationMarkOption"},"Double Quotation Mark")))))}id.propTypes={name:se.a.string.isRequired,onChange:se.a.func.isRequired,existingNames:se.a.arrayOf(se.a.string).isRequired,setValidation:se.a.func.isRequired,type:se.a.string.isRequired},sd.propTypes={parameter:se.a.object.isRequired,dialog:Je.isRequired,existingParams:se.a.arrayOf(se.a.string)},sd.defaultProps={existingParams:[]};var od=Xe(sd);function ld(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cd(e){var t=Object(c.extend)({},R.search);e.forEach(e=>{Object(c.extend)(t,e.toUrlParams())}),R.setSearch(t,!0)}class ud extends n.a.Component{constructor(e){super(e),ld(this,"toCamelCase",e=>Object(c.isEmpty)(e)?"":e.replace(/\s+/g,"").toLowerCase()),ld(this,"componentDidUpdate",e=>{var t=this.props,r=t.parameters,a=t.disableUrlUpdate,n=e.parameters!==r,i=e.disableUrlUpdate!==a;n&&this.setState({parameters:r}),!n&&!i||a||cd(r)}),ld(this,"handleKeyDown",e=>{13===e.keyCode&&(e.ctrlKey||e.metaKey||e.altKey)&&(e.stopPropagation(),this.applyChanges())}),ld(this,"setPendingValue",(e,t,r)=>{var a=this.props.onPendingValuesChange;this.setState(n=>{var i=n.parameters;return r?e.setPendingValue(t):e.clearPendingValue(),a(),{parameters:i}})}),ld(this,"moveParameter",e=>{var t=e.oldIndex,r=e.newIndex,a=this.props.onParametersEdit;t!==r&&this.setState(e=>{var n=e.parameters;return n.splice(r,0,n.splice(t,1)[0]),a(n),{parameters:n}})}),ld(this,"applyChanges",()=>{var e=this.props,t=e.onValuesChange,r=e.disableUrlUpdate;this.setState(e=>{var a=e.parameters,n=a.filter(e=>e.hasPendingValue);return Object(c.forEach)(a,e=>e.applyPendingValue()),r||cd(a),t(n),{parameters:a}})}),ld(this,"showParameterSettings",(e,t)=>{var r=this.props.onParametersEdit;od.showModal({parameter:e}).onClose(a=>{this.setState(n=>{var i=n.parameters,s=Object(c.extend)(e,a);return i[t]=qr(s,s.parentQueryId),r(i),{parameters:i}})})});var t=e.parameters,r=e.disableUrlUpdate;this.state={parameters:t},r||cd(t);var a=window.location.search.matchAll(/hide_filter=([^&]+)/g);this.hideValues=Array.from(a,e=>e[1])}renderParameter(e,t){if(this.hideValues.some(t=>this.toCamelCase(t)===this.toCamelCase(e.name)))return null;var r=this.props.editable;return e.hidden?null:n.a.createElement("div",{key:e.name,className:"di-block","data-test":"ParameterName-".concat(e.name)},n.a.createElement("div",{className:"parameter-heading"},n.a.createElement("label",null,e.title||li(e.name)),r&&n.a.createElement(Ee,{className:"btn btn-default btn-xs m-l-5","aria-label":"Edit",onClick:()=>this.showParameterSettings(e,t),"data-test":"ParameterSettings-".concat(e.name),type:"button"},n.a.createElement("i",{className:"fa fa-cog","aria-hidden":"true"}))),n.a.createElement(Yu,{type:e.type,value:e.normalizedValue,parameter:e,enumOptions:e.enumOptions,queryId:e.queryId,onSelect:(t,r)=>this.setPendingValue(e,t,r)}))}render(){var e=this.state.parameters,t=this.props,r=t.sortable,a=t.appendSortableToParent,i=Object(c.size)(Object(c.filter)(e,"hasPendingValue"));return n.a.createElement(Sc.SortableContainer,{disabled:!r,axis:"xy",useDragHandle:!0,lockToContainerEdges:!0,helperClass:"parameter-dragged",helperContainer:e=>a?e:document.body,updateBeforeSortStart:this.onBeforeSortStart,onSortEnd:this.moveParameter,containerProps:{className:"parameter-container",onKeyDown:i?this.handleKeyDown:null}},e&&e.map((e,t)=>n.a.createElement(Sc.SortableElement,{key:e.name,index:t},n.a.createElement("div",{className:"parameter-block","data-editable":r||null,"data-test":"ParameterBlock-".concat(e.name)},r&&n.a.createElement(Sc.DragHandle,{"data-test":"DragHandle-".concat(e.name)}),this.renderParameter(e,t)))),n.a.createElement(Tc,{onClick:this.applyChanges,paramCount:i}))}}function dd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return md(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return md(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function md(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function pd(e){var t=e.from,r=Object(a.useMemo)(()=>l()(t).valueOf(),[t]),i=dd(Object(a.useState)(null),2),s=i[0],o=i[1];return Object(a.useEffect)(()=>{function e(){var e=l.a.now()-r,t=e>36e5?"HH:mm:ss":"mm:ss";o(l.a.utc(e).format(t))}e();var t=setInterval(e,1e3);return()=>clearInterval(t)},[r]),n.a.createElement("span",{className:"rd-timer"},s)}function fd(e){var t=e.visualization,r=d.registeredVisualizations[t.type];return n.a.createElement("span",{className:"visualization-name"},r&&t.name!==r.name?t.name:null)}ld(ud,"propTypes",{parameters:se.a.arrayOf(se.a.instanceOf(At)),editable:se.a.bool,sortable:se.a.bool,disableUrlUpdate:se.a.bool,onValuesChange:se.a.func,onPendingValuesChange:se.a.func,onParametersEdit:se.a.func,appendSortableToParent:se.a.bool}),ld(ud,"defaultProps",{parameters:[],editable:!1,sortable:!1,disableUrlUpdate:!1,onValuesChange:()=>{},onPendingValuesChange:()=>{},onParametersEdit:()=>{},appendSortableToParent:!0}),pd.propTypes={from:se.a.oneOfType([se.a.string,se.a.number,se.a.instanceOf(Date),Kn])},pd.defaultProps={from:null},fd.propTypes={visualization:d.VisualizationType.isRequired};var hd=fd;function bd(){return(bd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function gd(e){var t=e.query,r=e.visualization,a=e.readOnly;return n.a.createElement(e=>{return a?n.a.createElement("span",e):n.a.createElement(S,bd({href:(i=null,r&&(i="TABLE"===r.type?"table":r.id),t.getUrl(!1,i))},e));var i},{className:"query-link"},n.a.createElement(hd,{visualization:r})," ",n.a.createElement("span",null,t.name))}gd.propTypes={query:se.a.object.isRequired,visualization:d.VisualizationType,readOnly:se.a.bool},gd.defaultProps={visualization:null,readOnly:!1};var yd=gd;function vd(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Od(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?vd(Object(r),!0).forEach((function(t){Ed(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vd(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ed(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var jd="###Redash::Filters::SelectAll###",wd=se.a.shape({name:se.a.string.isRequired,friendlyName:se.a.string.isRequired,multiple:se.a.bool,current:se.a.oneOfType([se.a.any,se.a.arrayOf(se.a.any)]),values:se.a.arrayOf(se.a.any).isRequired}),Sd=se.a.arrayOf(wd);function Pd(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!Object(c.isArray)(e))return[];var r=e;return Object(c.isArray)(t)&&t.length>0&&(r=r.filter(e=>Object(c.every)(t,t=>{var r=e[t.name],a=Object(c.isArray)(t.current)?t.current:[t.current];return Object(c.some)(a,e=>l.a.isMoment(r)?r.isSame(e):e===r||String(r)===e)}))),r}function Cd(e){var t=e.filters,r=e.onChange;return 0===t.length?null:(r=function(e,t){return(r,a)=>{if(Object(c.isArray)(a))a=Object(c.map)(a,e=>r.values[Object(c.toNumber)(e.key)]||e.key);else{var n=r.values[Object(c.toNumber)(a.key)];a=void 0!==n?n:a.key}r.multiple&&Object(c.includes)(a,jd)&&(a=[...r.values]),r.multiple&&Object(c.includes)(a,"###Redash::Filters::Clear###")&&(a=[]),e=Object(c.map)(e,e=>e.name===r.name?Od(Od({},r),{},{current:a}):e),t(e)}}(t,r),n.a.createElement("div",{className:"filters-wrapper","data-test":"Filters"},n.a.createElement("div",{className:"container bg-white"},n.a.createElement("div",{className:"row"},Object(c.map)(t,e=>{var t=Object(c.map)(e.values,(t,r)=>n.a.createElement(Qi.a.Option,{key:r},mi(t,Object(c.get)(e,"column.type"))));return n.a.createElement("div",{key:e.name,className:"col-sm-6 p-l-0 filter-container","data-test":"FilterName-".concat(e.name)},n.a.createElement("label",null,e.friendlyName),0===t.length&&n.a.createElement(Qi.a,{className:"w-100",disabled:!0,value:"No values"}),t.length>0&&n.a.createElement(Qi.a,{labelInValue:!0,className:"w-100",mode:e.multiple?"multiple":"default",value:Object(c.isArray)(e.current)?Object(c.map)(e.current,t=>({key:"".concat(Object(c.indexOf)(e.values,t)),label:mi(t)})):{key:"".concat(Object(c.indexOf)(e.values,e.current)),label:mi(e.current)},allowClear:e.multiple,optionFilterProp:"children",showSearch:!0,maxTagCount:3,maxTagTextLength:10,maxTagPlaceholder:e=>"+".concat(e.length," more"),onChange:t=>r(e,t)},!e.multiple&&t,e.multiple&&[n.a.createElement(Qi.a.Option,{key:"###Redash::Filters::Clear###","data-test":"ClearOption"},n.a.createElement("i",{className:"fa fa-square-o m-r-5","aria-hidden":"true"}),"Clear"),n.a.createElement(Qi.a.Option,{key:jd,"data-test":"SelectAllOption"},n.a.createElement("i",{className:"fa fa-check-square-o m-r-5","aria-hidden":"true"}),"Select All"),n.a.createElement(Qi.a.OptGroup,{key:"Values",title:"Values"},t)]))})))))}Cd.propTypes={filters:Sd.isRequired,onChange:se.a.func},Cd.defaultProps={onChange:()=>{}};var Nd=Cd;function kd(e){var t=Object(c.invoke)(e,"getStatus");return Object(a.useMemo)(()=>function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{status:t||Object(c.invoke)(e,"getStatus")||null,columns:Object(c.invoke)(e,"getColumns")||[],rows:Object(c.invoke)(e,"getData")||[],filters:Object(c.invoke)(e,"getFilters")||[],updatedAt:Object(c.invoke)(e,"getUpdatedAt")||null,retrievedAt:Object(c.get)(e,"query_result.retrieved_at",null),truncated:Object(c.invoke)(e,"getTruncated")||null,log:Object(c.invoke)(e,"getLog")||[],error:Object(c.invoke)(e,"getError")||null,runtime:Object(c.invoke)(e,"getRuntime")||null,metadata:Object(c.get)(e,"query_result.data.metadata",{})}}(e,t),[e,t])}function _d(e){var t=Object(a.useRef)();return t.current=Object(c.isFunction)(e)?e:c.noop,Object(a.useCallback)((function(){return t.current(...arguments)}),[])}var Ad=r(1081),xd=r(1082),qd=r(1083);function Td(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Id(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dd(e){return function(t){return Object(d.updateVisualizationsSettings)(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Td(Object(r),!0).forEach((function(t){Id(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Td(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({HelpTriggerComponent:Qe,LinkComponent:S,choroplethAvailableMaps:{countries:{name:"Countries",url:Ad.a,fieldNames:{name:"Short name",name_long:"Full name",abbrev:"Abbreviated name",iso_a2:"ISO code (2 letters)",iso_a3:"ISO code (3 letters)",iso_n3:"ISO code (3 digits)"}},usa:{name:"USA",url:xd.a,fieldNames:{name:"Name",ns_code:"National Standard ANSI Code (8-character)",geoid:"Geographic ID",usps_abbrev:"USPS Abbreviation",fips_code:"FIPS Code (2-character)"}},subdiv_japan:{name:"Japan/Prefectures",url:qd.a,fieldNames:{name:"Name",name_alt:"Name (alternative)",name_local:"Name (local)",iso_3166_2:"ISO-3166-2",postal:"Postal Code",type:"Type",type_en:"Type (EN)",region:"Region",region_code:"Region Code"}}}},Object(c.pick)($,["dateFormat","dateTimeFormat","integerFormat","floatFormat","booleanValues","tableCellMaxJSONSize","allowCustomJSVisualizations","hidePlotlyModeBar"]))),n.a.createElement(e,t)}}var Rd=Dd(d.Renderer),Md=Dd(d.Editor);function zd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fd(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Ld(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Ud(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ld(Object(r),!0).forEach((function(t){Vd(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ld(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Vd(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bd(e,t){return 0===e.length||0===t.length?e:Object(c.map)(e,e=>{var r=Object(c.find)(t,t=>t.name===e.name);return r?Ud(Ud({},e),{},{current:r.current}):e})}function Qd(e){var t=kd(e.queryResult),r=zd(Object(a.useState)(()=>Bd(t.filters,e.filters)),2),i=r[0],s=r[1],o=Object(a.useRef)();o.current=i;var l=_d(t=>{var r,a;a=i,(r=t).length===a.length&&(r=Object(c.fromPairs)(Object(c.map)(r,e=>[e.name,e])),a=Object(c.fromPairs)(Object(c.map)(a,e=>[e.name,e])),Object(c.isEqual)(r,a))||(s(t),e.onFiltersChange(t))});Object(a.useEffect)(()=>{l(Bd(t.filters,e.filters))},[t.filters,e.filters,l]),Object(a.useEffect)(()=>{l(Bd(o.current,e.filters))},[e.filters,l]);var u=Object(a.useMemo)(()=>({columns:t.columns,rows:Pd(t.rows,i)}),[t,i]),d=e.showFilters,m=e.visualization,p=Ud({},m.options);return"TABLE"===m.type&&(p.paginationSize="widget"===e.context?"small":"default"),n.a.createElement(Rd,{key:"visualization".concat(m.id),type:m.type,options:p,data:u,visualizationName:m.name,addonBefore:d&&n.a.createElement(Nd,{filters:i,onChange:l})})}function Wd(){return(Wd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Hd(e){var t=e.dialog,r=e.widget,a=e.filters;return n.a.createElement(V.a,Wd({},t.props,{title:n.a.createElement(n.a.Fragment,null,n.a.createElement(hd,{visualization:r.visualization})," ",n.a.createElement("span",null,r.getQuery().name)),width:"95%",footer:n.a.createElement(h.a,{onClick:t.dismiss},"Close")}),n.a.createElement(Qd,{visualization:r.visualization,queryResult:r.getQueryResult(),filters:a,context:"widget"}))}Qd.propTypes={visualization:d.VisualizationType.isRequired,queryResult:se.a.object.isRequired,showFilters:se.a.bool,filters:Sd,onFiltersChange:se.a.func,context:se.a.oneOf(["query","widget"]).isRequired},Qd.defaultProps={showFilters:!0,filters:[],onFiltersChange:()=>{}},Hd.propTypes={dialog:Je.isRequired,widget:se.a.object.isRequired,filters:Sd},Hd.defaultProps={filters:[]};var Gd=Xe(Hd),Kd=r(271),Yd=r.n(Kd),$d=r(237),Jd=r.n($d),Xd=r(82),Zd=r.n(Xd),em=r(633),tm=r.n(em),rm=r(440),am=r.n(rm),nm=r(236),im=r.n(nm);function sm(){return(sm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function om(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lm(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lm(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function cm(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var um="dashboard-add-new",dm="dashboard-map-to-existing",mm="widget-level",pm="static-value";function fm(e){return Object(c.fromPairs)(Object(c.map)(e,e=>{var t=Object(c.extend)({},e);switch(e.type){case um:case dm:t.type=Lr.DashboardLevel,t.value=null;break;case pm:t.type=Lr.StaticValue,t.param=Tr(e.param),t.param.setValue(t.value),t.value=t.param.value;break;case mm:t.type=Lr.WidgetLevel,t.value=null}return delete t.param,[t.name,t]}))}function hm(e,t){var r=[];return Object(c.each)(e,e=>{e.type===Lr.DashboardLevel&&Object(c.each)(t,t=>{var a=t.options.parameterMappings;Object(c.each)(a,a=>{a.type===Lr.DashboardLevel&&a.mapTo===e.mapTo&&a.title!==e.title&&(a.title=e.title,r.push(t))})})}),r}class bm extends n.a.Component{constructor(){super(...arguments),cm(this,"formItemProps",{labelCol:{span:5},wrapperCol:{span:16},className:"form-item"}),cm(this,"updateSourceType",e=>{var t=this.props.mapping.mapTo,r=this.props.existingParamNames;e!==dm||Object(c.includes)(r,t)||(t=r[0]),this.updateParamMapping({type:e,mapTo:t})}),cm(this,"updateParamMapping",e=>{var t=this.props,r=t.onChange,a=t.mapping,n=Object(c.extend)({},a,e);n.value!==a.value&&(n.param=Tr(n.param),n.param.setValue(n.value)),Object(c.has)(e,"type")&&(e.type===pm?n.value=n.param.value:n.value=null),r(n)})}renderMappingTypeSelector(){var e=Object(c.isEmpty)(this.props.existingParamNames);return n.a.createElement(Zd.a.Group,{value:this.props.mapping.type,onChange:e=>this.updateSourceType(e.target.value)},n.a.createElement(Zd.a,{className:"radio",value:um,"data-test":"NewDashboardParameterOption"},"New dashboard parameter"),n.a.createElement(Zd.a,{className:"radio",value:dm,disabled:e},"Existing dashboard parameter"," ",e?n.a.createElement(Ne,{title:"There are no dashboard parameters corresponding to this data type"},n.a.createElement(tm.a,null)):null),n.a.createElement(Zd.a,{className:"radio",value:mm,"data-test":"WidgetParameterOption"},"Widget parameter"),n.a.createElement(Zd.a,{className:"radio",value:pm,"data-test":"StaticValueOption"},"Static value"))}renderDashboardAddNew(){var e=this.props.mapping.mapTo;return n.a.createElement(He.a,{value:e,"aria-label":"Parameter name (key)",onChange:e=>this.updateParamMapping({mapTo:e.target.value})})}renderDashboardMapToExisting(){var e=this.props,t=e.mapping,r=e.existingParamNames,a=Object(c.map)(r,e=>({label:e,value:e}));return n.a.createElement(Qi.a,{value:t.mapTo,onChange:e=>this.updateParamMapping({mapTo:e}),options:a})}renderStaticValue(){var e=this.props.mapping;return n.a.createElement(Yu,{type:e.param.type,value:e.param.normalizedValue,enumOptions:e.param.enumOptions,queryId:e.param.queryId,parameter:e.param,onSelect:e=>this.updateParamMapping({value:e})})}renderInputBlock(){switch(this.props.mapping.type){case um:return["Key","Enter a new parameter keyword",this.renderDashboardAddNew()];case dm:return["Key","Select from a list of existing parameters",this.renderDashboardMapToExisting()];case pm:return["Value",null,this.renderStaticValue()];default:return[]}}render(){var e=this.props.inputError,t=om(this.renderInputBlock(),3),r=t[0],a=t[1],i=t[2];return n.a.createElement(yo.a,{layout:"horizontal"},n.a.createElement(yo.a.Item,sm({label:"Source"},this.formItemProps),this.renderMappingTypeSelector()),n.a.createElement(yo.a.Item,sm({style:{height:60,visibility:i?"visible":"hidden"},label:r},this.formItemProps,{validateStatus:e?"error":"",help:e||a}),i))}}cm(bm,"propTypes",{mapping:se.a.object,existingParamNames:se.a.arrayOf(se.a.string),onChange:se.a.func,inputError:se.a.string}),cm(bm,"defaultProps",{mapping:{},existingParamNames:[],onChange:()=>{},inputError:null});class gm extends n.a.Component{constructor(e){super(e),cm(this,"onVisibleChange",e=>{e?this.show():this.hide()}),cm(this,"onChange",e=>{var t=null;e.type===um&&(Object(c.isEmpty)(e.mapTo)?t="Keyword must have a value":Object(c.includes)(this.props.existingParamNames,e.mapTo)&&(t="A parameter with this name already exists")),this.setState({mapping:e,inputError:t})}),cm(this,"save",()=>{this.props.onChange(this.props.mapping,this.state.mapping),this.hide()}),cm(this,"show",()=>{this.setState({visible:!0,mapping:Object(c.clone)(this.props.mapping)})}),cm(this,"hide",()=>{this.setState({visible:!1})}),this.state={visible:!1,mapping:Object(c.clone)(this.props.mapping),inputError:null}}renderContent(){var e=this.state,t=e.mapping,r=e.inputError;return n.a.createElement("div",{className:"parameter-mapping-editor","data-test":"EditParamMappingPopover"},n.a.createElement("header",null,"Edit Source and Value ",n.a.createElement(Qe,{type:"VALUE_SOURCE_OPTIONS"})),n.a.createElement(bm,{mapping:t,existingParamNames:this.props.existingParamNames,onChange:this.onChange,inputError:r}),n.a.createElement("footer",null,n.a.createElement(h.a,{onClick:this.hide},"Cancel"),n.a.createElement(h.a,{onClick:this.save,disabled:!!r,type:"primary"},"OK")))}render(){var e=this.state,t=e.visible,r=e.mapping;return n.a.createElement(Yd.a,{placement:"left",trigger:"click",content:this.renderContent(),visible:t,onVisibleChange:this.onVisibleChange},n.a.createElement(h.a,{size:"small",type:"dashed","data-test":"EditParamMappingButton-".concat(r.param.name)},n.a.createElement(am.a,null)))}}cm(gm,"propTypes",{mapping:se.a.object.isRequired,existingParamNames:se.a.arrayOf(se.a.string).isRequired,onChange:se.a.func.isRequired});class ym extends n.a.Component{constructor(){super(...arguments),cm(this,"state",{showPopup:!1,title:""}),cm(this,"onPopupVisibleChange",e=>{this.setState({showPopup:e,title:e?this.getMappingTitle():""})}),cm(this,"onEditingTitleChange",e=>{this.setState({title:e.target.value})}),cm(this,"save",()=>{var e=Object(c.extend)({},this.props.mapping,{title:this.state.title});this.props.onChange(e),this.hide()}),cm(this,"hide",()=>{this.setState({showPopup:!1})})}getMappingTitle(){var e=this.props.mapping;if(Object(c.isString)(e.title)&&""!==e.title)return e.title;if(e.type===dm){var t=Object(c.find)(this.props.existingParams,{name:e.mapTo});t&&(e=t)}return e.title||e.param.title}renderPopover(){var e=this.props.mapping.param.title;return n.a.createElement("div",{className:"parameter-mapping-title-editor"},n.a.createElement(He.a,{size:"small",value:this.state.title,placeholder:e,"aria-label":"Edit parameter title",onChange:this.onEditingTitleChange,onPressEnter:this.save,maxLength:100,autoFocus:!0}),n.a.createElement(h.a,{size:"small",type:"dashed",onClick:this.hide},n.a.createElement(xe.a,null)),n.a.createElement(h.a,{size:"small",type:"dashed",onClick:this.save},n.a.createElement(im.a,null)))}renderEditButton(){return this.props.mapping.type===pm?n.a.createElement(Ne,{placement:"right",title:"Titles for static values don't appear in widgets"},n.a.createElement("span",{tabIndex:0},n.a.createElement("i",{className:"fa fa-eye-slash","aria-hidden":"true"}))):n.a.createElement(Yd.a,{placement:"right",trigger:"click",content:this.renderPopover(),visible:this.state.showPopup,onVisibleChange:this.onPopupVisibleChange},n.a.createElement(h.a,{size:"small",type:"dashed"},n.a.createElement(am.a,null)))}render(){var e=this.props.mapping.type===pm;return n.a.createElement("div",{className:ge()("parameter-mapping-title",{disabled:e})},n.a.createElement("span",{className:"text"},this.getMappingTitle()),this.renderEditButton())}}cm(ym,"propTypes",{existingParams:se.a.arrayOf(se.a.object),mapping:se.a.object.isRequired,onChange:se.a.func.isRequired}),cm(ym,"defaultProps",{existingParams:[]});class vm extends n.a.Component{static getStringValue(e){return e?e instanceof Object&&"start"in e&&"end"in e?"".concat(e.start," ~ ").concat(e.end):"object"==typeof e?Object(c.map)(e,e=>this.getStringValue(e)).join(", "):e.toString():""}static getDefaultValue(e,t){var r=e.type,a=e.mapTo,n=e.name,i=e.param;if(r===dm&&a!==n){var s=Object(c.find)(t,{name:a});s&&(i=s)}else r===pm&&(i=Tr(i).setValue(e.value));var o=At.getExecutionValue(i);return i.hasDynamicValue&&(o=i.normalizedValue.name),this.getStringValue(o)}static getSourceTypeLabel(e){var t=e.type,r=e.mapTo;switch(t){case um:case dm:return n.a.createElement(a.Fragment,null,"Dashboard ",n.a.createElement(Jd.a,{className:"tag"},r));case mm:return"Widget parameter";case pm:return"Static value";default:return""}}updateParamMapping(e,t){var r=[...this.props.mappings],a=Object(c.findIndex)(r,e);a>=0?r[a]=t:r.push(t),this.props.onChange(r)}render(){var e=this.props.existingParams,t=this.props.mappings.map(e=>({mapping:e}));return n.a.createElement("div",{className:"parameters-mapping-list"},n.a.createElement(In.a,{dataSource:t,size:"middle",pagination:!1,rowKey:(e,t)=>"row".concat(t)},n.a.createElement(In.a.Column,{title:"Title",dataIndex:"mapping",key:"title",render:t=>n.a.createElement(ym,{existingParams:e,mapping:t,onChange:e=>this.updateParamMapping(t,e)})}),n.a.createElement(In.a.Column,{title:"Keyword",dataIndex:"mapping",key:"keyword",className:"keyword",render:e=>n.a.createElement("code",null,"{{ ".concat(e.name," }}"))}),n.a.createElement(In.a.Column,{title:"Default Value",dataIndex:"mapping",key:"value",render:e=>this.constructor.getDefaultValue(e,this.props.existingParams)}),n.a.createElement(In.a.Column,{title:"Value Source",dataIndex:"mapping",key:"source",render:t=>{var r=e.filter(e=>e.type===t.param.type).map(e=>e.name);return n.a.createElement(a.Fragment,null,this.constructor.getSourceTypeLabel(t)," ",n.a.createElement(gm,{mapping:t,existingParamNames:r,onChange:(e,t)=>this.updateParamMapping(e,t)}))}})))}}function Om(){return(Om=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Em(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jm(e,t){return Object(c.map)(Object(c.sortBy)(e,e=>e.name),e=>{var r;switch(e.type){case pm:return[e.name,e.value];case mm:return[e.name,e.param.value];case um:case dm:return r=Object(c.find)(t,t=>t.name===e.mapTo),[e.name,r?r.value:null]}})}cm(vm,"propTypes",{mappings:se.a.arrayOf(se.a.object),existingParams:se.a.arrayOf(se.a.object),onChange:se.a.func}),cm(vm,"defaultProps",{mappings:[],existingParams:[],onChange:()=>{}});class wm extends n.a.Component{constructor(e){super(e),Em(this,"originalParamValuesSnapshot",null);var t=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Object(c.map)(e,e=>{var a=Object(c.extend)({},e),n=Object(c.includes)(r,e.mapTo);switch(a.param=Object(c.find)(t,t=>t.name===e.name),e.type){case Lr.DashboardLevel:a.type=n?dm:um,a.value=null;break;case Lr.StaticValue:a.type=pm,a.param=Tr(a.param),a.param.setValue(a.value);break;case Lr.WidgetLevel:a.type=mm,a.value=null}return a})}(e.widget.options.parameterMappings,e.widget.query.getParametersDefs(),Object(c.map)(this.props.dashboard.getParametersDefs(),e=>e.name));this.originalParamValuesSnapshot=jm(t,this.props.dashboard.getParametersDefs()),this.state={saveInProgress:!1,parameterMappings:t}}saveWidget(){var e=this.props.widget;this.setState({saveInProgress:!0});var t=fm(this.state.parameterMappings);e.options.parameterMappings=t;var r=!Object(c.isMatch)(this.originalParamValuesSnapshot,jm(this.state.parameterMappings,this.props.dashboard.getParametersDefs())),a=[e,...hm(e.options.parameterMappings,this.props.dashboard.widgets)];Promise.all(Object(c.map)(a,e=>e.save())).then(()=>{this.props.dialog.close(r)}).catch(()=>{sn.error("Widget cannot be updated")}).finally(()=>{this.setState({saveInProgress:!1})})}updateParamMappings(e){this.setState({parameterMappings:e})}render(){var e=this.props.dialog;return n.a.createElement(V.a,Om({},e.props,{title:"Parameters",onOk:()=>this.saveWidget(),okButtonProps:{loading:this.state.saveInProgress},width:700}),this.state.parameterMappings.length>0&&n.a.createElement(vm,{mappings:this.state.parameterMappings,existingParams:this.props.dashboard.getParametersDefs(),onChange:e=>this.updateParamMappings(e)}))}}Em(wm,"propTypes",{dashboard:se.a.object.isRequired,widget:se.a.object.isRequired,dialog:Je.isRequired});var Sm=Xe(wm);function Pm(){return(Pm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Cm(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nm(e){var t=e.extraOptions,r=e.showDeleteOption,a=e.onDelete,i=n.a.createElement(he.a,{"data-test":"WidgetDropdownButtonMenu"},t,r&&t&&n.a.createElement(he.a.Divider,null),r&&n.a.createElement(he.a.Item,{onClick:a},"Remove from Dashboard"));return n.a.createElement("div",{className:"widget-menu-regular"},n.a.createElement(Da.a,{overlay:i,placement:"bottomRight",trigger:["click"]},n.a.createElement(Ee,{className:"action p-l-15 p-r-15","data-test":"WidgetDropdownButton","aria-label":"More options"},n.a.createElement("i",{className:"zmdi zmdi-more-vert","aria-hidden":"true"}))))}function km(e){var t=e.onClick;return n.a.createElement("div",{className:"widget-menu-remove"},n.a.createElement(Ee,{className:"action",title:"Remove From Dashboard",onClick:t,"data-test":"WidgetDeleteButton","aria-label":"Close"},n.a.createElement("i",{className:"zmdi zmdi-close","aria-hidden":"true"})))}Nm.propTypes={extraOptions:se.a.node,showDeleteOption:se.a.bool,onDelete:se.a.func},Nm.defaultProps={extraOptions:null,showDeleteOption:!1,onDelete:()=>{}},km.propTypes={onClick:se.a.func},km.defaultProps={onClick:()=>{}};class _m extends n.a.Component{constructor(){super(...arguments),Cm(this,"deleteWidget",()=>{var e=this.props,t=e.widget,r=e.onDelete;V.a.confirm({title:"Delete Widget",content:"Are you sure you want to remove this widget from the dashboard?",okText:"Delete",okType:"danger",onOk:()=>t.delete().then(r),maskClosable:!0,autoFocusButton:null})})}componentDidMount(){vt("view","widget",this.props.widget.id)}render(){var e=this.props,t=e.className,r=e.children,a=e.header,i=e.footer,s=e.canEdit,o=e.isPublic,l=e.menuOptions,u=e.tileProps,d=!o&&(s||!Object(c.isEmpty)(l));return n.a.createElement("div",{className:"widget-wrapper"},n.a.createElement("div",Pm({className:ge()("tile body-container",t)},u),n.a.createElement("div",{className:"widget-actions"},d&&n.a.createElement(Nm,{extraOptions:l,showDeleteOption:s,onDelete:this.deleteWidget}),s&&n.a.createElement(km,{onClick:this.deleteWidget})),n.a.createElement("div",{className:"body-row widget-header"},a),r,i&&n.a.createElement("div",{className:"body-row tile__bottom-control"},i)))}}Cm(_m,"propTypes",{widget:se.a.object.isRequired,className:se.a.string,children:se.a.node,header:se.a.node,footer:se.a.node,canEdit:se.a.bool,isPublic:se.a.bool,refreshStartedAt:Kn,menuOptions:se.a.node,tileProps:se.a.object,onDelete:se.a.func}),Cm(_m,"defaultProps",{className:"",children:null,header:null,footer:null,canEdit:!1,isPublic:!1,refreshStartedAt:null,menuOptions:null,tileProps:{},onDelete:()=>{}});var Am=_m;function xm(){return(xm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function qm(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Tm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Im(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Im(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Im(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Dm(e){var t=e.widget,r=e.canEditDashboard,a=e.onParametersEdit,i=Y.hasPermission("view_query"),s=r&&!Object(c.isEmpty)(Object(c.invoke)(t,"query.getParametersDefs")),o=t.getQueryResult(),l=!o||!o.isEmpty||o.isEmpty(),u=e=>o.getLink(t.getQuery().id,e),d=e=>o.getName(t.getQuery().name,e);return Object(c.compact)([n.a.createElement(he.a.Item,{key:"download_csv",disabled:l},l?"Download as CSV File":n.a.createElement(S,{href:u("csv"),download:d("csv"),target:"_self"},"Download as CSV File")),n.a.createElement(he.a.Item,{key:"download_tsv",disabled:l},l?"Download as TSV File":n.a.createElement(S,{href:u("tsv"),download:d("tsv"),target:"_self"},"Download as TSV File")),n.a.createElement(he.a.Item,{key:"download_excel",disabled:l},l?"Download as Excel File":n.a.createElement(S,{href:u("xlsx"),download:d("xlsx"),target:"_self"},"Download as Excel File")),(i||s)&&n.a.createElement(he.a.Divider,{key:"divider"}),i&&n.a.createElement(he.a.Item,{key:"view_query"},n.a.createElement(S,{href:t.getQuery().getUrl(!0,t.visualization.id)},"View Query")),s&&n.a.createElement(he.a.Item,{key:"edit_parameters",onClick:a},"Edit Parameters")])}function Rm(e){var t=e.refreshStartedAt;return n.a.createElement("div",{className:"refresh-indicator"},n.a.createElement("div",{className:"refresh-icon"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Refreshing...")),n.a.createElement(pd,{from:t}))}function Mm(e){var t=e.widget,r=e.refreshStartedAt,a=e.parameters,i=e.isEditing,s=e.onParametersUpdate,o=e.onParametersEdit,l=Y.hasPermission("view_query");return n.a.createElement(n.a.Fragment,null,n.a.createElement(Rm,{refreshStartedAt:r}),n.a.createElement("div",{className:"t-header widget clearfix"},n.a.createElement("div",{className:"th-title"},n.a.createElement("p",null,n.a.createElement(yd,{query:t.getQuery(),visualization:t.visualization,readOnly:!l})),!Object(c.isEmpty)(t.getQuery().description)&&n.a.createElement(wc.a,{className:"text-muted markdown query--description"},Ec.markdown.toHTML(t.getQuery().description||"")))),!Object(c.isEmpty)(a)&&n.a.createElement("div",{className:"m-b-10"},n.a.createElement(ud,{parameters:a,sortable:i,appendSortableToParent:!1,onValuesChange:s,onParametersEdit:o})))}function zm(e){var t=e.widget,r=e.isPublic,i=e.onRefresh,s=e.onExpand,o=t.getQueryResult(),l=Object(c.invoke)(o,"getUpdatedAt"),u=Tm(Object(a.useState)(),2),d=u[0],m=u[1],p=e=>{d||(m(e),i().finally(()=>m(null)))};return o?n.a.createElement(n.a.Fragment,null,n.a.createElement("span",null,!r&&!!o&&n.a.createElement(Ee,{className:"refresh-button hidden-print btn btn-sm btn-default btn-transparent",onClick:()=>p(1),"data-test":"RefreshButton"},n.a.createElement("i",{className:ge()("zmdi zmdi-refresh",{"zmdi-hc-spin":1===d}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},1===d?"Refreshing, please wait. ":"Press to refresh. ")," ",n.a.createElement(Jn,{date:l})),n.a.createElement("span",{className:"visible-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",ri(l)),r&&n.a.createElement("span",{className:"small hidden-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",n.a.createElement(Jn,{date:l}))),n.a.createElement("span",null,!r&&n.a.createElement(Ee,{className:"btn btn-sm btn-default hidden-print btn-transparent btn__refresh",onClick:()=>p(2)},n.a.createElement("i",{className:ge()("zmdi zmdi-refresh",{"zmdi-hc-spin":2===d}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},2===d?"Refreshing, please wait.":"Press to refresh.")),n.a.createElement(Ee,{className:"btn btn-sm btn-default hidden-print btn-transparent btn__refresh",onClick:s},n.a.createElement("i",{className:"zmdi zmdi-fullscreen","aria-hidden":"true"})))):null}Rm.propTypes={refreshStartedAt:Kn},Rm.defaultProps={refreshStartedAt:null},Mm.propTypes={widget:se.a.object.isRequired,refreshStartedAt:Kn,parameters:se.a.arrayOf(se.a.object),isEditing:se.a.bool,onParametersUpdate:se.a.func,onParametersEdit:se.a.func},Mm.defaultProps={refreshStartedAt:null,onParametersUpdate:()=>{},onParametersEdit:()=>{},isEditing:!1,parameters:[]},zm.propTypes={widget:se.a.object.isRequired,isPublic:se.a.bool,onRefresh:se.a.func.isRequired,onExpand:se.a.func.isRequired},zm.defaultProps={isPublic:!1};class Fm extends n.a.Component{constructor(e){super(e),qm(this,"onLocalFiltersChange",e=>{this.setState({localFilters:e})}),qm(this,"expandWidget",()=>{Gd.showModal({widget:this.props.widget,filters:this.state.localFilters})}),qm(this,"editParameterMappings",()=>{var e=this.props,t=e.widget,r=e.dashboard,a=e.onRefresh,n=e.onParameterMappingsChange;Sm.showModal({dashboard:r,widget:t}).onClose(e=>{e&&a(),n(),this.setState({localParameters:t.getLocalParameters()})})}),this.state={localParameters:e.widget.getLocalParameters(),localFilters:e.filters}}componentDidMount(){var e=this.props,t=e.widget,r=e.onLoad;vt("view","query",t.visualization.query.id,{dashboard:!0}),vt("view","visualization",t.visualization.id,{dashboard:!0}),r()}renderVisualization(){var e=this.props,t=e.widget,r=e.filters,a=t.getQueryResult();switch(a&&a.getStatus()){case"failed":return n.a.createElement("div",{className:"body-row-auto scrollbox"},a.getError()&&n.a.createElement("div",{className:"alert alert-danger m-5"},"Error running query: ",n.a.createElement("strong",null,a.getError())));case"done":return n.a.createElement("div",{className:"body-row-auto scrollbox"},n.a.createElement(Qd,{visualization:t.visualization,queryResult:a,filters:r,onFiltersChange:this.onLocalFiltersChange,context:"widget"}));default:return n.a.createElement("div",{className:"body-row-auto spinner-container",role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("div",{className:"spinner"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin zmdi-hc-5x","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading...")))}}render(){var e=this.props,t=e.widget,r=e.isLoading,a=e.isPublic,i=e.canEdit,s=e.isEditing,o=e.onRefresh,l=this.state.localParameters,u=t.getQueryResult(),d=r&&!(!u||!u.getStatus());return n.a.createElement(Am,xm({},this.props,{className:"widget-visualization",menuOptions:Dm({widget:t,canEditDashboard:i,onParametersEdit:this.editParameterMappings}),header:n.a.createElement(Mm,{widget:t,refreshStartedAt:d?t.refreshStartedAt:null,parameters:l,isEditing:s,onParametersUpdate:o,onParametersEdit:e=>{var r=Object(c.map)(e,"name");t.options.paramOrder=r,t.save("options",{paramOrder:r})}}),footer:n.a.createElement(zm,{widget:t,isPublic:a,onRefresh:o,onExpand:this.expandWidget}),tileProps:{"data-refreshing":d}}),this.renderVisualization())}}qm(Fm,"propTypes",{widget:se.a.object.isRequired,dashboard:se.a.object.isRequired,filters:Sd,isPublic:se.a.bool,isLoading:se.a.bool,canEdit:se.a.bool,isEditing:se.a.bool,onLoad:se.a.func,onRefresh:se.a.func,onDelete:se.a.func,onParameterMappingsChange:se.a.func}),qm(Fm,"defaultProps",{filters:[],isPublic:!1,isLoading:!1,canEdit:!1,isEditing:!1,onLoad:()=>{},onRefresh:()=>{},onDelete:()=>{},onParameterMappingsChange:()=>{}});var Lm=Fm,Um=["dialog","isNew"];function Vm(){return(Vm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Bm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qm(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Qm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Qm(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Wm(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Hm(e){var t=e.dialog,r=e.isNew,i=Wm(e,Um),s=Bm(Object(a.useState)(Object(c.toString)(i.text)),2),o=s[0],l=s[1],u=Bm(Object(a.useState)(null),2),d=u[0],m=u[1];Object(a.useEffect)(()=>{l(i.text),m(Ec.markdown.toHTML(i.text))},[i.text]);var p=Bm(Object(Fo.a)(()=>{m(Ec.markdown.toHTML(o))},200),1)[0],f=Object(a.useCallback)(e=>{l(e.target.value),p()},[p]),h=Object(a.useCallback)(()=>{t.close(o).catch(()=>{sn.error(r?"Widget could not be added":"Widget could not be saved")})},[t,r,o]),b=Object(a.useCallback)(()=>{var e=i.text;o!==e?V.a.confirm({title:"Quit editing?",content:"Changes you made so far will not be saved. Are you sure?",okText:"Yes, quit",okType:"danger",onOk:()=>t.dismiss(),maskClosable:!0,autoFocusButton:null,style:{top:170}}):t.dismiss()},[t,o,i.text]);return n.a.createElement(V.a,Vm({},t.props,{title:r?"Add Textbox":"Edit Textbox",onOk:h,onCancel:b,okText:r?"Add to Dashboard":"Save",width:500,wrapProps:{"data-test":"TextboxDialog"}}),n.a.createElement("div",{className:"textbox-dialog"},n.a.createElement(He.a.TextArea,{className:"resize-vertical",rows:"5",value:o,"aria-label":"Textbox widget content",onChange:f,autoFocus:!0,placeholder:"This is where you write some text"}),n.a.createElement("small",null,"Supports basic"," ",n.a.createElement(S,{target:"_blank",rel:"noopener noreferrer",href:"https://www.markdownguide.org/cheat-sheet/#basic-syntax"},n.a.createElement(Ne,{title:"Markdown guide opens in new window"},"Markdown")),"."),o&&n.a.createElement(n.a.Fragment,null,n.a.createElement(wo.a,{dashed:!0}),n.a.createElement("strong",{className:"preview-title"},"Preview:"),n.a.createElement(wc.a,{className:"preview markdown"},d))))}Hm.propTypes={dialog:Je.isRequired,isNew:se.a.bool,text:se.a.string},Hm.defaultProps={isNew:!1,text:""};var Gm=Xe(Hm);function Km(){return(Km=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Ym(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $m(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Jm(e){var t=e.widget,r=e.canEdit,i=Ym(Object(a.useState)(t.text),2),s=i[0],o=i[1],l=[n.a.createElement(he.a.Item,{key:"edit",onClick:()=>{Gm.showModal({text:t.text}).onClose(e=>(t.text=e,o(e),t.save()))}},"Edit")];return t.width?n.a.createElement(Am,Km({},e,{menuOptions:r?l:null,className:"widget-text"}),n.a.createElement(wc.a,{className:"body-row-auto scrollbox t-body p-15 markdown"},Ec.markdown.toHTML(s||""))):null}Jm.propTypes={widget:se.a.object.isRequired,canEdit:se.a.bool},Jm.defaultProps={canEdit:!1};var Xm=Jm;function Zm(){return(Zm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var ep=function(e){return n.a.createElement(Am,Zm({},e,{className:"d-flex justify-content-center align-items-center widget-restricted"}),n.a.createElement("div",{className:"t-body scrollbox"},n.a.createElement("div",{className:"text-center"},n.a.createElement("h1",null,n.a.createElement("span",{className:"zmdi zmdi-lock"})),n.a.createElement("p",{className:"text-muted"},"This widget requires access to a data source you don't have access to."))))};function tp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return rp(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rp(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function ap(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var np=[".widget-header",".visualization-renderer",".scrollbox .alert",".spinner-container",".tile__bottom-control"].join(",");class ip{constructor(e){ap(this,"widgets",{}),ap(this,"interval",null),ap(this,"onHeightChange",null),ap(this,"add",e=>{this.isEmpty()&&this.start();var t='[data-widgetid="{0}"]'.replace("{0}",e);this.widgets[e]=[function(){var e=document.querySelector(t);if(e){var r=e.querySelectorAll(np);return Object(c.reduce)(r,(e,t)=>e+(t?t.getBoundingClientRect().height:0),0)}}]}),ap(this,"remove",e=>{this.exists(e)&&(this.widgets[e.toString()]=!1,this.isEmpty()&&this.stop())}),ap(this,"exists",e=>!!this.widgets[e.toString()]),ap(this,"isEmpty",()=>!Object(c.some)(this.widgets)),ap(this,"checkHeightChanges",()=>{Object.keys(this.widgets).filter(this.exists).forEach(e=>{var t=tp(this.widgets[e],2),r=t[0],a=t[1],n=r();n&&n!==a&&(this.widgets[e][1]=n,this.onHeightChange(e,n))})}),ap(this,"start",()=>{this.stop(),this.interval=setInterval(this.checkHeightChanges,200)}),ap(this,"stop",()=>{clearInterval(this.interval)}),ap(this,"resume",()=>{this.isEmpty()||this.start()}),ap(this,"destroy",()=>{this.stop(),this.widgets=null}),this.onHeightChange=e}update(e){var t=e.filter(e=>e.options.position.autoHeight).map(e=>e.id.toString());t.filter(e=>!Object(c.includes)(Object.keys(this.widgets),e)).forEach(this.add),Object.keys(this.widgets).filter(e=>!Object(c.includes)(t,e)).forEach(this.remove)}}r(2470);function sp(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var op=Object(Oc.WidthProvider)(Oc.Responsive),lp=se.a.shape({id:se.a.number.isRequired,options:se.a.shape({position:se.a.shape({col:se.a.number.isRequired,row:se.a.number.isRequired,sizeY:se.a.number.isRequired,minSizeY:se.a.number.isRequired,maxSizeY:se.a.number.isRequired,sizeX:se.a.number.isRequired,minSizeX:se.a.number.isRequired,maxSizeX:se.a.number.isRequired}).isRequired}).isRequired}),cp="single-column",up="multi-column",dp=n.a.memo((function(e){var t=e.widget,r=e.dashboard,a=e.onLoadWidget,i=e.onRefreshWidget,s=e.onRemoveWidget,o=e.onParameterMappingsChange,l=e.isEditing,c=e.canEdit,u=e.isPublic,d=e.isLoading,m=e.filters,p=t.type,f=()=>s(t.id);return p===Dr?n.a.createElement(Lm,{widget:t,dashboard:r,filters:m,isEditing:l,canEdit:c,isPublic:u,isLoading:d,onLoad:()=>a(t),onRefresh:()=>i(t),onDelete:f,onParameterMappingsChange:o}):p===Ir?n.a.createElement(Xm,{widget:t,canEdit:c,isPublic:u,onDelete:f}):n.a.createElement(ep,{widget:t})}),(e,t)=>e.widget===t.widget&&e.canEdit===t.canEdit&&e.isPublic===t.isPublic&&e.isLoading===t.isLoading&&e.filters===t.filters&&e.isEditing===t.isEditing);class mp extends n.a.Component{static normalizeFrom(e){var t=e.id,r=e.options.position;return{i:t.toString(),x:r.col,y:r.row,w:r.sizeX,h:r.sizeY,minW:r.minSizeX,maxW:r.maxSizeX,minH:r.minSizeY,maxH:r.maxSizeY}}constructor(e){super(e),sp(this,"mode",null),sp(this,"autoHeightCtrl",null),sp(this,"onLayoutChange",(e,t)=>{if(t[up]&&this.setState({layouts:t}),this.mode=document.body.offsetWidth<=wt?cp:up,this.mode!==cp){var r=Object(c.chain)(t[up]).keyBy("i").mapValues(this.normalizeTo).value();this.props.onLayoutChange(r)}}),sp(this,"onBreakpointChange",e=>{this.mode=e,this.props.onBreakpointChange(e===cp)}),sp(this,"onWidgetHeightUpdated",(e,t)=>{this.setState(r=>{var a=r.layouts,n=Object(c.cloneDeep)(a[up]),i=Object(c.find)(n,{i:e.toString()});return i&&(i.h=Math.ceil((t+jt)/Et)),{layouts:{[up]:n}}})}),sp(this,"onWidgetResize",(e,t,r)=>{t.h!==r.h&&this.autoHeightCtrl.remove(Number(r.i)),this.autoHeightCtrl.resume()}),sp(this,"normalizeTo",e=>({col:e.x,row:e.y,sizeX:e.w,sizeY:e.h,autoHeight:this.autoHeightCtrl.exists(e.i)})),this.state={layouts:{},disableAnimations:!0},this.autoHeightCtrl=new ip(this.onWidgetHeightUpdated),this.autoHeightCtrl.update(this.props.widgets)}componentDidMount(){this.onBreakpointChange(document.body.offsetWidth<=wt?cp:up),setTimeout(()=>{this.setState({disableAnimations:!1})},50)}componentDidUpdate(){this.autoHeightCtrl.update(this.props.widgets)}componentWillUnmount(){this.autoHeightCtrl.destroy()}render(){var e=this.props,t=e.onLoadWidget,r=e.onRefreshWidget,a=e.onRemoveWidget,i=e.onParameterMappingsChange,s=e.filters,o=e.dashboard,l=e.isPublic,c=e.isEditing,u=e.widgets,d=ge()("dashboard-wrapper",c?"editing-mode":"preview-mode");return n.a.createElement("div",{className:d},n.a.createElement(op,{draggableCancel:"input,.sortable-container",className:ge()("layout",{"disable-animations":this.state.disableAnimations}),cols:{[up]:Ot,[cp]:1},rowHeight:Et-jt,margin:[jt,jt],isDraggable:c,isResizable:c,onResizeStart:this.autoHeightCtrl.stop,onResizeStop:this.onWidgetResize,layouts:this.state.layouts,onLayoutChange:this.onLayoutChange,onBreakpointChange:this.onBreakpointChange,breakpoints:{[up]:wt,[cp]:0}},u.map(e=>n.a.createElement("div",{key:e.id,"data-grid":mp.normalizeFrom(e),"data-widgetid":e.id,"data-test":"WidgetId".concat(e.id),className:ge()("dashboard-widget-wrapper",{"widget-auto-height-enabled":this.autoHeightCtrl.exists(e.id)})},n.a.createElement(dp,{dashboard:o,widget:e,filters:s,isPublic:l,isLoading:e.loading,isEditing:c,canEdit:o.canEdit(),onLoadWidget:t,onRefreshWidget:r,onRemoveWidget:a,onParameterMappingsChange:i})))))}}sp(mp,"propTypes",{isEditing:se.a.bool.isRequired,isPublic:se.a.bool,dashboard:se.a.object.isRequired,widgets:se.a.arrayOf(lp).isRequired,filters:Sd,onBreakpointChange:se.a.func,onLoadWidget:se.a.func,onRefreshWidget:se.a.func,onRemoveWidget:se.a.func,onLayoutChange:se.a.func,onParameterMappingsChange:se.a.func}),sp(mp,"defaultProps",{isPublic:!1,filters:[],onLoadWidget:()=>{},onRefreshWidget:()=>{},onRemoveWidget:()=>{},onLayoutChange:()=>{},onBreakpointChange:()=>{},onParameterMappingsChange:()=>{}});var pp=mp,fp=new Map;function hp(){fp.size>0&&(fp.forEach((e,t)=>{var r=t.getBoundingClientRect(),a=Math.round(10*r.width),n=Math.round(10*r.height);e.width===a&&e.height===n||(e.width=a,e.height=n,e.callback(t))}),setTimeout(hp,100))}function bp(e,t){if(e&&!fp.has(e)){var r=0===fp.size;return fp.set(e,{callback:t}),r&&hp(),()=>fp.delete(e)}return()=>{}}function gp(){return(gp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function yp(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function vp(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yp(Object(r),!0).forEach((function(t){Op(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yp(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Op(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ep(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return jp(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jp(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function wp(e){var t=e.query,r=e.visualization,i=e.onChange,s=Object(a.useMemo)(()=>t?Object(c.groupBy)(t.visualizations,"type"):{},[t]),o=qe("visualization-select"),l=Object(a.useCallback)(e=>{var r=t?Object(c.find)(t.visualizations,{id:e}):null;i(r||null)},[t,i]);return t?n.a.createElement("div",null,n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:o},"Choose Visualization"),n.a.createElement(Qi.a,{id:o,className:"w-100",value:r?r.id:void 0,onChange:l},Object(c.map)(s,(e,t)=>n.a.createElement(Qi.a.OptGroup,{key:t,label:t},Object(c.map)(e,e=>n.a.createElement(Qi.a.Option,{key:"".concat(e.id),value:e.id},e.name))))))):null}function Sp(e){var t=e.dialog,r=e.dashboard,i=Ep(Object(a.useState)(null),2),s=i[0],o=i[1],l=Ep(Object(a.useState)(null),2),u=l[0],d=l[1],m=Ep(Object(a.useState)([]),2),p=m[0],f=m[1],h=Object(a.useCallback)(e=>{o(null),d(null),f([]),e&&ir.get({id:e}).then(e=>{if(e){var t=Object(c.map)(r.getParametersDefs(),e=>e.name);o(e),f(Object(c.map)(e.getParametersDefs(),e=>({name:e.name,type:Object(c.includes)(t,e.name)?dm:um,mapTo:e.name,value:e.normalizedValue,title:"",param:e}))),e.visualizations.length>0&&d(Object(c.first)(e.visualizations))}})},[r]),b=Object(a.useCallback)(()=>{t.close({visualization:u,parameterMappings:p}).catch(()=>{sn.error("Widget could not be added")})},[t,u,p]),g=r.getParametersDefs(),y=qe("parameter-mappings");return n.a.createElement(V.a,gp({},t.props,{title:"Add Widget",onOk:b,okButtonProps:vp(vp({},t.props.okButtonProps),{},{disabled:!s||t.props.okButtonProps.disabled}),okText:"Add to Dashboard",width:700}),n.a.createElement("div",{"data-test":"AddWidgetDialog"},n.a.createElement(Go,{onChange:e=>h(e?e.id:null)}),s&&n.a.createElement(wp,{query:s,visualization:u,onChange:d}),p.length>0&&[n.a.createElement("label",{key:"parameters-title",htmlFor:y},"Parameters"),n.a.createElement(vm,{key:"parameters-list",id:y,mappings:p,existingParams:g,onChange:f})]))}wp.propTypes={query:se.a.object,visualization:se.a.object,onChange:se.a.func},wp.defaultProps={query:null,visualization:null,onChange:()=>{}},Sp.propTypes={dialog:Je.isRequired,dashboard:se.a.object.isRequired};var Pp=Xe(Sp),Cp=["imageUrl","roundedImage","title","body","children","className"],Np=["user","withLink","children"],kp=["dataSource","withLink","children"];function _p(){return(_p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Ap(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function xp(e){var t=e.imageUrl,r=e.roundedImage,a=e.title,i=e.body,s=e.children,o=e.className,l=Ap(e,Cp);return n.a.createElement("div",_p({},l,{className:o+" w-100 d-flex align-items-center"}),n.a.createElement("img",{src:t,width:"32",height:"32",className:ge()({"profile__image--settings":r},"m-r-5"),alt:"Logo/Avatar"}),n.a.createElement("div",{className:"flex-fill"},n.a.createElement("div",null,a),i&&n.a.createElement("div",{className:"text-muted"},i)),s)}function qp(e){var t=e.user,r=e.withLink,a=e.children,i=Ap(e,Np),s=r?n.a.createElement(S,{href:"users/"+t.id},t.name):t.name;return n.a.createElement(xp,_p({},i,{imageUrl:t.profile_image_url,title:s,body:t.email}),a)}function Tp(e){var t=e.dataSource,r=e.withLink,a=e.children,i=Ap(e,kp),s="static/images/db-logos/".concat(t.type,".png"),o=r?n.a.createElement(S,{href:"data_sources/"+t.id},t.name):t.name;return n.a.createElement(xp,_p({},i,{imageUrl:s,title:o}),a)}xp.propTypes={imageUrl:se.a.string.isRequired,title:se.a.node.isRequired,body:se.a.node,roundedImage:se.a.bool,className:se.a.string,children:se.a.node},xp.defaultProps={body:null,roundedImage:!0,className:"",children:null},qp.propTypes={user:se.a.shape({profile_image_url:se.a.string.isRequired,name:se.a.string.isRequired,email:se.a.string.isRequired}).isRequired,withLink:se.a.bool,children:se.a.node},qp.defaultProps={withLink:!1,children:null},Tp.propTypes={dataSource:se.a.shape({name:se.a.string.isRequired,type:se.a.string.isRequired}).isRequired,withLink:se.a.bool,children:se.a.node},Tp.defaultProps={withLink:!1,children:null};var Ip=r(344),Dp=r.n(Ip);Dp.a.setConfig({ADD_ATTR:["target"]}),Dp.a.addHook("afterSanitizeAttributes",(function(e){var t=e.getAttribute("target");Object(c.isString)(t)&&"_blank"===t.toLowerCase()?e.setAttribute("rel","noopener noreferrer"):e.removeAttribute("target")}));var Rp=Dp.a.sanitize;function Mp(e){return Object(c.find)([Object(c.get)(e,"response.data.message"),Object(c.get)(e,"response.statusText"),"Unknown error"],c.isString)}function zp(e){return"api/users/".concat(e.id,"/disable")}var Fp={query:e=>K.get("api/users",{params:e}),get:e=>{var t=e.id;return K.get("api/users/".concat(t))},create:e=>K.post("api/users",e),save:e=>K.post("api/users/".concat(e.id),e),enableUser:function(e){var t=Rp(e.name);return K.delete(zp(e)).then(r=>(sn.success("User ".concat(t," is now enabled.")),e.is_disabled=!1,e.profile_image_url=r.profile_image_url,r)).catch(e=>{sn.error("Cannot enable user",Mp(e))})},disableUser:function(e){var t=Rp(e.name);return K.post(zp(e)).then(r=>(sn.warning("User ".concat(t," is now disabled.")),e.is_disabled=!0,e.profile_image_url=r.profile_image_url,r)).catch(e=>{sn.error("Cannot disable user",Mp(e))})},deleteUser:function(e){var t=Rp(e.name);return K.delete("api/users/".concat(e.id)).then(e=>(sn.warning("User ".concat(t," has been deleted.")),e)).catch(e=>{sn.error("Cannot delete user",Mp(e))})},convertUserInfo:function(e){return{id:e.id,name:e.name,email:e.email,profileImageUrl:e.profile_image_url,apiKey:e.api_key,groupIds:e.groups,isDisabled:e.is_disabled,isInvitationPending:e.is_invitation_pending}},regenerateApiKey:function(e){return K.post("api/users/".concat(e.id,"/regenerate_api_key")).then(e=>(sn.success("The API Key has been updated."),e.api_key)).catch(e=>{sn.error("Failed regenerating API Key",Mp(e))})},sendPasswordReset:function(e){return K.post("api/users/".concat(e.id,"/reset_password")).then(e=>{if($.mailSettingsMissing)return sn.warning("The mail server is not configured."),e.reset_link;sn.success("Password reset email sent.")}).catch(e=>{sn.error("Failed to send password reset email",Mp(e))})},resendInvitation:function(e){return K.post("api/users/".concat(e.id,"/invite")).then(e=>{if($.mailSettingsMissing)return sn.warning("The mail server is not configured."),e.invite_link;sn.success("Invitation sent.")}).catch(e=>{sn.error("Failed to resend invitation",Mp(e))})}};function Lp(){return(Lp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Up(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Vp(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vp(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var Bp=Qi.a.Option;function Qp(e){var t=e.context;return n.a.createElement(n.a.Fragment,null,"Manage Permissions",n.a.createElement("div",{className:"modal-header-desc"},"Editing this ".concat(t," is enabled for the users in this list and for admins. "),n.a.createElement(Qe,{type:"MANAGE_PERMISSIONS"})))}function Wp(e){var t=e.onSelect,r=e.shouldShowUser,i=Up(Object(a.useState)(!0),2),s=i[0],o=i[1],l=Up(Object(a.useState)([]),2),u=l[0],d=l[1],m=Up(Object(a.useState)(""),2),p=m[0],f=m[1],h=Object(a.useCallback)(Object(c.debounce)(e=>(e=>Fp.query({q:e}).then(e=>e.results).catch(()=>[]))(e).then(d).finally(()=>o(!1)),200),[]);return Object(a.useEffect)(()=>{o(!0),h(p)},[h,p]),n.a.createElement(Qi.a,{className:"w-100 m-b-10",placeholder:"Add users...",showSearch:!0,onSearch:f,suffixIcon:s?n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading...")):n.a.createElement("i",{className:"fa fa-search","aria-hidden":"true"}),filterOption:!1,notFoundContent:null,value:void 0,getPopupContainer:e=>e.parentNode,onSelect:t},u.filter(r).map(e=>n.a.createElement(Bp,{key:e.id,value:e.id},n.a.createElement(qp,{user:e}))))}function Hp(e){var t,r=e.dialog,i=e.author,s=e.context,o=e.aclUrl,l=Up(Object(a.useState)(!0),2),u=l[0],d=l[1],m=Up(Object(a.useState)([]),2),p=m[0],f=m[1],b=(t=o,{loadGrantees:Object(a.useCallback)(()=>K.get(t).then(e=>{var t=[];return Object(c.each)(e,(e,r)=>{e.forEach(e=>{e.accessType=li(r),t.push(e)})}),t}),[t]),addPermission:Object(a.useCallback)((function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modify";return K.post(t,{access_type:r,user_id:e}).catch(()=>sn.error("Could not grant permission to the user"))}),[t]),removePermission:Object(a.useCallback)((function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"modify";return K.delete(t,{data:{access_type:r,user_id:e}}).catch(()=>sn.error("Could not remove permission from the user"))}),[t])}),g=b.loadGrantees,y=b.addPermission,v=b.removePermission,O=Object(a.useCallback)(()=>{d(!0),g().then(f).catch(()=>sn.error("Failed to load grantees list")).finally(()=>d(!1))},[g]),E=Object(a.useCallback)(e=>e.id===i.id||!!Object(c.get)(Object(c.find)(p,{id:e.id}),"accessType"),[i.id,p]);return Object(a.useEffect)(()=>{O()},[o,O]),n.a.createElement(V.a,Lp({},r.props,{className:"permissions-editor-dialog",title:n.a.createElement(Qp,{context:s}),footer:n.a.createElement(h.a,{onClick:r.dismiss},"Close")}),n.a.createElement(Wp,{onSelect:e=>y(e).then(O),shouldShowUser:e=>!E(e)}),n.a.createElement("div",{className:"d-flex align-items-center m-t-5"},n.a.createElement("h5",{className:"flex-fill"},"Users with permissions"),u&&n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading..."))),n.a.createElement("div",{className:"scrollbox p-5",style:{maxHeight:"40vh"}},n.a.createElement(Gs.a,{size:"small",dataSource:[i,...p],renderItem:e=>n.a.createElement(Gs.a.Item,null,n.a.createElement(qp,{key:e.id,user:e},e.id===i.id?n.a.createElement(Jd.a,{className:"m-0"},"Author"):n.a.createElement(Ne,{title:"Remove user permissions"},n.a.createElement(Ee,{"aria-label":"Remove permissions",onClick:()=>v(e.id).then(O)},n.a.createElement("i",{className:"fa fa-remove clickable","aria-hidden":"true"})))))})))}Qp.propTypes={context:se.a.oneOf(["query","dashboard"])},Qp.defaultProps={context:"query"},Wp.propTypes={onSelect:se.a.func,shouldShowUser:se.a.func},Wp.defaultProps={onSelect:()=>{},shouldShowUser:()=>!0},Hp.propTypes={dialog:Je.isRequired,author:se.a.object.isRequired,context:se.a.oneOf(["query","dashboard"]),aclUrl:se.a.string.isRequired},Hp.defaultProps={context:"query"};var Gp=Xe(Hp),Kp=r(339),Yp=r.n(Kp);function $p(){return($p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Jp(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Xp extends n.a.Component{constructor(e){super(e),Jp(this,"copy",()=>{this.ref.current.select();try{if(!document.execCommand("copy"))throw new Error;this.setState({copied:"Copied!"})}catch(e){this.setState({copied:"Copy failed"})}this.resetCopyState=setTimeout(()=>this.setState({copied:null}),2e3)}),this.state={copied:null},this.ref=n.a.createRef(),this.copyFeatureSupported=document.queryCommandSupported("copy"),this.resetCopyState=null}componentWillUnmount(){this.resetCopyState&&clearTimeout(this.resetCopyState)}render(){var e=n.a.createElement(Ne,{title:this.state.copied||"Copy"},n.a.createElement(Ee,{onClick:this.copy},n.a.createElement(Yp.a,null)));return n.a.createElement(He.a,$p({},this.props,{ref:this.ref,addonAfter:this.copyFeatureSupported&&e}))}}function Zp(){return(Zp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function ef(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class tf extends n.a.Component{constructor(e){super(e),ef(this,"formItemProps",{labelCol:{span:8},wrapperCol:{span:16},style:{marginBottom:7}}),ef(this,"enableAccess",()=>{var e=this.props.dashboard;this.setState({saving:!0}),K.post(this.apiUrl).then(t=>{e.publicAccessEnabled=!0,e.public_url=t.public_url}).catch(()=>{sn.error("Failed to turn on sharing for this dashboard")}).finally(()=>{this.setState({saving:!1})})}),ef(this,"disableAccess",()=>{var e=this.props.dashboard;this.setState({saving:!0}),K.delete(this.apiUrl).then(()=>{e.publicAccessEnabled=!1,delete e.public_url}).catch(()=>{sn.error("Failed to turn off sharing for this dashboard")}).finally(()=>{this.setState({saving:!1})})}),ef(this,"onChange",e=>{e?this.enableAccess():this.disableAccess()});var t=this.props.dashboard;this.state={saving:!1},this.apiUrl=Object(c.replace)("api/dashboards/{id}/share","{id}",t.id),this.enabled=this.props.hasOnlySafeQueries||t.publicAccessEnabled}static get headerContent(){return n.a.createElement(n.a.Fragment,null,"Share Dashboard",n.a.createElement("div",{className:"modal-header-desc"},"Allow public access to this dashboard with a secret address. ",n.a.createElement(Qe,{type:"SHARE_DASHBOARD"})))}render(){var e=this.props,t=e.dialog,r=e.dashboard,a=e.hasOnlySafeQueries,i=this.constructor.headerContent;return n.a.createElement(V.a,Zp({},t.props,{title:i,footer:null}),n.a.createElement(yo.a,{layout:"horizontal"},!a&&n.a.createElement(yo.a.Item,null,n.a.createElement(p.a,{message:"For your security, sharing is currently not supported for dashboards containing queries with text parameters. Consider changing the text parameters in your query to a different type.",type:"error"})),n.a.createElement(yo.a.Item,Zp({label:"Allow public access"},this.formItemProps),n.a.createElement(Fi.a,{checked:r.publicAccessEnabled,onChange:this.onChange,loading:this.state.saving,disabled:!this.enabled,"data-test":"PublicAccessEnabled"})),r.public_url&&n.a.createElement(yo.a.Item,Zp({label:"Secret address"},this.formItemProps),n.a.createElement(Xp,{value:r.public_url,"data-test":"SecretAddress"}))))}}ef(tf,"propTypes",{dashboard:se.a.object.isRequired,hasOnlySafeQueries:se.a.bool.isRequired,dialog:Je.isRequired});var rf=Xe(tf);function af(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return nf(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nf(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function sf(){var e=af(Object(a.useState)(Object(c.has)(R.search,"fullscreen")),2),t=e[0],r=e[1];Object(a.useEffect)(()=>{document.body.classList.toggle("headless",t),R.setSearch({fullscreen:!!t||null},!0)},[t]);return[t,()=>r(!t)]}function of(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lf(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lf(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function cf(e){var t=ae.getDashboardRefreshIntervals();return Object(c.max)([30,Object(c.min)(t),e])}function uf(e){var t=of(Object(a.useState)(function(){var e=parseFloat(R.search.refresh);return Object(c.isNaN)(e)?null:cf(e)}()),2),r=t[0],n=t[1],i=_d(e);return Object(a.useEffect)(()=>{if(R.setSearch({refresh:r||null},!0),r){var e=setInterval(i,1e3*r);return()=>clearInterval(e)}},[r,i]),Object(a.useMemo)(()=>[r,e=>n(cf(e)),()=>n(null)],[r])}function df(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return mf(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mf(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var pf="saved",ff="saving",hf="saving_failed";function bf(e,t){var r=df(Object(a.useState)(e&&Object(c.has)(R.search,"edit")),2),n=r[0],i=r[1],s=df(Object(a.useState)(pf),2),o=s[0],l=s[1],u=df(Object(a.useState)([]),2),d=u[0],m=u[1],p=df(Object(a.useState)(!1),2),f=p[0],h=p[1];Object(a.useEffect)(()=>{R.setSearch({edit:!!n||null},!0)},[n]),Object(a.useEffect)(()=>{f&&o===pf&&(h(!1),i(!1))},[f,o]);var b=Object(a.useCallback)(r=>{if(e){var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(c.pickBy)(t,(t,r)=>{var a=Object(c.find)(e,{id:Number(r)}).options.position;return!Object(c.isMatch)(a,t)})}(t,r);l(ff),m(r);var n=Object(c.map)(a,(e,r)=>{var a=Object(c.find)(t,{id:Number(r)});return a?a.save("options",{position:e}):Promise.resolve()});return Promise.all(n).then(()=>l(pf)).catch(()=>{l(hf),sn.error("Error saving changes.")})}l(pf)},[e,t]),g=Object(a.useCallback)((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return l(ff),Object(c.debounce)(()=>b(...t),2e3)()}),[b]),y=Object(a.useCallback)(()=>b(d),[d,b]),v=Object(a.useCallback)(t=>{t||o===pf?i(e&&t):h(!0)},[o,e]);return{editingLayout:e&&n,setEditingLayout:v,saveDashboardLayout:n?g:b,retrySaveDashboardLayout:y,doneBtnClickedWhileSaving:f,dashboardStatus:o}}var gf=r(284),yf=r.n(gf);function vf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Of(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Of(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Of(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Ef(e){var t=vf(Object(a.useState)(!1),2),r=t[0],n=t[1],i=Object(a.useCallback)(()=>{var t="duplicatedDashboardTab/".concat(Math.random().toString()),r=window.open("",t);n(!0),$r.fork({id:e.id}).then(e=>{r.location=function(e){var t=A.a.parse(window.location.search);e=yf.a.parse(e);var r=A.a.parse(e.search);return yf.a.format(Object(c.extend)(Object(c.pick)(e,["protocol","auth","host","pathname"]),{search:A.a.stringify(Object(c.extend)(t,r))}))}(e.getUrl())}).finally(()=>{n(!1)})},[e.id]);return[r,r?c.noop:i]}function jf(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function wf(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jf(Object(r),!0).forEach((function(t){Sf(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jf(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Sf(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Cf(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Cf(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Nf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(c.isEmpty)(t)?e:e.filter(e=>Object.values(e.getParameterMappings()).filter(e=>"dashboard-level"===e.type).some(e=>{var r=e.mapTo;return Object(c.includes)(t.map(e=>e.name),r)}))}var kf=function(e){var t=Pf(Object(a.useState)(e),2),r=t[0],n=t[1],i=Pf(Object(a.useState)([]),2),s=i[0],o=i[1],l=Pf(Object(a.useState)(!1),2),u=l[0],d=l[1],m=Pf(Object(a.useState)(!1),2),p=m[0],f=m[1],h=Object(a.useMemo)(()=>r.getParametersDefs(),[r]),b=!r.is_archived&&ae.canEdit(r),g=Object(a.useMemo)(()=>!r.is_archived&&Object(c.has)(r,"user.id")&&(Y.id===r.user.id||Y.isAdmin),[r]),y=Object(a.useMemo)(()=>Object(c.every)(r.widgets,e=>!e.getQuery()||e.getQuery().is_safe),[r]),v=Pf(Ef(r),2),O=v[0],E=v[1],j=Object(a.useCallback)(()=>{var e="api/dashboards/".concat(r.id,"/acl");Gp.showModal({aclUrl:e,context:"dashboard",author:r.user})},[r]),w=Object(a.useCallback)((function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return n(t=>Object(c.extend)({},t,e)),e=wf(wf({},e),{},{id:r.id}),t&&(e=wf(wf({},e),{},{version:r.version})),$r.save(e).then(t=>{n(r=>Object(c.extend)({},r,Object(c.pick)(t,Object(c.keys)(e)))),Object(c.has)(e,"name")&&R.setPath(tt.parse(t.url).pathname,!0)}).catch(e=>{var t=Object(c.get)(e,"response.status");403===t?sn.error("Dashboard update failed","Permission Denied."):409===t&&sn.error("It seems like the dashboard has been modified by another user. ","Please copy/backup your changes and reload this page.",{duration:null})})}),[r]),S=Object(a.useCallback)(()=>{vt("toggle_published","dashboard",r.id),w({is_draft:!r.is_draft},!1)},[r,w]),P=Object(a.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.getParametersDefs(),n(e=>Object(c.extend)({},e)),e.load(t).catch(e=>{if(!(e instanceof or))return Promise.reject(e)}).finally(()=>n(e=>Object(c.extend)({},e)))}),[]),C=Object(a.useCallback)(e=>P(e,!0),[P]),N=Object(a.useCallback)(e=>{n(t=>Object(c.extend)({},t,{widgets:t.widgets.filter(t=>void 0!==t.id&&t.id!==e)}))},[]),k=Object(a.useRef)();k.current=r;var _=Object(a.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=Nf(k.current.widgets,t),a=Object(c.compact)(r.map(t=>P(t,e).catch(e=>e)));return Promise.all(a).then(()=>{var e=Object(c.compact)(Object(c.map)(k.current.widgets,e=>e.getQueryResult())),t=Gr(k.current,e,R.search);o(t)})}),[P]),A=Object(a.useCallback)(e=>{u||(d(!0),_(!0,e).finally(()=>d(!1)))},[u,_]),x=Object(a.useCallback)(()=>{vt("archive","dashboard",r.id),$r.delete(r).then(e=>n(t=>Object(c.extend)({},t,Object(c.pick)(e,["is_archived"]))))},[r]),q=Object(a.useCallback)(()=>{var e=()=>n(e=>Object(c.extend)({},e));rf.showModal({dashboard:r,hasOnlySafeQueries:y}).onClose(e).onDismiss(e)},[r,y]),T=Object(a.useCallback)(()=>{Gm.showModal({isNew:!0}).onClose(e=>r.addWidget(e).then(()=>n(e=>Object(c.extend)({},e))))},[r]),I=Object(a.useCallback)(()=>{Pp.showModal({dashboard:r}).onClose(e=>{var t=e.visualization,a=e.parameterMappings;return r.addWidget(t,{parameterMappings:fm(a)}).then(e=>{var t=[e,...hm(e.options.parameterMappings,r.widgets)];return Promise.all(t.map(e=>e.save())).then(()=>n(e=>Object(c.extend)({},e)))})})},[r]),D=Pf(uf(A),3),M=D[0],z=D[1],F=D[2],L=Pf(sf(),2),U=L[0],V=L[1],B=bf(!p&&b,r.widgets);return Object(a.useEffect)(()=>{n(e),_()},[e]),Object(a.useEffect)(()=>{document.title=r.name},[r.name]),Object(a.useEffect)(()=>{_()},[r.dashboard_filters_enabled]),wf(wf({dashboard:r,globalParameters:h,refreshing:u,filters:s,setFilters:o,loadDashboard:_,refreshDashboard:A,updateDashboard:w,togglePublished:S,archiveDashboard:x,loadWidget:P,refreshWidget:C,removeWidget:N,canEditDashboard:b,isDashboardOwnerOrAdmin:g,refreshRate:M,setRefreshRate:z,disableRefreshRate:F},B),{},{gridDisabled:p,setGridDisabled:f,fullscreen:U,toggleFullscreen:V,showShareDashboardDialog:q,showAddTextboxDialog:T,showAddWidgetDialog:I,managePermissions:j,isDuplicating:O,duplicateDashboard:E})};function _f(){return(_f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Af(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class xf extends n.a.Component{constructor(e){super(e),Af(this,"startEditing",()=>{this.props.isEditable&&this.setState({editing:!0})}),Af(this,"stopEditing",e=>{var t=Object(c.trim)(e);this.props.ignoreBlanks&&""===t||t===this.props.value||this.props.onDone(t),this.setState({editing:!1})}),Af(this,"handleKeyDown",e=>{13!==e.keyCode||e.shiftKey?27===e.keyCode&&this.setState({editing:!1}):(e.preventDefault(),this.stopEditing(e.target.value))}),Af(this,"renderNormal",()=>this.props.value?n.a.createElement("span",{role:"presentation",onFocus:this.startEditing,onClick:this.startEditing,className:this.props.isEditable?"editable":""},this.props.value):n.a.createElement("a",{className:"clickable",onClick:this.startEditing},this.props.placeholder)),Af(this,"renderEdit",()=>{var e=this.props,t=e.multiline,r=e.value,a=e.editorProps,i=t?He.a.TextArea:He.a;return n.a.createElement(i,_f({defaultValue:r,"aria-label":"Editing",onBlur:e=>this.stopEditing(e.target.value),onKeyDown:this.handleKeyDown,autoFocus:!0},a))}),this.state={editing:e.defaultEditing}}componentDidUpdate(e,t){!this.state.editing&&t.editing&&this.props.onStopEditing()}render(){return n.a.createElement("span",{className:ge()("edit-in-place",{active:this.state.editing},this.props.className)},this.state.editing?this.renderEdit():this.renderNormal())}}function qf(){return Fl("api/dashboards/tags").then(e=>Object(c.map)(e,e=>e.name))}function Tf(e){return e?"primary":"default"}function If(e){var t=e.dashboardConfiguration,r=t.dashboard,a=t.canEditDashboard,i=t.updateDashboard,s=t.editingLayout;return n.a.createElement("div",{className:"title-with-tags"},n.a.createElement("div",{className:"page-title"},n.a.createElement(zn,{item:r}),n.a.createElement("h3",null,n.a.createElement(xf,{isEditable:s,onDone:e=>i({name:e}),value:r.name,ignoreBlanks:!0})),n.a.createElement(Ne,{title:r.user.name,placement:"bottom"},n.a.createElement("img",{src:r.user.profile_image_url,className:"profile-image",alt:r.user.name}))),n.a.createElement(rs,{tags:r.tags,isDraft:r.is_draft,isArchived:r.is_archived,canEdit:a,getAvailableTags:qf,onEdit:e=>i({tags:e})}))}function Df(e){var t=e.dashboardConfiguration,r=t.refreshRate,a=t.setRefreshRate,i=t.disableRefreshRate,s=t.refreshing,o=t.refreshDashboard,l=ae.getDashboardRefreshIntervals(),u=$.dashboardRefreshIntervals;return n.a.createElement(h.a.Group,null,n.a.createElement(Ne,{title:r?"Auto Refreshing every ".concat(oi(r)):null},n.a.createElement(h.a,{type:Tf(r),onClick:()=>o()},n.a.createElement("i",{className:ge()("zmdi zmdi-refresh m-r-5",{"zmdi-hc-spin":s}),"aria-hidden":"true"}),r?oi(r):"Refresh")),n.a.createElement(Da.a,{trigger:["click"],placement:"bottomRight",overlay:n.a.createElement(he.a,{onClick:e=>{var t=e.key,r=parseFloat(t);r?(a(r),o()):i()},selectedKeys:["".concat(r)]},u.map(e=>n.a.createElement(he.a.Item,{key:"".concat(e),disabled:!Object(c.includes)(l,e)},oi(e))),r&&n.a.createElement(he.a.Item,{key:null},"Disable auto refresh"))},n.a.createElement(h.a,{className:"icon-button hidden-xs",type:Tf(r)},n.a.createElement("i",{className:"fa fa-angle-down","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Split button!"))))}function Rf(e){var t=e.dashboardConfiguration,r=t.dashboard,a=t.setEditingLayout,i=t.togglePublished,s=t.archiveDashboard,o=t.managePermissions,l=t.gridDisabled,c=t.isDashboardOwnerOrAdmin,u=t.isDuplicating,d=t.duplicateDashboard;return n.a.createElement(Da.a,{trigger:["click"],placement:"bottomRight",overlay:n.a.createElement(he.a,{"data-test":"DashboardMoreButtonMenu"},n.a.createElement(he.a.Item,{className:ge()({hidden:l})},n.a.createElement(Ee,{onClick:()=>a(!0)},"Edit")),!u&&r.canEdit()&&n.a.createElement(he.a.Item,null,n.a.createElement(Ee,{onClick:d},"Fork ",n.a.createElement("i",{className:"fa fa-external-link m-l-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)"))),$.showPermissionsControl&&c&&n.a.createElement(he.a.Item,null,n.a.createElement(Ee,{onClick:o},"Manage Permissions")),!$.disablePublish&&!r.is_draft&&n.a.createElement(he.a.Item,null,n.a.createElement(Ee,{onClick:i},"Unpublish")),n.a.createElement(he.a.Item,null,n.a.createElement(Ee,{onClick:()=>{V.a.confirm({title:"Archive Dashboard",content:'Are you sure you want to archive the "'.concat(r.name,'" dashboard?'),okText:"Archive",okType:"danger",onOk:s,maskClosable:!0,autoFocusButton:null})}},"Archive")))},n.a.createElement(h.a,{className:"icon-button m-l-5","data-test":"DashboardMoreButton","aria-label":"More actions"},n.a.createElement(po.a,{rotate:90,"aria-hidden":"true"})))}function Mf(e){var t=e.dashboardConfiguration,r=e.headerExtra,a=t.dashboard,i=t.togglePublished,s=t.canEditDashboard,o=t.fullscreen,l=t.toggleFullscreen,c=t.showShareDashboardDialog,u=t.updateDashboard,d=a.is_draft,m=!a.is_draft,p=s&&!a.is_draft,f=!$.disablePublicUrls&&(a.publicAccessEnabled||p),b=s;return n.a.createElement("div",{className:"dashboard-control"},a.can_edit&&a.is_archived&&n.a.createElement(h.a,{onClick:()=>{vt("unarchive","dashboard",a.id),u({is_archived:!1},!1)}},"Unarchive"),!a.is_archived&&n.a.createElement("span",{className:"hidden-print"},d&&n.a.createElement(h.a,{className:"m-r-5 hidden-xs",onClick:i},n.a.createElement("span",{className:"fa fa-paper-plane m-r-5"})," Publish"),n.a.createElement(Df,{dashboardConfiguration:t}),m&&n.a.createElement(Ne,{className:"hidden-xs",title:"Enable/Disable Fullscreen display"},n.a.createElement(h.a,{type:Tf(o),className:"icon-button m-l-5",onClick:l,"aria-label":"Toggle fullscreen display"},n.a.createElement("i",{className:"zmdi zmdi-fullscreen","aria-hidden":"true"}))),r,f&&n.a.createElement(Ne,{title:"Dashboard Sharing Options"},n.a.createElement(h.a,{className:"icon-button m-l-5",type:Tf(a.publicAccessEnabled),onClick:c,"data-test":"OpenShareForm","aria-label":"Share"},n.a.createElement("i",{className:"zmdi zmdi-share","aria-hidden":"true"}))),b&&n.a.createElement(Rf,{dashboardConfiguration:t})))}function zf(e){var t,r=e.dashboardConfiguration,a=e.headerExtra,i=r.setEditingLayout,s=r.doneBtnClickedWhileSaving,o=r.dashboardStatus,l=r.retrySaveDashboardLayout;return t=o===pf?n.a.createElement("span",{className:"save-status"},"Saved"):o===ff?n.a.createElement("span",{className:"save-status","data-saving":!0},"Saving"):n.a.createElement("span",{className:"save-status","data-error":!0},"Saving Failed"),n.a.createElement("div",{className:"dashboard-control"},t,o===hf?n.a.createElement(h.a,{type:"primary",onClick:l},"Retry"):n.a.createElement(h.a,{loading:s,type:"primary",onClick:()=>i(!1)},!s&&n.a.createElement("i",{className:"fa fa-check m-r-5","aria-hidden":"true"})," Done Editing"),a)}function Ff(e){var t=e.dashboardConfiguration,r=e.headerExtra,a=t.editingLayout?zf:Mf;return n.a.createElement("div",{className:"dashboard-header"},n.a.createElement(If,{dashboardConfiguration:t}),n.a.createElement(a,{dashboardConfiguration:t,headerExtra:r}))}Af(xf,"propTypes",{ignoreBlanks:se.a.bool,isEditable:se.a.bool,placeholder:se.a.string,value:se.a.string,onDone:se.a.func.isRequired,onStopEditing:se.a.func,multiline:se.a.bool,editorProps:se.a.object,defaultEditing:se.a.bool}),Af(xf,"defaultProps",{ignoreBlanks:!1,isEditable:!0,placeholder:"",value:"",onStopEditing:()=>{},multiline:!1,editorProps:{},defaultEditing:!1}),If.propTypes={dashboardConfiguration:se.a.object.isRequired},Df.propTypes={dashboardConfiguration:se.a.object.isRequired},Rf.propTypes={dashboardConfiguration:se.a.object.isRequired},Mf.propTypes={dashboardConfiguration:se.a.object.isRequired,headerExtra:se.a.node},zf.propTypes={dashboardConfiguration:se.a.object.isRequired,headerExtra:se.a.node},Ff.propTypes={dashboardConfiguration:se.a.object.isRequired,headerExtra:se.a.node};var Lf=["dashboardConfiguration","className"];function Uf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Vf(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vf(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Vf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Bf(){return(Bf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Qf(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Wf(e){var t=e.dashboardConfiguration,r=t.dashboard,a=t.updateDashboard;return n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(Jl.a,{checked:!!r.dashboard_filters_enabled,onChange:e=>{var t=e.target;return a({dashboard_filters_enabled:t.checked})},"data-test":"DashboardFiltersCheckbox"},"Use Dashboard Level Filters"))}function Hf(e){var t=e.dashboardConfiguration,r=e.className,a=Qf(e,Lf),i=t.showAddTextboxDialog,s=t.showAddWidgetDialog;return n.a.createElement("div",Bf({className:ge()("add-widget-container",r)},a),n.a.createElement("h2",null,n.a.createElement("i",{className:"zmdi zmdi-widgets","aria-hidden":"true"}),n.a.createElement("span",{className:"hidden-xs hidden-sm"},"Widgets are individual query visualizations or text boxes you can place on your dashboard in various arrangements.")),n.a.createElement("div",null,n.a.createElement(h.a,{className:"m-r-15",onClick:i,"data-test":"AddTextboxButton"},"Add Textbox"),n.a.createElement(h.a,{type:"primary",onClick:s,"data-test":"AddWidgetButton"},"Add Widget")))}function Gf(e){var t=kf(e.dashboard),r=t.dashboard,i=t.filters,s=t.setFilters,o=t.loadDashboard,l=t.loadWidget,u=t.removeWidget,d=t.saveDashboardLayout,m=t.globalParameters,p=t.updateDashboard,f=t.refreshDashboard,h=t.refreshWidget,b=t.editingLayout,g=t.setGridDisabled,y=Uf(Object(a.useState)(null),2),v=y[0],O=y[1],E=Uf(Object(a.useState)({}),2),j=E[0],w=E[1];return Object(a.useEffect)(()=>{if(v)return bp(v,()=>{if(b){var e=window.getComputedStyle(v,null),t=v.getBoundingClientRect(),r=parseFloat(e.paddingLeft)||0,a=parseFloat(e.paddingRight)||0;w({left:Math.round(t.left)+a,width:v.clientWidth-r-a})}window.dispatchEvent(new Event("resize"))})},[v,b]),n.a.createElement("div",{className:"container",ref:O,"data-test":"DashboardId".concat(r.id,"Container")},n.a.createElement(Ff,{dashboardConfiguration:t,headerExtra:n.a.createElement(pe,{name:"Dashboard.HeaderExtra",dashboard:r,dashboardConfiguration:t})}),!Object(c.isEmpty)(m)&&n.a.createElement("div",{className:"dashboard-parameters m-b-10 p-15 bg-white tiled","data-test":"DashboardParameters"},n.a.createElement(ud,{parameters:m,onValuesChange:f,sortable:b,onParametersEdit:e=>{var t=Object(c.map)(e,"name");p({options:{globalParamOrder:t}})}})),!Object(c.isEmpty)(i)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled","data-test":"DashboardFilters"},n.a.createElement(Nd,{filters:i,onChange:s})),b&&n.a.createElement(Wf,{dashboardConfiguration:t}),n.a.createElement("div",{id:"dashboard-container"},n.a.createElement(pp,{dashboard:r,widgets:r.widgets,filters:i,isEditing:b,onLayoutChange:b?d:()=>{},onBreakpointChange:g,onLoadWidget:l,onRefreshWidget:h,onRemoveWidget:u,onParameterMappingsChange:o})),b&&n.a.createElement(Hf,{dashboardConfiguration:t,style:j}))}function Kf(e){var t=e.dashboardSlug,r=e.dashboardId,i=e.onError,s=Uf(Object(a.useState)(null),2),o=s[0],l=s[1],c=_d(i);return Object(a.useEffect)(()=>{$r.get({id:r,slug:t}).then(e=>{vt("view","dashboard",e.id),l(e),r||R.setPath(tt.parse(e.url).pathname,!0)}).catch(c)},[r,t,c]),n.a.createElement("div",{className:"dashboard-page"},o&&n.a.createElement(Gf,{dashboard:o}))}Wf.propTypes={dashboardConfiguration:se.a.object.isRequired},Hf.propTypes={dashboardConfiguration:se.a.object.isRequired,className:se.a.string},Gf.propTypes={dashboard:se.a.object.isRequired},Kf.propTypes={dashboardSlug:se.a.string,dashboardId:se.a.string,onError:se.a.func},Kf.defaultProps={dashboardSlug:null,dashboardId:null,onError:se.a.func},mn.register("Dashboards.LegacyViewOrEdit",Ga({path:"/dashboard/:dashboardSlug",render:e=>n.a.createElement(Kf,e)})),mn.register("Dashboards.ViewOrEdit",Ga({path:"/dashboards/:dashboardId([^-]+)(-.*)?",render:e=>n.a.createElement(Kf,e)}));var Yf=["render","getApiKey"];function $f(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Jf(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Xf(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Jf(Object(r),!0).forEach((function(t){Zf(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jf(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Zf(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return th(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return th(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function th(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function rh(e){var t=e.apiKey,r=e.currentRoute,i=e.renderChildren,s=eh(Object(a.useState)(!1),2),o=s[0],l=s[1],c=Object(a.useContext)(P.ErrorBoundaryContext).handleError;return Object(a.useEffect)(()=>{var e=!1;return re.setApiKey(t),re.loadConfig().then(()=>{e||l(!0)}).catch(()=>{e||l(!1)}),()=>{e=!0}},[t]),!o||$.disablePublicUrls?null:n.a.createElement(n.a.Fragment,{key:r.key},i(Xf(Xf({},r.routeParams),{},{pageTitle:r.title,onError:c,apiKey:t})))}function ah(e){var t=e.render,r=e.getApiKey;return Xf(Xf({},$f(e,Yf)),{},{render:e=>n.a.createElement(rh,{apiKey:r(e),currentRoute:e,renderChildren:t})})}function nh(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ih(e){var t=e.dashboard,r=kf(t),a=r.globalParameters,i=r.filters,s=r.setFilters,o=r.refreshDashboard,l=r.loadWidget,u=r.refreshWidget;return n.a.createElement("div",{className:"container p-t-10 p-b-20"},n.a.createElement(Pn,{title:t.name}),!Object(c.isEmpty)(a)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(ud,{parameters:a,onValuesChange:o})),!Object(c.isEmpty)(i)&&n.a.createElement("div",{className:"m-b-10 p-15 bg-white tiled"},n.a.createElement(Nd,{filters:i,onChange:s})),n.a.createElement("div",{id:"dashboard-container"},n.a.createElement(pp,{dashboard:t,widgets:t.widgets,filters:i,isEditing:!1,isPublic:!0,onLoadWidget:l,onRefreshWidget:u})))}rh.propTypes={apiKey:se.a.string.isRequired,renderChildren:se.a.func},rh.defaultProps={renderChildren:()=>null},ih.propTypes={dashboard:se.a.object.isRequired};class sh extends n.a.Component{constructor(){super(...arguments),nh(this,"state",{loading:!0,dashboard:null})}componentDidMount(){$r.getByToken({token:this.props.token}).then(e=>this.setState({dashboard:e,loading:!1})).catch(e=>this.props.onError(e))}render(){var e=this.state,t=e.loading,r=e.dashboard;return n.a.createElement("div",{className:"public-dashboard-page"},t?n.a.createElement("div",{className:"container loading-message"},n.a.createElement(Ie,{className:"",icon:"fa-spinner fa-2x fa-pulse",message:"Loading..."})):n.a.createElement(ih,{dashboard:r}),n.a.createElement("div",{id:"footer"},n.a.createElement("div",{className:"text-center"},n.a.createElement(S,{href:"https://redash.io"},n.a.createElement("img",{alt:"Redash Logo",src:da.default,width:"38"}))),"Powered by ",n.a.createElement(S,{href:"https://redash.io/?ref=public-dashboard"},"Redash")))}}function oh(){return(oh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function lh(e){return n.a.createElement("div",{className:"text-center"},n.a.createElement(Ie,oh({icon:"fa-search",message:"Sorry, we couldn't find anything."},e)))}function ch(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return uh(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uh(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function dh(){return(dh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function mh(e){var t=e.item,r=e.keySuffix,a={key:"card".concat(r),className:"visual-card",onClick:t.onClick,children:n.a.createElement(n.a.Fragment,null,n.a.createElement("img",{alt:t.title,src:t.imgSrc}),n.a.createElement("h3",null,t.title))};return t.href?n.a.createElement(S,dh({href:t.href},a)):n.a.createElement(Ee,dh({type:"link"},a))}function ph(e){var t=e.items,r=void 0===t?[]:t,i=e.showSearch,s=void 0!==i&&i,o=ch(Object(a.useState)(""),2),l=o[0],u=o[1],d=r.filter(e=>Object(c.isEmpty)(l)||Object(c.includes)(e.title.toLowerCase(),l.toLowerCase()));return n.a.createElement("div",{"data-test":"CardsList"},s&&n.a.createElement("div",{className:"row p-10"},n.a.createElement("div",{className:"col-md-4 col-md-offset-4"},n.a.createElement(He.a.Search,{placeholder:"Search...","aria-label":"Search cards",onChange:e=>u(e.target.value),autoFocus:!0}))),Object(c.isEmpty)(d)?n.a.createElement(lh,{className:""}):n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-lg-12 d-inline-flex flex-wrap visual-card-list"},d.map((e,t)=>n.a.createElement(mh,{key:t,item:e,keySuffix:t.toString()})))))}nh(sh,"propTypes",{token:se.a.string.isRequired,onError:se.a.func}),nh(sh,"defaultProps",{onError:()=>{}}),mn.register("Dashboards.ViewShared",ah({path:"/public/dashboards/:token",render:e=>n.a.createElement(sh,e),getApiKey:e=>e.routeParams.token})),ph.propTypes={items:se.a.arrayOf(se.a.shape({title:se.a.string.isRequired,imgSrc:se.a.string.isRequired,onClick:se.a.func,href:se.a.string})),showSearch:se.a.bool};var fh=r(642),hh=r.n(fh),bh=r(441),gh=r.n(bh),yh=["collapsed","children","className"];function vh(){return(vh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Oh(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Eh(e){var t=e.collapsed,r=e.children,a=e.className,i=Oh(e,yh);return n.a.createElement(gh.a,vh({},i,{activeKey:t?null:"content",className:ge()(a,"ant-collapse-headerless")}),n.a.createElement(gh.a.Panel,{key:"content",header:""},r))}function jh(e){var t=e.title,r=e.name;return t||li(r)}Eh.propTypes={collapsed:se.a.bool,children:se.a.node,className:se.a.string},Eh.defaultProps={collapsed:!0,children:null,className:""};var wh=r(434),Sh=r.n(wh);function Ph(){return(Ph=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var Ch=Object(a.forwardRef)((function(e,t){return n.a.createElement("div",{className:"ace-editor-input","data-test":e["data-test"]},n.a.createElement(Sh.a,Ph({ref:t,mode:"sql",theme:"textmate",height:"100px",editorProps:{$blockScrolling:1/0},showPrintMargin:!1},e)))})),Nh=["form","field"];function kh(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var _h=["form","field"];function Ah(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var xh=r(1084),qh=r.n(xh),Th=r(1085),Ih=r.n(Th),Dh=["form","field"];function Rh(){return(Rh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Mh(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var zh=["form","field"];function Fh(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Lh(e){e.form,e.field;var t=Fh(e,zh);return n.a.createElement(He.a,t)}var Uh=["form","field"];function Vh(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Bh=["form","field"];function Qh(){return(Qh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Wh(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Hh=["form","field"];function Gh(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var Kh=["form","field"];function Yh(){return(Yh=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function $h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Jh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$h(Object(r),!0).forEach((function(t){Xh(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$h(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Xh(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zh(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var eb=se.a.shape({name:se.a.string.isRequired,title:se.a.string,type:se.a.oneOf(["ace","text","textarea","email","password","number","checkbox","file","select","content"]).isRequired,initialValue:se.a.oneOfType([se.a.string,se.a.number,se.a.bool,se.a.arrayOf(se.a.string),se.a.arrayOf(se.a.number)]),content:se.a.node,mode:se.a.string,required:se.a.bool,extra:se.a.bool,readOnly:se.a.bool,autoFocus:se.a.bool,minLength:se.a.number,placeholder:se.a.string,contentAfter:se.a.oneOfType([se.a.node,se.a.func]),loading:se.a.bool,props:se.a.object}),tb={checkbox:function(e){e.form;var t=e.field,r=Ah(e,_h),a=jh(t);return n.a.createElement(Jl.a,r,a)},file:function(e){var t=e.form,r=e.field,a=Mh(e,Dh),i=r.name,s=r.initialValue,o=t.getFieldValue,l=void 0!==o(i)&&o(i)!==s;return n.a.createElement(qh.a,Rh({},a,{beforeUpload:()=>!1}),n.a.createElement(h.a,{disabled:l},n.a.createElement(Ih.a,null)," Click to upload"))},select:function(e){e.form;var t=e.field,r=Wh(e,Bh),a=t.readOnly;return n.a.createElement(Qi.a,Qh({},r,{optionFilterProp:"children",loading:t.loading||!1,mode:t.mode,getPopupContainer:e=>e.parentNode}),t.options&&t.options.map(e=>n.a.createElement(Qi.a.Option,{key:"".concat(e.value),value:e.value,disabled:a},e.name||e.value)))},number:function(e){e.form,e.field;var t=Vh(e,Uh);return n.a.createElement(_o.a,t)},textarea:function(e){e.form,e.field;var t=Gh(e,Hh);return n.a.createElement(He.a.TextArea,t)},ace:function(e){e.form,e.field;var t=kh(e,Nh);return n.a.createElement(Ch,t)},content:function(e){return e.field.content}};function rb(e){var t=e.form,r=e.field,a=Zh(e,Kh),i=r.name,s=r.type,o=r.readOnly,l=r.autoFocus,u=jh(r),d=Jh(Jh({},r.props),{},{className:"w-100",name:i,type:s,readOnly:o,autoFocus:l,placeholder:r.placeholder,"data-test":u},a),m=Object(c.get)(tb,s,Lh);return n.a.createElement(m,Yh({},d,{form:t,field:r}))}function ab(e,t,r){var a=new Array(t.length);return Object.keys(e).forEach(n=>{var i=t.indexOf(n),s={name:n,title:e[n].title,type:e[n].type,placeholder:Object(c.isNil)(e[n].default)?null:e[n].default.toString(),required:e[n].required,extra:e[n].extra,initialValue:r[n]};"select"===s.type&&(s.placeholder="Select an option",s.options=e[n].options),i>-1?a[i]=s:a.push(s)}),a}function nb(e){Object(c.each)(e.properties,(t,r)=>{"password"!==r&&"passwd"!==r||(t.type="password"),r.endsWith("File")&&(t.type="file"),"boolean"===t.type&&(t.type="checkbox"),"string"===t.type&&(t.type="text"),Object(c.isEmpty)(t.enum)||(t.type="select",t.options=Object(c.map)(t.enum,e=>({value:e,name:e}))),Object(c.isEmpty)(t.extendedEnum)||(t.type="select",t.options=t.extendedEnum),t.required=Object(c.includes)(e.required,r),t.extra=Object(c.includes)(e.extra_options,r)}),e.order=e.order||[]}function ib(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.properties;Object.keys(r).forEach(e=>{var a=r[e];if(Object(c.isUndefined)(a.default)||"checkbox"!==a.type||(t[e]=a.default),"select"===a.type){var n=Object(c.map)(a.options,e=>e.value);t[e]=Object(c.includes)(n,a.default)?a.default:n[0]}})}rb.propTypes={field:eb.isRequired};var sb={getFields:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{options:{}},r=e.configuration_schema;nb(r);var a=Object.keys(t.options).length>0;a||ib(r,t.options);var i=!t.id,s=[{name:"name",title:"Name",type:"text",required:!0,initialValue:t.name,contentAfter:n.a.createElement("hr"),placeholder:"My ".concat(e.name),autoFocus:i},...ab(r.properties,r.order,t.options)];return s},updateTargetWithValues:function(e,t){e.name=t.name,Object.keys(t).forEach(r=>{"name"!==r&&(e.options[r]=t[r])})},getBase64:function(e){return new Promise((t,r)=>{var a=new FileReader;a.readAsDataURL(e),a.onload=()=>t(a.result.substr(a.result.indexOf(",")+1)),a.onerror=e=>r(e)})},hasFilledExtraField:function(e,t){var r=Object(c.get)(e,"configuration_schema.extra_options",[]);return Object(c.some)(r,r=>{var a=Object(c.get)(e,["configuration_schema","properties",r,"default"]),n=Object(c.get)(t,["options",r]);return!Object(c.isNil)(n)&&n!==a})}};function ob(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lb(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lb(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var cb=se.a.shape({name:se.a.string.isRequired,callback:se.a.func.isRequired,type:se.a.string,pullRight:se.a.bool,disabledWhenDirty:se.a.bool}),ub=se.a.shape({validateFieldsAndScroll:se.a.func}),db=e=>{var t=e.type,r=e.required,a=e.minLength;return[r&&{required:r,message:"This field is required."},a&&Object(c.includes)(["text","email","password"],t)&&{min:a,message:"This field is too short."},"email"===t&&{type:"email",message:"This field must be a valid email."}].filter(e=>e)};function mb(e){var t=e.fields,r=e.feedbackIcons,a=e.form;return t.map(e=>{var t=e.name,i=e.type,s=e.initialValue,o=e.contentAfter,l=jh(e),u={name:t,className:"m-b-10",hasFeedback:"checkbox"!==i&&"file"!==i&&r,label:"checkbox"===i?"":l,rules:db(e),valuePropName:"checkbox"===i?"checked":"value",initialValue:s};return"file"===i&&(u.valuePropName="data-value",u.getValueFromEvent=e=>{e&&e.fileList[0]&&sb.getBase64(e.file).then(e=>{a.setFieldsValue({[t]:e})})}),n.a.createElement(n.a.Fragment,{key:t},n.a.createElement(yo.a.Item,u,n.a.createElement(rb,{field:e,form:a})),Object(c.isFunction)(o)?o(a.getFieldValue(t)):o)})}mb.propTypes={fields:se.a.arrayOf(eb),feedbackIcons:se.a.bool,form:ub.isRequired},mb.defaultProps={fields:[],feedbackIcons:!1};var pb=(e,t)=>(t.inProgress?e.add(t.actionName):e.delete(t.actionName),new Set(e));function fb(e){var t=e.actions,r=e.isFormDirty,i=ob(Object(a.useReducer)(pb,new Set),2),s=i[0],o=i[1],l=Object(a.useCallback)(e=>{var t=e.name;Object(c.isFunction)(e.callback)&&(o({actionName:t,inProgress:!0}),e.callback(()=>{o({actionName:t,inProgress:!1})}))},[]);return t.map(e=>n.a.createElement(h.a,{key:e.name,htmlType:"button",className:ge()("m-t-10",{"pull-right":e.pullRight}),type:e.type,disabled:r&&e.disableWhenDirty,loading:s.has(e.name),onClick:()=>l(e)},e.name))}function hb(e){var t=e.id,r=e.fields,i=e.actions,s=e.feedbackIcons,o=e.hideSubmitButton,l=e.defaultShowExtraFields,u=e.saveText,d=e.onSubmit,m=ob(Object(a.useState)(!1),2),p=m[0],f=m[1],b=ob(Object(a.useState)(!1),2),g=b[0],y=b[1],v=ob(Object(a.useState)(l),2),O=v[0],E=v[1],j=ob(yo.a.useForm(),1)[0],w=Object(c.filter)(r,{extra:!0}),S=Object(c.difference)(r,w),P=Object(a.useCallback)(e=>{f(!0),e=function(e,t){return Object(c.mapValues)(t,(t,r)=>{var a=(Object(c.find)(e,{name:r})||{}).initialValue;return null!=a&&""!==a||""!==t?t:null})}(r,e),d(e,e=>{f(!1),y(!1),sn.success(e)},e=>{f(!1),sn.error(e)})},[r,d]),C=Object(a.useCallback)(e=>{var t=e.errorFields;j.scrollToField(t[0].name)},[j]);return n.a.createElement(yo.a,{form:j,onFieldsChange:()=>{y(!0)},id:t,className:"dynamic-form",layout:"vertical",onFinish:P,onFinishFailed:C},n.a.createElement(mb,{fields:S,feedbackIcons:s,form:j}),!Object(c.isEmpty)(w)&&n.a.createElement("div",{className:"extra-options"},n.a.createElement(h.a,{type:"dashed",block:!0,className:"extra-options-button",onClick:()=>E(e=>!e)},"Additional Settings",n.a.createElement("i",{className:ge()("fa m-l-5",{"fa-caret-up":O,"fa-caret-down":!O}),"aria-hidden":"true"})),n.a.createElement(Eh,{collapsed:!O,className:"extra-options-content"},n.a.createElement(mb,{fields:w,feedbackIcons:s,form:j}))),!o&&n.a.createElement(h.a,{className:"w-100 m-t-20",type:"primary",htmlType:"submit",disabled:p},u),n.a.createElement(fb,{actions:i,isFormDirty:g}))}function bb(){return(bb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function gb(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}fb.propTypes={actions:se.a.arrayOf(cb),isFormDirty:se.a.bool},fb.defaultProps={actions:[],isFormDirty:!1},hb.propTypes={id:se.a.string,fields:se.a.arrayOf(eb),actions:se.a.arrayOf(cb),feedbackIcons:se.a.bool,hideSubmitButton:se.a.bool,defaultShowExtraFields:se.a.bool,saveText:se.a.string,onSubmit:se.a.func},hb.defaultProps={id:null,fields:[],actions:[],feedbackIcons:!1,hideSubmitButton:!1,defaultShowExtraFields:!1,saveText:"Save",onSubmit:()=>{}};var yb=hh.a.Step,vb=He.a.Search,Ob=0,Eb=1,jb=2;class wb extends n.a.Component{constructor(){super(...arguments),gb(this,"state",{searchText:"",selectedType:null,savingSource:!1,currentStep:Ob}),gb(this,"formId",Object(c.uniqueId)("sourceForm")),gb(this,"selectType",e=>{this.setState({selectedType:e,currentStep:Eb})}),gb(this,"resetType",()=>{this.state.currentStep===Eb&&this.setState({searchText:"",selectedType:null,currentStep:Ob})}),gb(this,"createSource",(e,t,r)=>{var a=this.state,n=a.selectedType;a.savingSource||(this.setState({savingSource:!0,currentStep:jb}),this.props.onCreate(n,e).then(e=>{t("Saved."),this.props.dialog.close({success:!0,data:e})}).catch(e=>{this.setState({savingSource:!1,currentStep:Eb}),r(Object(c.get)(e,"response.data.message","Failed saving."))}))})}renderTypeSelector(){var e=this.props.types,t=this.state.searchText,r=e.filter(e=>Object(c.isEmpty)(t)||Object(c.includes)(e.name.toLowerCase(),t.toLowerCase()));return n.a.createElement("div",{className:"m-t-10"},n.a.createElement(vb,{placeholder:"Search...","aria-label":"Search",onChange:e=>this.setState({searchText:e.target.value}),autoFocus:!0,"data-test":"SearchSource"}),n.a.createElement("div",{className:"scrollbox p-5 m-t-10",style:{minHeight:"30vh",maxHeight:"40vh"}},Object(c.isEmpty)(r)?n.a.createElement(lh,{className:""}):n.a.createElement(Gs.a,{size:"small",dataSource:r,renderItem:e=>this.renderItem(e)})))}renderForm(){var e=this.props,t=e.imageFolder,r=e.helpTriggerPrefix,a=this.state.selectedType,i=sb.getFields(a),s="".concat(r).concat(Object(c.toUpper)(a.type));return n.a.createElement("div",null,n.a.createElement("div",{className:"d-flex justify-content-center align-items-center"},n.a.createElement("img",{className:"p-5",src:"".concat(t,"/").concat(a.type,".png"),alt:a.name,width:"48"}),n.a.createElement("h4",{className:"m-0"},a.name)),n.a.createElement("div",{className:"text-right"},Ue[s]&&n.a.createElement(Qe,{className:"f-13",type:s},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(help)"))),n.a.createElement(hb,{id:this.formId,fields:i,onSubmit:this.createSource,feedbackIcons:!0,hideSubmitButton:!0}),"databricks"===a.type&&n.a.createElement("small",null,"By using the Databricks Data Source you agree to the Databricks JDBC/ODBC"," ",n.a.createElement(S,{href:"https://databricks.com/spark/odbc-driver-download",target:"_blank",rel:"noopener noreferrer"},"Driver Download Terms and Conditions"),"."))}renderItem(e){var t=this.props.imageFolder;return n.a.createElement(Gs.a.Item,{className:"p-l-10 p-r-10 clickable",onClick:()=>this.selectType(e)},n.a.createElement(xp,{title:e.name,imageUrl:"".concat(t,"/").concat(e.type,".png"),roundedImage:!1,"data-test":"PreviewItem","data-test-type":e.type},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"})))}render(){var e=this.state,t=e.currentStep,r=e.savingSource,a=this.props,i=a.dialog,s=a.sourceType;return n.a.createElement(V.a,bb({},i.props,{title:"Create a New ".concat(s),footer:t===Ob?[n.a.createElement(h.a,{key:"cancel",onClick:()=>i.dismiss(),"data-test":"CreateSourceCancelButton"},"Cancel"),n.a.createElement(h.a,{key:"submit",type:"primary",disabled:!0},"Create")]:[n.a.createElement(h.a,{key:"previous",onClick:this.resetType},"Previous"),n.a.createElement(h.a,{key:"submit",htmlType:"submit",form:this.formId,type:"primary",loading:r,"data-test":"CreateSourceSaveButton"},"Create")]}),n.a.createElement("div",{"data-test":"CreateSourceDialog"},n.a.createElement(hh.a,{className:"hidden-xs m-b-10",size:"small",current:t,progressDot:!0},t===Eb?n.a.createElement(yb,{title:n.a.createElement("a",null,"Type Selection"),className:"clickable",onClick:this.resetType}):n.a.createElement(yb,{title:"Type Selection"}),n.a.createElement(yb,{title:"Configuration"}),n.a.createElement(yb,{title:"Done"})),t===Ob&&this.renderTypeSelector(),t!==Ob&&this.renderForm()))}}gb(wb,"propTypes",{dialog:Je.isRequired,types:se.a.arrayOf(se.a.object),sourceType:se.a.string.isRequired,imageFolder:se.a.string.isRequired,helpTriggerPrefix:se.a.string,onCreate:se.a.func.isRequired}),gb(wb,"defaultProps",{types:[],helpTriggerPrefix:null});var Sb=Xe(wb);var Pb=function(e,t,r){return ua.add(e,t),function(e){var t=ua.getActiveItem(R.path);return n.a.createElement("div",{className:"settings-screen"},n.a.createElement("div",{className:"container"},n.a.createElement(Pn,{title:"Settings"}),n.a.createElement("div",{className:"bg-white tiled"},n.a.createElement(he.a,{selectedKeys:[t&&t.title],selectable:!1,mode:"horizontal"},ua.getAvailableItems().map(e=>n.a.createElement(he.a.Item,{key:e.title},n.a.createElement(S,{href:e.path,"data-test":"SettingsScreenItem"},e.title)))),n.a.createElement("div",{className:"p-15"},n.a.createElement("div",null,n.a.createElement(r,e))))))}};function Cb(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Nb(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Cb(Object(r),!0).forEach((function(t){kb(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cb(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function kb(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _b(e){return Object(c.map)(e,e=>Object(c.isObject)(e)?e:{name:e})}var Ab={query:()=>K.get("api/data_sources"),get:e=>{var t=e.id;return K.get("api/data_sources/".concat(t))},types:()=>K.get("api/data_sources/types"),create:e=>K.post("api/data_sources",e),save:e=>K.post("api/data_sources/".concat(e.id),e),test:e=>K.post("api/data_sources/".concat(e.id,"/test")),delete:e=>{var t=e.id;return K.delete("api/data_sources/".concat(t))},fetchSchema:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={};return t&&(r.refresh=!0),K.get("api/data_sources/".concat(e.id,"/schema"),{params:r}).then(e=>Object(c.has)(e,"job")?Yt(e.job.id).catch(t=>1===t.code?[]:Promise.reject(new Error(e.job.error))):Object(c.has)(e,"schema")?e.schema:Promise.reject()).then(e=>Object(c.map)(e,e=>Nb(Nb({},e),{},{columns:_b(e.columns)})))}};function xb(){return(xb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function qb(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}me("DataSourcesListComponent",(function(e){var t=e.dataSources,r=e.onClickCreate,a=t.map(e=>({title:e.name,imgSrc:"".concat("static/images/db-logos","/").concat(e.type,".png"),href:"data_sources/".concat(e.id)}));return Object(c.isEmpty)(t)?n.a.createElement("div",{className:"text-center"},"There are no data sources yet.",ae.isCreateDataSourceEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(Ee,{type:"link",onClick:r,"data-test":"CreateDataSourceLink"},"Click here")," ","to add one.")):n.a.createElement(ph,{items:a})}));class Tb extends n.a.Component{constructor(){var e;super(...arguments),e=this,qb(this,"state",{dataSourceTypes:[],dataSources:[],loading:!0}),qb(this,"newDataSourceDialog",null),qb(this,"createDataSource",(e,t)=>{var r={options:{},type:e.type};return sb.updateTargetWithValues(r,t),Ab.create(r).then(e=>(this.setState({loading:!0}),Ab.query().then(e=>this.setState({dataSources:e,loading:!1})),e))}),qb(this,"showCreateSourceDialog",()=>{vt("view","page","data_sources/new"),this.newDataSourceDialog=Sb.showModal({types:Object(c.reject)(this.state.dataSourceTypes,"deprecated"),sourceType:"Data Source",imageFolder:"static/images/db-logos",helpTriggerPrefix:"DS_",onCreate:this.createDataSource}),this.newDataSourceDialog.onClose((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.newDataSourceDialog=null,t.success&&bt("data_sources/".concat(t.data.id))})).onDismiss(()=>{this.newDataSourceDialog=null,bt("data_sources",!0)})})}componentDidMount(){Promise.all([Ab.query(),Ab.types()]).then(e=>this.setState({dataSources:e[0],dataSourceTypes:e[1],loading:!1},()=>{this.props.isNewDataSourcePage&&(ae.canCreateDataSource()?this.showCreateSourceDialog():bt("data_sources",!0))})).catch(e=>this.props.onError(e))}componentWillUnmount(){this.newDataSourceDialog&&this.newDataSourceDialog.dismiss()}render(){var e={type:"primary",onClick:ae.isCreateDataSourceEnabled()?this.showCreateSourceDialog:null,disabled:!ae.isCreateDataSourceEnabled(),"data-test":"CreateDataSourceButton"};return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(h.a,e,n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Data Source"),n.a.createElement(pe,{name:"DataSourcesListExtra"})),this.state.loading?n.a.createElement(Us,{className:""}):n.a.createElement(pe,{name:"DataSourcesListComponent",dataSources:this.state.dataSources,onClickCreate:this.showCreateSourceDialog}))}}qb(Tb,"propTypes",{isNewDataSourcePage:se.a.bool,onError:se.a.func}),qb(Tb,"defaultProps",{isNewDataSourcePage:!1,onError:()=>{}});var Ib=Pb("DataSources.List",{permission:"admin",title:"Data Sources",path:"data_sources",order:1},Tb);function Db(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}mn.register("DataSources.List",Ga({path:"/data_sources",title:"Data Sources",render:e=>n.a.createElement(Ib,e)})),mn.register("DataSources.New",Ga({path:"/data_sources/new",title:"Data Sources",render:e=>n.a.createElement(Ib,xb({},e,{isNewDataSourcePage:!0}))}));class Rb extends n.a.Component{constructor(){super(...arguments),Db(this,"state",{dataSource:null,type:null,loading:!0}),Db(this,"saveDataSource",(e,t,r)=>{var a=this.state.dataSource;sb.updateTargetWithValues(a,e),Ab.save(a).then(()=>t("Saved.")).catch(e=>{var t=Object(c.get)(e,"response.data.message","Failed saving.");r(t)})}),Db(this,"deleteDataSource",e=>{var t=this.state.dataSource;V.a.confirm({title:"Delete Data Source",content:"Are you sure you want to delete this data source?",okText:"Delete",okType:"danger",onOk:()=>{Ab.delete(t).then(()=>{sn.success("Data source deleted successfully."),bt("data_sources")}).catch(()=>{e()})},onCancel:e,maskClosable:!0,autoFocusButton:null})}),Db(this,"testConnection",e=>{var t=this.state.dataSource;Ab.test({id:t.id}).then(t=>{t.ok?sn.success("Success"):sn.error("Connection Test Failed:",t.message,{duration:10}),e()}).catch(()=>{sn.error("Connection Test Failed:","Unknown error occurred while performing connection test. Please try again later.",{duration:10}),e()})})}componentDidMount(){Ab.get({id:this.props.dataSourceId}).then(e=>{var t=e.type;this.setState({dataSource:e}),Ab.types().then(e=>this.setState({type:Object(c.find)(e,{type:t}),loading:!1}))}).catch(e=>this.props.onError(e))}renderForm(){var e=this.state,t=e.dataSource,r=e.type,a=sb.getFields(r,t),i="DS_".concat(Object(c.toUpper)(r.type)),s={fields:a,type:r,actions:[{name:"Delete",type:"danger",callback:this.deleteDataSource},{name:"Test Connection",pullRight:!0,callback:this.testConnection,disableWhenDirty:!0}],onSubmit:this.saveDataSource,feedbackIcons:!0,defaultShowExtraFields:sb.hasFilledExtraField(r,t)};return n.a.createElement("div",{className:"row","data-test":"DataSource"},n.a.createElement("div",{className:"text-right m-r-10"},Ue[i]&&n.a.createElement(Qe,{className:"f-13",type:i},"Setup Instructions ",n.a.createElement("i",{className:"fa fa-question-circle","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(help)"))),n.a.createElement("div",{className:"text-center m-b-10"},n.a.createElement("img",{className:"p-5",src:"".concat("static/images/db-logos","/").concat(r.type,".png"),alt:r.name,width:"64"}),n.a.createElement("h3",{className:"m-0"},r.name)),n.a.createElement("div",{className:"col-md-4 col-md-offset-4 m-b-10"},n.a.createElement(hb,s)))}render(){return this.state.loading?n.a.createElement(Us,{className:""}):this.renderForm()}}Db(Rb,"propTypes",{dataSourceId:se.a.string.isRequired,onError:se.a.func}),Db(Rb,"defaultProps",{onError:()=>{}});var Mb=Pb("DataSources.Edit",null,Rb);function zb(){return(zb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Fb(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}mn.register("DataSources.Edit",Ga({path:"/data_sources/:dataSourceId",title:"Data Sources",render:e=>n.a.createElement(Mb,e)}));class Lb extends n.a.Component{constructor(){super(...arguments),Fb(this,"state",{destinationTypes:[],destinations:[],loading:!0}),Fb(this,"createDestination",(e,t)=>{var r={options:{},type:e.type};return sb.updateTargetWithValues(r,t),nl.create(r).then(e=>(this.setState({loading:!0}),nl.query().then(e=>this.setState({destinations:e,loading:!1})),e))}),Fb(this,"showCreateSourceDialog",()=>{Sb.showModal({types:Object(c.reject)(this.state.destinationTypes,"deprecated"),sourceType:"Alert Destination",imageFolder:al,onCreate:this.createDestination}).onClose((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.success&&bt("destinations/".concat(e.data.id))})).onDismiss(()=>{bt("destinations",!0)})})}componentDidMount(){Promise.all([nl.query(),nl.types()]).then(e=>this.setState({destinations:e[0],destinationTypes:e[1],loading:!1},()=>{this.props.isNewDestinationPage&&(ae.canCreateDestination()?this.showCreateSourceDialog():bt("destinations",!0))})).catch(e=>this.props.onError(e))}renderDestinations(){var e=this.state.destinations,t=e.map(e=>({title:e.name,imgSrc:"".concat(al,"/").concat(e.type,".png"),href:"destinations/".concat(e.id)}));return Object(c.isEmpty)(e)?n.a.createElement("div",{className:"text-center"},"There are no alert destinations yet.",ae.isCreateDestinationEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(Ee,{type:"link",onClick:this.showCreateSourceDialog},"Click here")," ","to add one.")):n.a.createElement(ph,{items:t})}render(){var e={type:"primary",onClick:ae.isCreateDestinationEnabled()?this.showCreateSourceDialog:null,disabled:!ae.isCreateDestinationEnabled()};return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(h.a,e,n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Alert Destination")),this.state.loading?n.a.createElement(Us,{className:""}):this.renderDestinations())}}Fb(Lb,"propTypes",{isNewDestinationPage:se.a.bool,onError:se.a.func}),Fb(Lb,"defaultProps",{isNewDestinationPage:!1,onError:()=>{}});var Ub=Pb("AlertDestinations.List",{permission:"admin",title:"Alert Destinations",path:"destinations",order:4},Lb);function Vb(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}mn.register("AlertDestinations.List",Ga({path:"/destinations",title:"Alert Destinations",render:e=>n.a.createElement(Ub,e)})),mn.register("AlertDestinations.New",Ga({path:"/destinations/new",title:"Alert Destinations",render:e=>n.a.createElement(Ub,zb({},e,{isNewDestinationPage:!0}))}));class Bb extends n.a.Component{constructor(){super(...arguments),Vb(this,"state",{destination:null,type:null,loading:!0}),Vb(this,"saveDestination",(e,t,r)=>{var a=this.state.destination;sb.updateTargetWithValues(a,e),nl.save(a).then(()=>t("Saved.")).catch(e=>{var t=Object(c.get)(e,"response.data.message","Failed saving.");r(t)})}),Vb(this,"deleteDestination",e=>{var t=this.state.destination;V.a.confirm({title:"Delete Alert Destination",content:"Are you sure you want to delete this alert destination?",okText:"Delete",okType:"danger",onOk:()=>{nl.delete(t).then(()=>{sn.success("Alert destination deleted successfully."),bt("destinations")}).catch(()=>{e()})},onCancel:e,maskClosable:!0,autoFocusButton:null})})}componentDidMount(){nl.get({id:this.props.destinationId}).then(e=>{var t=e.type;this.setState({destination:e}),nl.types().then(e=>this.setState({type:Object(c.find)(e,{type:t}),loading:!1}))}).catch(e=>this.props.onError(e))}renderForm(){var e=this.state,t=e.destination,r=e.type,a={fields:sb.getFields(r,t),type:r,actions:[{name:"Delete",type:"danger",callback:this.deleteDestination}],onSubmit:this.saveDestination,defaultShowExtraFields:sb.hasFilledExtraField(r,t),feedbackIcons:!0};return n.a.createElement("div",{className:"row","data-test":"Destination"},n.a.createElement("div",{className:"text-center m-b-10"},n.a.createElement("img",{className:"p-5",src:"".concat(al,"/").concat(r.type,".png"),alt:r.name,width:"64"}),n.a.createElement("h3",{className:"m-0"},r.name)),n.a.createElement("div",{className:"col-md-4 col-md-offset-4 m-b-10"},n.a.createElement(hb,a)))}render(){return this.state.loading?n.a.createElement(Us,{className:""}):this.renderForm()}}Vb(Bb,"propTypes",{destinationId:se.a.string.isRequired,onError:se.a.func}),Vb(Bb,"defaultProps",{onError:()=>{}});var Qb=Pb("AlertDestinations.Edit",null,Bb);function Wb(){return(Wb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Hb(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}mn.register("AlertDestinations.Edit",Ga({path:"/destinations/:destinationId",title:"Alert Destinations",render:e=>n.a.createElement(Qb,e)}));class Gb extends n.a.Component{constructor(){super(...arguments),Hb(this,"state",{name:""}),Hb(this,"save",()=>{this.props.dialog.close({name:this.state.name})})}render(){var e=this.props.dialog;return n.a.createElement(V.a,Wb({},e.props,{title:"Create a New Group",okText:"Create",onOk:()=>this.save()}),n.a.createElement(He.a,{className:"form-control",defaultValue:this.state.name,onChange:e=>this.setState({name:e.target.value}),onPressEnter:()=>this.save(),placeholder:"Group Name","aria-label":"Group name",autoFocus:!0}))}}Hb(Gb,"propTypes",{dialog:Je.isRequired});var Kb=Xe(Gb),Yb={query:()=>K.get("api/groups"),get:e=>{var t=e.id;return K.get("api/groups/".concat(t))},create:e=>K.post("api/groups",e),save:e=>K.post("api/groups/".concat(e.id),e),delete:e=>K.delete("api/groups/".concat(e.id)),members:e=>{var t=e.id;return K.get("api/groups/".concat(t,"/members"))},addMember:(e,t)=>{var r=e.id;return K.post("api/groups/".concat(r,"/members"),t)},removeMember:e=>{var t=e.id,r=e.userId;return K.delete("api/groups/".concat(t,"/members/").concat(r))},dataSources:e=>{var t=e.id;return K.get("api/groups/".concat(t,"/data_sources"))},addDataSource:(e,t)=>{var r=e.id;return K.post("api/groups/".concat(r,"/data_sources"),t)},removeDataSource:e=>{var t=e.id,r=e.dataSourceId;return K.delete("api/groups/".concat(t,"/data_sources/").concat(r))},updateDataSource:(e,t)=>{var r=e.id,a=e.dataSourceId;return K.post("api/groups/".concat(r,"/data_sources/").concat(a),t)}},$b=["group","title","onClick","children"];function Jb(){return(Jb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Xb(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Zb(e){var t=e.group,r=e.title,a=e.onClick,i=e.children,s=Xb(e,$b);if(!t)return null;var o=n.a.createElement(h.a,Jb({},s,{type:"danger",onClick:e=>function(e,t,r){V.a.confirm({title:"Delete Group",content:"Are you sure you want to delete this group?",okText:"Yes",okType:"danger",cancelText:"No",onOk:()=>{Yb.delete(t).then(()=>{sn.success("Group deleted successfully."),r()})}})}(0,t,a)}),i);return Object(c.isString)(r)&&""!==r?n.a.createElement(Ne,{placement:"top",title:r,mouseLeaveDelay:0},o):o}function eg(){return(eg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function tg(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Zb.propTypes={group:se.a.object,title:se.a.string,onClick:se.a.func,children:se.a.node},Zb.defaultProps={group:null,title:null,onClick:()=>{},children:null};class rg extends n.a.Component{constructor(){super(...arguments),tg(this,"listColumns",[yi.custom((e,t)=>n.a.createElement("div",null,n.a.createElement(S,{href:"groups/"+t.id},t.name),"builtin"===t.type&&n.a.createElement("span",{className:"label label-default m-l-10"},"built-in")),{field:"name",width:null}),yi.custom((e,t)=>n.a.createElement(h.a.Group,null,n.a.createElement(S.Button,{href:"groups/".concat(t.id)},"Members"),Y.isAdmin&&n.a.createElement(S.Button,{href:"groups/".concat(t.id,"/data_sources")},"Data Sources")),{width:"1%",className:"text-nowrap"}),yi.custom((e,t)=>{var r="builtin"!==t.type;return n.a.createElement(Zb,{className:"w-100",disabled:!r,group:t,title:r?null:"Cannot delete built-in group",onClick:()=>this.onGroupDeleted()},"Delete")},{width:"1%",className:"text-nowrap p-l-0",isAvailable:()=>Y.isAdmin})]),tg(this,"createGroup",()=>{Kb.showModal().onClose(e=>Yb.create(e).then(e=>bt("groups/".concat(e.id))))}),tg(this,"onGroupDeleted",()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"GroupList"},Y.isAdmin&&n.a.createElement("div",{className:"m-b-15"},n.a.createElement(h.a,{type:"primary",onClick:this.createGroup},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Group")),!e.isLoaded&&n.a.createElement(Us,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(lh,{className:""}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(vi,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vi,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}tg(rg,"propTypes",{controller:bs.isRequired});var ag=Pb("Groups.List",{permission:"list_users",title:"Groups",path:"groups",order:3},gs(rg,()=>new Ds({isPlainList:!0,getRequest:()=>({}),getResource:()=>Yb.query.bind(Yb)}),()=>new zs({orderByField:"name",itemsPerPage:10})));mn.register("Groups.List",Ga({path:"/groups",title:"Groups",render:e=>n.a.createElement(ag,eg({},e,{currentPage:"groups"}))}));var ng=r(336),ig=r.n(ng),sg=["group","onChange"];function og(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function lg(e){var t=e.group,r=e.onChange,a=og(e,sg);if(!t)return null;var i=Y.isAdmin&&"builtin"!==t.type;return n.a.createElement("h3",a,n.a.createElement(xf,{className:"edit-in-place",isEditable:i,ignoreBlanks:!0,onDone:e=>function(e,t,r){e.name=t,Yb.save(e),r()}(t,e,r),value:t.name}))}function cg(e){var t=e.controller,r=e.group,a=e.items,i=e.canAddMembers,s=e.onAddMembersClick,o=e.canAddDataSources,l=e.onAddDataSourcesClick,c=e.onGroupDeleted,u=r&&Y.isAdmin&&"builtin"!==r.type;return n.a.createElement(n.a.Fragment,null,n.a.createElement(Hl,{items:a,selected:t.params.currentPage}),i&&n.a.createElement(h.a,{className:"w-100 m-t-5",type:"primary",onClick:s},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"Add Members"),o&&n.a.createElement(h.a,{className:"w-100 m-t-5",type:"primary",onClick:l},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"Add Data Sources"),u&&n.a.createElement(n.a.Fragment,null,n.a.createElement(wo.a,{dashed:!0,className:"m-t-10 m-b-10"}),n.a.createElement(Zb,{className:"w-100",group:r,onClick:c},"Delete Group")))}function ug(){return(ug=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function dg(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}lg.propTypes={group:se.a.shape({name:se.a.string.isRequired}),onChange:se.a.func},lg.defaultProps={group:null,onChange:()=>{}},cg.propTypes={controller:bs.isRequired,group:se.a.object,items:se.a.array.isRequired,canAddMembers:se.a.bool,onAddMembersClick:se.a.func,canAddDataSources:se.a.bool,onAddDataSourcesClick:se.a.func,onGroupDeleted:se.a.func},cg.defaultProps={group:null,canAddMembers:!1,onAddMembersClick:null,canAddDataSources:!1,onAddDataSourcesClick:null,onGroupDeleted:null};class mg extends n.a.Component{constructor(){super(...arguments),dg(this,"groupId",parseInt(this.props.controller.params.groupId,10)),dg(this,"group",null),dg(this,"sidebarMenu",[{key:"users",href:"groups/".concat(this.groupId),title:"Members"},{key:"datasources",href:"groups/".concat(this.groupId,"/data_sources"),title:"Data Sources",isAvailable:()=>Y.isAdmin}]),dg(this,"listColumns",[yi.custom((e,t)=>n.a.createElement(Tp,{dataSource:t,withLink:!0}),{title:"Name",field:"name",width:null}),yi.custom((e,t)=>{var r=n.a.createElement(he.a,{selectedKeys:[t.view_only?"viewonly":"full"],onClick:e=>this.setDataSourcePermissions(t,e.key)},n.a.createElement(he.a.Item,{key:"full"},"Full Access"),n.a.createElement(he.a.Item,{key:"viewonly"},"View Only"));return n.a.createElement(Da.a,{trigger:["click"],overlay:r},n.a.createElement(h.a,{className:"w-100","aria-label":"Permissions"},t.view_only?"View Only":"Full Access",n.a.createElement(ig.a,{"aria-hidden":"true"})))},{width:"1%",className:"p-r-0",isAvailable:()=>Y.isAdmin}),yi.custom((e,t)=>n.a.createElement(h.a,{className:"w-100",type:"danger",onClick:()=>this.removeGroupDataSource(t)},"Remove"),{width:"1%",isAvailable:()=>Y.isAdmin})]),dg(this,"removeGroupDataSource",e=>{Yb.removeDataSource({id:this.groupId,dataSourceId:e.id}).then(()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()}).catch(()=>{sn.error("Failed to remove data source from group.")})}),dg(this,"setDataSourcePermissions",(e,t)=>{var r="full"!==t;Yb.updateDataSource({id:this.groupId,dataSourceId:e.id},{view_only:r}).then(()=>{e.view_only=r,this.forceUpdate()}).catch(()=>{sn.error("Failed change data source permissions.")})}),dg(this,"addDataSources",()=>{var e=Ab.query(),t=Object(c.map)(this.props.controller.allItems,e=>e.id);rl.showModal({dialogTitle:"Add Data Sources",inputPlaceholder:"Search data sources...",selectedItemsTitle:"New Data Sources",searchItems:t=>(t=Object(c.toLower)(t),e.then(e=>Object(c.filter)(e,e=>Object(c.includes)(Object(c.toLower)(e.name),t)))),renderItem:(e,r)=>{var a=r.isSelected,i=Object(c.includes)(t,e.id);return{content:n.a.createElement(Tp,{dataSource:e},n.a.createElement(sl,{isSelected:a,alreadyInGroup:i})),isDisabled:i,className:a||i?"selected":""}},renderStagedItem:(e,t)=>{var r=t.isSelected;return{content:n.a.createElement(Tp,{dataSource:e},n.a.createElement(sl,{isSelected:r,isStaged:!0}))}}}).onClose(e=>{var t=Object(c.map)(e,e=>Yb.addDataSource({id:this.groupId},{data_source_id:e.id}));return Promise.all(t).then(()=>this.props.controller.update())})})}componentDidMount(){Yb.get({id:this.groupId}).then(e=>{this.group=e,this.forceUpdate()}).catch(e=>{this.props.controller.handleError(e)})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"Group"},n.a.createElement(lg,{className:"d-block m-t-0 m-b-15",group:this.group,onChange:()=>this.forceUpdate()}),n.a.createElement(dc,null,n.a.createElement(dc.Sidebar,null,n.a.createElement(cg,{controller:e,group:this.group,items:this.sidebarMenu,canAddDataSources:Y.isAdmin,onAddDataSourcesClick:this.addDataSources,onGroupDeleted:()=>bt("groups")})),n.a.createElement(dc.Content,null,!e.isLoaded&&n.a.createElement(Us,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},n.a.createElement("p",null,"There are no data sources in this group yet."),Y.isAdmin&&n.a.createElement(h.a,{type:"primary",onClick:this.addDataSources},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"Add Data Sources")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(vi,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vi,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}dg(mg,"propTypes",{controller:bs.isRequired});var pg=Pb("Groups.DataSources",null,gs(mg,()=>new Ds({isPlainList:!0,getRequest:(e,t)=>({id:t.params.groupId}),getResource:()=>Yb.dataSources.bind(Yb)}),()=>new zs({orderByField:"name"})));function fg(){return(fg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function hg(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}mn.register("Groups.DataSources",Ga({path:"/groups/:groupId/data_sources",title:"Group Data Sources",render:e=>n.a.createElement(pg,ug({},e,{currentPage:"datasources"}))}));class bg extends n.a.Component{constructor(){super(...arguments),hg(this,"groupId",parseInt(this.props.controller.params.groupId,10)),hg(this,"group",null),hg(this,"sidebarMenu",[{key:"users",href:"groups/".concat(this.groupId),title:"Members"},{key:"datasources",href:"groups/".concat(this.groupId,"/data_sources"),title:"Data Sources",isAvailable:()=>Y.isAdmin}]),hg(this,"listColumns",[yi.custom((e,t)=>n.a.createElement(qp,{user:t,withLink:!0}),{title:"Name",field:"name",width:null}),yi.custom((e,t)=>this.group?"builtin"===this.group.type&&Y.id===t.id?null:n.a.createElement(h.a,{className:"w-100",type:"danger",onClick:e=>this.removeGroupMember(e,t)},"Remove"):null,{width:"1%",isAvailable:()=>Y.isAdmin})]),hg(this,"removeGroupMember",(e,t)=>Yb.removeMember({id:this.groupId,userId:t.id}).then(()=>{this.props.controller.updatePagination({page:1}),this.props.controller.update()}).catch(()=>{sn.error("Failed to remove member from group.")})),hg(this,"addMembers",()=>{var e=Object(c.map)(this.props.controller.allItems,e=>e.id);rl.showModal({dialogTitle:"Add Members",inputPlaceholder:"Search users...",selectedItemsTitle:"New Members",searchItems:e=>Fp.query({q:e}).then(e=>e.results),renderItem:(t,r)=>{var a=r.isSelected,i=Object(c.includes)(e,t.id);return{content:n.a.createElement(qp,{user:t},n.a.createElement(sl,{isSelected:a,alreadyInGroup:i})),isDisabled:i,className:a||i?"selected":""}},renderStagedItem:(e,t)=>{var r=t.isSelected;return{content:n.a.createElement(qp,{user:e},n.a.createElement(sl,{isSelected:r,isStaged:!0}))}}}).onClose(e=>{var t=Object(c.map)(e,e=>Yb.addMember({id:this.groupId},{user_id:e.id}));return Promise.all(t).then(()=>this.props.controller.update())})})}componentDidMount(){Yb.get({id:this.groupId}).then(e=>{this.group=e,this.forceUpdate()}).catch(e=>{this.props.controller.handleError(e)})}render(){var e=this.props.controller;return n.a.createElement("div",{"data-test":"Group"},n.a.createElement(lg,{className:"d-block m-t-0 m-b-15",group:this.group,onChange:()=>this.forceUpdate()}),n.a.createElement(dc,null,n.a.createElement(dc.Sidebar,null,n.a.createElement(cg,{controller:e,group:this.group,items:this.sidebarMenu,canAddMembers:Y.isAdmin,onAddMembersClick:this.addMembers,onGroupDeleted:()=>bt("groups")})),n.a.createElement(dc.Content,null,!e.isLoaded&&n.a.createElement(Us,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},n.a.createElement("p",null,"There are no members in this group yet."),Y.isAdmin&&n.a.createElement(h.a,{type:"primary",onClick:this.addMembers},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"Add Members")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive"},n.a.createElement(vi,{items:e.pageItems,columns:this.listColumns,showHeader:!1,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vi,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}hg(bg,"propTypes",{controller:bs.isRequired});var gg=Pb("Groups.Members",null,gs(bg,()=>new Ds({isPlainList:!0,getRequest:(e,t)=>({id:t.params.groupId}),getResource:()=>Yb.members.bind(Yb)}),()=>new zs({orderByField:"name"})));function yg(e){var t=e.page,r=e.searchTerm,a=e.selectedTags;if(""!==r)return n.a.createElement(Ie,{message:"Sorry, we couldn't find anything.",icon:"fa-search"});if(a.length>0)return n.a.createElement(mc,{objectType:"queries",tags:a});switch(t){case"favorites":return n.a.createElement(Ie,{message:"Mark queries as Favorite to list them here.",icon:"fa-star"});case"archive":return n.a.createElement(Ie,{message:"Archived queries will be listed here.",icon:"fa-archive"});case"my":var i=Y.hasPermission("create_query")?n.a.createElement("span",null,n.a.createElement(S.Button,{href:"queries/new",type:"primary",size:"small"},"Create your first query!")," ",n.a.createElement(Qe,{className:"f-13",type:"QUERIES",showTooltip:!1},"Need help?")):n.a.createElement("span",null,"Sorry, we couldn't find anything.");return n.a.createElement(Ie,{icon:"fa-search"},i);default:return n.a.createElement(pe,{name:"QueriesList.EmptyState"},n.a.createElement(Xa,{icon:"fa fa-code",illustration:"query",description:"Getting the data from your datasources.",helpMessage:n.a.createElement($a,{helpTriggerType:"QUERIES"})}))}}function vg(){return(vg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}mn.register("Groups.Members",Ga({path:"/groups/:groupId",title:"Group Members",render:e=>n.a.createElement(gg,fg({},e,{currentPage:"users"}))})),yg.propTypes={page:se.a.string.isRequired,searchTerm:se.a.string.isRequired,selectedTags:se.a.array.isRequired};var Og=[{key:"all",href:"queries",title:"All Queries",icon:()=>n.a.createElement(Gl,{icon:"fa fa-code"})},{key:"my",href:"queries/my",title:"My Queries",icon:()=>n.a.createElement(Kl,{user:Y})},{key:"favorites",href:"queries/favorites",title:"Favorites",icon:()=>n.a.createElement(Gl,{icon:"fa fa-star"})},{key:"archive",href:"queries/archive",title:"Archived",icon:()=>n.a.createElement(Gl,{icon:"fa fa-archive"})}],Eg=[yi.favorites({className:"p-r-0"}),yi.custom.sortable((e,t)=>n.a.createElement(n.a.Fragment,null,n.a.createElement(S,{className:"table-main-title",href:"queries/"+t.id},t.name),n.a.createElement(ts,{className:"d-block",tags:t.tags,isDraft:t.is_draft,isArchived:t.is_archived})),{title:"Name",field:"name",width:null}),yi.custom((e,t)=>t.user.name,{title:"Created By",width:"1%"}),yi.dateTime.sortable({title:"Created At",field:"created_at",width:"1%"}),yi.dateTime.sortable({title:"Last Executed At",field:"retrieved_at",orderByField:"executed_at",width:"1%"}),yi.custom.sortable((e,t)=>n.a.createElement(ss,{schedule:t.schedule,isNew:t.isNew()}),{title:"Refresh Schedule",field:"schedule",width:"1%"})];function jg(e){return n.a.createElement(pe,vg({name:"QueriesList.Actions"},e))}function wg(e){var t=e.controller,r=Object(a.useRef)();r.current=t,Object(a.useEffect)(()=>{var e=R.listen((e,t)=>{var a=R.search.q||"";"PUSH"===t&&a!==r.current.searchTerm&&r.current.updateSearch(a)});return()=>{e()}},[]);var i=tc(t,Eg,jg),s=i.areExtraActionsAvailable,o=i.listColumns,l=i.Component,c=i.selectedItems;return n.a.createElement("div",{className:"page-queries-list"},n.a.createElement("div",{className:"container"},n.a.createElement(Pn,{title:t.params.pageTitle,actions:Y.hasPermission("create_query")?n.a.createElement(S.Button,{block:!0,type:"primary",href:"queries/new"},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Query"):null}),n.a.createElement(dc,null,n.a.createElement(dc.Sidebar,{className:"m-b-0"},n.a.createElement(Wl,{placeholder:"Search Queries...",label:"Search queries",value:t.searchTerm,onChange:t.updateSearch}),n.a.createElement(Hl,{items:Og,selected:t.params.currentPage}),n.a.createElement(Yl,{url:"api/queries/tags",onChange:t.updateSelectedTags,showUnselectAll:!0})),n.a.createElement(dc.Content,null,t.isLoaded&&t.isEmpty?n.a.createElement(yg,{page:t.params.currentPage,searchTerm:t.searchTerm,selectedTags:t.selectedTags}):n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:ge()({"m-b-10":s})},n.a.createElement(l,{selectedItems:c})),n.a.createElement("div",{className:"bg-white tiled table-responsive"},n.a.createElement(vi,{items:t.pageItems,loading:!t.isLoaded,columns:o,orderByField:t.orderByField,orderByReverse:t.orderByReverse,toggleSorting:t.toggleSorting}),n.a.createElement(Vi,{showPageSizeSelect:!0,totalCount:t.totalItemsCount,pageSize:t.itemsPerPage,onPageSizeChange:e=>t.updatePagination({itemsPerPage:e}),page:t.page,onChange:e=>t.updatePagination({page:e})})))))))}wg.propTypes={controller:bs.isRequired};var Sg=gs(wg,()=>new Ds({getResource(e){var t=e.params.currentPage;return{all:ir.query.bind(ir),my:ir.myQueries.bind(ir),favorites:ir.favorites.bind(ir),archive:ir.archive.bind(ir)}[t]},getItemProcessor:()=>e=>new ir(e)}),()=>new Fs({orderByField:"created_at",orderByReverse:!0}));mn.register("Queries.List",Ga({path:"/queries",title:"Queries",render:e=>n.a.createElement(Sg,vg({},e,{currentPage:"all"}))})),mn.register("Queries.Favorites",Ga({path:"/queries/favorites",title:"Favorite Queries",render:e=>n.a.createElement(Sg,vg({},e,{currentPage:"favorites"}))})),mn.register("Queries.Archived",Ga({path:"/queries/archive",title:"Archived Queries",render:e=>n.a.createElement(Sg,vg({},e,{currentPage:"archive"}))})),mn.register("Queries.My",Ga({path:"/queries/my",title:"My Queries",render:e=>n.a.createElement(Sg,vg({},e,{currentPage:"my"}))}));var Pg=r(192),Cg=r.n(Pg),Ng=r(643),kg=r.n(Ng),_g=r(635);function Ag(){return(Ag=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function xg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function qg(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xg(Object(r),!0).forEach((function(t){Tg(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xg(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Tg(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ig(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Dg(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dg(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Rg(e){var t=e.toggleShortcut,r=e.direction,i=e.sizeAttribute,s=e.children,o=Ig(Object(a.useState)(0),2),l=o[0],c=o[1],u=Object(a.useRef)(),d=Object(a.useRef)(!1),m=Object(a.useRef)(!1),p="horizontal"===r?"width":"height";i=i||p;var f=Object(a.useCallback)(()=>u.current?Math.floor(u.current.getBoundingClientRect()[p]):0,[p]),h=Object(a.useRef)(null),b=Object(a.useCallback)(()=>{if(u.current){var e,t=kg.a.select(u.current);null===h.current?(e="0px",h.current="".concat(f(),"px")):(e=h.current,h.current=null),t.style(i,h.current||"0px").transition().duration(200).ease("swing").style(i,e),c(parseInt(e)||0)}},[f,i]),g=Object(a.useMemo)(()=>n.a.createElement("span",{className:"react-resizable-handle react-resizable-handle-".concat(r),role:"separator",onClick:()=>{!d.current&&m.current||b(),d.current=!1,m.current=!1}}),[r,b]);Object(a.useEffect)(()=>{if(t){var e={[t]:b};return xc.bind(e),()=>{xc.unbind(e)}}},[t,b]);var y=Object(a.useMemo)(()=>({onResizeStart:()=>{c(f())},onResize:(e,t)=>{kg.a.select(u.current).style(i,"".concat(t.size[p],"px")),c(t.size[p]),m.current=!0},onResizeStop:()=>{m.current&&(h.current=null)}}),[p,f,i]),v=Object(a.useMemo)(()=>({onMouseDown:e=>{"touchstart"===e.type&&(d.current=!0),c(f())}}),[f]);return s?(s=n.a.createElement(s.type,qg(qg({},s.props),{},{ref:u})),n.a.createElement(_g.Resizable,Ag({className:"resizable-component",axis:"horizontal"===r?"x":"y",resizeHandles:["horizontal"===r?"e":"s"],handle:g,width:"horizontal"===r?l:0,height:"vertical"===r?l:0,minConstraints:[0,0]},y,{draggableOpts:v}),s)):null}Rg.propTypes={direction:se.a.oneOf(["horizontal","vertical"]),sizeAttribute:se.a.string,toggleShortcut:se.a.string,children:se.a.element},Rg.defaultProps={direction:"horizontal",sizeAttribute:null,toggleShortcut:null,children:null};var Mg=r(1086),zg=r.n(Mg),Fg={sql:e=>zg.a.format(Object(c.trim)(e)),json:e=>JSON.stringify(JSON.parse(e),null,4)};function Lg(e){return e in Fg}function Ug(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t=t||{view_only:!0},Object(a.useMemo)(()=>({isNew:Object(c.isNil)(e.id),isDraft:e.is_draft,isArchived:e.is_archived,canCreate:Y.hasPermission("create_query"),canView:Y.hasPermission("view_query"),canEdit:Y.hasPermission("edit_query")&&ae.canEdit(e),canViewSource:Y.hasPermission("view_source"),canExecute:!Object(c.isEmpty)(e.query)&&ae.canRun(e)&&(e.is_safe||Y.hasPermission("execute_query")&&!t.view_only),canFork:Y.hasPermission("edit_query")&&!t.view_only,canSchedule:Y.hasPermission("schedule_query")}),[e,t.view_only])}function Vg(e,t){var r=_d(t);return Object(a.useCallback)(()=>{new Promise((e,t)=>{V.a.confirm({title:"Archive Query",content:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},"Are you sure you want to archive this query?"),n.a.createElement("div",null,"All alerts and dashboard widgets created with its visualizations will be deleted.")),okText:"Archive",okType:"danger",onOk:()=>{e()},onCancel:()=>{t()},maskClosable:!0,autoFocusButton:null})}).then(()=>function(e){return ir.delete({id:e.id}).then(()=>Object(c.extend)(e.clone(),{is_archived:!0,schedule:null})).catch(e=>(sn.error("Query could not be archived."),Promise.reject(e)))}(e)).then(r)},[e,r])}function Bg(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Qg(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Bg(Object(r),!0).forEach((function(t){Wg(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bg(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Wg(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Hg extends(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)){constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e),this.detailedMessage=t}}class Gg extends Hg{constructor(){super("Changes not saved",n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},"It seems like the query has been modified by another user."),n.a.createElement("div",null,"Please copy/backup your changes and reload this page.")))}}function Kg(){return new Promise((e,t)=>{V.a.confirm({title:"Overwrite Query",content:n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"m-b-5"},"It seems like the query has been modified by another user."),n.a.createElement("div",null,"Are you sure you want to overwrite the query with your version?")),okText:"Overwrite",okType:"danger",onOk:()=>{e()},onCancel:()=>{t()},maskClosable:!0,autoFocusButton:null})})}function Yg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.canOverwrite,a=void 0!==r&&r;return Object(c.isObject)(e.options)&&e.options.parameters&&(e.options=Qg(Qg({},e.options),{},{parameters:Object(c.map)(e.options.parameters,e=>e.toSaveableObject())})),ir.save(e).catch(t=>409===Object(c.get)(t,"response.status")?a?Kg().then(()=>ir.save(Object(c.omit)(e,["version"]))).catch(()=>Promise.reject(new Gg)):Promise.reject(new Gg):Promise.reject(new Hg("Query could not be saved")))}function $g(e,t){var r=_d(t);return Object(a.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.successMessage,i=void 0===n?"Query saved":n;if(Object(c.isObject)(t)){if(e.isNew())return void r(Object(c.extend)(e.clone(),t));t=Qg(Qg({},t),{},{id:e.id,version:e.version})}else t=Object(c.pick)(e,["id","version","schedule","query","description","name","data_source_id","options","latest_query_data_id","is_draft","tags"]);return Yg(t,{canOverwrite:ae.canEdit(e)}).then(a=>{Object(c.isNil)(i)||sn.success(i),r(Object(c.extend)(e.clone(),a.id!==e.id?a:Object(c.pick)(a,Object(c.uniq)(["id","version",...Object(c.keys)(t)]))))}).catch(e=>{var t={};e instanceof Gg&&(t.duration=null),sn.error(e.message,e.detailedMessage,t)})}),[e,r])}function Jg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Xg(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xg(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Zg(e){var t=Jg(Object(a.useState)(!1),2),r=t[0],n=t[1],i=Object(a.useCallback)(()=>{var t="duplicatedQueryTab/".concat(Math.random().toString()),r=window.open("",t);n(!0),ir.fork({id:e.id}).then(e=>{r.location=function(e){var t=A.a.parse(window.location.search);e=yf.a.parse(e);var r=A.a.parse(e.search);return yf.a.format(Object(c.extend)(Object(c.pick)(e,["protocol","auth","host","pathname","hash"]),{search:A.a.stringify(Object(c.extend)(t,r))}))}(e.getUrl(!0))}).finally(()=>{n(!1)})},[e.id]);return[r,r?c.noop:i]}var ey=["copyable","children"];function ty(){return(ty=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function ry(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function ay(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class ny extends n.a.Component{constructor(e){super(e),ay(this,"state",{copied:null}),ay(this,"copy",()=>{window.getSelection().selectAllChildren(this.ref.current);try{if(!document.execCommand("copy"))throw new Error;this.setState({copied:"Copied!"})}catch(e){this.setState({copied:"Copy failed"})}window.getSelection().removeAllRanges(),this.resetCopyState=setTimeout(()=>this.setState({copied:null}),2e3)}),this.ref=n.a.createRef(),this.copyFeatureEnabled=e.copyable&&document.queryCommandSupported("copy"),this.resetCopyState=null}componentWillUnmount(){this.resetCopyState&&clearTimeout(this.resetCopyState)}render(){var e=this.props,t=(e.copyable,e.children),r=ry(e,ey),a=n.a.createElement(Ne,{title:this.state.copied||"Copy"},n.a.createElement(h.a,{icon:n.a.createElement(Yp.a,null),type:"dashed",size:"small",onClick:this.copy}));return n.a.createElement("div",{className:"code-block"},n.a.createElement("code",ty({},r,{ref:this.ref}),t),this.copyFeatureEnabled&&a)}}ay(ny,"propTypes",{copyable:se.a.bool,children:se.a.node}),ay(ny,"defaultProps",{copyable:!1,children:null});var iy=["dialog"];function sy(){return(sy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function oy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ly(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ly(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ly(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function cy(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function uy(e){var t=e.dialog,r=cy(e,iy),i=oy(Object(a.useState)(r.query),2),s=i[0],o=i[1],l=oy(Object(a.useState)(!1),2),u=l[0],d=l[1],m=Object(a.useCallback)(()=>{d(!0),K.post("api/queries/".concat(s.id,"/regenerate_api_key")).then(e=>{d(!1),o(Object(c.extend)(s.clone(),{api_key:e.api_key}))}).catch(()=>{d(!1),sn.error("Failed to update API key")})},[s]),p=Object(a.useMemo)(()=>({csvUrl:"".concat($.basePath,"api/queries/").concat(s.id,"/results.csv?api_key=").concat(s.api_key),jsonUrl:"".concat($.basePath,"api/queries/").concat(s.id,"/results.json?api_key=").concat(s.api_key)}),[s.id,s.api_key]),f=p.csvUrl,b=p.jsonUrl,g=qe("csv-results-label"),y=qe("json-results-label");return n.a.createElement(V.a,sy({},t.props,{width:600,footer:n.a.createElement(h.a,{onClick:()=>t.close(s)},"Close")}),n.a.createElement("div",{className:"query-api-key-dialog-wrapper"},n.a.createElement("h5",null,"API Key"),n.a.createElement("div",{className:"m-b-20"},n.a.createElement(He.a.Group,{compact:!0},n.a.createElement(He.a,{readOnly:!0,value:s.api_key,"aria-label":"Query API Key"}),ae.canEdit(s)&&n.a.createElement(h.a,{disabled:u,loading:u,onClick:m},"Regenerate"))),n.a.createElement("h5",null,"Example API Calls:"),n.a.createElement("div",{className:"m-b-10"},n.a.createElement("span",{id:g},"Results in CSV format:"),n.a.createElement(ny,{"aria-labelledby":g,copyable:!0},f)),n.a.createElement("div",null,n.a.createElement("span",{id:y},"Results in JSON format:"),n.a.createElement(ny,{"aria-labelledby":y,copyable:!0},b))))}uy.propTypes={dialog:Je.isRequired,query:se.a.shape({id:se.a.number.isRequired,api_key:se.a.string,can_edit:se.a.bool}).isRequired};var dy=Xe(uy);function my(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return py(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return py(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function py(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function fy(){return Fl("api/queries/tags").then(e=>Object(c.map)(e,e=>e.name))}function hy(e){var t=e.query,r=e.dataSource,i=e.sourceMode,s=e.selectedVisualization,o=e.headerExtra,l=e.tagsExtra,u=e.onChange,d=Cg()({minWidth:768}),m=Ug(t,r),p=function(e,t){var r=$g(e,t);return Object(a.useCallback)(t=>{vt("edit_name","query",e.id);var a={name:t},n={};e.is_draft&&$.autoPublishNamedQueries&&"New Query"!==t&&(a.is_draft=!1,n.successMessage="Query saved and published"),r(a,n)},[e.id,e.is_draft,r])}(t,u),f=function(e,t){var r=$g(e,t);return Object(a.useCallback)(t=>{vt("edit_tags","query",e.id),r({tags:t})},[e.id,r])}(t,u),b=Vg(t,u),g=function(e,t){var r=$g(e,t);return Object(a.useCallback)(()=>{vt("toggle_published","query",e.id),r({is_draft:!1})},[e.id,r])}(t,u),y=function(e,t){var r=$g(e,t);return Object(a.useCallback)(()=>{vt("toggle_published","query",e.id),r({is_draft:!0})},[e.id,r])}(t,u),v=my(Zg(t),2),O=v[0],E=v[1],j=function(e,t){var r=_d(t);return Object(a.useCallback)(()=>{dy.showModal({query:e}).onClose(r)},[e,r])}(t,u),w=function(e){return Object(a.useCallback)(()=>{Gp.showModal({aclUrl:"api/queries/".concat(e.id,"/acl"),context:"query",author:e.user})},[e.id,e.user])}(t),P=Object(a.useMemo)(()=>{return e=[{fork:{isEnabled:!m.isNew&&m.canFork&&!O,title:n.a.createElement(n.a.Fragment,null,"Fork ",n.a.createElement("i",{className:"fa fa-external-link m-l-5","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"(opens in a new tab)")),onClick:E}},{archive:{isAvailable:!m.isNew&&m.canEdit&&!m.isArchived,title:"Archive",onClick:b},managePermissions:{isAvailable:!m.isNew&&m.canEdit&&!m.isArchived&&$.showPermissionsControl,title:"Manage Permissions",onClick:w},publish:{isAvailable:!d&&m.isDraft&&!m.isArchived&&!m.isNew&&m.canEdit,title:"Publish",onClick:g},unpublish:{isAvailable:!$.disablePublish&&!m.isNew&&m.canEdit&&!m.isDraft,title:"Unpublish",onClick:y}},{showAPIKey:{isAvailable:!$.disablePublicUrls&&!m.isNew,title:"Show API Key",onClick:j}}],t={},r=Object(c.map)(e,e=>Object(c.filter)(Object(c.map)(e,(e,r)=>(e=Object(c.extend)({isAvailable:!0,isEnabled:!0,onClick:()=>{}},e)).isAvailable?(t[r]=e.onClick,n.a.createElement(he.a.Item,{key:r,disabled:!e.isEnabled},e.title)):null))),n.a.createElement(he.a,{onClick:e=>{var r=e.key;return t[r]()}},Object(c.reduce)(Object(c.filter)(r,e=>e.length>0),(e,t,r)=>{var a=e.length>0?n.a.createElement(he.a.Divider,{key:"divider".concat(r)}):null;return[...e,a,...t]},[]));var e,t,r},[m.isNew,m.canFork,m.canEdit,m.isArchived,m.isDraft,O,E,b,w,d,g,y,j]);return n.a.createElement("div",{className:"query-page-header"},n.a.createElement("div",{className:"title-with-tags"},n.a.createElement("div",{className:"page-title"},n.a.createElement("div",{className:"d-flex align-items-center"},!m.isNew&&n.a.createElement(zn,{item:t}),n.a.createElement("h3",null,n.a.createElement(xf,{isEditable:m.canEdit,onDone:p,ignoreBlanks:!0,value:t.name})))),n.a.createElement("div",{className:"query-tags"},n.a.createElement(ts,{tags:t.tags,isDraft:m.isDraft,isArchived:m.isArchived,canEdit:m.canEdit,getAvailableTags:fy,onEdit:f,tagsExtra:l}))),n.a.createElement("div",{className:"header-actions"},o,d&&m.isDraft&&!m.isArchived&&!m.isNew&&m.canEdit&&n.a.createElement(h.a,{className:"m-r-5",onClick:g},n.a.createElement("i",{className:"fa fa-paper-plane m-r-5","aria-hidden":"true"})," Publish"),!m.isNew&&m.canViewSource&&n.a.createElement("span",null,!i&&n.a.createElement(S.Button,{className:"m-r-5",href:t.getUrl(!0,s)},n.a.createElement("i",{className:"fa fa-pencil-square-o","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5"},"Edit Source")),i&&n.a.createElement(S.Button,{className:"m-r-5",href:t.getUrl(!1,s),"data-test":"QueryPageShowResultOnly"},n.a.createElement("i",{className:"fa fa-table","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5"},"Show Results Only"))),!m.isNew&&n.a.createElement(Da.a,{overlay:P,trigger:["click"]},n.a.createElement(h.a,{"data-test":"QueryPageHeaderMoreButton","aria-label":"More actions"},n.a.createElement(po.a,{rotate:90,"aria-hidden":"true"})))))}function by(e){var t=e.query,r=e.dataSource,a=e.layout,i=e.onEditSchedule;return n.a.createElement("div",{className:"query-metadata query-metadata-".concat(a)},n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("img",{className:"profile__image_thumb",src:t.user.profile_image_url,alt:"Avatar"}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("strong",{className:ge()("query-metadata-label",{"text-muted":t.user.is_disabled})},t.user.name),n.a.createElement("span",{className:"query-metadata-value"},"created"," ",n.a.createElement("strong",null,n.a.createElement(Jn,{date:t.created_at}))))),n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("img",{className:"profile__image_thumb",src:t.last_modified_by.profile_image_url,alt:"Avatar"}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("strong",{className:ge()("query-metadata-label",{"text-muted":t.last_modified_by.is_disabled})},t.last_modified_by.name),n.a.createElement("span",{className:"query-metadata-value"},"updated"," ",n.a.createElement("strong",null,n.a.createElement(Jn,{date:t.updated_at}))))),n.a.createElement("div",{className:"query-metadata-space"}),Object(c.has)(r,"name")&&Object(c.has)(r,"type")&&n.a.createElement("div",{className:"query-metadata-item"},"Data Source:",n.a.createElement("img",{src:"".concat("static/images/db-logos","/").concat(r.type,".png"),width:"20",alt:r.type}),n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("div",{className:"query-metadata-label"},r.name))),n.a.createElement("div",{className:"query-metadata-item"},n.a.createElement("div",{className:"query-metadata-property"},n.a.createElement("span",{className:"query-metadata-label"},n.a.createElement("span",{className:"zmdi zmdi-refresh m-r-5"}),"Refresh Schedule"),n.a.createElement("span",{className:"query-metadata-value"},n.a.createElement(ss,{isLink:Object(c.isFunction)(i),isNew:t.isNew(),schedule:t.schedule,onClick:i})))))}hy.propTypes={query:se.a.shape({id:se.a.oneOfType([se.a.number,se.a.string]),name:se.a.string,tags:se.a.arrayOf(se.a.string)}).isRequired,dataSource:se.a.object,sourceMode:se.a.bool,selectedVisualization:se.a.number,headerExtra:se.a.node,tagsExtra:se.a.node,onChange:se.a.func},hy.defaultProps={dataSource:null,sourceMode:!1,selectedVisualization:null,headerExtra:null,tagsExtra:null,onChange:()=>{}},by.propTypes={layout:se.a.oneOf(["table","horizontal"]),query:se.a.shape({created_at:se.a.oneOfType([se.a.string,Kn]).isRequired,updated_at:se.a.oneOfType([se.a.string,Kn]).isRequired,user:se.a.shape({name:se.a.string.isRequired,profile_image_url:se.a.string.isRequired,is_disabled:se.a.bool}).isRequired,last_modified_by:se.a.shape({name:se.a.string.isRequired,profile_image_url:se.a.string.isRequired,is_disabled:se.a.bool}).isRequired,schedule:se.a.object}).isRequired,dataSource:se.a.shape({type:se.a.string,name:se.a.string}),onEditSchedule:se.a.func},by.defaultProps={layout:"table",dataSource:null,onEditSchedule:null};var gy=["visualizationName","canDelete","onDelete"],yy=["queryResult","selectedTab","showNewVisualizationButton","canDeleteVisualizations","onChangeTab","onAddVisualization","onDeleteVisualization","refreshButton","canRefresh"];function vy(){return(vy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Oy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ey(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ey(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ey(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function jy(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var wy=wn.a.TabPane;function Sy(e){var t=e.title,r=e.message,a=e.refreshButton;return n.a.createElement("div",{className:"query-results-empty-state"},n.a.createElement("div",{className:"empty-state-content"},n.a.createElement("div",null,n.a.createElement("img",{src:"static/images/illustrations/no-query-results.svg",alt:"No Query Results Illustration"})),n.a.createElement("h3",null,t),n.a.createElement("div",{className:"m-b-20"},r),a))}function Py(e){var t=e.visualizationName,r=e.canDelete,i=e.onDelete,s=jy(e,gy),o=Object(a.useCallback)(e=>{e.stopPropagation(),V.a.confirm({title:"Delete Visualization",content:"Are you sure you want to delete this visualization?",okText:"Delete",okType:"danger",onOk:i,maskClosable:!0,autoFocusButton:null})},[i]);return n.a.createElement("span",s,t,r&&n.a.createElement(Ee,{className:"delete-visualization-button",onClick:o,"aria-label":"Close",title:"Close"},n.a.createElement("i",{className:"zmdi zmdi-close","aria-hidden":"true"})))}Sy.propTypes={title:se.a.string.isRequired,message:se.a.string.isRequired,refreshButton:se.a.node},Sy.defaultProps={refreshButton:null},Py.propTypes={visualizationName:se.a.string.isRequired,canDelete:se.a.bool,onDelete:se.a.func},Py.defaultProps={canDelete:!1,onDelete:()=>{}};var Cy=[{type:"TABLE",name:"Table",id:null,options:{}}];function Ny(e){var t=e.queryResult,r=e.selectedTab,i=e.showNewVisualizationButton,s=e.canDeleteVisualizations,o=e.onChangeTab,l=e.onAddVisualization,u=e.onDeleteVisualization,d=e.refreshButton,m=e.canRefresh,p=jy(e,yy),f=Object(a.useMemo)(()=>p.visualizations.length>0?p.visualizations:Cy,[p.visualizations]),b={};Object(c.find)(f,{id:r})&&(b.activeKey="".concat(r)),i&&(b.tabBarExtraContent=n.a.createElement(h.a,{className:"add-visualization-button","data-test":"NewVisualization",type:"link",onClick:()=>l()},n.a.createElement("i",{className:"fa fa-plus","aria-hidden":"true"}),n.a.createElement("span",{className:"m-l-5 hidden-xs"},"Add Visualization")));var g=Object(a.useMemo)(()=>Object(c.orderBy)(f,["id"]),[f]),y=Object(a.useCallback)(e=>e===g[0].id,[g]),v=Cg()({maxWidth:768}),O=Oy(Object(a.useState)([]),2),E=O[0],j=O[1];return n.a.createElement(wn.a,vy({},b,{type:"card",className:ge()("query-visualization-tabs card-style"),"data-test":"QueryPageVisualizationTabs",animated:!1,tabBarGutter:0,onChange:e=>o(+e),destroyInactiveTabPane:!0}),g.map(e=>n.a.createElement(wy,{key:"".concat(e.id),tab:n.a.createElement(Py,{"data-test":"QueryPageVisualizationTab".concat(e.id),canDelete:!v&&s&&!y(e.id),visualizationName:e.name,onDelete:()=>u(e.id)})},t?n.a.createElement(Qd,{visualization:e,queryResult:t,context:"query",filters:E,onFiltersChange:j}):n.a.createElement(Sy,{title:"Query has no result",message:m?"Execute/Refresh the query to show results.":"You do not have a permission to execute/refresh this query.",refreshButton:d}))))}function ky(e){var t=e.status,r=e.updatedAt,a=e.error,i=e.isCancelling,s=e.onCancel,o="failed"===t?"error":"info",l="failed"!==t&&r,u=Object(c.includes)(["waiting","processing"],t),d=i?n.a.createElement(n.a.Fragment,null,"Cancelling…"):null;switch(t){case"waiting":i||(d=n.a.createElement(n.a.Fragment,null,"Query in queue…"));break;case"processing":i||(d=n.a.createElement(n.a.Fragment,null,"Executing query…"));break;case"loading-result":d=n.a.createElement(n.a.Fragment,null,"Loading results…");break;case"failed":d=n.a.createElement(n.a.Fragment,null,"Error running query: ",n.a.createElement("strong",null,a))}return n.a.createElement(p.a,{"data-test":"QueryExecutionStatus",type:o,message:n.a.createElement("div",{className:"d-flex align-items-center"},n.a.createElement("div",{className:"flex-fill p-t-5 p-b-5"},d," ",l&&n.a.createElement(pd,{from:r})),n.a.createElement("div",null,u&&n.a.createElement(h.a,{className:"m-l-10",type:"primary",size:"small",disabled:i,onClick:s},"Cancel")))})}function _y(e){var t=e.query,r=e.dataSourcesAvailable,a=Ug(t),i=null;return a.isNew&&!a.canCreate?i=n.a.createElement(n.a.Fragment,null,n.a.createElement(Xc.a.Title,{level:4},"You don't have permission to create new queries on any of the data sources available to you."),n.a.createElement("p",null,n.a.createElement(Xc.a.Text,{type:"secondary"},"You can either ",n.a.createElement(S,{href:"queries"},"browse existing queries"),", or ask for additional permissions from your Redash admin."))):r||(i=Y.isAdmin?n.a.createElement(n.a.Fragment,null,n.a.createElement(Xc.a.Title,{level:4},"Looks like no data sources were created yet or none of them available to the group(s) you're member of."),n.a.createElement("p",null,n.a.createElement(Xc.a.Text,{type:"secondary"},"Please create one first, and then start querying.")),n.a.createElement("div",{className:"query-source-alerts-actions"},n.a.createElement(S.Button,{type:"primary",href:"data_sources/new"},"Create Data Source"),n.a.createElement(S.Button,{type:"default",href:"groups"},"Manage Group Permissions"))):n.a.createElement(n.a.Fragment,null,n.a.createElement(Xc.a.Title,{level:4},"Looks like no data sources were created yet or none of them available to the group(s) you're member of."),n.a.createElement("p",null,n.a.createElement(Xc.a.Text,{type:"secondary"},"Please ask your Redash admin to create one first.")))),i?n.a.createElement("div",{className:"query-source-alerts"},n.a.createElement(An.a,null,n.a.createElement(pe,{name:"QuerySource.Alerts",query:t,dataSourcesAvailable:r},n.a.createElement("div",{className:"query-source-alerts-icon"},n.a.createElement(Eo.a,null)),i))):null}Ny.propTypes={queryResult:se.a.object,visualizations:se.a.arrayOf(se.a.object),selectedTab:se.a.number,showNewVisualizationButton:se.a.bool,canDeleteVisualizations:se.a.bool,onChangeTab:se.a.func,onAddVisualization:se.a.func,onDeleteVisualization:se.a.func,refreshButton:se.a.node,canRefresh:se.a.bool},Ny.defaultProps={queryResult:null,visualizations:[],selectedTab:null,showNewVisualizationButton:!1,canDeleteVisualizations:!1,onChangeTab:()=>{},onAddVisualization:()=>{},onDeleteVisualization:()=>{},refreshButton:null,canRefresh:!0},ky.propTypes={status:se.a.string,updatedAt:se.a.any,error:se.a.string,isCancelling:se.a.bool,onCancel:se.a.func},ky.defaultProps={status:"waiting",updatedAt:null,error:null,isCancelling:!0,onCancel:()=>{}},_y.propTypes={query:se.a.object.isRequired,dataSourcesAvailable:se.a.bool},_y.defaultProps={dataSourcesAvailable:!1};var Ay=["queryId","onError"];function xy(){return(xy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function qy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ty(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ty(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ty(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Iy(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Dy(e){function t(t){var r=t.queryId,i=t.onError,s=Iy(t,Ay),o=qy(Object(a.useState)(null),2),l=o[0],c=o[1],u=_d(i);return Object(a.useEffect)(()=>{var e=!1;return(r?ir.get({id:r}):Promise.resolve(ir.newQuery())).then(t=>{e||c(t)}).catch(u),()=>{e=!0}},[r,u]),l?n.a.createElement(e,xy({query:l,onError:i},s)):n.a.createElement(Us,{className:"flex-fill"})}return t.propTypes={queryId:se.a.oneOfType([se.a.number,se.a.string])},t.defaultProps={queryId:null},t}var Ry=r(1090),My=r.n(Ry);function zy(){return(zy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Fy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ly(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ly(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ly(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Uy(e){var t=e.dialog,r=e.visualization,i=Fy(Object(a.useState)(""),2),s=i[0],o=i[1],l=Fy(Vo(e=>Object(c.isString)(e)&&""!==e?$r.query({q:e}).then(e=>e.results).catch(()=>[]):Promise.resolve([]),{initialResults:[]}),3),u=l[0],d=l[1],m=l[2],p=Fy(Object(a.useState)(null),2),f=p[0],h=p[1],b=Fy(Object(a.useState)(!1),2),g=b[0],y=b[1];Object(a.useEffect)(()=>{u(s)},[u,s]);var v=f?[f]:d;return n.a.createElement(V.a,zy({},t.props,{title:"Add to Dashboard",okButtonProps:{disabled:!f||g,loading:g},cancelButtonProps:{disabled:g},onOk:function(){$r.get(f).then(e=>(e.addWidget(r),e)).then(e=>{t.close();var r="notification-".concat(Math.random().toString(36).substr(2,10));sn.success("Widget added to dashboard",n.a.createElement(n.a.Fragment,null,n.a.createElement(S,{href:"".concat(e.url),onClick:()=>sn.close(r)},e.name),n.a.createElement(ts,{isDraft:e.is_draft,tags:e.tags})),{key:r})}).catch(()=>{sn.error("Widget not added.")}).finally(()=>{y(!1)})}}),n.a.createElement("label",{htmlFor:"add-to-dashboard-dialog-dashboard"},"Choose the dashboard to add this query to:"),!f&&n.a.createElement(He.a,{id:"add-to-dashboard-dialog-dashboard",className:"w-100",autoComplete:"off",autoFocus:!0,placeholder:"Search a dashboard by name",value:s,onChange:e=>o(e.target.value),suffix:n.a.createElement(Ee,{className:""===s?"hidden":null,onClick:()=>o("")},n.a.createElement(xe.a,null))}),(v.length>0||m)&&n.a.createElement(Gs.a,{className:f?"add-to-dashboard-dialog-selection":"add-to-dashboard-dialog-search-results",bordered:!0,itemLayout:"horizontal",loading:m,dataSource:v,renderItem:e=>n.a.createElement(Gs.a.Item,{key:"dashboard-".concat(e.id),actions:f?[n.a.createElement(Ee,{onClick:()=>h(null)},n.a.createElement(xe.a,null))]:[],onClick:f?null:()=>h(e)},n.a.createElement("div",{className:"add-to-dashboard-dialog-item-content"},e.name,n.a.createElement(ts,{isDraft:e.is_draft,tags:e.tags})))}))}Uy.propTypes={dialog:Je.isRequired,visualization:se.a.object.isRequired};var Vy=Xe(Uy);function By(){return(By=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Qy(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Wy extends n.a.Component{constructor(e){super(e),Qy(this,"state",{enableChangeIframeSize:!1,iframeWidth:720,iframeHeight:391}),Qy(this,"urlEmbedLabelId",Object(c.uniqueId)("url-embed-label")),Qy(this,"iframeEmbedLabelId",Object(c.uniqueId)("iframe-embed-label"));var t=e.query,r=e.visualization;this.embedUrl="".concat($.basePath,"embed/query/").concat(t.id,"/visualization/").concat(r.id,"?api_key=").concat(t.api_key,"&").concat(t.getParameters().toUrlParams()),window.snapshotUrlBuilder&&(this.snapshotUrl=window.snapshotUrlBuilder(t,r))}render(){var e=this.props,t=e.query,r=e.dialog,a=this.state,i=a.enableChangeIframeSize,s=a.iframeWidth,o=a.iframeHeight;return n.a.createElement(V.a,By({},r.props,{className:"embed-query-dialog",title:"Embed Query",footer:n.a.createElement(h.a,{onClick:r.dismiss},"Close")}),t.is_safe?n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",{id:this.urlEmbedLabelId,className:"m-t-0"},"Public URL"),n.a.createElement("div",{className:"m-b-30"},n.a.createElement(ny,{"aria-labelledby":this.urlEmbedLabelId,"data-test":"EmbedIframe",copyable:!0},this.embedUrl)),n.a.createElement("h5",{id:this.iframeEmbedLabelId,className:"m-t-0"},"IFrame Embed"),n.a.createElement("div",null,n.a.createElement(ny,{"aria-labelledby":this.iframeEmbedLabelId,copyable:!0},'<iframe src="'.concat(this.embedUrl,'" width="').concat(s,'" height="').concat(o,'"></iframe>')),n.a.createElement(yo.a,{className:"m-t-10",layout:"inline"},n.a.createElement(yo.a.Item,null,n.a.createElement(Jl.a,{checked:i,onChange:e=>this.setState({enableChangeIframeSize:e.target.checked})})),n.a.createElement(yo.a.Item,{label:"Width"},n.a.createElement(_o.a,{className:"size-input",value:s,onChange:e=>this.setState({iframeWidth:e}),size:"small",disabled:!i})),n.a.createElement(yo.a.Item,{label:"Height"},n.a.createElement(_o.a,{className:"size-input",value:o,onChange:e=>this.setState({iframeHeight:e}),size:"small",disabled:!i})))),this.snapshotUrl&&n.a.createElement(n.a.Fragment,null,n.a.createElement("h5",null,"Image Embed"),n.a.createElement(ny,{copyable:!0},this.snapshotUrl))):n.a.createElement(p.a,{message:"Currently it is not possible to embed queries that contain text parameters.",type:"error","data-test":"EmbedErrorAlert"}))}}Qy(Wy,"propTypes",{dialog:Je.isRequired,query:se.a.object.isRequired,visualization:se.a.object.isRequired});var Hy=Xe(Wy);var Gy=r(1087),Ky=r.n(Gy),Yy=r(1088),$y=r.n(Yy),Jy=r(285),Xy=r.n(Jy),Zy=r(442),ev=r.n(Zy);function tv(e){var t="",r=e.query,a=e.queryResult,i=e.fileType,s=a.getId&&a.getId(),o=a.getData&&a.getData();return s&&o&&r.name&&(t=r.id?"api/queries/".concat(r.id,"/results/").concat(s,".").concat(i).concat(e.embed?"?api_key=".concat(e.apiKey):""):"api/query_results/".concat(s,".").concat(i)),n.a.createElement(S,{target:"_blank",rel:"noopener noreferrer",disabled:e.disabled,href:t,download:!0},e.children)}function rv(e){var t=n.a.createElement(he.a,null,!e.query.isNew()&&(!e.query.is_draft||!e.query.is_archived)&&n.a.createElement(he.a.Item,null,n.a.createElement(Ee,{onClick:()=>e.openAddToDashboardForm(e.selectedTab)},n.a.createElement(Ky.a,null)," Add to Dashboard")),!$.disablePublicUrls&&!e.query.isNew()&&n.a.createElement(he.a.Item,null,n.a.createElement(Ee,{onClick:()=>e.showEmbedDialog(e.query,e.selectedTab),"data-test":"ShowEmbedDialogButton"},n.a.createElement($y.a,null)," Embed Elsewhere")),n.a.createElement(he.a.Item,null,n.a.createElement(tv,{fileType:"csv",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(Xy.a,null)," Download as CSV File")),n.a.createElement(he.a.Item,null,n.a.createElement(tv,{fileType:"tsv",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(Xy.a,null)," Download as TSV File")),n.a.createElement(he.a.Item,null,n.a.createElement(tv,{fileType:"xlsx",disabled:e.queryExecuting||!e.queryResult.getData||!e.queryResult.getData(),query:e.query,queryResult:e.queryResult,embed:e.embed,apiKey:e.apiKey},n.a.createElement(ev.a,null)," Download as Excel File")));return n.a.createElement(Da.a,{trigger:["click"],overlay:t,overlayClassName:"query-control-dropdown-overlay"},n.a.createElement(h.a,{"data-test":"QueryControlDropdownButton"},n.a.createElement(po.a,{rotate:90})))}tv.propTypes={query:se.a.object.isRequired,queryResult:se.a.object,fileType:se.a.string,disabled:se.a.bool.isRequired,embed:se.a.bool,apiKey:se.a.string,children:se.a.oneOfType([se.a.arrayOf(se.a.node),se.a.node]).isRequired},tv.defaultProps={queryResult:{},fileType:"csv",embed:!1,apiKey:""},rv.propTypes={query:se.a.object.isRequired,queryResult:se.a.object,queryExecuting:se.a.bool.isRequired,showEmbedDialog:se.a.func.isRequired,embed:se.a.bool,apiKey:se.a.string,selectedTab:se.a.oneOfType([se.a.string,se.a.number]),openAddToDashboardForm:se.a.func.isRequired},rv.defaultProps={queryResult:{},embed:!1,apiKey:"",selectedTab:""};var av=r(1089),nv=r.n(av);function iv(e){return n.a.createElement(h.a,{"data-test":"EditVisualization",className:"edit-visualization",onClick:()=>e.openVisualizationEditor(e.selectedTab)},n.a.createElement(nv.a,null),n.a.createElement("span",{className:"hidden-xs hidden-s hidden-m"},"Edit Visualization"))}function sv(e){var t=e.query,r=e.queryResult,i=e.isQueryExecuting,s=e.selectedVisualization,o=e.showEditVisualizationButton,l=e.onEditVisualization,u=e.extraActions,d=kd(r),m=function(e){return Object(a.useCallback)(t=>{var r=Object(c.find)(e.visualizations,{id:t});Vy.showModal({visualization:r})},[e.visualizations])}(t),p=function(e){return Object(a.useCallback)((t,r)=>{var a=Object(c.find)(e.visualizations,{id:r});Hy.showModal({query:e,visualization:a})},[e])}(t);return n.a.createElement("div",{className:"query-execution-metadata"},n.a.createElement("span",{className:"m-r-5"},n.a.createElement(rv,{query:t,queryResult:r,queryExecuting:i,showEmbedDialog:p,embed:!1,apiKey:t.api_key,selectedTab:s,openAddToDashboardForm:m})),u,o&&n.a.createElement(iv,{openVisualizationEditor:l,selectedTab:s}),n.a.createElement("span",{className:"m-l-5 m-r-10"},n.a.createElement("span",null,!0===d.truncated&&n.a.createElement("span",{className:"m-r-5"},n.a.createElement(Ne,{title:"Result truncated to "+d.rows.length+" rows. Databricks may truncate query results that are unstably large."},n.a.createElement(My.a,{twoToneColor:"#FF9800"}))),n.a.createElement("strong",null,d.rows.length)," ",si("row",d.rows.length)),n.a.createElement("span",{className:"m-l-5"},!i&&n.a.createElement(n.a.Fragment,null,n.a.createElement("strong",null,oi(d.runtime)),n.a.createElement("span",{className:"hidden-xs"}," runtime")),i&&n.a.createElement("span",null,"Running…")),d.metadata.data_scanned&&n.a.createElement("span",{className:"m-l-5"},"Data Scanned",n.a.createElement("strong",null,di(d.metadata.data_scanned)))),n.a.createElement("div",null,n.a.createElement("span",{className:"m-r-10"},n.a.createElement("span",{className:"hidden-xs"},"Refreshed "),n.a.createElement("strong",null,n.a.createElement(Jn,{date:d.retrievedAt,placeholder:"-"})))))}iv.propTypes={openVisualizationEditor:se.a.func.isRequired,selectedTab:se.a.oneOfType([se.a.string,se.a.number])},iv.defaultProps={selectedTab:""},sv.propTypes={query:se.a.object.isRequired,queryResult:se.a.object.isRequired,isQueryExecuting:se.a.bool,selectedVisualization:se.a.number,showEditVisualizationButton:se.a.bool,onEditVisualization:se.a.func,extraActions:se.a.node},sv.defaultProps={isQueryExecuting:!1,selectedVisualization:null,showEditVisualizationButton:!1,onEditVisualization:()=>{},extraActions:null};var ov=r(1091),lv=r.n(ov),cv=r(1092),uv=r.n(cv);function dv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return mv(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mv(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function pv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return e?Ab.fetchSchema(e,t).catch(()=>(sn.error("Schema refresh failed.","Please try again later."),Promise.resolve([]))):Promise.resolve([])}var fv=["item","expanded","onToggle","onSelect"],hv=["dataSource","onSchemaUpdate","onItemSelect","options","onOptionsUpdate"];function bv(){return(bv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function gv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function yv(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?gv(Object(r),!0).forEach((function(t){vv(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gv(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function vv(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ov(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ev(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ev(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ev(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function jv(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var wv=se.a.shape({name:se.a.string.isRequired,type:se.a.string}),Sv=se.a.shape({name:se.a.string.isRequired,size:se.a.number,loading:se.a.bool,columns:se.a.arrayOf(wv).isRequired});function Pv(e){var t=e.item,r=e.expanded,i=e.onToggle,s=e.onSelect,o=jv(e,fv),l=Object(a.useCallback)((function(e){e.preventDefault(),e.stopPropagation();for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];s(...r)}),[s]);if(!t)return null;var u=t.displayName||t.name;return n.a.createElement("div",o,n.a.createElement("div",{className:"schema-list-item"},n.a.createElement(Ee,{className:"table-name",onClick:i},n.a.createElement("i",{className:"fa fa-table m-r-5","aria-hidden":"true"}),n.a.createElement("strong",null,n.a.createElement("span",{title:t.name},u),!Object(c.isNil)(t.size)&&n.a.createElement("span",null," (",t.size,")"))),n.a.createElement(Ne,{title:"Insert table name into query text",mouseEnterDelay:0,mouseLeaveDelay:0,placement:"topRight",arrowPointAtCenter:!0},n.a.createElement(Ee,{className:"copy-to-editor",onClick:e=>l(e,t.name)},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"})))),r&&n.a.createElement("div",{className:"table-open"},t.loading?n.a.createElement("div",{className:"table-open"},"Loading..."):Object(c.map)(t.columns,e=>{var t=Object(c.get)(e,"name"),r=Object(c.get)(e,"type");return n.a.createElement(Ne,{title:"Insert column name into query text",mouseEnterDelay:0,mouseLeaveDelay:0,placement:"rightTop"},n.a.createElement(Ee,{key:t,className:"table-open-item",onClick:e=>l(e,t)},n.a.createElement("div",null,t," ",r&&n.a.createElement("span",{className:"column-type"},r)),n.a.createElement("div",{className:"copy-to-editor"},n.a.createElement("i",{className:"fa fa-angle-double-right","aria-hidden":"true"}))))})))}function Cv(){return n.a.createElement("div",{className:"schema-loading-state"},n.a.createElement(Us,{className:""}))}function Nv(e){var t=e.loading,r=e.schema,i=e.expandedFlags,s=e.onTableExpand,o=e.onItemSelect,l=Ov(Object(a.useState)(null),2),c=l[0],u=l[1];return Object(a.useEffect)(()=>{c&&c.recomputeRowHeights()},[c,r,i]),n.a.createElement("div",{className:"schema-browser"},t&&n.a.createElement(Cv,null),!t&&n.a.createElement(lv.a,null,e=>{var t=e.width,a=e.height;return n.a.createElement(uv.a,{ref:u,width:t,height:a,rowCount:r.length,rowHeight:e=>{var t=e.index,a=r[t],n=a.loading?1:a.columns.length;return 22+18*(i[a.name]?n:0)},rowRenderer:e=>{var t=e.key,a=e.index,l=e.style,c=r[a];return n.a.createElement(Pv,{key:t,style:l,item:c,expanded:i[c.name],onToggle:()=>s(c.name),onSelect:o})}})}))}function kv(e,t){var r=Object(c.filter)(t.toLowerCase().split(/\s+/),e=>e.length>0);if(0===r.length)return e;if(1===r.length){var a=r[0],n=r[0];return Object(c.filter)(e,e=>Object(c.includes)(e.name.toLowerCase(),a)||Object(c.some)(e.columns,e=>Object(c.includes)(Object(c.get)(e,"name").toLowerCase(),n)))}var i=r[0],s=r[1];return Object(c.filter)(Object(c.map)(e,e=>{if(Object(c.includes)(e.name.toLowerCase(),i))return(e=yv(yv({},e),{},{columns:Object(c.filter)(e.columns,e=>Object(c.includes)(Object(c.get)(e,"name").toLowerCase(),s))})).columns.length>0?e:null}))}function _v(e){var t=e.dataSource,r=e.onSchemaUpdate,i=e.onItemSelect,s=(e.options,e.onOptionsUpdate,jv(e,hv)),o=Ov(function(e){var t=dv(Object(a.useState)([]),2),r=t[0],n=t[1],i=dv(Object(a.useState)(!0),2),s=i[0],o=i[1],l=Object(a.useRef)(null),c=Object(a.useCallback)((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;o(!0);var r=Math.random().toString(36).substr(2);l.current=r,pv(e,t).then(e=>{l.current===r&&n(e)}).finally(()=>{l.current===r&&o(!1)})}),[e]);return Object(a.useEffect)(()=>{c()},[c]),Object(a.useEffect)(()=>()=>{l.current=null},[]),Object(a.useMemo)(()=>[r,s,c],[r,s,c])}(t),3),l=o[0],c=o[1],u=o[2],d=Ov(Object(a.useState)(""),2),m=d[0],p=d[1],f=Object(a.useMemo)(()=>kv(l,m),[l,m]),b=Ov(Object(Fo.a)(p,500),1)[0],g=Ov(Object(a.useState)({}),2),y=g[0],v=g[1],O=_d(r);if(Object(a.useEffect)(()=>{v({}),O(l)},[l,O]),0===l.length&&!c)return null;return n.a.createElement("div",bv({className:"schema-container"},s),n.a.createElement("div",{className:"schema-control"},n.a.createElement(He.a,{className:"m-r-5",placeholder:"Search schema...","aria-label":"Search schema",disabled:0===l.length,onChange:e=>b(e.target.value)}),n.a.createElement(Ne,{title:"Refresh Schema"},n.a.createElement(h.a,{onClick:()=>u(!0)},n.a.createElement("i",{className:ge()("zmdi zmdi-refresh",{"zmdi-hc-spin":c}),"aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},c?"Loading, please wait.":"Press to refresh.")))),n.a.createElement(Nv,{loading:c&&0===l.length,schema:f,expandedFlags:y,onTableExpand:function(e){v(yv(yv({},y),{},{[e]:!y[e]}))},onItemSelect:i}))}Pv.propTypes={item:Sv,expanded:se.a.bool,onToggle:se.a.func,onSelect:se.a.func},Pv.defaultProps={item:null,expanded:!1,onToggle:()=>{},onSelect:()=>{}},_v.propTypes={dataSource:se.a.object,onSchemaUpdate:se.a.func,onItemSelect:se.a.func},_v.defaultProps={dataSource:null,onSchemaUpdate:()=>{},onItemSelect:()=>{}};var Av=r(215),xv=r.n(Av),qv=(r(2621),r(2622),r(2623),r(2624),r(2625),r(2626),r(2627),xv.a.acequire("ace/ext/language_tools")),Tv=xv.a.acequire("ace/snippets");function Iv(e){xv.a.define("ace/snippets/".concat(e),["require","exports","module"],(t,r)=>{r.snippetText="",r.scope=e})}function Dv(e){var t=[],r={},a={};return e.forEach(e=>{t.push({name:e.name,value:e.name,score:100,meta:"Table"}),a[e.name]=function(e){var t=[];return e.columns.forEach(r=>{var a=Object(c.get)(r,"name");t.push({name:"".concat(e.name,".").concat(a),value:"".concat(e.name,".").concat(a),score:100,meta:Object(c.capitalize)(Object(c.get)(r,"type","Column"))})}),t}(e),e.columns.forEach(e=>{var t=Object(c.get)(e,"name",e);r[t]=Object(c.capitalize)(Object(c.get)(e,"type","Column"))})}),{table:t,column:Object(c.map)(r,(e,t)=>({name:t,value:t,score:50,meta:e})),tableColumn:a}}Iv("python"),Iv("sql"),Iv("json"),Iv("yaml"),xv.a.define("ace/mode/custom",[],()=>{});var Rv={};function Mv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Rv[e]=Object(c.isNil)(t)?null:Dv(t)}qv.setCompleters([qv.snippetCompleter,qv.keyWordCompleter,qv.textCompleter,{identifierRegexps:[/[a-zA-Z_0-9.\-\u00A2-\uFFFF]/],getCompletions:(e,t,r,a,n)=>{var i=Rv[e.id]||{table:[],column:[],tableColumn:[]},s=i.table,o=i.column,l=i.tableColumn;if(0!==a.length&&0!==s.length)if("."!==a[a.length-1])n(null,s.concat(o));else{var c=a.substring(0,a.length-1);n(null,s.concat(l[c]))}else n(null,[])}}]);class zv{constructor(e){Object(c.extend)(this,e)}getSnippet(){var e=this.trigger;return""!==this.description&&(e="".concat(this.trigger,": ").concat(this.description)),{name:e,content:this.snippet,tabTrigger:this.trigger}}}var Fv=e=>new zv(e),Lv={get:e=>K.get("api/query_snippets/".concat(e.id)).then(Fv),query:()=>K.get("api/query_snippets").then(e=>Object(c.map)(e,Fv)),create:e=>K.post("api/query_snippets",e).then(Fv),save:e=>K.post("api/query_snippets/".concat(e.id),e).then(Fv),delete:e=>K.delete("api/query_snippets/".concat(e.id))};function Uv(e){var t=e.available,r=e.enabled,i=e.onToggle,s="Live Autocomplete Enabled",o="icon-flash";r||(s="Live Autocomplete Disabled",o="icon-flash-off"),t||(s="Live Autocomplete Not Available (Use Ctrl+Space to Trigger)",o="icon-flash-off");var l=Object(a.useCallback)(()=>{vt("toggle_autocomplete","screen","query_editor",{state:!r}),i(!r)},[r,i]);return n.a.createElement(Ne,{placement:"top",title:s},n.a.createElement(h.a,{className:"query-editor-controls-button m-r-5",disabled:!t,onClick:l,"aria-label":r?"Disable live autocomplete":"Enable live autocomplete"},n.a.createElement("i",{className:"icon "+o,"aria-hidden":"true"})))}function Vv(e){var t=e.available,r=e.checked,i=e.onChange,s=Object(a.useCallback)(()=>{vt("checkbox_auto_limit","screen","query_editor",{state:!r}),i(!r)},[r,i]),o=null;return o=t?"Auto limit results to first 1000 rows.":"Auto limiting is not available for this Data Source type.",n.a.createElement(Ne,{placement:"top",title:o},n.a.createElement(Jl.a,{className:"query-editor-controls-checkbox",disabled:!t,onClick:s,checked:t&&r},"LIMIT 1000"))}Uv.propTypes={available:se.a.bool.isRequired,enabled:se.a.bool.isRequired,onToggle:se.a.func.isRequired},Vv.propTypes={available:se.a.bool,checked:se.a.bool.isRequired,onChange:se.a.func.isRequired};var Bv=["title","shortcut"];function Qv(){return(Qv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Wv(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Hv(e){var t=e.title,r=e.shortcut,a=Wv(e,Bv);return r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,r={mod:Object(c.upperFirst)(Nc),alt:Object(c.upperFirst)(kc)};return e=Object(c.toLower)(Object(c.toString)(e)),e=Object(c.filter)(Object(c.map)(e.split(","),c.trim),e=>""!==e).slice(0,t),""!==(e=Object(c.map)(e,e=>(e=Object(c.filter)(Object(c.map)(e.split("+")),e=>""!==e),Object(c.map)(e,e=>r[e]||Object(c.upperFirst)(e)).join(" + "))).join(", "))?e:null}(r,1),t=t&&r?n.a.createElement(n.a.Fragment,null,t," (",n.a.createElement("i",null,r),")"):t||r,n.a.createElement(Ne,Qv({placement:"top",title:t},a))}function Gv(e){var t=e.addParameterButtonProps,r=e.formatButtonProps,i=e.saveButtonProps,s=e.executeButtonProps,o=e.autocompleteToggleProps,l=e.autoLimitCheckboxProps,u=e.dataSourceSelectorProps;return Object(a.useEffect)(()=>{var e=Object(c.filter)([t,r,i,s],e=>e.shortcut&&Object(c.isFunction)(e.onClick));if(e.length>0){var a=Object(c.fromPairs)(Object(c.map)(e,e=>[e.shortcut,e.disabled?c.noop:e.onClick]));return xc.bind(a),()=>{xc.unbind(a)}}},[t,r,i,s]),n.a.createElement("div",{className:"query-editor-controls"},!1!==t&&n.a.createElement(Hv,{title:t.title,shortcut:t.shortcut},n.a.createElement(h.a,{className:"query-editor-controls-button m-r-5",disabled:t.disabled,onClick:t.onClick},"{{"," ","}}")),!1!==r&&n.a.createElement(Hv,{title:r.title,shortcut:r.shortcut},n.a.createElement(h.a,{className:"query-editor-controls-button m-r-5",disabled:r.disabled,onClick:r.onClick},n.a.createElement("span",{className:"zmdi zmdi-format-indent-increase"}),r.text)),!1!==o&&n.a.createElement(Uv,{available:o.available,enabled:o.enabled,onToggle:o.onToggle}),!1!==l&&n.a.createElement(Vv,l),!1===u&&n.a.createElement("span",{className:"query-editor-controls-spacer"}),!1!==u&&n.a.createElement(Qi.a,{className:"w-100 flex-fill datasource-small",disabled:u.disabled,value:u.value,onChange:u.onChange},Object(c.map)(u.options,e=>n.a.createElement(Qi.a.Option,{key:"option-".concat(e.value),value:e.value},e.label))),!1!==i&&n.a.createElement(Hv,{title:i.title,shortcut:i.shortcut},n.a.createElement(h.a,{className:"query-editor-controls-button m-l-5",disabled:i.disabled,loading:i.loading,onClick:i.onClick,"data-test":"SaveButton"},!i.loading&&n.a.createElement("span",{className:"fa fa-floppy-o"}),i.text)),!1!==s&&n.a.createElement(Hv,{title:s.title,shortcut:s.shortcut},n.a.createElement(h.a,{className:"query-editor-controls-button m-l-5",type:"primary",disabled:s.disabled,onClick:s.onClick,"data-test":"ExecuteButton"},n.a.createElement("span",{className:"zmdi zmdi-play"}),s.text)))}Hv.propTypes={title:se.a.node,shortcut:se.a.string},Hv.defaultProps={title:null,shortcut:null};var Kv=se.a.oneOfType([se.a.bool,se.a.shape({title:se.a.node,disabled:se.a.bool,loading:se.a.bool,onClick:se.a.func,text:se.a.node,shortcut:se.a.string})]);Gv.propTypes={addParameterButtonProps:Kv,formatButtonProps:Kv,saveButtonProps:Kv,executeButtonProps:Kv,autocompleteToggleProps:se.a.oneOfType([se.a.bool,se.a.shape({available:se.a.bool,enabled:se.a.bool,onToggle:se.a.func})]),autoLimitCheckboxProps:se.a.oneOfType([se.a.bool,se.a.shape(Vv.propTypes)]),dataSourceSelectorProps:se.a.oneOfType([se.a.bool,se.a.shape({disabled:se.a.bool,value:se.a.oneOfType([se.a.string,se.a.number]),options:se.a.arrayOf(se.a.shape({value:se.a.oneOfType([se.a.string,se.a.number]),label:se.a.node})),onChange:se.a.func})])},Gv.defaultProps={addParameterButtonProps:!1,formatButtonProps:!1,saveButtonProps:!1,executeButtonProps:!1,autocompleteToggleProps:!1,autoLimitCheckboxProps:!1,dataSourceSelectorProps:!1};var Yv=["className","syntax","value","autocompleteEnabled","schema","onChange","onSelectionChange"];function $v(){return($v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Jv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Xv(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xv(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Zv(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var eO={$blockScrolling:1/0},tO=n.a.forwardRef((function(e,t){var r=e.className,i=e.syntax,s=e.value,o=e.autocompleteEnabled,l=e.schema,c=e.onChange,u=e.onSelectionChange,d=Zv(e,Yv),m=Jv(Object(a.useState)(null),2),p=m[0],f=m[1],h=Jv(Object(a.useState)(null),2),b=h[0],g=h[1],y=Jv(Object(a.useState)(s),2),v=y[0],O=y[1];Object(a.useEffect)(()=>{O(s)},[s]);var E=Object(a.useCallback)(e=>{O(e),c(e)},[c]),j=Object(a.useMemo)(()=>({behavioursEnabled:!0,enableSnippets:!0,enableBasicAutocompletion:!0,enableLiveAutocompletion:o,autoScrollEditorIntoView:!0}),[o]);Object(a.useEffect)(()=>{if(b){var e=b.editor.id;return Mv(e,l),()=>{Mv(e,null)}}},[l,b]),Object(a.useEffect)(()=>{function e(){b&&b.editor.resize()}if(p)return e(),bp(p,e)},[p,b]);var w=Object(a.useCallback)(e=>{var t=b.editor.session.doc.getTextRange(e.getRange()),r=t.length>1?t:null;u(r)},[b,u]),S=Object(a.useCallback)(e=>{e.commands.bindKey({win:"Ctrl+L",mac:"Cmd+L"},null),e.commands.bindKey({win:"Ctrl+Shift+F",mac:"Cmd+Shift+F"},null),e.commands.bindKey({win:"Ctrl+P",mac:null},null),e.commands.bindKey({win:null,mac:"Ctrl+P"},"golineup"),e.commands.bindKey({win:"Esc",mac:"Esc"},()=>{e.blur()});var t=null;e.on("focus",()=>{t=function(e){var t=e.text,r=e.expiry,a=void 0===r?1e3:r,n=e.container,i=void 0===n?document.body:n,s=e.politeness,o=void 0===s?"polite":s,l=document.createElement("div"),c="speak-".concat(Date.now());l.id=c,l.className="sr-only",l.textContent=t,l.setAttribute("role","alert"),l.setAttribute("aria-live",o),i.appendChild(l);var u=null,d=!1,m=()=>{if(!d){d=!0;try{i.removeChild(l)}catch(e){console.error(e)}u&&window.clearTimeout(u)}};return u=window.setTimeout(m,a),m}({text:"You've entered the SQL editor. To exit press the ESC key.",politeness:"assertive"})}),e.on("blur",()=>{t&&t()}),e.commands.on("afterExec",t=>{"insertstring"===t.command.name&&"."===t.args&&e.completer&&e.completer.showPopup(e)}),Lv.query().then(e=>{var t=Tv.snippetManager,r={snippetText:""};r.snippets=t.parseSnippetFile(r.snippetText),e.forEach(e=>{r.snippets.push(e.getSnippet())}),t.register(r.snippets||[],r.scope)}),e.focus()},[]);return Object(a.useImperativeHandle)(t,()=>({paste:e=>{if(b){var t=b.editor;t.session.doc.replace(t.selection.getRange(),e);var r=t.selection.getRange();c(t.session.getValue()),t.selection.setRange(r)}},focus:()=>{b&&b.editor.focus()}}),[b,c]),n.a.createElement("div",$v({className:ge()("query-editor-container",r)},d,{ref:f}),n.a.createElement(Sh.a,{ref:g,theme:"textmate",mode:i||"sql",value:v,editorProps:eO,width:"100%",height:"100%",setOptions:j,showPrintMargin:!1,wrapEnabled:!1,onLoad:S,onChange:E,onSelectionChange:w}))}));tO.propTypes={className:se.a.string,syntax:se.a.string,value:se.a.string,autocompleteEnabled:se.a.bool,schema:se.a.arrayOf(Sv),onChange:se.a.func,onSelectionChange:se.a.func},tO.defaultProps={className:null,syntax:null,value:null,autocompleteEnabled:!0,schema:[],onChange:()=>{},onSelectionChange:()=>{}},tO.Controls=Gv;var rO=tO,aO=r(1093),nO=r.n(aO);function iO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function sO(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?iO(Object(r),!0).forEach((function(t){oO(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iO(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function oO(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lO(e){return Object(c.has)(e,"job.id")?Yt(e.job.id,1e3):e}function cO(e){return Object(c.has)(e,"error")?Promise.reject(new Error(e.error.message)):e}var uO=sO(sO({},Ab),{},{getDatabases:function(e){var t=e.id,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={};return r&&(a.refresh=!0),K.get("api/databricks/databases/".concat(t),{params:a}).then(lO).then(cO)},getDatabaseTables:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a={};return r&&(a.refresh=!0),K.get("api/databricks/databases/".concat(e.id,"/").concat(t,"/tables"),{params:a}).then(lO).then(cO)},getTableColumns:(e,t,r)=>K.get("api/databricks/databases/".concat(e.id,"/").concat(t,"/columns/").concat(r)).then(lO).then(cO)});function dO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return mO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mO(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function pO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function fO(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pO(Object(r),!0).forEach((function(t){hO(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pO(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function hO(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bO(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?uO.getDatabases(e,t).catch(()=>(sn.error("Failed to load Database list.","Please try again later."),Promise.reject())):Promise.resolve([])}function gO(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e&&t?uO.getDatabaseTables(e,t,r).catch(()=>(sn.error("Failed to load tables for ".concat(t,"."),"Please try again later."),Promise.reject())):Promise.resolve([])}function yO(e,t){return t?Object(c.map)(e,e=>{var r=t+".",a=e.name;return Object(c.startsWith)(e.name,r)&&(a=e.name.slice(r.length)),fO(fO({},e),{},{displayName:a})}):e}var vO=["dataSource","options","onOptionsUpdate","onSchemaUpdate","onItemSelect"];function OO(){return(OO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function EO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function jO(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?EO(Object(r),!0).forEach((function(t){wO(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):EO(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function wO(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return PO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return PO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function PO(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function CO(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function NO(e){var t=e.dataSource,r=e.options,i=e.onOptionsUpdate,s=e.onSchemaUpdate,o=e.onItemSelect,l=CO(e,vO),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=Object(a.useState)([]),i=dO(n,2),s=i[0],o=i[1],l=Object(a.useState)(!0),u=dO(l,2),d=u[0],m=u[1],p=Object(a.useState)(),f=dO(p,2),h=f[0],b=f[1],g=Object(a.useState)({}),y=dO(g,2),v=y[0],O=y[1],E=Object(a.useState)(!1),j=dO(E,2),w=j[0],S=j[1],P=Object(a.useState)(!1),C=dO(P,2),N=C[0],k=C[1],_=Object(a.useCallback)(e=>O(t=>fO(fO({},t),{},{[h]:e})),[h]),A=Object(a.useRef)();A.current=h;var x=Object(a.useCallback)(t=>{uO.getTableColumns(e,h,t.substring(h.length+1)).then(e=>{A.current===h&&O(r=>{var a=Object(c.get)(r,h,[]),n=Object(c.map)(a,r=>r.name===t?fO(fO({},r),{},{columns:e,loading:!1}):r);return fO(fO({},r),{},{[h]:n})})})},[e,h]),q=Object(a.useMemo)(()=>yO(Object(c.get)(v,h,[]),h),[v,h]),T=Object(a.useCallback)(()=>{if(!N){k(!0);var t=bO(e,!0).then(o),r=gO(e,h,!0).then(e=>{var t=e.schema;return _(t)});Promise.all([r.catch(()=>{}),t.catch(()=>{})]).then(()=>k(!1))}},[e,h,_,N]),I=Object(a.useRef)();I.current=v,Object(a.useEffect)(()=>{var t=!1;return h&&!Object(c.has)(I.current,h)&&(S(!0),gO(e,h).catch(()=>Promise.resolve({schema:[],has_columns:!0})).then(r=>{var a=r.schema,n=r.has_columns;t||(n||Object(c.isEmpty)(a)||(a=Object(c.map)(a,e=>fO(fO({},e),{},{loading:!0})),gO(e,h,!0).then(e=>{var r=e.schema;t||_(r)})),_(a))}).finally(()=>{t||S(!1)})),()=>{t=!0}},[e,h,_]);var D=Object(a.useRef)();D.current=Object(c.get)(t,"selectedDatabase",null),Object(a.useEffect)(()=>{var t=!1;return m(!0),b(void 0),O({}),bO(e).catch(()=>Promise.resolve([])).then(r=>{if(!t){o(r);var a=D.current||localStorage.getItem("lastSelectedDatabricksDatabase_".concat(e.id));a||(a=Object(c.includes)(r,"default")?"default":Object(c.first)(r)||null),b(a)}}).finally(()=>{t||m(!1)}),()=>{t=!0}},[e]);var R=Object(a.useCallback)(a=>{if(a)try{localStorage.setItem("lastSelectedDatabricksDatabase_".concat(e.id),a)}catch(e){}b(a),Object(c.isFunction)(r)&&a!==D.current&&r(fO(fO({},t),{},{selectedDatabase:a}))},[e.id,t,r]);return{databases:s,loadingDatabases:d,schema:q,loadingSchema:w,currentDatabaseName:h,setCurrentDatabase:R,loadTableColumns:x,refreshAll:T,refreshing:N}}(t,r,i),d=u.databases,m=u.loadingDatabases,p=u.schema,f=u.loadingSchema,b=u.loadTableColumns,g=u.currentDatabaseName,y=u.setCurrentDatabase,v=u.refreshAll,O=u.refreshing,E=SO(Object(a.useState)(""),2),j=E[0],w=E[1],S=SO(Object(a.useState)(""),2),P=S[0],C=S[1],N=Object(a.useMemo)(()=>kv(p,j),[p,j]),k=SO(Object(a.useState)(!1),2),_=k[0],A=k[1],x=SO(Object(a.useState)({}),2),q=x[0],T=x[1],I=SO(Object(Fo.a)(w,500),1)[0],D=SO(Object(Fo.a)(C,500),2),R=D[0],M=D[1],z=Object(a.useCallback)(e=>{y(e),M(),C("")},[M,y]),F=Object(a.useMemo)(()=>Object(c.filter)(d,e=>Object(c.includes)(e.toLowerCase(),P.toLowerCase())),[d,P]),L=_d(s);return Object(a.useEffect)(()=>{L(p)},[p,L]),Object(a.useEffect)(()=>{T({})},[g]),n.a.createElement("div",OO({className:"databricks-schema-browser schema-container"},l),n.a.createElement("div",{className:"schema-control"},n.a.createElement(He.a,{className:_?"database-select-open":"",placeholder:"Filter tables & columns...","aria-label":"Search schema",disabled:m||f,onChange:e=>I(e.target.value),addonBefore:n.a.createElement(Qi.a,{dropdownClassName:"databricks-schema-browser-db-dropdown",loading:m,disabled:m,onChange:z,value:g,showSearch:!0,onSearch:R,onDropdownVisibleChange:A,placeholder:n.a.createElement(n.a.Fragment,null,n.a.createElement("i",{className:"fa fa-database m-r-5","aria-hidden":"true"})," Database")},F.map(e=>n.a.createElement(Qi.a.Option,{key:e},n.a.createElement("i",{className:"fa fa-database m-r-5","aria-hidden":"true"}),e)))})),n.a.createElement("div",{className:"schema-list-wrapper"},n.a.createElement(Nv,{loading:m||f,schema:N,expandedFlags:q,onTableExpand:function(e){var t=Object(c.find)(p,{name:e});!q[e]&&Object(c.get)(t,"loading",!1)&&b(e),T(jO(jO({},q),{},{[e]:!q[e]}))},onItemSelect:o}),!(f||m)&&n.a.createElement("div",{className:"load-button"},n.a.createElement(Ne,{title:O?null:"Refresh Databases and Current Schema"},n.a.createElement(h.a,{type:"link",onClick:v,disabled:O},n.a.createElement(nO.a,{spin:O}))))))}function kO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _O(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?kO(Object(r),!0).forEach((function(t){AO(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kO(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function AO(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}NO.propTypes={dataSource:se.a.object,options:se.a.object,onOptionsUpdate:se.a.func,onSchemaUpdate:se.a.func,onItemSelect:se.a.func},NO.defaultProps={dataSource:null,options:null,onOptionsUpdate:()=>{},onSchemaUpdate:()=>{},onItemSelect:()=>{}};var xO=new Map,qO="SchemaBrowser",TO="QueryEditor";function IO(e,t,r){Object(c.isNil)(r)&&(r=[null]),Object(c.isArray)(r)||(r=[r]),Object(c.each)(r,r=>{xO.set(r,_O(_O({},xO.get(r)),{},{[e]:t}))})}function DO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return RO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return RO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function RO(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function MO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return zO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zO(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function FO(e){var t=Object(a.useMemo)(()=>Object(c.first)(Object(c.orderBy)(e,["id"]))||{},[e]),r=MO(Object(a.useState)(+R.hash||t.id),2),n=r[0],i=r[1];return Object(a.useEffect)(()=>{var e=n!==t.id?"".concat(n):null;return R.hash!==e&&R.setHash(e),R.listen(()=>{R.hash!==e&&i(+R.hash||t.id)})},[t.id,n]),Object(a.useEffect)(()=>{Object(c.find)(e,{id:n})||i(t.id)},[t.id,n,e]),Object(a.useMemo)(()=>[n,i],[n])}function LO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return UO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return UO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function UO(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function VO(e){var t=Object(a.useMemo)(()=>function(e){return Object(c.reduce)(e,(e,t)=>e+t.columns.length,0)}(e)<=5e3,[e]),r=LO(Object(a.useState)(Zt.get("liveAutocomplete",!0)),2),n=r[0],i=r[1],s=Object(a.useCallback)(e=>{i(e),Zt.set("liveAutocomplete",e)},[]);return Object(a.useMemo)(()=>[t,n,s],[t,n,s])}function BO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function QO(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?BO(Object(r),!0).forEach((function(t){WO(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BO(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function WO(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function HO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return GO(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return GO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function GO(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function KO(e,t,r){var n=function(e){return Object(c.get)(e,"supports_auto_limit",!1)}(e),i=HO(Object(a.useState)(t.options.apply_auto_limit),2),s=i[0],o=i[1];return t.options.apply_auto_limit=s,[n,s,Object(a.useCallback)(e=>{o(e),Zt.set("applyAutoLimit",e),r(Object(c.extend)(t.clone(),{options:QO(QO({},t.options),{},{apply_auto_limit:e})}))},[t,r])]}IO(qO,_v),IO(TO,rO),IO(qO,NO,["databricks","databricks_internal"]);var YO=k()("redash:notifications"),$O=window.Notification||null;$O||YO("HTML5 notifications are not supported.");var JO=Object(c.find)(["hidden","webkitHidden","mozHidden","msHidden"],e=>e in document);var XO={getPermissions:function(){$O&&"default"===$O.permission&&$O.requestPermission()},showNotification:function(e,t){$O&&document[JO]&&"granted"===$O.permission&&(new $O(e,{tag:e+t,body:t,icon:da.default}).onclick=function(){window.focus(),this.close(),vt("click","notification")})}};function ZO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return eE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function tE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function rE(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tE(Object(r),!0).forEach((function(t){aE(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tE(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function aE(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var nE=(e,t)=>rE(rE({},e),t);function iE(e){var t=ZO(Object(a.useReducer)(nE,{queryResult:null,isExecuting:!1,loadedInitialResults:!1,executionStatus:null,isCancelling:!1,cancelCallback:null,error:null}),2),r=t[0],n=t[1],i=Object(a.useRef)(null);Object(a.useEffect)(()=>()=>{i.current=null},[]);var s=_d((function(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1?arguments[1]:void 0;t=s?s():e.getQueryResult(a),vt("execute","query",e.id),XO.getPermissions(),i.current=t,n({updatedAt:t.getUpdatedAt(),executionStatus:t.getStatus(),isExecuting:!0,cancelCallback:()=>{vt("cancel_execute","query",e.id),n({isCancelling:!0}),t.cancelExecution()}});var o=e=>{i.current===t&&n({updatedAt:t.getUpdatedAt(),executionStatus:e})};t.toPromise(o).then(a=>{i.current===t&&(a&&a.query_result.query===e.query&&(e.latest_query_data_id=a.getId(),e.queryResult=a),r.loadedInitialResults&&XO.showNotification("Redash","".concat(e.name," updated.")),n({queryResult:a,loadedInitialResults:!0,error:null,isExecuting:!1,isCancelling:!1,executionStatus:null}))}).catch(a=>{i.current===t&&(r.loadedInitialResults&&XO.showNotification("Redash","".concat(e.name," failed to run: ").concat(a.getError())),n({queryResult:a,loadedInitialResults:!0,error:a.getError(),isExecuting:!1,isCancelling:!1,executionStatus:Qt}))})})),o=Object(a.useRef)(e);return o.current=e,Object(a.useEffect)(()=>{var e;o.current.hasResult()||o.current.paramsRequired()?s(void 0!==(e=R.search.maxAge)?e:-1):n({loadedInitialResults:!0})},[s]),rE(rE({},r),{executeQuery:s})}function sE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return oE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function lE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return cE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function uE(e){var t=Object(a.useMemo)(()=>e.getParametersDefs(),[e]),r=lE(Object(a.useState)(e.getParameters().hasPendingValues()),2),n=r[0],i=r[1],s=Object(a.useCallback)(t=>{t=Object(c.isUndefined)(t)?e.getParameters().hasPendingValues():t,i(t)},[e]);return Object(a.useEffect)(()=>{var t=e.getParameters().hasPendingValues();t!==n&&i(t)},[e,t,n]),Object(a.useMemo)(()=>[t,n,s],[t,n,s])}var dE=r(1094),mE=r.n(dE);function pE(){return(pE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function fE(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return bE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var gE=l.a.weekdaysShort(),yE=l.a.weekdays(),vE=Qi.a.Option,OE=Qi.a.OptGroup;function EE(e){var t=hE(Object(a.useState)(e.defaultValue),2),r=t[0],i=t[1],s=r&&!r.isUTC();return n.a.createElement(n.a.Fragment,null,n.a.createElement(mE.a,{allowClear:!1,value:r,format:"HH:mm",minuteStep:5,onChange:function(t){i(t),e.onChange(t)}}),s&&n.a.createElement("span",{className:"utc","data-testid":"utc"},"(",l.a.utc(r).format("HH:mm")," UTC)"))}EE.propTypes={defaultValue:Kn,onChange:se.a.func.isRequired},EE.defaultProps={defaultValue:null};class jE extends n.a.Component{constructor(){super(...arguments),fE(this,"state",this.getState()),fE(this,"setTime",e=>{this.newSchedule={time:l()(e).utc().format("HH:mm")}}),fE(this,"setInterval",e=>{var t=this.state.newSchedule,r=ii(e).interval;r===ei.NEVER&&(t.until=null),-1!==[ei.NEVER,ei.MINUTES,ei.HOURS].indexOf(r)&&(t.time=null),r!==ei.WEEKS&&(t.day_of_week=null),r!==ei.DAYS&&r!==ei.WEEKS||this.state.minute&&this.state.hour||(t.time=l()().hour("00").minute("15").utc().format("HH:mm")),r!==ei.WEEKS||this.state.dayOfWeek||(t.day_of_week=yE[0]),t.interval=e;var a=hE(t.time?ni(t.time).split(":"):[null,null],2),n=a[0],i=a[1];this.setState({interval:r,seconds:e,hour:n,minute:i,dayOfWeek:t.day_of_week?gE[yE.indexOf(t.day_of_week)]:null}),this.newSchedule=t}),fE(this,"setScheduleUntil",(e,t)=>{this.newSchedule={until:t}}),fE(this,"setWeekday",e=>{var t=e.target.value;this.setState({dayOfWeek:t}),this.newSchedule={day_of_week:t?yE[gE.indexOf(t)]:null}}),fE(this,"setUntilToggle",e=>{var t=e.target.value?l()().format("YYYY-MM-DD"):null;this.setScheduleUntil(null,t)})}getState(){var e=Object(c.clone)(this.props.schedule||jE.defaultProps.schedule),t=e.time,r=e.interval,a=e.day_of_week,n=ii(r).interval,i=hE(t?ni(t).split(":"):[null,null],2);return{hour:i[0],minute:i[1],seconds:r,interval:n,dayOfWeek:a?gE[yE.indexOf(a)]:null,newSchedule:e}}get intervals(){var e={[ei.NEVER]:[]};return this.props.refreshOptions.forEach(t=>{var r=ii(t),a=r.count,n=r.interval;n in e||(e[n]=[]),e[n].push([a,t])}),Object.defineProperty(this,"intervals",{value:e}),e}set newSchedule(e){this.setState(t=>({newSchedule:pE(t.newSchedule,e)}))}save(){var e=this.state.newSchedule;(()=>{var t=Object(c.omitBy)(e,c.isNil),r=Object(c.omitBy)(this.props.schedule,c.isNil);return!Object(c.isEqual)(t,r)})()&&(e.interval?this.props.dialog.close(Object(c.clone)(e)):this.props.dialog.close(null)),this.props.dialog.dismiss()}render(){var e=this.props.dialog,t=this.state,r=t.interval,a=t.minute,i=t.hour,s=t.seconds,o=t.newSchedule.until;return n.a.createElement(V.a,pE({},e.props,{title:"Refresh Schedule",className:"schedule",onOk:()=>this.save()}),n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"Refresh every"),n.a.createElement("div",{"data-testid":"interval"},n.a.createElement(Qi.a,{className:"input",value:s,onChange:this.setInterval,dropdownMatchSelectWidth:!1},n.a.createElement(vE,{value:null,key:"never"},"Never"),Object.keys(this.intervals).filter(e=>!Object(c.isEmpty)(this.intervals[e])).map(e=>n.a.createElement(OE,{label:Object(c.capitalize)(si(e)),key:e},this.intervals[e].map(t=>{var r=hE(t,2),a=r[0],i=r[1];return n.a.createElement(vE,{value:i,key:"".concat(e,"-").concat(a)},oi(i))})))))),-1!==[ei.DAYS,ei.WEEKS].indexOf(r)?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"On time"),n.a.createElement("div",{"data-testid":"time"},n.a.createElement(EE,{defaultValue:i?l()().hour(i).minute(a):null,onChange:this.setTime}))):null,ei.WEEKS===r?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"On day"),n.a.createElement("div",{"data-testid":"weekday"},n.a.createElement(Zd.a.Group,{size:"medium",defaultValue:this.state.dayOfWeek,onChange:this.setWeekday},gE.map(e=>n.a.createElement(Zd.a.Button,{value:e,key:e,className:"input"},e[0]))))):null,r!==ei.NEVER?n.a.createElement("div",{className:"schedule-component"},n.a.createElement("h5",null,"Ends"),n.a.createElement("div",{className:"ends","data-testid":"ends"},n.a.createElement(Zd.a.Group,{size:"medium",value:!!o,onChange:this.setUntilToggle},n.a.createElement(Zd.a,{value:!1},"Never"),n.a.createElement(Zd.a,{value:!0},"On")),o?n.a.createElement(Lc.a,{size:"small",className:"datepicker",value:l()(o),allowClear:!1,format:"YYYY-MM-DD",onChange:this.setScheduleUntil}):null)):null)}}fE(jE,"propTypes",{schedule:Ln,refreshOptions:se.a.arrayOf(se.a.number).isRequired,dialog:Je.isRequired}),fE(jE,"defaultProps",{schedule:Un});var wE=Xe(jE);function SE(e,t){var r=Ug(e),n=$g(e,t);return Object(a.useCallback)(()=>{if(r.canEdit&&r.canSchedule){var t=$.queryRefreshIntervals,a=ae.getQueryRefreshIntervals(),i=Object(c.isArray)(a)?Object(c.intersection)(t,a):t;wE.showModal({schedule:e.schedule,refreshOptions:i}).onClose(t=>{vt("edit_schedule","query",e.id),n({schedule:t})})}},[e.id,e.schedule,r.canEdit,r.canSchedule,n])}var PE={save:e=>K.post((e=>e.id?"api/visualizations/".concat(e.id):"api/visualizations")(e),e),delete:e=>K.delete("api/visualizations/".concat(e.id))};function CE(){return(CE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function NE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return kE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _E(e){var t=e.dialog,r=e.visualization,i=e.query,s=e.queryResult,o=Object(a.useRef)(),l=!r,u=kd(s),m=NE(Object(a.useState)(u.filters),2),p=m[0],f=m[1],h=Object(a.useMemo)(()=>({columns:u.columns,rows:Pd(u.rows,p)}),[u,p]),b=Object(a.useMemo)(()=>{var e=r?d.registeredVisualizations[r.type]:Object(d.getDefaultVisualization)(),t=e.getOptions(l?{}:r.options,u);return{type:e.type,name:l?e.name:r.name,options:t,originalOptions:t}},[u,l,r]),g=NE(Object(a.useState)(b.type),2),y=g[0],v=g[1],O=NE(Object(a.useState)(b.name),2),E=O[0],j=O[1],w=NE(Object(a.useState)(!1),2),S=w[0],P=w[1],C=NE(Object(a.useState)(b.options),2),N=C[0],k=C[1],_=NE(Object(a.useState)(!1),2),A=_[0],x=_[1];function q(e){var t=d.registeredVisualizations[y];k(t.getOptions(e,u))}Object(a.useEffect)(()=>{o.current&&o.current.reset()},[u,N]);var T=l?Object(c.filter)(Object(c.sortBy)(d.registeredVisualizations,["name"]),e=>!e.isDeprecated):Object(c.pick)(d.registeredVisualizations,[y]),I=qe("visualization-type"),D=qe("visualization-name");return n.a.createElement(V.a,CE({},t.props,{wrapClassName:"ant-modal-fullscreen",title:"Visualization Editor",okText:"Save",okButtonProps:{loading:A,disabled:A},onOk:function(){x(!0);var e=N;"TABLE"===y&&(e=Object(c.omit)(e,["paginationSize"])),function(e){return e.id?vt("update","visualization",e.id,{type:e.type}):vt("create","visualization",null,{type:e.type}),PE.save(e).then(e=>(sn.success("Visualization saved"),e)).catch(e=>(sn.error("Visualization could not be saved"),Promise.reject(e)))}(Object(c.extend)(Object(d.newVisualization)(y),r,{name:E,options:e,query_id:i.id})).then(e=>{!function(e,t){var r=Object(c.findIndex)(e.visualizations,e=>e.id===t.id);r>-1?e.visualizations[r]=t:e.visualizations.push(t),e.visualizations=[...e.visualizations]}(i,e),t.close(e)})},onCancel:function(){var e,r=!Object(c.isEqual)(N,b.originalOptions);(e=S||r,new Promise((t,r)=>{e?V.a.confirm({title:"Visualization Editor",content:"Are you sure you want to close the editor without saving?",okText:"Yes",cancelText:"No",onOk:()=>t(),onCancel:()=>r()}):t()})).then(t.dismiss).catch(()=>{})},wrapProps:{"data-test":"EditVisualizationDialog"}}),n.a.createElement("div",{className:"edit-visualization-dialog"},n.a.createElement("div",{className:"visualization-settings"},n.a.createElement("div",{className:"m-b-15"},n.a.createElement("label",{htmlFor:I},"Visualization Type"),n.a.createElement(Qi.a,{"data-test":"VisualizationType",id:I,className:"w-100",disabled:!l,value:y,onChange:function(e){v(e);var t=d.registeredVisualizations[e];S||j(t.name),k(t.getOptions(l?{}:r.options,u))}},Object(c.map)(T,e=>n.a.createElement(Qi.a.Option,{key:e.type,"data-test":"VisualizationType."+e.type},e.name)))),n.a.createElement("div",{className:"m-b-15"},n.a.createElement("label",{htmlFor:D},"Visualization Name"),n.a.createElement(He.a,{"data-test":"VisualizationName",id:D,className:"w-100",value:E,onChange:e=>{return t=e.target.value,j(t),void P(t!==E);var t}})),n.a.createElement("div",{"data-test":"VisualizationEditor"},n.a.createElement(Md,{type:y,data:u,options:N,visualizationName:E,onOptionsChange:q}))),n.a.createElement("div",{className:"visualization-preview"},n.a.createElement("label",{htmlFor:"visualization-preview",className:"invisible hidden-xs"},"Preview"),n.a.createElement(Nd,{filters:p,onChange:f}),n.a.createElement("div",{className:"scrollbox","data-test":"VisualizationPreview"},n.a.createElement(Rd,{type:y,data:h,options:N,visualizationName:E,onOptionsChange:q})))))}_E.propTypes={dialog:Je.isRequired,query:se.a.object.isRequired,visualization:d.VisualizationType,queryResult:se.a.object.isRequired},_E.defaultProps={visualization:null};var AE=Xe(_E);function xE(e,t,r){var n=_d(r);return Object(a.useCallback)((function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=Object(c.find)(e.visualizations,{id:r})||null;AE.showModal({query:e,visualization:a,queryResult:t}).onClose(t=>{var r=Object(c.filter)(e.visualizations,e=>e.id!==t.id);n(Object(c.extend)(e.clone(),{visualizations:[...r,t]}),t)})}),[e,t,n])}function qE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return TE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return TE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function TE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function IE(e,t){var r=_d(t);return Object(a.useCallback)(t=>PE.delete({id:t}).then(()=>{var a=Object(c.filter)(e.visualizations,e=>e.id!==t);r(Object(c.extend)(e.clone(),{visualizations:a}))}).catch(()=>{sn.error("Error deleting visualization.","Maybe it's used in a dashboard?")}),[e,r])}function DE(e,t){var r=$g(e,t);return Object(a.useCallback)(t=>{vt("edit_description","query",e.id),r({description:t})},[e.id,r])}function RE(e){return n.a.createElement("img",{src:"static/images/db-logos/".concat(e.type,".png"),width:"20",alt:e.alt})}function ME(e){var t=e.dataSource,r=e.children;return n.a.createElement(n.a.Fragment,null,n.a.createElement(RE,{type:t.type,"aria-label":t.name,title:t.name}),r||n.a.createElement("span",null,t.name))}function zE(e){return n.a.createElement(Qi.a,{className:"w-100","data-test":"SelectDataSource",placeholder:"Choose data source...",value:e.value,disabled:e.disabled,loading:e.loading,optionFilterProp:"data-name",showSearch:!0,onChange:e.onChange},Object(c.map)(e.dataSources,e=>n.a.createElement(Qi.a.Option,{key:"ds-".concat(e.id),value:e.id,"data-name":e.name,"data-test":"SelectDataSource".concat(e.id)},n.a.createElement(pe,{name:"QuerySourceDropdownItem",dataSource:e}))))}function FE(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function LE(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?FE(Object(r),!0).forEach((function(t){UE(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FE(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function UE(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return BE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return BE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function BE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function QE(e){var t,r=function(e){var t=DO(Object(a.useState)(e),2),r=t[0],n=t[1],i=DO(Object(a.useState)(e.query),2),s=i[0],o=i[1],l=DO(Object(a.useState)(r.options.apply_auto_limit),2),u=l[0],d=l[1],m=$g(r,e=>{e.id!==r.id&&bt(e.getUrl(!0),!0),n(e),o(e.query),d(e.options.apply_auto_limit)});return Object(a.useMemo)(()=>({query:r,setQuery:n,isDirty:r.query!==s||!Object(c.isEmpty)(r.query)&&r.options.apply_auto_limit!==u,saveQuery:()=>m()}),[r,s,m,u])}(e.query),i=r.query,s=r.setQuery,o=r.isDirty,l=r.saveQuery,u=function(e){var t=sE(Object(a.useState)([]),2),r=t[0],n=t[1],i=sE(Object(a.useState)(!1),2),s=i[0],o=i[1],l=Object(a.useMemo)(()=>Object(c.filter)(r,t=>!t.view_only||t.id===e.data_source_id),[r,e.data_source_id]),u=Object(a.useMemo)(()=>Object(c.find)(l,t=>Object(c.toString)(t.id)===Object(c.toString)(e.data_source_id))||null,[e.data_source_id,l]);return Object(a.useEffect)(()=>{var e=!1;return Ab.query().then(t=>{e||(o(!0),n(t))}),()=>{e=!0}},[]),Object(a.useMemo)(()=>({dataSourcesLoaded:s,dataSources:l,dataSource:u}),[s,l,u])}(i),d=u.dataSourcesLoaded,m=u.dataSources,p=u.dataSource,f=VE(Object(a.useState)([]),2),b=f[0],g=f[1],y=Ug(i,p),v=VE(uE(i),3),O=v[0],E=v[1],j=v[2],w=VE(FO(i.visualizations),2),S=w[0],P=w[1],C=(t=p&&p.type,_O(_O({},xO.get(null)),xO.get(t))),N=C.QueryEditor,k=C.SchemaBrowser,_=!Cg()({minWidth:768});!function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(a.useRef)();t.current=e,Object(a.useEffect)(()=>{var e="".concat("You will lose your changes if you leave","\n\nAre you sure you want to leave this page?"),r=window.onbeforeunload;window.onbeforeunload=function(){return t.current?"You will lose your changes if you leave":void 0};var a=R.confirmChange((r,a)=>{if(t.current&&r.path!==a.path)return e});return()=>{window.onbeforeunload=r,a()}},[])}(o);var A=iE(i),x=A.queryResult,q=A.isExecuting,T=A.executionStatus,I=A.executeQuery,D=A.error,M=A.cancelCallback,z=A.isCancelling,F=A.updatedAt,L=A.loadedInitialResults,U=kd(x),V=Object(a.useRef)(null),B=VE(VO(b),3),Q=B[0],W=B[1],H=B[2],G=VE(KO(p,i,s),3),K=G[0],Y=G[1],$=G[2],J=VE(Object(Fo.a)(e=>{s(Object(c.extend)(i.clone(),{query:e}))},100),1)[0];Object(a.useEffect)(()=>{vt("view_source","query",i.id)},[i.id]),Object(a.useEffect)(()=>{document.title=i.name},[i.name]);var X=$g(i,s),Z=DE(i,s),ee=p?p.syntax||"sql":null,te=Lg(ee),re=Object(a.useCallback)(e=>{if(e)try{localStorage.setItem("lastSelectedDataSourceId",e)}catch(e){}if(i.data_source_id!==e){vt("update_data_source","query",i.id,{dataSourceId:e});var t={data_source_id:e,latest_query_data_id:null,latest_query_data:null};s(Object(c.extend)(i.clone(),t)),X(t,{successMessage:null})}},[i,s,X]);Object(a.useEffect)(()=>{if(d&&y.isNew){var e=m.length>0?m[0].id:null,t=parseInt(localStorage.getItem("lastSelectedDataSourceId"))||null;re((r=[i.data_source_id,t,e],a=m,a=Object(c.map)(a,e=>e.id),Object(c.find)(r,e=>Object(c.includes)(a,e))||null))}var r,a},[i.data_source_id,y.isNew,d,m,re]);var ae=SE(i,s),ne=function(e,t){var r=_d(t);return Object(a.useCallback)(()=>{od.showModal({parameter:{title:null,name:"",type:"text",value:null},existingParams:Object(c.map)(e.getParameters().get(),e=>e.name)}).onClose(t=>{var a=e.clone();t=a.getParameters().add(t),r(a,t)})},[e,r])}(i,(e,t)=>{V.current&&(V.current.paste(t.toQueryTextFragment()),V.current.focus()),s(e)}),ie=Object(a.useCallback)(e=>{V.current&&V.current.paste(e)},[]),se=VE(Object(a.useState)(null),2),oe=se[0],le=se[1],ce=Object(a.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];y.canExecute&&(e||!E&&!q)&&(o||!Object(c.isEmpty)(oe)?I(null,()=>i.getQueryResultByText(0,oe)):I())}),[i,y.canExecute,E,q,o,oe,I]),ue=VE(Object(a.useState)(!1),2),de=ue[0],me=ue[1],fe=Object(a.useCallback)(()=>{de||(me(!0),l().finally(()=>me(!1)))},[de,l]),he=function(e,t,r,n){var i=Ug(e),s=xE(e,t,n),o=qE(Object(a.useState)(!1),2),l=o[0],c=o[1];return Object(a.useEffect)(()=>{!i.isNew&&l&&(c(!1),s())},[i.isNew,l,s]),Object(a.useCallback)(()=>{i.isNew?(c(!0),r()):s()},[i.isNew,r,s])}(i,x,fe,(e,t)=>{s(e),P(t.id)}),be=xE(i,x,e=>s(e)),ye=IE(i,s);return n.a.createElement("div",{className:ge()("query-page-wrapper",{"query-fixed-layout":!_})},n.a.createElement(_y,{query:i,dataSourcesAvailable:!d||m.length>0}),n.a.createElement("div",{className:"container w-100 p-b-10"},n.a.createElement(hy,{query:i,dataSource:p,sourceMode:!0,selectedVisualization:S,headerExtra:n.a.createElement(pe,{name:"QuerySource.HeaderExtra",query:i}),onChange:s})),n.a.createElement("main",{className:"query-fullscreen"},n.a.createElement(Rg,{direction:"horizontal",sizeAttribute:"flex-basis",toggleShortcut:"Alt+Shift+D, Alt+D"},n.a.createElement("nav",null,d&&n.a.createElement("div",{className:"editor__left__data-source"},n.a.createElement(pe,{name:"QuerySourceDropdown",dataSources:m,value:p?p.id:void 0,disabled:!y.canEdit||!d||0===m.length,loading:!d,onChange:re})),n.a.createElement("div",{className:"editor__left__schema"},n.a.createElement(k,{dataSource:p,options:i.options.schemaOptions,onOptionsUpdate:e=>s(Object(c.extend)(i.clone(),{options:LE(LE({},i.options),{},{schemaOptions:e})})),onSchemaUpdate:g,onItemSelect:ie})),!i.isNew()&&n.a.createElement("div",{className:"query-page-query-description"},n.a.createElement(xf,{isEditable:y.canEdit,markdown:!0,ignoreBlanks:!1,placeholder:"Add description",value:i.description,onDone:Z,multiline:!0})),!i.isNew()&&n.a.createElement(by,{layout:"table",query:i,onEditSchedule:ae}))),n.a.createElement("div",{className:"content"},n.a.createElement("div",{className:"flex-fill p-relative"},n.a.createElement("div",{className:"p-absolute d-flex flex-column p-l-15 p-r-15",style:{left:0,top:0,right:0,bottom:0,overflow:"auto"}},n.a.createElement(Rg,{direction:"vertical",sizeAttribute:"flex-basis"},n.a.createElement("div",{className:"row editor"},n.a.createElement("section",{className:"query-editor-wrapper","data-test":"QueryEditor"},n.a.createElement(N,{ref:V,"data-executing":q?"true":null,syntax:p?p.syntax:null,value:i.query,schema:b,autocompleteEnabled:Q&&W,onChange:J,onSelectionChange:le}),n.a.createElement(N.Controls,{addParameterButtonProps:{title:"Add New Parameter",shortcut:"mod+p",onClick:ne},formatButtonProps:{title:te?"Format Query":"Query formatting is not supported for your Data Source syntax",disabled:!p||!te,shortcut:te?"mod+shift+f":null,onClick:()=>{try{var e=(t=i.query,Lg(r=ee)?(0,Fg[r])(t):t);s(Object(c.extend)(i.clone(),{query:e}))}catch(e){sn.error(String(e))}var t,r}},saveButtonProps:y.canEdit&&{text:n.a.createElement(n.a.Fragment,null,n.a.createElement("span",{className:"hidden-xs"},"Save"),o&&!de?"*":null),shortcut:"mod+s",onClick:fe,loading:de},executeButtonProps:{disabled:!y.canExecute||q||E,shortcut:"mod+enter, alt+enter, ctrl+enter, shift+enter",onClick:ce,text:n.a.createElement("span",{className:"hidden-xs"},null===oe?"Execute":"Execute Selected")},autocompleteToggleProps:{available:Q,enabled:W,onToggle:H},autoLimitCheckboxProps:{available:K,checked:Y,onChange:$},dataSourceSelectorProps:!!p&&{disabled:!y.canEdit,value:p.id,onChange:re,options:Object(c.map)(m,e=>({value:e.id,label:e.name}))}})))),!y.isNew&&n.a.createElement(by,{layout:"horizontal",query:i,onEditSchedule:ae}),n.a.createElement("section",{className:"query-results-wrapper"},i.hasParameters()&&n.a.createElement("div",{className:"query-parameters-wrapper"},n.a.createElement(ud,{editable:y.canEdit,sortable:y.canEdit,disableUrlUpdate:y.isNew,parameters:O,onPendingValuesChange:()=>j(),onValuesChange:()=>{j(!1),ce(!0)},onParametersEdit:()=>{o||l()}})),(D||q)&&n.a.createElement("div",{className:"query-alerts"},n.a.createElement(ky,{status:T,updatedAt:F,error:D,isCancelling:z,onCancel:M})),n.a.createElement(n.a.Fragment,null,U.log.length>0&&n.a.createElement("div",{className:"query-results-log"},n.a.createElement("p",null,"Log Information:"),Object(c.map)(U.log,(e,t)=>n.a.createElement("p",{key:"log-line-".concat(t),className:"query-log-line"},e))),L&&!(y.isNew&&!x)&&n.a.createElement(Ny,{queryResult:x,visualizations:i.visualizations,showNewVisualizationButton:y.canEdit&&U.status===Bt,canDeleteVisualizations:y.canEdit,selectedTab:S,onChangeTab:P,onAddVisualization:he,onDeleteVisualization:ye,refreshButton:n.a.createElement(h.a,{type:"primary",disabled:!y.canExecute||E,loading:q,onClick:ce},!q&&n.a.createElement("i",{className:"zmdi zmdi-refresh m-r-5","aria-hidden":"true"}),"Refresh Now")}))))),x&&!x.getError()&&n.a.createElement("div",{className:"bottom-controller-container"},n.a.createElement(sv,{query:i,queryResult:x,selectedVisualization:S,isQueryExecuting:q,showEditVisualizationButton:!y.isNew&&y.canEdit,onEditVisualization:be})))))}RE.propTypes={type:se.a.string,alt:se.a.string},ME.propTypes={dataSource:se.a.shape({name:se.a.string,id:se.a.oneOfType([se.a.string,se.a.number]),type:se.a.string}).isRequired,children:se.a.element},me("QuerySourceDropdownItem",ME),zE.propTypes={dataSources:se.a.any,value:se.a.oneOfType([se.a.string,se.a.number]),disabled:se.a.bool,loading:se.a.bool,onChange:se.a.func},me("QuerySourceDropdown",zE),QE.propTypes={query:se.a.object.isRequired};var WE=Dy(QE);mn.register("Queries.New",Ga({path:"/queries/new",render:e=>n.a.createElement(WE,e),bodyClass:"fixed-layout"})),mn.register("Queries.Edit",Ga({path:"/queries/:queryId/source",render:e=>n.a.createElement(WE,e),bodyClass:"fixed-layout"}));var HE=r(1096),GE=r.n(HE),KE=r(1095),YE=r.n(KE),$E=["title","shortcut","disabled","children","onClick"];function JE(){return(JE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function XE(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ZE(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ZE(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ZE(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function ej(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function tj(e){var t=e.title,r=e.shortcut,i=e.disabled,s=e.children,o=e.onClick,l=ej(e,$E),c=XE(Object(a.useState)(!1),2),u=c[0],d=c[1],m=Object(a.useMemo)(()=>({onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1)}),[]);return Object(a.useEffect)(()=>{i&&d(!1)},[i]),Object(a.useEffect)(()=>{if(r){var e={[r]:o};return xc.bind(e),()=>{xc.unbind(e)}}},[r,o]),n.a.createElement(Hv,{title:t,shortcut:r,visible:u},n.a.createElement("span",m,n.a.createElement(h.a,JE({"data-test":"ExecuteButton",disabled:i,onClick:o,style:i?{pointerEvents:"none"}:{}},l),s)))}function rj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return aj(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return aj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function aj(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function nj(e){var t=rj(Object(a.useState)(e.query),2),r=t[0],i=t[1],s=rj(Object(a.useState)(),2),o=s[0],l=s[1],c=Ug(r,o),u=rj(uE(r),3),d=u[0],m=u[1],p=u[2],f=rj(FO(r.visualizations),2),b=f[0],g=f[1],y=Cg()({minWidth:768}),v=Cg()({minHeight:500})&&y,O=rj(sf(),2),E=O[0],j=O[1],w=rj(Object(a.useState)(!1),2),S=w[0],P=w[1],C=iE(r),N=C.queryResult,k=C.loadedInitialResults,_=C.isExecuting,A=C.executionStatus,x=C.executeQuery,q=C.error,T=C.cancelCallback,I=C.isCancelling,D=C.updatedAt,R=kd(N),M=DE(r,i),z=SE(r,i),F=xE(r,N,(e,t)=>{i(e),g(t.id)}),L=xE(r,N,e=>i(e)),U=IE(r,i),V=Object(a.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];c.canExecute&&(e||!m&&!_)&&x()}),[m,x,_,c.canExecute]);return Object(a.useEffect)(()=>{document.title=r.name},[r.name]),Object(a.useEffect)(()=>{Ab.get({id:r.data_source_id}).then(l)},[r.data_source_id]),n.a.createElement("div",{className:ge()("query-page-wrapper",{"query-view-fullscreen":E,"query-fixed-layout":v})},n.a.createElement("div",{className:"container w-100"},n.a.createElement(hy,{query:r,dataSource:o,onChange:i,selectedVisualization:b,headerExtra:n.a.createElement(pe,{name:"QueryView.HeaderExtra",query:r},ae.canRun(r)&&n.a.createElement(tj,{className:"m-r-5",type:"primary",shortcut:"mod+enter, alt+enter, ctrl+enter",disabled:!c.canExecute||_||m,onClick:V},"Refresh")),tagsExtra:!r.description&&c.canEdit&&!S&&!E&&n.a.createElement(Ee,{className:"label label-tag hidden-xs",role:"none",onClick:()=>P(!0)},n.a.createElement("i",{className:"zmdi zmdi-plus m-r-5","aria-hidden":"true"}),"Add description")}),(r.description||S)&&n.a.createElement("div",{className:ge()("m-t-5",{hidden:E})},n.a.createElement(xf,{className:"w-100",value:r.description,isEditable:c.canEdit,onDone:M,onStopEditing:()=>P(!1),placeholder:"Add description",ignoreBlanks:!1,editorProps:{autoSize:{minRows:2,maxRows:4}},defaultEditing:S,multiline:!0}))),n.a.createElement("div",{className:"query-view-content"},r.hasParameters()&&n.a.createElement("div",{className:ge()("bg-white tiled p-15 m-t-15 m-l-15 m-r-15",{hidden:E})},n.a.createElement(ud,{parameters:d,onValuesChange:()=>{p(!1),V(!0)},onPendingValuesChange:()=>p()})),n.a.createElement("div",{className:"query-results m-t-15"},k&&n.a.createElement(Ny,{queryResult:N,visualizations:r.visualizations,showNewVisualizationButton:c.canEdit&&R.status===Bt,canDeleteVisualizations:c.canEdit,selectedTab:b,onChangeTab:g,onAddVisualization:F,onDeleteVisualization:U,refreshButton:ae.canRun(r)&&n.a.createElement(h.a,{type:"primary",disabled:!c.canExecute||m,loading:_,onClick:V},!_&&n.a.createElement("i",{className:"zmdi zmdi-refresh m-r-5","aria-hidden":"true"}),"Refresh Now"),canRefresh:ae.canRun(r)}),n.a.createElement("div",{className:"query-results-footer"},N&&!N.getError()&&n.a.createElement(sv,{query:r,queryResult:N,selectedVisualization:b,isQueryExecuting:_,showEditVisualizationButton:c.canEdit,onEditVisualization:L,extraActions:n.a.createElement(tj,{className:"icon-button m-r-5 hidden-xs",title:"Toggle Fullscreen",type:"default",shortcut:"alt+f",onClick:j},E?n.a.createElement(YE.a,null):n.a.createElement(GE.a,null))}),(q||_)&&n.a.createElement("div",{className:"query-execution-status"},n.a.createElement(ky,{status:A,error:q,isCancelling:I,onCancel:T,updatedAt:D})))),n.a.createElement("div",{className:ge()("p-t-15 p-r-15 p-l-15",{hidden:E})},n.a.createElement(by,{layout:"horizontal",query:r,dataSource:o,onEditSchedule:z}))))}tj.propTypes={className:se.a.string,shortcut:se.a.string,disabled:se.a.bool,children:se.a.node,onClick:se.a.func},tj.defaultProps={className:null,shortcut:null,disabled:!1,children:null,onClick:()=>{}},nj.propTypes={query:se.a.object.isRequired};var ij=Dy(nj);function sj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return oj(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return oj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oj(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function lj(e){var t=e.queryName,r=e.queryDescription,a=e.visualization;return n.a.createElement("div",{className:"embed-heading p-b-10 p-r-15 p-l-15"},n.a.createElement("h3",null,n.a.createElement("img",{src:da.default,alt:"Redash Logo",style:{height:"24px",verticalAlign:"text-bottom"}}),n.a.createElement(hd,{visualization:a})," ",t,r&&n.a.createElement("small",null,n.a.createElement(wc.a,{className:"markdown text-muted"},Ec.markdown.toHTML(r||"")))))}function cj(e){var t=e.query,r=e.queryResults,a=e.updatedAt,i=e.refreshStartedAt,s=e.queryUrl,o=e.hideTimestamp,l=e.apiKey,c=n.a.createElement(he.a,null,n.a.createElement(he.a.Item,null,n.a.createElement(tv,{fileType:"csv",query:t,queryResult:r,apiKey:l,disabled:!r||!r.getData||!r.getData(),embed:!0},n.a.createElement(Xy.a,null)," Download as CSV File")),n.a.createElement(he.a.Item,null,n.a.createElement(tv,{fileType:"tsv",query:t,queryResult:r,apiKey:l,disabled:!r||!r.getData||!r.getData(),embed:!0},n.a.createElement(Xy.a,null)," Download as TSV File")),n.a.createElement(he.a.Item,null,n.a.createElement(tv,{fileType:"xlsx",query:t,queryResult:r,apiKey:l,disabled:!r||!r.getData||!r.getData(),embed:!0},n.a.createElement(ev.a,null)," Download as Excel File")));return n.a.createElement("div",{className:"tile__bottom-control"},!o&&n.a.createElement("span",null,n.a.createElement("span",{className:"small hidden-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",i?n.a.createElement(pd,{from:i}):n.a.createElement(Jn,{date:a})),n.a.createElement("span",{className:"small visible-print"},n.a.createElement("i",{className:"zmdi zmdi-time-restore","aria-hidden":"true"})," ",ri(a))),s&&n.a.createElement("span",{className:"hidden-print"},n.a.createElement(Ne,{title:"Open in Redash"},n.a.createElement(S.Button,{className:"icon-button",href:s,target:"_blank"},n.a.createElement("i",{className:"fa fa-external-link","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Open in Redash"))),!t.hasParameters()&&n.a.createElement(Da.a,{overlay:c,disabled:!r,trigger:["click"],placement:"topLeft"},n.a.createElement(h.a,{loading:!r&&!!i,className:"m-l-5"},"Download Dataset",n.a.createElement("i",{className:"fa fa-caret-up m-l-5","aria-hidden":"true"})))))}function uj(e){var t=e.queryId,r=e.visualizationId,i=e.apiKey,s=e.onError,o=sj(Object(a.useState)(null),2),u=o[0],d=o[1],m=sj(Object(a.useState)(null),2),p=m[0],f=m[1],h=sj(Object(a.useState)(null),2),b=h[0],g=h[1],y=sj(Object(a.useState)(null),2),v=y[0],O=y[1],E=_d(s);Object(a.useEffect)(()=>{var e=!1;return ir.get({id:t}).then(t=>{e||d(t)}).catch(E),()=>{e=!0}},[t,E]);var j=Object(a.useCallback)(()=>{u&&(f(null),g(l()()),u.getQueryResultPromise().then(e=>{O(e)}).catch(e=>{f(e.getError())}).finally(()=>g(null)))},[u]);if(Object(a.useEffect)(()=>{document.querySelector("body").classList.add("headless"),j()},[j]),!u)return null;var w=Object(c.has)(R.search,"hide_header"),S=Object(c.has)(R.search,"hide_parameters"),P=Object(c.has)(R.search,"hide_link"),C=Object(c.has)(R.search,"hide_timestamp"),N=Object(c.has)(R.search,"showDescription");r=parseInt(r,10);var k=Object(c.find)(u.visualizations,e=>e.id===r);return k?n.a.createElement("div",{className:"tile m-t-10 m-l-10 m-r-10 p-t-10 embed__vis","data-test":"VisualizationEmbed"},!w&&n.a.createElement(lj,{queryName:u.name,queryDescription:N?u.description:null,visualization:k}),n.a.createElement("div",{className:"col-md-12 query__vis"},!S&&u.hasParameters()&&n.a.createElement("div",{className:"p-t-15 p-b-10"},n.a.createElement(ud,{parameters:u.getParametersDefs(),onValuesChange:j})),p&&n.a.createElement("div",{className:"alert alert-danger","data-test":"ErrorMessage"},"Error: ".concat(p)),!p&&v&&n.a.createElement(Qd,{visualization:k,queryResult:v,context:"widget"}),!v&&b&&n.a.createElement("div",{className:"d-flex justify-content-center"},n.a.createElement("div",{className:"spinner"},n.a.createElement("i",{className:"zmdi zmdi-refresh zmdi-hc-spin zmdi-hc-5x","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Refreshing...")))),n.a.createElement(cj,{query:u,queryResults:v,updatedAt:v?v.getUpdatedAt():void 0,refreshStartedAt:b,queryUrl:P?null:u.getUrl(),hideTimestamp:C,apiKey:i})):(setTimeout(()=>{s(new Error("Visualization does not exist"))},10),null)}function dj(){return(dj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function mj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function pj(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mj(Object(r),!0).forEach((function(t){fj(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mj(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function fj(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hj(e){var t=e.querySnippet,r=e.dialog,i=e.readOnly,s=Object(a.useCallback)((e,a,n)=>{var i=Object(c.get)(t,"id");Object(c.isNil)(e.description)&&(e.description=""),r.close(i?pj({id:i},e):e).then(()=>a("Saved.")).catch(()=>n("Failed saving snippet."))},[r,t]),o=!!Object(c.get)(t,"id"),l=[{name:"trigger",title:"Trigger",type:"text",required:!0,autoFocus:!o},{name:"description",title:"Description",type:"text"},{name:"snippet",title:"Snippet",type:"ace",required:!0}].map(e=>pj(pj({},e),{},{readOnly:i,initialValue:Object(c.get)(t,e.name,"")})),u=qe("querySnippetForm");return n.a.createElement(V.a,dj({},r.props,{title:o?t.trigger:"Create Query Snippet",footer:[n.a.createElement(h.a,dj({key:"cancel"},r.props.cancelButtonProps,{onClick:r.dismiss}),i?"Close":"Cancel"),!i&&n.a.createElement(h.a,dj({key:"submit"},r.props.okButtonProps,{disabled:i||r.props.okButtonProps.disabled,htmlType:"submit",type:"primary",form:u,"data-test":"SaveQuerySnippetButton"}),o?"Save":"Create")],wrapProps:{"data-test":"QuerySnippetDialog"}}),n.a.createElement(hb,{id:u,fields:l,onSubmit:s,hideSubmitButton:!0,feedbackIcons:!0}))}mn.register("Queries.View",Ga({path:"/queries/:queryId",render:e=>n.a.createElement(ij,e)})),lj.propTypes={queryName:se.a.string.isRequired,queryDescription:se.a.string,visualization:d.VisualizationType.isRequired},lj.defaultProps={queryDescription:""},cj.propTypes={query:se.a.object.isRequired,queryResults:se.a.object,updatedAt:se.a.string,refreshStartedAt:Kn,queryUrl:se.a.string,hideTimestamp:se.a.bool,apiKey:se.a.string},cj.defaultProps={queryResults:null,updatedAt:null,refreshStartedAt:null,queryUrl:null,hideTimestamp:!1,apiKey:null},uj.propTypes={queryId:se.a.string.isRequired,visualizationId:se.a.string,apiKey:se.a.string.isRequired,onError:se.a.func},uj.defaultProps={onError:()=>{}},mn.register("Visualizations.ViewShared",ah({path:"/embed/query/:queryId/visualization/:visualizationId",render:e=>n.a.createElement(uj,e),getApiKey:()=>R.search.api_key})),hj.propTypes={dialog:Je.isRequired,querySnippet:se.a.object,readOnly:se.a.bool},hj.defaultProps={querySnippet:null,readOnly:!1};var bj=Xe(hj);function gj(){return(gj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function yj(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var vj=e=>Y.isAdmin||Y.id===Object(c.get)(e,"user.id");class Oj extends n.a.Component{constructor(){var e;super(...arguments),e=this,yj(this,"listColumns",[yi.custom.sortable((e,t)=>n.a.createElement(Ee,{type:"link",className:"table-main-title",onClick:()=>this.showSnippetDialog(t)},t.trigger),{title:"Trigger",field:"trigger",className:"text-nowrap"}),yi.custom.sortable(e=>e,{title:"Description",field:"description",className:"text-nowrap"}),yi.custom(e=>n.a.createElement("code",{className:"snippet-content"},e),{title:"Snippet",field:"snippet"}),yi.avatar({field:"user",className:"p-l-0 p-r-0"},e=>"Created by ".concat(e)),yi.date.sortable({title:"Created At",field:"created_at",className:"text-nowrap",width:"1%"}),yi.custom((e,t)=>vj(t)&&n.a.createElement(h.a,{type:"danger",className:"w-100",onClick:e=>this.deleteQuerySnippet(e,t)},"Delete"),{width:"1%"})]),yj(this,"saveQuerySnippet",e=>(e.id?Lv.save:Lv.create)(e)),yj(this,"deleteQuerySnippet",(e,t)=>{V.a.confirm({title:"Delete Query Snippet",content:"Are you sure you want to delete this query snippet?",okText:"Yes",okType:"danger",cancelText:"No",onOk:()=>{Lv.delete(t).then(()=>{sn.success("Query snippet deleted successfully."),this.props.controller.update()}).catch(()=>{sn.error("Failed deleting query snippet.")})}})}),yj(this,"showSnippetDialog",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=!t||vj(t);bt("query_snippets/"+Object(c.get)(t,"id","new"),!0);var a=()=>bt("query_snippets",!0);bj.showModal({querySnippet:t,readOnly:!r}).onClose(t=>e.saveQuerySnippet(t).then(()=>{e.props.controller.update(),a()})).onDismiss(a)}))}componentDidMount(){var e=this.props.controller.params,t=e.isNewOrEditPage,r=e.querySnippetId;t&&("new"===r?ae.isCreateQuerySnippetEnabled()?this.showSnippetDialog():bt("query_snippets",!0):Lv.get({id:r}).then(this.showSnippetDialog).catch(e=>{this.props.controller.handleError(e)}))}render(){var e=this.props.controller;return n.a.createElement("div",null,n.a.createElement("div",{className:"m-b-15"},n.a.createElement(h.a,{type:"primary",onClick:()=>this.showSnippetDialog(),disabled:!ae.isCreateQuerySnippetEnabled()},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New Query Snippet")),!e.isLoaded&&n.a.createElement(Us,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement("div",{className:"text-center"},"There are no query snippets yet.",ae.isCreateQuerySnippetEnabled()&&n.a.createElement("div",{className:"m-t-5"},n.a.createElement(Ee,{type:"link",onClick:()=>this.showSnippetDialog()},"Click here")," ","to add one.")),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive query-snippets-table"},n.a.createElement(vi,{items:e.pageItems,columns:this.listColumns,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vi,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))}}yj(Oj,"propTypes",{controller:bs.isRequired});var Ej=Pb("QuerySnippets.List",{permission:"create_query",title:"Query Snippets",path:"query_snippets",order:5},gs(Oj,()=>new Ds({isPlainList:!0,getRequest:()=>({}),getResource:()=>Lv.query.bind(Lv)}),()=>new zs({orderByField:"trigger",itemsPerPage:10})));mn.register("QuerySnippets.List",Ga({path:"/query_snippets",title:"Query Snippets",render:e=>n.a.createElement(Ej,gj({},e,{currentPage:"query_snippets"}))})),mn.register("QuerySnippets.NewOrEdit",Ga({path:"/query_snippets/:querySnippetId",title:"Query Snippets",render:e=>n.a.createElement(Ej,gj({},e,{currentPage:"query_snippets",isNewOrEditPage:!0}))}));var jj=()=>K.get("api/settings/organization"),wj=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Settings changes saved.";return K.post("api/settings/organization",e).then(e=>(sn.success(t),e)).catch(()=>{sn.error("Failed saving changes.")})};function Sj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Pj(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Sj(Object(r),!0).forEach((function(t){Cj(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sj(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Cj(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Nj(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return kj(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kj(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kj(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _j(e){var t=e.onError,r=Nj(Object(a.useState)({}),2),n=r[0],i=r[1],s=Nj(Object(a.useState)({}),2),o=s[0],l=s[1],u=Nj(Object(a.useState)(!0),2),d=u[0],m=u[1],p=Nj(Object(a.useState)(!1),2),f=p[0],h=p[1],b=_d(t);Object(a.useEffect)(()=>{vt("view","page","org_settings");var e=!1;return jj().then(t=>{if(!e){var r=Object(c.get)(t,"settings");i(r),l(Pj({},r)),m(!1)}}).catch(t=>{e||b(t)}),()=>{e=!0}},[b]);var g=Object(a.useCallback)(e=>{l(t=>Pj(Pj({},t),e))},[]),y=Object(a.useCallback)(()=>{f||(h(!0),wj(o).then(e=>{var t,r=Object(c.get)(e,"settings");i(r),l(Pj({},r)),t={dateFormat:o.date_format,timeFormat:o.time_format,dateTimeFormat:"".concat(o.date_format," ").concat(o.time_format)},Object(c.extend)($,t)}).catch(b).finally(()=>h(!1)))},[f,o,b]);return{settings:n,currentValues:o,isLoading:d,isSaving:f,handleSubmit:y,handleChange:g}}var Aj={settings:se.a.object,values:se.a.object,onChange:se.a.func,loading:se.a.bool},xj={settings:{},values:{},onChange:()=>{},loading:!1};function qj(){return(qj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Tj(e){var t=e.values,r=e.onChange,a=e.loading;return n.a.createElement(pe,qj({name:"OrganizationSettings.FormatSettings"},e),n.a.createElement(yo.a.Item,{label:"Date Format"},a?n.a.createElement(Rn.a.Input,{style:{width:300},active:!0}):n.a.createElement(Qi.a,{value:t.date_format,onChange:e=>r({date_format:e}),"data-test":"DateFormatSelect"},$.dateFormatList.map(e=>n.a.createElement(Qi.a.Option,{key:e,"data-test":"DateFormatSelect:".concat(e)},e)))),n.a.createElement(yo.a.Item,{label:"Time Format"},a?n.a.createElement(Rn.a.Input,{style:{width:300},active:!0}):n.a.createElement(Qi.a,{value:t.time_format,onChange:e=>r({time_format:e}),"data-test":"TimeFormatSelect"},$.timeFormatList.map(e=>n.a.createElement(Qi.a.Option,{key:e},e)))))}function Ij(){return(Ij=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Dj(e){var t=e.values,r=e.onChange,a=e.loading;return n.a.createElement(pe,Ij({name:"OrganizationSettings.PlotlySettings"},e),n.a.createElement(yo.a.Item,{label:"Chart Visualization"},a?n.a.createElement(Rn.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(Jl.a,{name:"hide_plotly_mode_bar",checked:t.hide_plotly_mode_bar,onChange:e=>r({hide_plotly_mode_bar:e.target.checked})},"Hide Plotly mode bar")))}Tj.propTypes=Aj,Tj.defaultProps=xj,Dj.propTypes=Aj,Dj.defaultProps=xj;var Rj=r(283),Mj=r.n(Rj);function zj(){return(zj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Fj(e){var t=e.values,r=e.onChange,a=e.loading;return n.a.createElement(pe,zj({name:"OrganizationSettings.FeatureFlagsSettings"},e),n.a.createElement(yo.a.Item,{label:"Feature Flags"},a?n.a.createElement(n.a.Fragment,null,n.a.createElement(Mj.a,null,n.a.createElement(Rn.a,{title:!1,paragraph:{width:[300,300,300],rows:3},active:!0}))):n.a.createElement(n.a.Fragment,null,n.a.createElement(pe,zj({name:"OrganizationSettings.FeatureFlagsSettings.PermissionsControl"},e),n.a.createElement(Mj.a,null,n.a.createElement(Jl.a,{name:"feature_show_permissions_control",checked:t.feature_show_permissions_control,onChange:e=>r({feature_show_permissions_control:e.target.checked})},"Enable experimental multiple owners support"))),n.a.createElement(Mj.a,null,n.a.createElement(Jl.a,{name:"send_email_on_failed_scheduled_queries",checked:t.send_email_on_failed_scheduled_queries,onChange:e=>r({send_email_on_failed_scheduled_queries:e.target.checked})},"Email query owners when scheduled queries fail")),n.a.createElement(Mj.a,null,n.a.createElement(Jl.a,{name:"multi_byte_search_enabled",checked:t.multi_byte_search_enabled,onChange:e=>r({multi_byte_search_enabled:e.target.checked})},"Enable multi-byte (Chinese, Japanese, and Korean) search for query names and descriptions (slower)")))))}function Lj(){return(Lj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Uj(e){return n.a.createElement(pe,Lj({name:"OrganizationSettings.GeneralSettings"},e),n.a.createElement("h3",{className:"m-t-0"},"General"),n.a.createElement("hr",null),n.a.createElement(Tj,e),n.a.createElement(Dj,e),n.a.createElement(Fj,e))}function Vj(){return(Vj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Bj(e){var t=e.settings,r=e.values,a=e.onChange,i=e.loading,s=!$.googleLoginEnabled&&!$.ldapLoginEnabled&&!r.auth_saml_enabled;return n.a.createElement(pe,Vj({name:"OrganizationSettings.PasswordLoginSettings"},e),!i&&!t.auth_password_login_enabled&&n.a.createElement(p.a,{message:"Password based login is currently disabled and users will be able to login only with the enabled SSO options.",type:"warning",className:"m-t-15 m-b-15"}),n.a.createElement(yo.a.Item,{label:"Password Login"},i?n.a.createElement(Rn.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(Jl.a,{checked:r.auth_password_login_enabled,disabled:s,onChange:e=>a({auth_password_login_enabled:e.target.checked})},n.a.createElement(Ne,{title:s?"Password login can be disabled only if another login method is enabled.":null,placement:"right"},"Password Login Enabled"))))}function Qj(){return(Qj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Wj(e){var t=e.values,r=e.onChange;return $.googleLoginEnabled?n.a.createElement(pe,Qj({name:"OrganizationSettings.GoogleLoginSettings"},e),n.a.createElement("h4",null,"Google Login"),n.a.createElement(yo.a.Item,{label:"Allowed Google Apps Domains"},n.a.createElement(Qi.a,{mode:"tags",value:t.auth_google_apps_domains,onChange:e=>r({auth_google_apps_domains:e})}),!Object(c.isEmpty)(t.auth_google_apps_domains)&&n.a.createElement(p.a,{message:n.a.createElement("p",null,"Any user registered with a ",n.a.createElement("strong",null,Object(c.join)(t.auth_google_apps_domains,", "))," Google Apps account will be able to login. If they don't have an existing user, a new user will be created and join the ",n.a.createElement("strong",null,"Default")," group."),className:"m-t-15"}))):null}function Hj(){return(Hj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Gj(e){var t=e.values,r=e.onChange,a=e.loading;return n.a.createElement(pe,Hj({name:"OrganizationSettings.SAMLSettings"},e),n.a.createElement("h4",null,"SAML"),n.a.createElement(yo.a.Item,{label:"SAML Enabled"},a?n.a.createElement(Rn.a,{title:{width:300},paragraph:!1,active:!0}):n.a.createElement(Zd.a.Group,{onChange:e=>{var t={auth_saml_enabled:!!e.target.value};e.target.value&&(t.auth_saml_type=e.target.value),r(t)},value:t.auth_saml_enabled&&(t.auth_saml_type||"dynamic")},n.a.createElement(Zd.a,{value:!1},"Disabled"),n.a.createElement(Zd.a,{value:"static"},"Enabled (Static)"),n.a.createElement(Zd.a,{value:"dynamic"},"Enabled (Dynamic)"))),t.auth_saml_enabled&&n.a.createElement(n.a.Fragment,null,"static"===t.auth_saml_type&&n.a.createElement(n.a.Fragment,null,n.a.createElement(yo.a.Item,{label:"SAML Single Sign-on URL"},n.a.createElement(He.a,{value:t.auth_saml_sso_url,onChange:e=>r({auth_saml_sso_url:e.target.value})})),n.a.createElement(yo.a.Item,{label:"SAML Entity ID"},n.a.createElement(He.a,{value:t.auth_saml_entity_id,onChange:e=>r({auth_saml_entity_id:e.target.value})})),n.a.createElement(yo.a.Item,{label:"SAML x509 cert"},n.a.createElement(He.a,{value:t.auth_saml_x509_cert,onChange:e=>r({auth_saml_x509_cert:e.target.value})}))),"dynamic"===t.auth_saml_type&&n.a.createElement(n.a.Fragment,null,n.a.createElement(yo.a.Item,{label:"SAML Metadata URL"},n.a.createElement(He.a,{value:t.auth_saml_metadata_url,onChange:e=>r({auth_saml_metadata_url:e.target.value})})),n.a.createElement(yo.a.Item,{label:"SAML Entity ID"},n.a.createElement(He.a,{value:t.auth_saml_entity_id,onChange:e=>r({auth_saml_entity_id:e.target.value})})),n.a.createElement(yo.a.Item,{label:"SAML NameID Format"},n.a.createElement(He.a,{value:t.auth_saml_nameid_format,onChange:e=>r({auth_saml_nameid_format:e.target.value})})))))}function Kj(){return(Kj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Yj(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function $j(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Yj(Object(r),!0).forEach((function(t){Jj(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yj(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Jj(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Xj(e){var t=e.values,r=e.onChange,i=Object(a.useCallback)(e=>{var a=$j($j({},t),e);!$.googleLoginEnabled&&!$.ldapLoginEnabled&&!a.auth_saml_enabled&&(e=$j($j({},e),{},{auth_password_login_enabled:!0})),r(e)},[t,r]);return n.a.createElement(pe,Kj({name:"OrganizationSettings.AuthSettings"},e),n.a.createElement("h3",{className:"m-t-0"},"Authentication ",n.a.createElement(Qe,{type:"AUTHENTICATION_OPTIONS"})),n.a.createElement("hr",null),n.a.createElement(Bj,Kj({},e,{onChange:i})),n.a.createElement(Wj,Kj({},e,{onChange:i})),n.a.createElement(Gj,Kj({},e,{onChange:i})))}function Zj(){return(Zj=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function ew(e){var t=_j(e.onError),r=t.settings,a=t.currentValues,i=t.isLoading,s=t.isSaving,o=t.handleSubmit,l=t.handleChange;return n.a.createElement("div",{className:"row","data-test":"OrganizationSettings"},n.a.createElement("div",{className:"m-r-20 m-l-20"},n.a.createElement(yo.a,Zj({},{labelCol:{xs:{span:24},sm:{span:6},lg:{span:4}},wrapperCol:{xs:{span:24},sm:{span:12},lg:{span:10}},layout:"horizontal",className:"ant-form-horizontal--labels-left"},{onFinish:o}),n.a.createElement(Uj,{loading:i,settings:r,values:a,onChange:l}),n.a.createElement(Xj,{loading:i,settings:r,values:a,onChange:l}),n.a.createElement(yo.a.Item,{wrapperCol:{xs:{span:24},sm:{span:12,offset:6},lg:{span:12,offset:4}}},i?n.a.createElement(Rn.a.Button,{active:!0}):n.a.createElement(h.a,{type:"primary",htmlType:"submit",loading:s,"data-test":"OrganizationSettingsSaveButton"},"Save")))))}Fj.propTypes=Aj,Fj.defaultProps=xj,Bj.propTypes=Aj,Bj.defaultProps=xj,Wj.propTypes=Aj,Wj.defaultProps=xj,Gj.propTypes=Aj,Gj.defaultProps=xj,Xj.propTypes=Aj,Xj.defaultProps=xj,ew.propTypes={onError:se.a.func},ew.defaultProps={onError:()=>{}};var tw=Pb("Settings.Organization",{permission:"admin",title:"General",path:"settings/general",order:6},ew);function rw(e){var t=new URL(e,window.location);return t.protocol=window.location.protocol,t.host=window.location.host,t.toString()}function aw(){return(aw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function nw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return iw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return iw(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function iw(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}mn.register("Settings.Organization",Ga({path:"/settings/general",title:"General Settings",render:e=>n.a.createElement(tw,e)}));var sw=[{required:!0,name:"name",title:"Name",type:"text",autoFocus:!0},{required:!0,name:"email",title:"Email",type:"email"}];function ow(e){var t=e.dialog,r=nw(Object(a.useState)(null),2),i=r[0],s=r[1];Object(a.useEffect)(()=>{vt("view","page","users/new")},[]);var o=Object(a.useCallback)(e=>t.close(e).catch(s),[t]),l=qe("userForm");return n.a.createElement(V.a,aw({},t.props,{title:"Create a New User",footer:[n.a.createElement(h.a,aw({key:"cancel"},t.props.cancelButtonProps,{onClick:t.dismiss}),"Cancel"),n.a.createElement(h.a,aw({key:"submit"},t.props.okButtonProps,{htmlType:"submit",type:"primary",form:l,"data-test":"SaveUserButton"}),"Create")],wrapProps:{"data-test":"CreateUserDialog"}}),n.a.createElement(hb,{id:l,fields:sw,onSubmit:o,hideSubmitButton:!0}),i&&n.a.createElement(p.a,{message:i.message,type:"error",showIcon:!0,"data-test":"CreateUserErrorAlert"}))}ow.propTypes={dialog:Je.isRequired};var lw=Xe(ow);function cw(){return(cw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function uw(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dw(e){var t=e.user,r=e.enableUser,a=e.disableUser,i=e.deleteUser;return t.id===Y.id?null:t.is_invitation_pending?n.a.createElement(h.a,{type:"danger",className:"w-100",onClick:e=>i(e,t)},"Delete"):t.is_disabled?n.a.createElement(h.a,{type:"primary",className:"w-100",onClick:e=>r(e,t)},"Enable"):n.a.createElement(h.a,{className:"w-100",onClick:e=>a(e,t)},"Disable")}dw.propTypes={user:se.a.shape({id:se.a.number,is_invitation_pending:se.a.bool,is_disabled:se.a.bool}).isRequired,enableUser:se.a.func.isRequired,disableUser:se.a.func.isRequired,deleteUser:se.a.func.isRequired};class mw extends n.a.Component{constructor(){super(...arguments),uw(this,"sidebarMenu",[{key:"active",href:"users",title:"Active Users"},{key:"pending",href:"users/pending",title:"Pending Invitations"},{key:"disabled",href:"users/disabled",title:"Disabled Users",isAvailable:()=>ae.canCreateUser()}]),uw(this,"listColumns",[yi.custom.sortable((e,t)=>n.a.createElement(qp,{user:t,withLink:!0}),{title:"Name",field:"name",width:null}),yi.custom.sortable((e,t)=>Object(c.map)(t.groups,e=>n.a.createElement(S,{key:"group"+e.id,className:"label label-tag",href:"groups/"+e.id},e.name)),{title:"Groups",field:"groups"}),yi.timeAgo.sortable({title:"Joined",field:"created_at",className:"text-nowrap",width:"1%"}),yi.timeAgo.sortable({title:"Last Active At",field:"active_at",className:"text-nowrap",width:"1%"}),yi.custom((e,t)=>n.a.createElement(dw,{user:t,enableUser:this.enableUser,disableUser:this.disableUser,deleteUser:this.deleteUser}),{width:"1%",isAvailable:()=>ae.canCreateUser()})]),uw(this,"createUser",e=>Fp.create(e).then(e=>{sn.success("Saved."),e.invite_link&&V.a.warning({title:"Email not sent!",content:n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,"The mail server is not configured, please send the following link to ",n.a.createElement("b",null,e.name),":"),n.a.createElement(Xp,{value:rw(e.invite_link),"aria-label":"Invite link",readOnly:!0}))})}).catch(e=>{var t=Object(c.find)([Object(c.get)(e,"response.data.message"),Object(c.get)(e,"message"),"Failed saving."],c.isString);return Promise.reject(new Error(t))})),uw(this,"showCreateUserDialog",()=>{if(ae.isCreateUserEnabled()){var e=()=>{this.props.controller.params.isNewUserPage&&bt("users")};lw.showModal().onClose(t=>this.createUser(t).then(()=>{this.props.controller.update(),e()})).onDismiss(e)}}),uw(this,"enableUser",(e,t)=>Fp.enableUser(t).then(()=>this.props.controller.update())),uw(this,"disableUser",(e,t)=>Fp.disableUser(t).then(()=>this.props.controller.update())),uw(this,"deleteUser",(e,t)=>Fp.deleteUser(t).then(()=>this.props.controller.update()))}componentDidMount(){this.props.controller.params.isNewUserPage&&this.showCreateUserDialog()}renderPageHeader(){return ae.canCreateUser()?n.a.createElement("div",{className:"m-b-15"},n.a.createElement(h.a,{type:"primary",disabled:!ae.isCreateUserEnabled(),onClick:this.showCreateUserDialog},n.a.createElement("i",{className:"fa fa-plus m-r-5","aria-hidden":"true"}),"New User"),n.a.createElement(pe,{name:"UsersListExtra"})):null}render(){var e=this.props.controller;return n.a.createElement(n.a.Fragment,null,this.renderPageHeader(),n.a.createElement(dc,null,n.a.createElement(dc.Sidebar,{className:"m-b-0"},n.a.createElement(Wl,{value:e.searchTerm,onChange:e.updateSearch,label:"Search users"}),n.a.createElement(Hl,{items:this.sidebarMenu,selected:e.params.currentPage})),n.a.createElement(dc.Content,null,!e.isLoaded&&n.a.createElement(Us,{className:""}),e.isLoaded&&e.isEmpty&&n.a.createElement(lh,{className:""}),e.isLoaded&&!e.isEmpty&&n.a.createElement("div",{className:"table-responsive","data-test":"UserList"},n.a.createElement(vi,{items:e.pageItems,columns:this.listColumns,context:this.actions,orderByField:e.orderByField,orderByReverse:e.orderByReverse,toggleSorting:e.toggleSorting}),n.a.createElement(Vi,{showPageSizeSelect:!0,totalCount:e.totalItemsCount,pageSize:e.itemsPerPage,onPageSizeChange:t=>e.updatePagination({itemsPerPage:t}),page:e.page,onChange:t=>e.updatePagination({page:t})})))))}}uw(mw,"propTypes",{controller:bs.isRequired});var pw=Pb("Users.List",{permission:"list_users",title:"Users",path:"users",isActive:e=>e.startsWith("/users")&&"/users/me"!==e,order:2},gs(mw,()=>new Ds({getRequest(e,t){switch(t.params.currentPage){case"active":e.pending=!1;break;case"pending":e.pending=!0;break;case"disabled":e.disabled=!0}return e},getResource:()=>Fp.query.bind(Fp)}),()=>new Fs({orderByField:"created_at",orderByReverse:!0})));mn.register("Users.New",Ga({path:"/users/new",title:"Users",render:e=>n.a.createElement(pw,cw({},e,{currentPage:"active",isNewUserPage:!0}))})),mn.register("Users.List",Ga({path:"/users",title:"Users",render:e=>n.a.createElement(pw,cw({},e,{currentPage:"active"}))})),mn.register("Users.Pending",Ga({path:"/users/pending",title:"Pending Invitations",render:e=>n.a.createElement(pw,cw({},e,{currentPage:"pending"}))})),mn.register("Users.Disabled",Ga({path:"/users/disabled",title:"Disabled Users",render:e=>n.a.createElement(pw,cw({},e,{currentPage:"disabled"}))}));var fw=["groups","linkGroups"];function hw(){return(hw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function bw(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function gw(e){var t=e.groups,r=e.linkGroups,a=bw(e,fw);return n.a.createElement("div",hw({className:"user-groups"},a),Object(c.map)(t,e=>n.a.createElement(Jd.a,{key:e.id},r?n.a.createElement(S,{href:"groups/".concat(e.id)},e.name):e.name)))}function yw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vw(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vw(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Ow(e){var t=yw(Object(a.useState)([]),2),r=t[0],n=t[1],i=yw(Object(a.useState)(!0),2),s=i[0],o=i[1],l=Object(a.useMemo)(()=>Object(c.filter)(r,t=>Object(c.includes)(e.groupIds,t.id)),[r,e]);return Object(a.useEffect)(()=>{Yb.query().then(e=>{n(Object(c.isArray)(e)?e:[]),o(!1)})},[]),Object(a.useMemo)(()=>({groups:l,allGroups:r,isLoading:s}),[l,r,s])}function Ew(){return(Ew=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function jw(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function ww(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jw(Object(r),!0).forEach((function(t){Sw(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jw(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Sw(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pw(e){var t=e.user,r=e.onChange,i=Ow(t),s=i.groups,o=i.allGroups,l=i.isLoading,u=_d(r),d=Object(a.useCallback)((e,r,a)=>{var n=ww(ww({},e),{},{id:t.id});Fp.save(n).then(e=>{r("Saved."),u(Fp.convertUserInfo(e))}).catch(e=>{a(Object(c.get)(e,"response.data.message","Failed saving."))})},[t,u]),m=Object(a.useMemo)(()=>Object(c.map)([{name:"name",title:"Name",type:"text",initialValue:t.name},{name:"email",title:"Email",type:"email",initialValue:t.email},t.isDisabled||Y.id===t.id?{name:"group_ids",title:"Groups",type:"content",required:!1,content:l?"Loading...":n.a.createElement(gw,{"data-test":"Groups",groups:s})}:{name:"group_ids",title:"Groups",type:"select",mode:"multiple",options:Object(c.map)(o,e=>({name:e.name,value:e.id})),initialValue:t.groupIds,loading:l,placeholder:l?"Loading...":""}],e=>ww({readOnly:t.isDisabled,required:!0},e)),[t,s,o,l]);return n.a.createElement(pe,Ew({name:"UserProfile.UserInfoForm"},e),n.a.createElement(hb,{fields:m,onSubmit:d,hideSubmitButton:t.isDisabled}))}function Cw(){return(Cw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Nw(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function kw(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Nw(Object(r),!0).forEach((function(t){_w(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nw(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _w(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Aw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xw(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xw(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function qw(e){var t=e.user,r=e.onChange,i=Aw(Object(a.useState)(!1),2),s=i[0],o=i[1],l=_d(r),c=qe("apiKey"),u=Object(a.useCallback)(()=>{V.a.confirm({title:"Regenerate API Key",content:"Are you sure you want to regenerate?",okText:"Regenerate",onOk:()=>{o(!0),Fp.regenerateApiKey(t).then(e=>{e&&l(kw(kw({},t),{},{apiKey:e}))}).finally(()=>{o(!1)})},maskClosable:!0,autoFocusButton:null})},[t,l]);return n.a.createElement(pe,Cw({name:"UserProfile.ApiKeyForm"},e),n.a.createElement(yo.a,{layout:"vertical"},n.a.createElement("hr",null),n.a.createElement(yo.a.Item,{label:"API Key",className:"m-b-10"},n.a.createElement(Xp,{id:c,className:"hide-in-percy",value:t.apiKey,"data-test":"ApiKey",readOnly:!0})),n.a.createElement(h.a,{className:"w-100",onClick:u,loading:s,"data-test":"RegenerateApiKey"},"Regenerate")))}function Tw(){return(Tw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Iw(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Dw(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Iw(Object(r),!0).forEach((function(t){Rw(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Iw(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Rw(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}gw.propTypes={groups:se.a.arrayOf(se.a.shape({id:se.a.oneOfType([se.a.number,se.a.string]).isRequired,name:se.a.string})),linkGroups:se.a.bool},gw.defaultProps={groups:[],linkGroups:!0},Pw.propTypes={user:Vn.isRequired,onChange:se.a.func},Pw.defaultProps={onChange:()=>{}},qw.propTypes={user:Vn.isRequired,onChange:se.a.func},qw.defaultProps={onChange:()=>{}};class Mw extends n.a.Component{constructor(e){super(e),Rw(this,"fieldError",(e,t)=>0===t.length?"This field is required.":"currentPassword"!==e&&t.length<6?"This field is too short.":"repeatPassword"===e&&t!==this.state.newPassword.value?"Passwords don't match":null),Rw(this,"validateFields",e=>{var t=this.state,r=t.currentPassword,a=t.newPassword,n=t.repeatPassword,i={currentPassword:this.fieldError("currentPassword",r.value),newPassword:this.fieldError("newPassword",a.value),repeatPassword:this.fieldError("repeatPassword",n.value)};this.setState({currentPassword:Dw(Dw({},r),{},{error:i.currentPassword}),newPassword:Dw(Dw({},a),{},{error:i.newPassword}),repeatPassword:Dw(Dw({},n),{},{error:i.repeatPassword})}),Object(c.isFunction)(e)&&e(i.currentPassword||i.newPassword||i.repeatPassword?i:null)}),Rw(this,"updatePassword",()=>{var e=this.state,t=e.currentPassword,r=e.newPassword;e.updatingPassword||this.validateFields(e=>{if(e)this.setState(e=>({currentPassword:Dw(Dw({},e.currentPassword),{},{touched:!0}),newPassword:Dw(Dw({},e.newPassword),{},{touched:!0}),repeatPassword:Dw(Dw({},e.repeatPassword),{},{touched:!0})}));else{var a={id:this.props.user.id,old_password:t.value,password:r.value};this.setState({updatingPassword:!0}),Fp.save(a).then(()=>{sn.success("Saved."),this.props.dialog.close({success:!0})}).catch(e=>{sn.error(Object(c.get)(e,"response.data.message","Failed saving.")),this.setState({updatingPassword:!1})})}})}),Rw(this,"handleChange",e=>{var t=e.target,r=t.name,a=t.value,n=this.state[r].error;this.setState({[r]:{value:a,error:n,touched:!0}},()=>{this.validateFields()})}),this.state={currentPassword:{value:"",error:null,touched:!1},newPassword:{value:"",error:null,touched:!1},repeatPassword:{value:"",error:null,touched:!1},updatingPassword:!1}}render(){var e=this.props.dialog,t=this.state,r=t.currentPassword,a=t.newPassword,i=t.repeatPassword,s=t.updatingPassword,o={className:"m-b-10",required:!0},l={onChange:this.handleChange,onPressEnter:this.updatePassword};return n.a.createElement(V.a,Tw({},e.props,{okButtonProps:{loading:s},onOk:this.updatePassword,title:"Change Password"}),n.a.createElement(yo.a,{layout:"vertical"},n.a.createElement(yo.a.Item,Tw({},o,{validateStatus:r.touched&&r.error?"error":null,help:r.touched?r.error:null,label:"Current Password"}),n.a.createElement(He.a.Password,Tw({},l,{name:"currentPassword","data-test":"CurrentPassword",autoFocus:!0}))),n.a.createElement(yo.a.Item,Tw({},o,{validateStatus:a.touched&&a.error?"error":null,help:a.touched?a.error:null,label:"New Password"}),n.a.createElement(He.a.Password,Tw({},l,{name:"newPassword","data-test":"NewPassword"}))),n.a.createElement(yo.a.Item,Tw({},o,{validateStatus:i.touched&&i.error?"error":null,help:i.touched?i.error:null,label:"Repeat New Password"}),n.a.createElement(He.a.Password,Tw({},l,{name:"repeatPassword","data-test":"RepeatPassword"})))))}}Rw(Mw,"propTypes",{user:Vn.isRequired,dialog:Je.isRequired});var zw=Xe(Mw),Fw=["user","passwordLink"];function Lw(){return(Lw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Uw(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Vw(e){var t=e.user,r=e.passwordLink,a=Uw(e,Fw);return Object(c.isString)(r)?n.a.createElement(pe,Lw({name:"UserProfile.PasswordLinkAlert"},e),n.a.createElement(p.a,Lw({message:"Email not sent!",description:n.a.createElement(n.a.Fragment,null,n.a.createElement("p",null,"The mail server is not configured, please send the following link to ",n.a.createElement("b",null,t.name),":"),n.a.createElement(Xp,{value:rw(r),"aria-label":"Password link",readOnly:!0})),type:"warning",className:"m-t-20",closable:!0},a))):null}function Bw(){return(Bw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Qw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ww(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ww(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ww(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Hw(e){var t=e.user,r=Qw(Object(a.useState)(!1),2),i=r[0],s=r[1],o=Qw(Object(a.useState)(null),2),l=o[0],c=o[1],u=Object(a.useCallback)(()=>{s(!0),Fp.sendPasswordReset(t).then(e=>{c(e)}).finally(()=>{s(!1)})},[t]);return n.a.createElement(pe,Bw({name:"UserProfile.PasswordResetForm"},e),n.a.createElement(h.a,{className:"w-100 m-t-10",onClick:u,loading:i},"Send Password Reset Email"),n.a.createElement(Vw,{user:t,passwordLink:l,afterClose:()=>c(null)}))}function Gw(){return(Gw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Kw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Yw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Yw(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yw(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function $w(e){var t=e.user,r=Kw(Object(a.useState)(!1),2),i=r[0],s=r[1],o=Kw(Object(a.useState)(null),2),l=o[0],c=o[1],u=Object(a.useCallback)(()=>{s(!0),Fp.resendInvitation(t).then(e=>{c(e)}).finally(()=>{s(!1)})},[t]);return n.a.createElement(pe,Gw({name:"UserProfile.ResendInvitationForm"},e),n.a.createElement(h.a,{className:"w-100 m-t-10",onClick:u,loading:i},"Resend Invitation"),n.a.createElement(Vw,{user:t,passwordLink:l,afterClose:()=>c(null)}))}function Jw(){return(Jw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function Xw(e){var t=e.user,r=Object(a.useCallback)(()=>{zw.showModal({user:t})},[t]);return n.a.createElement(pe,Jw({name:"UserProfile.PasswordForm"},e),n.a.createElement("h5",null,"Password"),t.id===Y.id&&n.a.createElement(h.a,{className:"w-100 m-t-10",onClick:r,"data-test":"ChangePassword"},"Change Password"),t.id!==Y.id&&Y.isAdmin&&n.a.createElement(n.a.Fragment,null,t.isInvitationPending?n.a.createElement($w,{user:t}):n.a.createElement(Hw,{user:t})))}function Zw(){return(Zw=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function eS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tS(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function rS(e){var t=e.user,r=e.onChange,i=eS(Object(a.useState)(!1),2),s=i[0],o=i[1],l=_d(r),c=Object(a.useCallback)(()=>{var e=t.isDisabled?Fp.enableUser:Fp.disableUser;o(!0),e(t).then(e=>{e&&l(Fp.convertUserInfo(e))}).finally(()=>{o(!1)})},[t,l]);if(!Y.isAdmin||t.id===Y.id)return null;var u={type:t.isDisabled?"primary":"danger",children:t.isDisabled?"Enable User":"Disable User"};return n.a.createElement(pe,{name:"UserProfile.ToggleUserForm"},n.a.createElement(h.a,Zw({className:"w-100 m-t-10",onClick:c,loading:s},u)))}function aS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return nS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return nS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nS(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function iS(e){var t=aS(Object(a.useState)(e.user),2),r=t[0],i=t[1];return Object(a.useEffect)(()=>{i(e.user)},[e.user]),n.a.createElement("div",{className:"col-md-4 col-md-offset-4"},n.a.createElement("img",{alt:"Profile",src:r.profileImageUrl,className:"profile__image",width:"40"}),n.a.createElement("h3",{className:"profile__h3"},r.name),n.a.createElement("hr",null),n.a.createElement(Pw,{user:r,onChange:i}),!r.isDisabled&&n.a.createElement(n.a.Fragment,null,n.a.createElement(qw,{user:r,onChange:i}),n.a.createElement("hr",null),n.a.createElement(Xw,{user:r})),n.a.createElement("hr",null),n.a.createElement(rS,{user:r,onChange:i}))}function sS(e){var t=e.user,r=Ow(t),a=r.groups,i=r.isLoading;return n.a.createElement("div",{className:"col-md-4 col-md-offset-4 profile__container"},n.a.createElement("img",{alt:"profile",src:t.profileImageUrl,className:"profile__image",width:"40"}),n.a.createElement("h3",{className:"profile__h3"},t.name),n.a.createElement("hr",null),n.a.createElement("dl",{className:"profile__dl"},n.a.createElement("dt",null,"Name:"),n.a.createElement("dd",null,t.name),n.a.createElement("dt",null,"Email:"),n.a.createElement("dd",null,t.email),n.a.createElement("dt",{className:"m-b-5"},"Groups:"),n.a.createElement("dd",null,i?"Loading...":n.a.createElement(gw,{groups:a}))))}function oS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return lS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lS(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function cS(e){var t=e.userId,r=e.onError,i=oS(Object(a.useState)(null),2),s=i[0],o=i[1],l=_d(r);Object(a.useEffect)(()=>{var e=!1;return Fp.get({id:t||Y.id}).then(t=>{e||o(Fp.convertUserInfo(t))}).catch(t=>{e||l(t)}),()=>{e=!0}},[t,l]);var c=s&&(Y.isAdmin||Y.id===s.id);return n.a.createElement(n.a.Fragment,null,n.a.createElement(ol,{featureName:"invite emails",className:"m-b-20",adminOnly:!0}),n.a.createElement("div",{className:"row"},!s&&n.a.createElement(Us,{className:""}),s&&n.a.createElement(pe,{name:"UserProfile",user:s},!c&&n.a.createElement(sS,{user:s}),c&&n.a.createElement(iS,{user:s}))))}Vw.propTypes={user:Vn.isRequired,passwordLink:se.a.string},Vw.defaultProps={passwordLink:null},Hw.propTypes={user:Vn.isRequired},$w.propTypes={user:Vn.isRequired},Xw.propTypes={user:Vn.isRequired},rS.propTypes={user:Vn.isRequired,onChange:se.a.func},rS.defaultProps={onChange:()=>{}},iS.propTypes={user:Vn.isRequired},sS.propTypes={user:Vn.isRequired},cS.propTypes={userId:se.a.string,onError:se.a.func},cS.defaultProps={userId:null,onError:()=>{}};var uS,dS,mS=Pb("Users.Account",{title:"Account",path:"users/me",order:7},cS);function pS(e){for(var t=e.target;t&&"A"!==t.tagName;)t=t.parentNode;if(t&&t.hasAttribute("href")&&!t.hasAttribute("download")&&!t.dataset.skipRouter&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)){var r=t.getAttribute("target");Object(c.isString)(r)&&"_blank"===r.toLowerCase()||(e.preventDefault(),bt(t.href))}}function fS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,o=[],l=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;l=!1}else for(;!(l=(a=i.call(r)).done)&&(o.push(a.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return hS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hS(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function hS(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}mn.register("Users.Account",Ga({path:"/users/me",title:"Account",render:e=>n.a.createElement(mS,e)})),mn.register("Users.ViewOrEdit",Ga({path:"/users/:userId",title:"Users",render:e=>n.a.createElement(mS,e)})),qn.a.setDefaultIndicator(n.a.createElement("span",{role:"status","aria-live":"polite","aria-relevant":"additions removals"},n.a.createElement("i",{className:"fa fa-spinner fa-pulse","aria-hidden":"true"}),n.a.createElement("span",{className:"sr-only"},"Loading..."))),l.a.updateLocale("en",{relativeTime:{future:"%s",past:"%s",s:"just now",m:"a minute ago",mm:"%d minutes ago",h:"an hour ago",hh:"%d hours ago",d:"a day ago",dd:"%d days ago",M:"a month ago",MM:"%d months ago",y:"a year ago",yy:"%d years ago"}}),(uS=r(2634)).keys().forEach(uS),(dS=r(2736)).keys().map(dS).map(e=>e.default).filter(c.isFunction).filter(e=>e.init).map(e=>e());var bS={init(){window.addEventListener("offline",()=>{var e;sn.warning("Please check your Internet connection.",null,{key:"connectionNotification",duration:null}),e="connectionNotification",window.addEventListener("online",(function t(){sn.close(e),window.removeEventListener("online",t)}))})}};s.a.render(n.a.createElement((function(){var e=fS(Object(a.useState)(null),2),t=e[0],r=e[1],i=fS(Object(a.useState)(null),2),s=i[0],o=i[1];return Object(a.useEffect)(()=>{t&&t.title&&(document.title=t.title)},[t]),Object(a.useEffect)(()=>{function e(e){e.preventDefault(),"Uncaught SyntaxError: Unexpected token '<'"===e.message&&console.error("[Uncaught SyntaxError: Unexpected token '<'] usually means that a fallback html file was returned from server rather than the expected script. Check that the server is properly serving the file ".concat(e.filename,".")),o(e.error)}return document.body.addEventListener("click",pS,!1),window.addEventListener("error",e,!1),()=>{document.body.removeEventListener("click",pS,!1),window.removeEventListener("error",e,!1)}},[]),s?n.a.createElement(ot,{error:s}):n.a.createElement(ht,{routes:mn.items,onRouteChange:r})}),null),document.getElementById("application-root"),()=>{bS.init()})},639:function(e){e.exports=JSON.parse('"dev"')},659:function(e,t,r){"use strict";r.r(t),t.default=r.p+"images/avatar.svg"}});
//# sourceMappingURL=app.1738ede2ce452798d81b.js.map